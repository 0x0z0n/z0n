<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Optimized Cybersecurity Blog</title>
  <!-- External CSS -->
  <link rel="stylesheet" href="style.css">
  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* Attack Path Enhancements */
    .attack-path {
      background: #000;
      color: #00ff95;
      font-family: monospace;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,255,150,0.5);
      position: relative;
      white-space: pre-wrap;
    }
    .attack-path button.copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      background: transparent;
      border: none;
      color: #00ff95;
      cursor: pointer;
      font-size: 1rem;
    }
    .attack-step {
      margin: 0.25rem 0;
      cursor: pointer;
    }
    .attack-step.collapsed > .details {
      display: none;
    }

    /* Search Highlight */
    mark {
      background: yellow;
      color: black;
      padding: 0 2px;
    }

    /* Cytoscape modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(6px);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #111;
      padding: 1rem;
      border-radius: 10px;
      width: 80%;
      height: 80%;
      position: relative;
    }
    .modal-content #cy {
      width: 100%;
      height: 100%;
    }
    .modal .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      cursor: pointer;
      color: #fff;
      font-size: 1.5rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="profile">
        <img src="profile.jpg" alt="Profile Picture">
        <h1>XPl0RiZ0n</h1>
        <p>Cybersecurity Researcher & CTF Enthusiast</p>
      </div>
      <nav class="nav-links">
        <a href="#">Home</a>
        <a href="#">Writeups</a>
        <a href="#">Cheatsheets</a>
        <a href="#">About</a>
      </nav>
      <div class="social-links">
        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
        <a href="#" aria-label="GitHub"><i class="fab fa-github"></i></a>
        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
      </div>
      <div class="profile-links">
        <a href="#">HTB</a> | <a href="#">THM</a> | <a href="#">CyberDefenders</a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search posts...">
      </div>
      <div id="posts-container"></div>
    </main>
  </div>

  <!-- Attack Path Graph Modal -->
  <div id="graphModal" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <div id="cy"></div>
    </div>
  </div>

  <footer class="footer">
    <p>Â© 2025 XPl0RiZ0n - All Rights Reserved.</p>
  </footer>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.26.0/cytoscape.min.js"></script>
  <script>
    const postsContainer = document.getElementById('posts-container');
    const searchInput = document.getElementById('searchInput');

    // Load posts
    fetch('data/posts.json')
      .then(res => res.json())
      .then(posts => {
        renderPosts(posts);

        // Search handler
        searchInput.addEventListener('input', e => {
          const query = e.target.value.toLowerCase();
          const filtered = posts.filter(p =>
            p.title.toLowerCase().includes(query) ||
            p.category.toLowerCase().includes(query) ||
            p.tags.some(t => t.toLowerCase().includes(query)) ||
            p.date.toLowerCase().startsWith(query)
          );
          renderPosts(filtered, query);
        });
      });

    // Render posts with highlights
    function renderPosts(posts, query = '') {
      postsContainer.innerHTML = '';
      if (posts.length === 0) {
        postsContainer.innerHTML = `<p>No results for <strong>${query}</strong></p>`;
        return;
      }
      posts.forEach(post => {
        const card = document.createElement('div');
        card.className = 'post-card';

        const title = highlight(post.title, query);
        const category = highlight(post.category, query);

        card.innerHTML = `
          <h2><a href="${post.href}">${title}</a></h2>
          <p class="category">${category}</p>
          <p class="date">${post.date}</p>
          <div class="tags">${post.tags.map(t => `<span>${highlight(t, query)}</span>`).join('')}</div>
        `;

        // Attack path
        if (post.attack_path) {
          const attackDiv = document.createElement('div');
          attackDiv.className = 'attack-path';
          attackDiv.innerHTML = `
            <button class="copy-btn" title="Copy to clipboard"><i class="fa fa-copy"></i></button>
            <pre>${post.attack_path}</pre>
            <button class="graph-btn">View Graph</button>
          `;
          card.appendChild(attackDiv);

          // Copy button
          attackDiv.querySelector('.copy-btn').addEventListener('click', () => {
            navigator.clipboard.writeText(post.attack_path);
            alert('Copied to clipboard');
          });

          // Graph button
          attackDiv.querySelector('.graph-btn').addEventListener('click', () => showGraph(post.attack_path));
        }

        postsContainer.appendChild(card);
      });
    }

    function highlight(text, query) {
      if (!query) return text;
      return text.replace(new RegExp(`(${query})`, 'gi'), '<mark>$1</mark>');
    }

    // Cytoscape Graph
    const modal = document.getElementById('graphModal');
    const closeBtn = modal.querySelector('.close-btn');
    closeBtn.onclick = () => modal.style.display = 'none';

    function showGraph(attackPath) {
      modal.style.display = 'flex';
      const cy = cytoscape({
        container: document.getElementById('cy'),
        elements: parseAttackPath(attackPath),
        style: [
          { selector: 'node', style: { 'background-color': '#00ff95', 'label': 'data(id)' } },
          { selector: 'edge', style: { 'width': 2, 'line-color': '#00d0ff', 'target-arrow-shape': 'triangle', 'target-arrow-color': '#00d0ff' } }
        ],
        layout: { name: 'breadthfirst' }
      });
    }

    function parseAttackPath(path) {
      const steps = path.split('\n').filter(Boolean);
      const nodes = steps.map((s, i) => ({ data: { id: `Step${i+1}` } }));
      const edges = steps.slice(0, -1).map((s, i) => ({ data: { source: `Step${i+1}`, target: `Step${i+2}` } }));
      return { nodes, edges };
    }
  </script>
</body>
</html>
