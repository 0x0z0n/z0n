<!DOCTYPE html>
<html lang="en" data-theme="minimal-dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>0x0z0n — Responsive Blog</title>
    <link rel="icon" href="assets/tab.png" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />

    <style>
      /* ======================================================
         0x0z0n — Modern Responsive Layout (single-file)
         - Responsive grid for left sidebar | main | right panel
         - Fluid posts grid (auto-fit) -> masonry-like
         - Accessible mobile nav, sliding sidebars
         - Theme engine using CSS variables
         ====================================================== */

      :root{
        /* semantic tokens */
        --bg: #0a0a0a;
        --surface: #141414;
        --surface-2: #1c1c1c;
        --text: #dfeee9; /* neutral */
        --muted: #9aa7a3;
        --accent-primary: #ffd84d; /* yellow */
        --accent-secondary: #00ff95; /* green */
        --glass: rgba(255,255,255,0.03);
        --radius: 12px;
        --shadow-1: 0 6px 18px rgba(0,0,0,0.6);
        --glass-border: 1px solid rgba(255,255,255,0.04);
        --transition: 220ms cubic-bezier(.2,.9,.2,1);
        --max-width: 1220px;
      }

      /* light variants (only a couple tokens) */
      html[data-theme*="light"]{
        --bg: #f7f9fb;
        --surface: #ffffff;
        --surface-2: #f3f6f8;
        --text: #0b1220;
        --muted: #5c6b73;
        --glass: rgba(11,18,32,0.03);
      }

      /* -------- Base reset -------- */
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0;
        font-family: 'Inter', 'Orbitron', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        background:linear-gradient(180deg,var(--bg),#060606 120px);
        color:var(--text);
        -webkit-font-smoothing:antialiased;
        -moz-osx-font-smoothing:grayscale;
        display:flex;
        justify-content:center;
        padding:28px 20px;
      }

      /* top-level container */
      .site{
        width:100%;
        max-width:var(--max-width);
        display:grid;
        grid-template-columns: 260px 1fr 300px;
        gap:20px;
        align-items:start;
      }

      /* ---------- SIDEBAR LEFT ---------- */
      aside.sidebar-left{
        background:linear-gradient(180deg,var(--surface),var(--surface-2));
        padding:18px;
        border-radius:var(--radius);
        position:sticky;
        top:24px;
        height:fit-content;
        min-height:120px;
        box-shadow:var(--shadow-1);
        border:var(--glass-border);
      }

      aside.sidebar-left img{width:86px;height:86px;border-radius:999px;display:block;margin:0 auto 10px;border:2px solid var(--accent-secondary)}
      .site-title{font-weight:700;text-align:center;font-size:1.25rem;margin-bottom:4px}
      .site-sub{font-size:0.82rem;color:var(--muted);text-align:center;margin-bottom:12px}
      nav.left-nav a{display:block;padding:10px;border-radius:8px;text-decoration:none;color:var(--text);margin:6px 0;font-weight:600}
      nav.left-nav a:hover{background:var(--glass);transform:translateY(-2px)}

      /* ---------- RIGHT PANEL ---------- */
      .sidebar-right{
        background:linear-gradient(180deg,var(--surface),rgba(255,255,255,0.01));
        padding:18px;border-radius:var(--radius);position:sticky;top:24px;height:fit-content;box-shadow:var(--shadow-1);border:var(--glass-border)
      }

      .sidebar-right h3{margin:0 0 10px;color:var(--accent-primary)}

      /* ---------- MAIN ---------- */
      main{
        background:transparent;padding:6px 0;min-width:0; /* important for collapsing */
      }

      /* Search bar */
      .top-controls{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px}
      .search-box{flex:1;display:flex}
      .search-box input{width:100%;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--surface);color:var(--text);font-weight:600}

      .controls-right{display:flex;gap:8px;align-items:center}
      .theme-toggle, .menu-toggle{background:var(--surface);border-radius:10px;padding:8px;border:var(--glass-border);cursor:pointer}

      /* POSTS grid: fluid, auto-fit columns */
      #posts{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:18px;align-items:start}

      .post-card{
        background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(0,0,0,0.03));padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 26px rgba(0,0,0,0.6);transition:transform var(--transition),box-shadow var(--transition),background var(--transition);
      }
      .post-card:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(0,0,0,0.7);}

      .post-card h2{margin:0 0 8px;font-size:1.05rem;color:var(--accent-primary)}
      .post-meta{font-size:0.82rem;color:var(--muted);margin-bottom:8px}
      .post-excerpt{color:var(--text);opacity:0.9;margin-bottom:10px;line-height:1.45}

      .post-categories{margin-bottom:8px}
      .category-button{display:inline-block;padding:6px 10px;border-radius:999px;background:transparent;border:1px solid rgba(255,255,255,0.03);font-weight:700;font-size:0.78rem;margin-right:6px}

      .post-tags{display:flex;flex-wrap:wrap;gap:6px}
      .tag-link{font-size:0.78rem;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);text-decoration:none;color:var(--muted)}

      /* attack path terminal box */
      .attack-path-terminal{background:linear-gradient(180deg,rgba(0,0,0,0.35),rgba(0,0,0,0.15));padding:10px;border-radius:8px;font-family:monospace;font-size:12px;color:var(--accent-secondary);max-height:280px;overflow:auto}

      /* archive list small */
      .archive-list{font-size:0.85rem;color:var(--muted);max-height:220px;overflow:auto}

      /* Footer */
      footer{margin-top:28px;color:var(--muted);text-align:center}

      /* ---------- Responsive rules ---------- */
      @media (max-width:1200px){
        .site{grid-template-columns:220px 1fr}
        .sidebar-right{display:none}
      }

      @media (max-width:880px){
        body{padding:18px}
        .site{grid-template-columns:1fr;gap:14px}
        aside.sidebar-left{display:none}
        .top-controls{flex-direction:column;align-items:stretch;gap:10px}
        .controls-right{justify-content:flex-end}
        #posts{gap:14px}
      }

      @media (max-width:520px){
        .post-card{padding:12px}
        .post-card h2{font-size:1rem}
        .search-box input{padding:10px}
      }

      /* small utility classes */
      .muted{color:var(--muted)}
      .pill{display:inline-block;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-weight:700;font-size:0.78rem}

      /* hide native scrollbars while keeping functionality on desktop panels */
      .attack-path-terminal::-webkit-scrollbar{height:6px;width:6px}
      .attack-path-terminal::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.06);border-radius:10px}

    </style>
  </head>
  <body>
    <div class="site" id="site">

      <aside class="sidebar-left" aria-label="Main sidebar">
        <img src="assets/avatar.jpeg" alt="avatar">
        <div class="site-title">0x0z0n</div>
        <div class="site-sub">Cyber Security Blog</div>
        <nav class="left-nav" aria-label="Primary">
          <a href="index.html"><i class="fas fa-home"></i>&nbsp; Home</a>
          <a href="posts/Cheatsheet.html"><i class="fas fa-book"></i>&nbsp; Cheatsheet</a>
          <a href="#contact"><i class="fas fa-envelope"></i>&nbsp; Contact</a>
        </nav>

        <div style="margin-top:12px">
          <div style="font-weight:700;color:var(--accent-primary);margin-bottom:6px">Activity</div>
          <div class="archive-list" id="archiveList">Loading…</div>
        </div>
      </aside>

      <main>
        <div class="top-controls">
          <div class="search-box">
            <input id="searchInput" type="search" placeholder="Search posts, tags, categories…" aria-label="Search posts">
          </div>

          <div class="controls-right">
            <button id="themeBtn" class="theme-toggle" title="Toggle theme"><i class="fas fa-circle-half-stroke"></i></button>
            <button id="sidebarToggle" class="menu-toggle" title="Toggle sidebar"><i class="fas fa-bars"></i></button>
          </div>
        </div>

        <section id="posts" aria-live="polite"> <!-- posts injected here -->
        </section>

        <footer>
          <small>&copy; 2025 0x0z0n — Built with care.</small>
        </footer>
      </main>

      <aside class="sidebar-right" aria-label="Right utilities">
        <h3>Categories</h3>
        <div id="categoryList">—</div>

        <h3 style="margin-top:14px">Tags</h3>
        <div id="tagList">—</div>

        <h3 style="margin-top:14px">Quick Links</h3>
        <div><a href="posts/Cheatsheet.html" class="pill">Cheatsheet</a></div>
      </aside>

    </div>


    <script>
      /* ------------- Utility & State -------------- */
      const postsContainer = document.getElementById('posts');
      const searchInput = document.getElementById('searchInput');
      const categoryList = document.getElementById('categoryList');
      const tagList = document.getElementById('tagList');
      const archiveList = document.getElementById('archiveList');

      let allPosts = [];
      let categoriesCount = {};
      let tagsCount = {};
      let archivesGrouped = {};

      const escapeHTML = str => String(str||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

      function buildAttackPathHTML(attack_path){
        if(!attack_path) return '';
        if(!Array.isArray(attack_path)) attack_path=[attack_path];
        return attack_path.map((s,i)=>{
          const user = s.user?`<span class="pill">User: ${escapeHTML(s.user)}</span>`:'';
          const tech = s.technique?`<span class="pill">${escapeHTML(s.technique)}</span>`:'';
          const result = s.result?`<div class="muted" style="margin-top:8px;font-size:0.92rem">${escapeHTML(s.result)}</div>`:'';
          return `<div style="margin-bottom:10px">${user} ${tech}${result}</div>`;
        }).join('');
      }

      function renderPosts(list){
        postsContainer.innerHTML = '';
        if(!list.length){ postsContainer.innerHTML = '<div class="muted">No posts found.</div>'; return; }
        list.forEach(post=>{
          const div = document.createElement('article'); div.className='post-card';
          const cats = (post.category||[]).map(c=>`<span class="category-button">${escapeHTML(c)}</span>`).join(' ');
          const tags = (post.tags||[]).map(t=>`<a class="tag-link" href="#" data-tag="${escapeHTML(t)}">${escapeHTML(t)}</a>`).join(' ');
          const attack = buildAttackPathHTML(post.attack_path);

          div.innerHTML = `\n            <h2><a href="${escapeHTML(post.href||'#')}">${escapeHTML(post.title||'Untitled')}</a></h2>\n            <div class="post-meta">${escapeHTML(post.date||'')}</div>\n            <div class="post-excerpt">${escapeHTML(post.excerpt||'')}</div>\n            <div class="post-categories">${cats}</div>\n            <div class="post-tags">${tags}</div>\n            ${attack?`<div class="attack-path-terminal">${attack}</div>`:''}\n          `;

          postsContainer.appendChild(div);
        });
      }

      function filterPosts(q){
        const query = (q!==undefined? q : searchInput.value).trim().toLowerCase();
        const results = allPosts.filter(p=>{
          const inTitle = (p.title||'').toLowerCase().includes(query);
          const inCat = (p.category||[]).some(c=>c.toLowerCase().includes(query));
          const inTag = (p.tags||[]).some(t=>t.toLowerCase().includes(query));
          const inDate = p.date && p.date.startsWith(query);
          return !query || inTitle||inCat||inTag||inDate;
        });
        renderPosts(results);
      }

      /* --------- Fetch posts.json (single-pass) --------- */
      fetch('data/posts.json').then(r=>r.json()).then(posts=>{
        allPosts = posts || [];
        // build indexes
        categoriesCount = {}; tagsCount = {}; archivesGrouped = {};
        allPosts.forEach(post=>{
          (post.category||[]).forEach(c=> categoriesCount[c] = (categoriesCount[c]||0)+1 );
          (post.tags||[]).forEach(t=> tagsCount[t] = (tagsCount[t]||0)+1 );

          const d = new Date(post.date);
          const monthKey = d.toLocaleDateString('en-GB',{year:'numeric',month:'short'});
          const day = d.toLocaleDateString('en-GB',{day:'2-digit',month:'short'});
          if(!archivesGrouped[monthKey]) archivesGrouped[monthKey]=[];
          archivesGrouped[monthKey].push({...post,formattedDate:day});
        });

        // populate sidebar lists
        categoryList.innerHTML = Object.entries(categoriesCount).map(([k,v])=>`<div style="margin-bottom:6px"><a href="#" class="pill" data-cat="${escapeHTML(k)}">${escapeHTML(k)} (${v})</a></div>`).join('')||'<div class="muted">—</div>';
        tagList.innerHTML = Object.entries(tagsCount).slice(0,40).map(([k,v])=>`<a href="#" class="tag-link" data-tag="${escapeHTML(k)}">${escapeHTML(k)} (${v})</a>`).join(' ')||'<div class="muted">—</div>';

        // archive
        archiveList.innerHTML = Object.entries(archivesGrouped).sort((a,b)=> new Date(b[0]) - new Date(a[0])).map(([m,entries])=>{
          const items = entries.sort((x,y)=> new Date(y.date)-new Date(x.date)).map(e=>`<div style="margin-bottom:6px;font-size:0.9rem"><a href="${escapeHTML(e.href||'#')}">${escapeHTML(e.title)}</a> <span class="muted">${escapeHTML(e.formattedDate)}</span></div>`).join('');
          return `<div style="margin-bottom:10px"><strong style="color:var(--accent-primary)">${escapeHTML(m)}</strong>${items}</div>`;
        }).join('')||'<div class="muted">—</div>';

        // initial render
        renderPosts(allPosts);
      }).catch(err=>{ console.warn('Failed to load data/posts.json',err); postsContainer.innerHTML='<div class="muted">Unable to load posts.json</div>'; });

      /* ------------- UI Controls ------------- */
      // search
      searchInput.addEventListener('input', ()=>filterPosts());

      // delegated clicks for tags & categories
      document.addEventListener('click', e=>{
        const t = e.target;
        if(t.matches('.tag-link') || t.closest('.tag-link')){
          e.preventDefault(); const tag = t.dataset.tag || t.closest('.tag-link').dataset.tag; searchInput.value=tag; filterPosts(tag); return;
        }
        if(t.matches('.category-button') || t.closest('.pill[data-cat]')){
          e.preventDefault(); const cat = t.dataset.cat || (t.closest('[data-cat]') && t.closest('[data-cat]').dataset.cat); if(cat){ searchInput.value=cat; filterPosts(cat);} return;
        }
      });

      // theme toggle (persist)
      const themeBtn = document.getElementById('themeBtn');
      themeBtn.addEventListener('click', ()=>{
        const cur = document.documentElement.getAttribute('data-theme') || 'minimal-dark';
        const next = cur.includes('dark') ? (cur.includes('minimal') ? 'minimal-light' : '0x0z0n-light') : (cur.includes('minimal') ? 'minimal-dark' : '0x0z0n-dark');
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('themeStyle', next);
      });

      // load saved theme
      (function(){ const saved = localStorage.getItem('themeStyle'); if(saved) document.documentElement.setAttribute('data-theme', saved);})();

      // sidebar toggle (mobile)
      const sidebarToggle = document.getElementById('sidebarToggle');
      sidebarToggle.addEventListener('click', ()=>{
        const left = document.querySelector('.sidebar-left');
        if(!left) return;
        const shown = left.style.display !== 'none' && window.getComputedStyle(left).display !== 'none';
        left.style.display = shown ? 'none' : 'block';
        // if showing, smooth scroll to top
        if(!shown) left.scrollIntoView({behavior:'smooth'});
      });

      /* small accessibility: keyboard shortcut to focus search ("/") */
      window.addEventListener('keydown', e=>{ if(e.key === '/') { const active = document.activeElement; if(active && (active.tagName==='INPUT' || active.tagName==='TEXTAREA')) return; e.preventDefault(); searchInput.focus(); }});

    </script>
  </body>
</html>
