<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <title>HackTheBox Gavel | Writeup</title>
  <link rel="icon" type="image/png" href="assets/tab.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link rel="stylesheet" href="../style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <style>
  :root {
    --accent: #4caf50;
    --accent-glow: rgba(76, 175, 80, 0.4);
    --link: #ffeb3b;
    --bg: #0c0c0c;
    --text: #e0e0e0;
    --card: #161616;
    --border: #333;
    --sidebar-w: 280px;
    --term-header: #2d2d2d;
  }

  * { box-sizing: border-box; }
  html { height: 100%; scroll-behavior: smooth; }

  body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: var(--bg);
    color: var(--text);
    display: flex;
    min-height: 100vh;
    overflow: hidden;
  }

  /* === Scroll Progress === */
  #progress-bar {
    position: fixed; top: 0; left: 0; width: 0%; height: 3px;
    background: linear-gradient(90deg, var(--accent), #00ff99);
    z-index: 9999; box-shadow: 0 0 10px var(--accent-glow);
    transition: width 0.1s linear;
  }

  /* === Sidebar === */
  .sidebar {
    width: var(--sidebar-w);
    background: #111;
    border-right: 1px solid var(--border);
    padding: 1.5rem;
    height: 100vh;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    z-index: 100;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .sidebar h2 {
    color: #fff; font-size: 0.9rem; letter-spacing: 1px;
    margin: 0 0 1rem 0; text-transform: uppercase; opacity: 0.7;
  }

  .search-box { position: relative; margin-bottom: 1.5rem; }
  .search-box input {
    width: 100%; background: #1a1a1a; border: 1px solid #333;
    color: #fff; padding: 10px 10px 10px 35px; border-radius: 6px;
    outline: none; font-size: 0.9rem; transition: border-color 0.2s;
  }
  .search-box input:focus { border-color: var(--accent); box-shadow: 0 0 0 2px var(--accent-glow); }
  .search-box i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #666; font-size: 0.8rem; }

  #toc-container { flex: 1; overflow-y: auto; padding-right: 5px; }
  #toc-container::-webkit-scrollbar { width: 4px; }
  #toc-container::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

  .sidebar ul { list-style: none; padding-left: 0; margin: 0; }
  .sidebar li { margin: 2px 0; }
  .sidebar a {
    color: #888; text-decoration: none; display: block;
    padding: 6px 10px; font-size: 0.9rem; border-radius: 4px;
    transition: all 0.2s; border-left: 2px solid transparent;
  }
  .sidebar a:hover { background: rgba(255,255,255,0.05); color: #fff; }
  .sidebar a.active { 
    background: rgba(76, 175, 80, 0.1); color: var(--accent); 
    border-left-color: var(--accent); font-weight: 600; 
  }

  /* === Main Content === */
  main {
    flex: 1; padding: 3rem 5rem;
    overflow-y: auto; height: 100vh;
    position: relative;
  }

  #content {
    max-width: 1000px; margin: 0 auto;
    line-height: 1.8; font-size: 1.05rem;
    padding-bottom: 5rem;
  }

  /* === Typography & Anchors === */
  h1, h2, h3 { color: var(--accent); margin-top: 3rem; position: relative; }
  h1 { font-size: 2.5rem; border-bottom: 1px solid #333; padding-bottom: 1rem; margin-top: 0; }
  
  .anchor-link {
    position: absolute; left: -25px; top: 0;
    color: #444; font-size: 0.8em; opacity: 0;
    transition: opacity 0.2s; text-decoration: none;
    padding: 0 5px; cursor: pointer;
  }
  h1:hover .anchor-link, h2:hover .anchor-link, h3:hover .anchor-link { opacity: 1; }
  .anchor-link:hover { color: var(--accent); }

  /* === Terminal Code Blocks === */
  .terminal-wrapper {
    margin: 2rem 0;
    background: #1e1e1e;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    border: 1px solid #333;
    overflow: hidden;
  }
  
  .terminal-header {
    background: var(--term-header);
    padding: 10px 15px;
    display: flex; align-items: center; justify-content: space-between;
    border-bottom: 1px solid #333;
  }
  
  .terminal-controls { display: flex; gap: 8px; }
  .control { width: 12px; height: 12px; border-radius: 50%; }
  .close { background: #ff5f56; }
  .minimize { background: #ffbd2e; }
  .maximize { background: #27c93f; }
  
  .lang-badge {
    color: #888; font-size: 0.75rem; text-transform: uppercase;
    font-family: 'JetBrains Mono', monospace; letter-spacing: 1px;
    font-weight: bold;
  }

  .copy-btn {
    background: transparent; border: 1px solid #555;
    color: #ccc; padding: 4px 10px; border-radius: 4px;
    font-size: 0.75rem; cursor: pointer; transition: 0.2s;
    display: flex; align-items: center; gap: 6px;
  }
  .copy-btn:hover { background: #444; color: #fff; border-color: #777; }

  pre { margin: 0; padding: 1.5rem; overflow-x: auto; }
  code { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; }

  /* === Admonitions === */
  .admonition {
    border-left: 4px solid; background: #151b23;
    padding: 1rem 1.5rem; margin: 1.5rem 0; border-radius: 0 6px 6px 0;
  }
  .admonition-title { font-weight: bold; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 10px; }
  .note { border-color: #1f6feb; } .note .admonition-title { color: #1f6feb; }
  .warning { border-color: #d29922; } .warning .admonition-title { color: #d29922; }
  .danger { border-color: #f85149; } .danger .admonition-title { color: #f85149; }

  /* === Images === */
  img {
    max-width: 100%; border-radius: 8px; margin: 2rem auto; display: block;
    box-shadow: 0 5px 20px rgba(0,0,0,0.5); cursor: zoom-in;
    transition: transform 0.3s;
  }
  img:hover { transform: scale(1.01); }

  /* === Skeleton Loader === */
  .skeleton { animation: shimmer 2s infinite linear; background: linear-gradient(to right, #1a1a1a 4%, #222 25%, #1a1a1a 36%); background-size: 1000px 100%; }
  .sk-title { height: 40px; margin-bottom: 20px; width: 60%; border-radius: 4px; }
  .sk-line { height: 15px; margin-bottom: 12px; width: 100%; border-radius: 4px; }
  .sk-block { height: 200px; margin: 20px 0; width: 100%; border-radius: 8px; }
  @keyframes shimmer { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }

  /* === Floating UI === */
  .back-to-top {
    position: fixed; bottom: 30px; right: 30px;
    background: var(--accent); color: #000;
    width: 45px; height: 45px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 15px var(--accent-glow);
    cursor: pointer; opacity: 0; transform: translateY(20px);
    transition: all 0.3s; pointer-events: none; z-index: 90;
  }
  .back-to-top.visible { opacity: 1; transform: translateY(0); pointer-events: all; }
  .back-to-top:hover { transform: translateY(-5px); box-shadow: 0 6px 20px var(--accent-glow); }

  /* === Mobile === */
  .mobile-toggle { display: none; }
  @media (max-width: 992px) {
    .sidebar { position: fixed; left: -100%; box-shadow: 10px 0 30px rgba(0,0,0,0.8); }
    .sidebar.active { left: 0; }
    main { padding: 1.5rem; }
    .mobile-toggle {
      display: flex; position: fixed; bottom: 20px; left: 20px;
      width: 50px; height: 50px; background: #222; border: 1px solid #444;
      border-radius: 50%; color: #fff; align-items: center; justify-content: center;
      z-index: 101; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    .overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8); z-index: 99; opacity: 0; pointer-events: none; transition: 0.3s;
    }
    .overlay.active { opacity: 1; pointer-events: all; }
  }

  /* === Print === */
  @media print {
    .sidebar, .mobile-toggle, .back-to-top, #progress-bar, .copy-btn { display: none !important; }
    main { padding: 0; height: auto; overflow: visible; }
    body, main { background: #fff; color: #000; }
    pre, .terminal-wrapper { border: 1px solid #ccc; box-shadow: none; }
    .terminal-header { background: #f0f0f0; border-bottom: 1px solid #ccc; }
    .lang-badge { color: #000; }
    a { text-decoration: underline; color: #000; }
    h1, h2, h3 { color: #000; border-bottom: 1px solid #000; }
  }
  </style>
</head>

<body>
  <div id="progress-bar"></div>
  
  <div class="overlay" onclick="toggleSidebar()"></div>
  <div class="mobile-toggle" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>

  <nav class="sidebar">
    <div class="search-box">
      <i class="fa-solid fa-search"></i>
      <input type="text" id="toc-search" placeholder="Filter..." autocomplete="off">
    </div>
    <h2>Outline</h2>
    <div id="toc-container"><ul id="toc"></ul></div>
    <div style="margin-top:auto; font-size:0.8rem; color:#555; text-align:center; padding-top:20px;">
      &copy; 2025 0x0z0n
    </div>
  </nav>

  <main id="main-scroll">
    <a href="../../index.html" style="color:var(--link);font-weight:bold;text-decoration:none;">‚Üê Return Home</a>
    
    <div id="skeleton-ui" style="margin-top:2rem;">
      <div class="skeleton sk-title"></div>
      <div class="skeleton sk-line"></div>
      <div class="skeleton sk-line" style="width:80%"></div>
      <div class="skeleton sk-block"></div>
      <div class="skeleton sk-line"></div>
      <div class="skeleton sk-line"></div>
    </div>

    <div id="content" style="display:none; opacity:0; transition: opacity 0.5s ease;"></div>
    
    <div class="back-to-top" onclick="document.getElementById('main-scroll').scrollTo(0,0)">
      <i class="fa-solid fa-arrow-up"></i>
    </div>
  </main>

  <div id="lightbox" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);display:flex;justify-content:center;align-items:center;z-index:2000;opacity:0;pointer-events:none;transition:0.3s;">
    <img id="lb-img" style="max-height:90vh;max-width:90vw;box-shadow:0 0 30px var(--accent-glow);">
  </div>

  <script>
  const mdFile = "Gavel.md";
  
  function toggleSidebar() {
    document.querySelector('.sidebar').classList.toggle('active');
    document.querySelector('.overlay').classList.toggle('active');
  }

  fetch(mdFile)
    .then(res => res.text())
    .then(md => {
      // 1. Configure Marked
      marked.setOptions({
        highlight: (code, lang) => {
          const language = highlight.getLanguage(lang) ? lang : 'plaintext';
          return highlight.highlight(code, { language }).value;
        }
      });

      // 2. Parse Markdown
      let html = marked.parse(md);

      // 3. Transform Admonitions
      html = html.replace(/<blockquote>\s*<p>\[!(NOTE|WARNING|DANGER)\]\s*(.*?)<\/p>\s*((.|[\r\n])*?)<\/blockquote>/gim, 
        (match, type, title, body) => {
           const t = type.toLowerCase();
           const icon = t==='note'?'fa-info-circle':t==='warning'?'fa-exclamation-triangle':'fa-skull';
           return `<div class="admonition ${t}"><div class="admonition-title"><i class="fa-solid ${icon}"></i> ${title||type}</div><div>${body}</div></div>`;
        });

      // 4. Inject Content & Remove Skeleton
      const contentDiv = document.getElementById("content");
      contentDiv.innerHTML = html;
      document.getElementById("skeleton-ui").style.display = "none";
      contentDiv.style.display = "block";
      setTimeout(() => contentDiv.style.opacity = 1, 50);

      // 5. Enhance Content (The Magic)
      
      // A. Terminal Windows for Code
      document.querySelectorAll("pre").forEach(pre => {
        const codeClass = pre.querySelector("code").className;
        const lang = codeClass.replace("language-", "").toUpperCase() || "TEXT";
        
        const wrapper = document.createElement("div");
        wrapper.className = "terminal-wrapper";
        
        const header = document.createElement("div");
        header.className = "terminal-header";
        header.innerHTML = `
          <div class="terminal-controls">
            <div class="control close"></div>
            <div class="control minimize"></div>
            <div class="control maximize"></div>
          </div>
          <div class="lang-badge">${lang}</div>
          <button class="copy-btn"><i class="fa-regular fa-copy"></i> Copy</button>
        `;
        
        pre.parentNode.insertBefore(wrapper, pre);
        wrapper.appendChild(header);
        wrapper.appendChild(pre);
        
        // Copy Logic
        const btn = header.querySelector(".copy-btn");
        btn.onclick = () => {
          navigator.clipboard.writeText(pre.innerText);
          btn.innerHTML = '<i class="fa-solid fa-check"></i> Copied';
          setTimeout(() => btn.innerHTML = '<i class="fa-regular fa-copy"></i> Copy', 2000);
        };
      });

      // B. Anchor Links & TOC
      const headings = Array.from(document.querySelectorAll("#content h1, #content h2, #content h3"));
      const toc = document.getElementById("toc");
      const tocStack = [{ level: 0, ul: toc }];

      headings.forEach((h, i) => {
        // ID generation
        const id = h.textContent.trim().toLowerCase().replace(/[^\w]+/g, "-");
        h.id = id;

        // Anchor Link
        const anchor = document.createElement("a");
        anchor.className = "anchor-link";
        anchor.href = `#${id}`;
        anchor.innerHTML = '<i class="fa-solid fa-link"></i>';
        anchor.onclick = (e) => {
            e.preventDefault();
            navigator.clipboard.writeText(window.location.origin + window.location.pathname + `#${id}`);
            // Optional: Show toast
        };
        h.appendChild(anchor);

        // TOC Building
        const level = parseInt(h.tagName.substring(1));
        const li = document.createElement("li");
        li.innerHTML = `<a href="#${id}" data-target="${id}">${h.childNodes[0].textContent}</a>`;
        
        while (tocStack.length > 1 && tocStack[tocStack.length - 1].level >= level) tocStack.pop();
        tocStack[tocStack.length - 1].ul.appendChild(li);
        
        const next = headings[i+1];
        if(next && parseInt(next.tagName.substring(1)) > level) {
          const ul = document.createElement("ul");
          li.appendChild(ul);
          tocStack.push({ level, ul });
        }
      });

      // C. Image Lightbox
      const lb = document.getElementById("lightbox");
      const lbImg = document.getElementById("lb-img");
      document.querySelectorAll("#content img").forEach(img => {
        img.onclick = () => {
          lbImg.src = img.src;
          lb.style.opacity = "1";
          lb.style.pointerEvents = "all";
        };
      });
      lb.onclick = () => {
        lb.style.opacity = "0";
        lb.style.pointerEvents = "none";
      };

      // D. Scroll Logic (Progress + BackToTop + Spy)
      const main = document.getElementById("main-scroll");
      const links = document.querySelectorAll(".sidebar a");
      const backBtn = document.querySelector(".back-to-top");

      main.addEventListener("scroll", () => {
        // Progress
        const percent = (main.scrollTop / (main.scrollHeight - main.clientHeight)) * 100;
        document.getElementById("progress-bar").style.width = percent + "%";
        
        // Back To Top
        if(main.scrollTop > 500) backBtn.classList.add("visible");
        else backBtn.classList.remove("visible");

        // Spy
        let current = "";
        headings.forEach(h => {
          if(h.offsetTop - main.offsetTop <= 150) current = h.id;
        });
        links.forEach(l => {
          l.classList.remove("active");
          if(l.dataset.target === current) {
              l.classList.add("active");
              // Auto-scroll sidebar
              l.scrollIntoView({ behavior: "smooth", block: "nearest" });
          }
        });
      });

      // Search Filter
      document.getElementById("toc-search").addEventListener("input", (e) => {
        const val = e.target.value.toLowerCase();
        document.querySelectorAll("#toc li").forEach(li => {
          const text = li.textContent.toLowerCase();
          li.style.display = text.includes(val) ? "block" : "none";
        });
      });
    });
  </script>
</body>
</html>