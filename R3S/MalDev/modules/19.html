<!DOCTYPE html>
<html class="dark"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie-edge">
        <link rel="stylesheet" href="19_files/template.css">
        <link rel="shortcut icon" href="https://maldevacademy.com/maldev-icon.png">
        <!-- fontawesome for icons -->
        <link rel="stylesheet" href="19_files/font-awesome.min.css">
        <!-- google fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com/">
        <link href="19_files/css2.css" rel="stylesheet">
        <link href="19_files/css2_002.css" rel="stylesheet">
        <title>Payload Encryption - AES Encryption</title>
        <!-- Custom css files, order matters -->
        <link rel="preload" as="style" href="19_files/app.6a881bc1.css"><link rel="stylesheet" href="19_files/app.6a881bc1.css"><link href="19_files/prism-coldark-dark.css" rel="stylesheet">
<link rel="stylesheet" href="19_files/viewer.css">
    <style>.base-arrow-GfAHTK {
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAyCAYAAACtd6CrAAAACXBIWXMAAC4jAAAuIwF4pT92AAAC9ElEQVR4nL2YSWtUQRSFS23nhRsXgmsFE/+AmwRFURQnRMURdSMSp2iCnXQwA3ZMSIKJRMRNHFDEefaXqP/An2Ack/Yc320pz+skPdx44TSv3ynq49Z7r+pWZerr1qwLIdyFVkA3oPYPHz8VwixEBroDrbL/WWjZ2vq6ptkAErZS7p2CJgE84w0k7BZ0Qe43QQUAz3oCCWuFlkNHxTsNTQDY7AXMoCMO2Qlcz4GOiH8OIqjZBcYfAJnBcVzOgw5Km/PwJtCmxQUWATmUzPCAtLsIr4A2rS4wAc6F9kvbFssw6wIz4C90ejgkGe4T+5Jl2OYCi4CHQvIM94idhTeJNjkXWATks3sE7Ra73TLscIEZ8Cc65bN7DO0SO2fPsNMFJsAn0A6xL9uQdrvADPgDne7F5VNou9hdNqQ9LjABPoO2id1tQ5p3gRnwOzrl2/kc2ir2Fcuw1wUmwBfQFrHzlmG/C8yA39ApP4eX0Gax+ww46AIT4Ctok9gDNqRDLjADfkWnO3H5Gtoo9qBlOOwCE+AbaIPY1yzDEReYAcfRKb+/t9D6EkBmOOoCE+A7qDGyuHpchzfuBjPgF3TKD/491CDAq66wmcIVhqyWhmQYG8Ri0dTmBgNoSUjeyEaxCGL9OeYCi0D6JjJYd47yomYYQItDMovoN1YEjRT/1ASLQDp7MFri2aMmGECLQjLz67zIaNV5sWpYBNIZn5EtNeNXBQNoYUhWa13LGLmp1rKKYRFIV2lGx3SrdEUwgBaEpMLS+oPROVP9UTYsAmllxegqp7IqCwbQ/JBUxVozMnrKrRlnhEUgrYYZ+Uqq4WlhANF7GNJ1PqO30jp/SpiBHoT0DobRV80OpiTMQPdDem/G6K92b5aCAcT92L2Q3nUyBmvZdf4Di0C6n2YM1bqf/gsz0O2QPilgDHucFPyBAcTN+lhIn4EwuBbp6U/1MGggpE93GFxd3U53irCTJe7zKND13KoI+wytju7dhNxP5IqwY+E/HW7+BpJoVXj80aQPAAAAAElFTkSuQmCC);
  width: 16px;
  height: 16px;
  position: absolute;
  top: 16px;
  left: 16px;
  cursor: pointer;
  background-size: contain;
  background-repeat: no-repeat;
}
.base-navigation-tab-Ahvn3N {
  width: 24px;
  height: 24px;
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;
}
.base-navigation-label-vUENtU {
  font-family: 'Inter', sans-serif;
  font-size: 13px;
  line-height: 18px;
  color: rgba(0, 0, 0, 0.87);
}
.shoop-de-tooltip-rXf0XP {
  position: relative;
}
.shoop-de-tooltip__text-block-VXptk_ {
  height: 136px;
  background: #e35144;
  position: absolute;
  top: -148px;
  width: 302px;
  padding: 16px;
  border-radius: 8px;
  font-family: 'Inter', sans-serif;
  font-style: normal;
  font-size: 15px;
  line-height: 21px;
  font-weight: normal;
  letter-spacing: -0.24px;
  color: #FFF;
  display: flex;
  align-items: flex-end;
}
.shoop-de-tooltip__polygon-a7JmmB {
  position: absolute;
  width: 15px;
  height: 15px;
  top: -20px;
  left: 17px;
  border-radius: 2px;
  transform: rotate(45deg);
  background: #e35144;
}
</style><style>.shoop-de-serp-beA_vX {
  z-index: 999999999999;
  width: max-content;
  font-size: 15px;
  line-height: 21px;
  font-weight: bold;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  cursor: pointer;
}
.shoop-de-serp-beA_vX:hover .shoop-de-serp__tooltip-jznGdA {
  opacity: 1;
}
.shoop-de-serp__logo-VNEyj1 {
  width: 30px;
  height: 20px;
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yOC42NTg4IDYuNjUwMjFDMjMuODkxIDYuNjUwMjEgMTkuODUyMyA5Ljc3MTY0IDE4LjQ3NDggMTQuMDgyNEMxNi41NjQ4IDEyLjI5OSAxNC4wMDA0IDExLjIwNzUgMTEuMTgxMSAxMS4yMDc1QzUuMjc3NSAxMS4yMDc1IDAuNDkxNzkgMTUuOTkzMiAwLjQ5MTc5IDIxLjg5NjhDMC40OTE3OSAyNy44MDA0IDUuMjc3NSAzMi41ODYxIDExLjE4MTEgMzIuNTg2MUMxNS45NDg5IDMyLjU4NjEgMTkuOTg3NiAyOS40NjQ2IDIxLjM2NTEgMjUuMTUzOEMyMy4yNzUgMjYuOTM3MyAyNS44Mzk0IDI4LjAyODggMjguNjU4OCAyOC4wMjg4QzM0LjU2MjQgMjguMDI4OCAzOS4zNDgxIDIzLjI0MzEgMzkuMzQ4MSAxNy4zMzk1QzM5LjM0ODEgMTEuNDM1OSAzNC41NjI0IDYuNjUwMjEgMjguNjU4OCA2LjY1MDIxWk0yOC42NTg4IDIyLjI5NTJDMjUuOTIxNyAyMi4yOTUyIDIzLjcwMzEgMjAuMDc2NiAyMy43MDMxIDE3LjMzOTVDMjMuNzAzMSAxNC42MDI0IDI1LjkyMTcgMTIuMzgzOCAyOC42NTg4IDEyLjM4MzhDMzEuMzk1OSAxMi4zODM4IDMzLjYxNDUgMTQuNjAyNCAzMy42MTQ1IDE3LjMzOTVDMzMuNjE0NSAyMC4wNzY2IDMxLjM5NTkgMjIuMjk1MiAyOC42NTg4IDIyLjI5NTJaTTExLjE4MTEgMjYuODUyNUM4LjQ0MzkzIDI2Ljg1MjUgNi4yMjUzNiAyNC42MzM5IDYuMjI1MzYgMjEuODk2OEM2LjIyNTM2IDE5LjE1OTYgOC40NDM5MyAxNi45NDExIDExLjE4MTEgMTYuOTQxMUMxMy45MTgyIDE2Ljk0MTEgMTYuMTM2OCAxOS4xNTk2IDE2LjEzNjggMjEuODk2OEMxNi4xMzY4IDI0LjYzMzkgMTMuOTE4MiAyNi44NTI1IDExLjE4MTEgMjYuODUyNVoiIGZpbGw9IiMxRDdCQ0UiLz4KPC9zdmc+Cg==) no-repeat;
  background-size: contain;
}
.shoop-de-serp__premium-ZDFq9y {
  background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTggMC42NjY2NTZDNy4wNjAyNyAwLjY2NjY1NiA2LjI4NTcxIDEuNDU3MzUgNi4yODU3MSAyLjQxNjY2QzYuMjg1NzEgMy4wNzI5MSA2LjY0NzMyIDMuNjQ5NCA3LjE3ODU3IDMuOTQ3OTFMNS41IDcuMzc0OTlMMi44NzUgNS40NjA5M0MzLjIxODc1IDUuMTM5NjQgMy40Mjg1NyA0LjY3NDc5IDMuNDI4NTcgNC4xNjY2NkMzLjQyODU3IDMuMjA3MzUgMi42NTQwMiAyLjQxNjY2IDEuNzE0MjkgMi40MTY2NkMwLjc3NDU1NCAyLjQxNjY2IDAgMy4yMDczNSAwIDQuMTY2NjZDMCA0Ljk1Mjc5IDAuNTI5MDE4IDUuNjA2NzYgMS4yMzIxNCA1LjgyNTUxTDIuMjg1NzEgMTEuNzVWMTQuNjY2N0gxMy43MTQzVjExLjc1TDE0Ljc2NzkgNS44MjU1MUMxNS40NzEgNS42MDY3NiAxNiA0Ljk1Mjc5IDE2IDQuMTY2NjZDMTYgMy4yMDczNSAxNS4yMjU0IDIuNDE2NjYgMTQuMjg1NyAyLjQxNjY2QzEzLjM0NiAyLjQxNjY2IDEyLjU3MTQgMy4yMDczNSAxMi41NzE0IDQuMTY2NjZDMTIuNTcxNCA0LjY3NDc5IDEyLjc4MTMgNS4xMzk2NCAxMy4xMjUgNS40NjA5M0wxMC41IDcuMzc0OTlMOC44MjE0MyAzLjk0NzkxQzkuMzUyNjggMy42NDk0IDkuNzE0MjkgMy4wNzI5MSA5LjcxNDI5IDIuNDE2NjZDOS43MTQyOSAxLjQ1NzM1IDguOTM5NzMgMC42NjY2NTYgOCAwLjY2NjY1NlpNOCAxLjgzMzMyQzguMzIxNDMgMS44MzMzMiA4LjU3MTQzIDIuMDg4NTMgOC41NzE0MyAyLjQxNjY2QzguNTcxNDMgMi43NDQ3OCA4LjMyMTQzIDIuOTk5OTkgOCAyLjk5OTk5QzcuNjc4NTcgMi45OTk5OSA3LjQyODU3IDIuNzQ0NzggNy40Mjg1NyAyLjQxNjY2QzcuNDI4NTcgMi4wODg1MyA3LjY3ODU3IDEuODMzMzIgOCAxLjgzMzMyWk0xLjcxNDI5IDMuNTgzMzJDMi4wMzU3MSAzLjU4MzMyIDIuMjg1NzEgMy44Mzg1MyAyLjI4NTcxIDQuMTY2NjZDMi4yODU3MSA0LjQ5NDc4IDIuMDM1NzEgNC43NDk5OSAxLjcxNDI5IDQuNzQ5OTlDMS4zOTI4NiA0Ljc0OTk5IDEuMTQyODYgNC40OTQ3OCAxLjE0Mjg2IDQuMTY2NjZDMS4xNDI4NiAzLjgzODUzIDEuMzkyODYgMy41ODMzMiAxLjcxNDI5IDMuNTgzMzJaTTE0LjI4NTcgMy41ODMzMkMxNC42MDcxIDMuNTgzMzIgMTQuODU3MSAzLjgzODUzIDE0Ljg1NzEgNC4xNjY2NkMxNC44NTcxIDQuNDk0NzggMTQuNjA3MSA0Ljc0OTk5IDE0LjI4NTcgNC43NDk5OUMxMy45NjQzIDQuNzQ5OTkgMTMuNzE0MyA0LjQ5NDc4IDEzLjcxNDMgNC4xNjY2NkMxMy43MTQzIDMuODM4NTMgMTMuOTY0MyAzLjU4MzMyIDE0LjI4NTcgMy41ODMzMlpNOCA0Ljg5NTgyTDkuNzY3ODYgOC41MDUyTDEwLjYyNSA4LjcyMzk1TDEzLjQ4MjEgNi42NDU4MkwxMi42Nzg2IDExLjE2NjdIMy4zMjE0M0wyLjUxNzg2IDYuNjQ1ODJMNS4zNzUgOC43MjM5NUw2LjIzMjE0IDguNTA1Mkw4IDQuODk1ODJaTTMuNDI4NTcgMTIuMzMzM0gxMi41NzE0VjEzLjVIMy40Mjg1N1YxMi4zMzMzWiIgZmlsbD0iIzYwNDVFMiIvPgo8L3N2Zz4K);
  width: 16px;
  height: 16px;
  margin-right: 10px;
}
.shoop-de-serp__description-pzXVxP {
  color: #1D7BCE;
  font-weight: 600;
}
.shoop-de-serp__container-HDQc_M {
  display: flex;
  width: 100%;
}
</style><meta name="shoop-toolbar" version="3.2.17.2"></head>
    <body>
        <nav id="navbar" class="px-2 sm:px-0 py-2.5 bg-gray-900 sticky hidden">
    <div class="container flex flex-wrap md:flex-nowrap justify-between mx-auto">
      <a data-target="_self" href="https://maldevacademy.com/" class="flex items-center">
        <div class="main-logo flex flex-row items-center block sm:block md:hidden lg:block">
            <img class="w-[150px]" src="19_files/maldev-navbar-logo.svg" alt="Logo">   
        </div>
      </a>
      <button data-collapse-toggle="navbar-default" id="navbar-phone-btn" type="button" class="inline-flex items-center p-2 ml-3 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-default" aria-expanded="false">
        <span class="sr-only">Open main menu</span>
        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
      </button>
      <div class="hidden w-full md:block md:w-auto" id="navbar-default">
        <ul class="flex flex-col items-center p-4 mt-4 bg-gray-50 rounded-lg border border-gray-100 md:flex-row md:space-x-8 md:mt-0 md:text-sm md:font-medium md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
          <li>
            <a data-target="_self" href="https://maldevacademy.com/" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Home</a>
          </li>

          <li>
            <a data-target="_self" href="https://maldevacademy.com/tools" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Public Tools</a>
          </li>

          <li>
            <a data-target="_self" target="_blank" href="https://search.maldevacademy.com/" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Code Database</a>
          </li>

          
                              <div class="group relative">
            <button id="profileNavBar" onclick="toggleProfileDropdown()" class="flex items-center justify-between w-full py-2 pl-3 pr-4 rounded md:border-0 md:p-0 md:w-auto text-gray-400">
              Account
              <svg class="w-2.5 h-2.5 ml-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"></path>
              </svg>
            </button>
            <div id="profileDropdown" class="md:absolute hidden md:left-0 md:font-normal md:bg-white md:divide-y md:divide-gray-100 md:rounded-lg md:shadow md:w-44 md:dark:bg-gray-800 border-[1px] dark:border-gray-700">
              <ul class="py-2 text-sm text-gray-700 dark:text-gray-400">
                <li>
                  <a href="https://maldevacademy.com/profile" class="block px-4 py-2  hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" target="_blank">Profile</a>
                </li>
                <li>
                <form action="https://maldevacademy.com/logout" method="POST" class="">
                </form>
                </li>
              </ul>
            </div>
          </div>
                              <li class="mt-4 md:mt-0">
            <a data-target="_self" href="https://maldevacademy.com/dashboard" class="text-white bg-blue-700 hover:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center md:mr-3 mr-0 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Dashboard</a>
          </li>
                  </ul>
      </div>
    </div>
  </nav>        <div class="fixed bottom-4 right-5 bg-gray-900 text-white text-sm font-bold rounded-xl px-2 py-2 shadow-lg cursor-pointer" onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">
    <img src="19_files/module-up.svg" width="20px" alt="">
</div>


<div class="bg-gray-900 p-4">
    <div class="flex">
        <input type="hidden" value="17077">
        <div class="md:flex-row flex-col flex md:items-center w-1/2 bg-gray-700 border-l border-t border-gray-600 pl-4 pt-2 pb-2 rounded-tl">
            <div>
                Module 19 - Payload Encryption - AES Encryption
            </div>
            <div class="ml-2 w-4 h-4 bg-green-800 rounded-full"></div>
        </div>
        <div class="flex justify-end items-center w-1/2 bg-gray-700 pr-4 pt-2 pb-2 rounded-tr border-t border-r border-gray-600">
            <div class="progress-container pr-4">
                <img src="19_files#.svg" onclick="toggleProgress()" class="hover:bg-gray-600 rounded-sm cursor-pointer" id="progressToggle" width="20px" alt="Progress Toggle">
            </div>
            <div class="enlarge-container pr-4">
                <img src="19_files/enlarge.svg" onclick="toggleScreenWidth()" class="hover:bg-gray-600 rounded-sm cursor-pointer" id="enlargeToggle" width="20px" alt="Screen Width">
            </div>
            <div class="objectives-container pr-4">
                <img src="19_files/objectives.svg" onclick="toggleObjectives()" class="hover:bg-gray-600 cursor-pointer" id="objectivesToggle" width="20px" alt="Objectives">
            </div>
            <div class="terminal-container  pr-4 ">
                <img src="19_files/ide.svg" onclick="toggleIde()" class="hover:bg-gray-600 rounded-sm cursor-pointer" id="terminalToggle" width="22px" alt="Terminal">
            </div>
                                    <div class="dl-container">
                <a href="https://maldevacademy.com/download/file/Aes" target="_blank">
                    <img src="19_files/dl.svg" class="hover:bg-gray-600 rounded-full cursor-pointer" width="20px" alt="Download">
                </a>
            </div>
                                </div>
    </div>
    <div id="height-container" class="flex h-full min-h-[800px]">
        <div class="flex max-w-full min-w-full">
            <div id="description-container" class="viewer code-description h-full bg-gray-800 p-4 border-r border-l border-b border-gray-600 px-5 md:px-10 lg:px-20 w-full"><div class="toastui-editor-contents" style="overflow-wrap: break-word;">
                
                            
                <h2>Payload Encryption - AES Encryption</h2>
<h3>Advanced Encryption Standard</h3>
<p>This module discusses a more secure encryption algorithm, Advanced 
Encryption Standard (AES). It is a symmetric-key algorithm, meaning the 
same key is used for both encryption and decryption. There are several 
types of AES encryption such as AES128, AES192, and AES256 that vary by 
the key size. For example, AES128 uses a 128-bit key whereas AES256 uses
 a 256-bit key.</p>
<p>Additionally, AES can use different <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation" target="_blank">block cipher modes of operation</a>
 such as CBC and GCM. Depending on the AES mode, the AES algorithm will 
require an additional component along with the encryption key called an <a href="https://en.wikipedia.org/wiki/Initialization_vector" target="_blank">Initialization Vector</a> or IV. Providing an IV provides an additional layer of security to the encryption process.</p>
<p>Regardless of the chosen AES type, AES always requires a 128-bit 
input and produces a 128-bit output blocks. The important thing to keep 
in mind is that the input data should be multiples of 16 bytes (128 
bits). If the payload being encrypted is not a multiple of 16 bytes then
 padding is required to increase the size of the payload and make it a 
multiple of 16 bytes.</p>
<p>The module provides 2 code samples that use AES256-CBC. The first 
sample is achieved through the bCrypt library which utilizes WinAPIs and
 the second sample uses <a href="https://github.com/kokke/tiny-AES-c" target="_blank">Tiny Aes Project</a>.
 Note that since the AES256-CBC is being used, the code uses a 32-byte 
key and a 16-byte IV. Again, this would vary if the code used a 
different AES type or mode.</p>
<h3>AES Using WinAPIs (bCrypt Library)</h3>
<p>There are several ways to implement the AES encryption algorithm. This section utilizes the bCrypt library (<a href="https://learn.microsoft.com/en-us/windows/win32/api/bcrypt/" target="_blank">bcrypt.h</a>)
 to perform AES encryption. This section will explain the code which is 
available for download as usual at the top right of the module box.</p>
<h4>AES Structure</h4>
<p>To start, an <code>AES</code> structure is created which contains the required data to perform encryption and decryption.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_AES</span> <span class="token punctuation">{</span>

	PBYTE	pPlainText<span class="token punctuation">;</span>         <span class="token comment">// base address of the plain text data </span>
	DWORD	dwPlainSize<span class="token punctuation">;</span>        <span class="token comment">// size of the plain text data</span>

	PBYTE	pCipherText<span class="token punctuation">;</span>        <span class="token comment">// base address of the encrypted data	</span>
	DWORD	dwCipherSize<span class="token punctuation">;</span>       <span class="token comment">// size of it (this can change from dwPlainSize in case there was padding)</span>

	PBYTE	pKey<span class="token punctuation">;</span>               <span class="token comment">// the 32 byte key</span>
	PBYTE	pIv<span class="token punctuation">;</span>                <span class="token comment">// the 16 byte iv</span>

<span class="token punctuation">}</span> AES<span class="token punctuation">,</span> <span class="token operator">*</span>PAES<span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4>SimpleEncryption Wrapper</h4>
<p>The <code>SimpleEncryption</code> function has six parameters that are used to initialize the <code>AES</code> structure. Once the structure is initialized, the function will call <code>InstallAesEncryption</code> to perform the AES encryption process. Note that two of its parameters are <code>OUT</code> parameters, therefore the function returns the following:</p>
<ul>
<li>
<p><code>pCipherTextData</code> - A pointer to the newly allocated heap buffer which contains the ciphertext data.</p>
</li>
<li>
<p><code>sCipherTextSize</code> - The size of the ciphertext buffer.</p>
</li>
</ul>
<p>The function returns <code>TRUE</code> if the <code>InstallAesEncryption</code> succeeds, otherwise <code>FALSE</code>.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// Wrapper function for InstallAesEncryption that makes things easier</span>
BOOL <span class="token function">SimpleEncryption</span><span class="token punctuation">(</span>IN PVOID pPlainTextData<span class="token punctuation">,</span> IN DWORD sPlainTextSize<span class="token punctuation">,</span> IN PBYTE pKey<span class="token punctuation">,</span> IN PBYTE pIv<span class="token punctuation">,</span> OUT PVOID<span class="token operator">*</span> pCipherTextData<span class="token punctuation">,</span> OUT DWORD<span class="token operator">*</span> sCipherTextSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>pPlainTextData <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> sPlainTextSize <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> pKey <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> pIv <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	
	<span class="token comment">// Intializing the struct</span>
	AES Aes <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token punctuation">.</span>pKey        <span class="token operator">=</span> pKey<span class="token punctuation">,</span>
		<span class="token punctuation">.</span>pIv         <span class="token operator">=</span> pIv<span class="token punctuation">,</span>
		<span class="token punctuation">.</span>pPlainText  <span class="token operator">=</span> pPlainTextData<span class="token punctuation">,</span>
		<span class="token punctuation">.</span>dwPlainSize <span class="token operator">=</span> sPlainTextSize
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">InstallAesEncryption</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Aes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Saving output</span>
	<span class="token operator">*</span>pCipherTextData <span class="token operator">=</span> Aes<span class="token punctuation">.</span>pCipherText<span class="token punctuation">;</span>
	<span class="token operator">*</span>sCipherTextSize <span class="token operator">=</span> Aes<span class="token punctuation">.</span>dwCipherSize<span class="token punctuation">;</span>

	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4>SimpleDecryption Wrapper</h4>
<p>The <code>SimpleDecryption</code> function also has six parameters and behaves similarly to <code>SimpleEncryption</code> with the difference being that it calls the <code>InstallAesDecryption</code> function and it returns two different values.</p>
<ul>
<li>
<p><code>pPlainTextData</code> - A pointer to the newly allocated heap buffer which contains the plaintext data.</p>
</li>
<li>
<p><code>sPlainTextSize</code> - The size of the plaintext buffer.</p>
</li>
</ul>
<p>The function returns <code>TRUE</code> if the <code>InstallAesDecryption</code> succeeds, otherwise <code>FALSE</code>.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// Wrapper function for InstallAesDecryption that make things easier</span>
BOOL <span class="token function">SimpleDecryption</span><span class="token punctuation">(</span>IN PVOID pCipherTextData<span class="token punctuation">,</span> IN DWORD sCipherTextSize<span class="token punctuation">,</span> IN PBYTE pKey<span class="token punctuation">,</span> IN PBYTE pIv<span class="token punctuation">,</span> OUT PVOID<span class="token operator">*</span> pPlainTextData<span class="token punctuation">,</span> OUT DWORD<span class="token operator">*</span> sPlainTextSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>pCipherTextData <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> sCipherTextSize <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> pKey <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> pIv <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

	<span class="token comment">// Intializing the struct</span>
	AES Aes <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token punctuation">.</span>pKey          <span class="token operator">=</span> pKey<span class="token punctuation">,</span>
		<span class="token punctuation">.</span>pIv           <span class="token operator">=</span> pIv<span class="token punctuation">,</span>
		<span class="token punctuation">.</span>pCipherText   <span class="token operator">=</span> pCipherTextData<span class="token punctuation">,</span>
		<span class="token punctuation">.</span>dwCipherSize  <span class="token operator">=</span> sCipherTextSize
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">InstallAesDecryption</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Aes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Saving output</span>
	<span class="token operator">*</span>pPlainTextData <span class="token operator">=</span> Aes<span class="token punctuation">.</span>pPlainText<span class="token punctuation">;</span>
	<span class="token operator">*</span>sPlainTextSize <span class="token operator">=</span> Aes<span class="token punctuation">.</span>dwPlainSize<span class="token punctuation">;</span>

	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4>Cryptographic Next Generation</h4>
<p>Cryptographic Next Generation (CNG) provides a set of cryptographic 
functions that can be used by applications of the OS. CNG provides a 
standardized interface for cryptographic operations, making it easier 
for developers to implement security features in their applications. 
Both <code>InstallAesEncryption</code> and <code>InstallAesDecryption</code> functions make use of CNG.</p>
<p>More information about CNG is available <a href="https://learn.microsoft.com/en-us/windows/win32/seccng/cng-portal" target="_blank">here</a>.</p>
<h4>InstallAesEncryption Function</h4>
<p>The <code>InstallAesEncryption</code> is the function that performs AES encryption. The function has one parameter, <code>PAES</code>, which is a pointer to a populated <code>AES</code> structure. The bCrypt library functions used in the function are shown below.</p>
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptopenalgorithmprovider" target="_blank">BCryptOpenAlgorithmProvider</a> - Used to load the <a href="https://learn.microsoft.com/en-us/windows/win32/seccng/cng-algorithm-identifiers" target="_blank">BCRYPT_AES_ALGORITHM</a> Cryptographic Next Generation (CNG) provider to enable the use of cryptographic functions.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptgetproperty" target="_blank">BCryptGetProperty</a> - This function is called twice, the first time to retrieve the value of <a href="https://learn.microsoft.com/en-us/windows/win32/seccng/cng-property-identifiers" target="_blank">BCRYPT_OBJECT_LENGTH</a> and the second time to fetch the value of <a href="https://learn.microsoft.com/en-us/windows/win32/seccng/cng-property-identifiers" target="_blank">BCRYPT_BLOCK_LENGTH</a> property identifiers.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptsetproperty" target="_blank">BCryptSetProperty</a> - Used to initialize the <code>BCRYPT_OBJECT_LENGTH</code> property identifier.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey" target="_blank">BCryptGenerateSymmetricKey</a> - Used to create a key object from the input AES key specified.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptencrypt" target="_blank">BCryptEncrypt</a>
 - Used to encrypt a specified block of data. This function is called 
twice, the first time retrieves the size of the encrypted data to 
allocate a heap buffer of that size. The second call encrypts the data 
and stores the ciphertext in the allocated heap.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptdestroykey" target="_blank">BCryptDestroyKey</a> - Used to clean up by destroying the key object created using <code>BCryptGenerateSymmetricKey</code>.</p>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptclosealgorithmprovider" target="_blank">BCryptCloseAlgorithmProvider</a> - Used to clean up by closing the object handle of the algorithm provider created earlier using <code>BCryptOpenAlgorithmProvider</code>.</p>
</li>
</ul>
<p>The function returns <code>TRUE</code> if it successfully encrypts the payload, otherwise <code>FALSE</code>.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// The encryption implementation</span>
BOOL <span class="token function">InstallAesEncryption</span><span class="token punctuation">(</span>PAES pAes<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  BOOL                  bSTATE           <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
  BCRYPT_ALG_HANDLE     hAlgorithm       <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  BCRYPT_KEY_HANDLE     hKeyHandle       <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

  ULONG       		cbResult         <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  DWORD       		dwBlockSize      <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  
  DWORD       		cbKeyObject      <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  PBYTE       		pbKeyObject      <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

  PBYTE      		pbCipherText     <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  DWORD       		cbCipherText     <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  NTSTATUS           STATUS           <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

  <span class="token comment">// Intializing "hAlgorithm" as AES algorithm Handle</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptOpenAlgorithmProvider</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hAlgorithm<span class="token punctuation">,</span> BCRYPT_AES_ALGORITHM<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptOpenAlgorithmProvider Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Getting the size of the key object variable pbKeyObject. This is used by the BCryptGenerateSymmetricKey function later </span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptGetProperty</span><span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">,</span> BCRYPT_OBJECT_LENGTH<span class="token punctuation">,</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span><span class="token operator">&amp;</span>cbKeyObject<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cbResult<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptGetProperty[1] Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Getting the size of the block used in the encryption. Since this is AES it must be 16 bytes.</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptGetProperty</span><span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">,</span> BCRYPT_BLOCK_LENGTH<span class="token punctuation">,</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span><span class="token operator">&amp;</span>dwBlockSize<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cbResult<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptGetProperty[2] Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Checking if block size is 16 bytes</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>dwBlockSize <span class="token operator">!=</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Allocating memory for the key object </span>
  pbKeyObject <span class="token operator">=</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cbKeyObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pbKeyObject <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Setting Block Cipher Mode to CBC. This uses a 32 byte key and a 16 byte IV.</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptSetProperty</span><span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">,</span> BCRYPT_CHAINING_MODE<span class="token punctuation">,</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>BCRYPT_CHAIN_MODE_CBC<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>BCRYPT_CHAIN_MODE_CBC<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptSetProperty Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Generating the key object from the AES key "pAes-&gt;pKey". The output will be saved in pbKeyObject and will be of size cbKeyObject </span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptGenerateSymmetricKey</span><span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hKeyHandle<span class="token punctuation">,</span> pbKeyObject<span class="token punctuation">,</span> cbKeyObject<span class="token punctuation">,</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pAes<span class="token operator">-&gt;</span>pKey<span class="token punctuation">,</span> KEYSIZE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptGenerateSymmetricKey Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Running BCryptEncrypt first time with NULL output parameters to retrieve the size of the output buffer which is saved in cbCipherText</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptEncrypt</span><span class="token punctuation">(</span>hKeyHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span>PUCHAR<span class="token punctuation">)</span>pAes<span class="token operator">-&gt;</span>pPlainText<span class="token punctuation">,</span> <span class="token punctuation">(</span>ULONG<span class="token punctuation">)</span>pAes<span class="token operator">-&gt;</span>dwPlainSize<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> pAes<span class="token operator">-&gt;</span>pIv<span class="token punctuation">,</span> IVSIZE<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cbCipherText<span class="token punctuation">,</span> BCRYPT_BLOCK_PADDING<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptEncrypt[1] Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Allocating enough memory for the output buffer, cbCipherText</span>
  pbCipherText <span class="token operator">=</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cbCipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pbCipherText <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Running BCryptEncrypt again with pbCipherText as the output buffer</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptEncrypt</span><span class="token punctuation">(</span>hKeyHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span>PUCHAR<span class="token punctuation">)</span>pAes<span class="token operator">-&gt;</span>pPlainText<span class="token punctuation">,</span> <span class="token punctuation">(</span>ULONG<span class="token punctuation">)</span>pAes<span class="token operator">-&gt;</span>dwPlainSize<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> pAes<span class="token operator">-&gt;</span>pIv<span class="token punctuation">,</span> IVSIZE<span class="token punctuation">,</span> pbCipherText<span class="token punctuation">,</span> cbCipherText<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cbResult<span class="token punctuation">,</span> BCRYPT_BLOCK_PADDING<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptEncrypt[2] Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>


  <span class="token comment">// Clean up</span>
_EndOfFunc<span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hKeyHandle<span class="token punctuation">)</span> 
    	<span class="token function">BCryptDestroyKey</span><span class="token punctuation">(</span>hKeyHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">)</span> 
    	<span class="token function">BCryptCloseAlgorithmProvider</span><span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pbKeyObject<span class="token punctuation">)</span> 
    	<span class="token function">HeapFree</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pbKeyObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pbCipherText <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> bSTATE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// If everything worked, save pbCipherText and cbCipherText </span>
        pAes<span class="token operator">-&gt;</span>pCipherText 	<span class="token operator">=</span> pbCipherText<span class="token punctuation">;</span>
        pAes<span class="token operator">-&gt;</span>dwCipherSize 	<span class="token operator">=</span> cbCipherText<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> bSTATE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4>InstallAesDecryption Function</h4>
<p>The <code>InstallAesDecryption</code> is the function that performs AES decryption. The function has one parameter, <code>PAES</code>, which is a pointer to a populated <code>AES</code> structure. The bCrypt library functions used in the function are the same as in the <code>InstallAesEncryption</code> function above, with the only difference being that <code>BCryptDecrypt</code> is used instead of <code>BCryptEncrypt</code>.</p>
<ul>
<li>
<a href="https://learn.microsoft.com/en-us/windows/win32/api/bcrypt/nf-bcrypt-bcryptdecrypt" target="_blank">BCryptDecrypt</a>
 - Used to decrypt a specified block of data. This function is called 
twice, the first time retrieves the size of the decrypted data to 
allocate a heap buffer of that size. The second call decrypts the data 
and stores the plaintext data in the allocated heap.</li>
</ul>
<p>The function returns <code>TRUE</code> if it successfully decrypts the payload, otherwise <code>FALSE</code>.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// The decryption implementation</span>
BOOL <span class="token function">InstallAesDecryption</span><span class="token punctuation">(</span>PAES pAes<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  BOOL                  bSTATE          <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
  BCRYPT_ALG_HANDLE     hAlgorithm      <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  BCRYPT_KEY_HANDLE     hKeyHandle      <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

  ULONG                 cbResult        <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  DWORD                 dwBlockSize     <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  
  DWORD                 cbKeyObject     <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  PBYTE                 pbKeyObject     <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

  PBYTE                 pbPlainText     <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  DWORD                 cbPlainText     <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  NTSTATUS              STATUS          <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

  <span class="token comment">// Intializing "hAlgorithm" as AES algorithm Handle</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptOpenAlgorithmProvider</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hAlgorithm<span class="token punctuation">,</span> BCRYPT_AES_ALGORITHM<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptOpenAlgorithmProvider Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Getting the size of the key object variable pbKeyObject. This is used by the BCryptGenerateSymmetricKey function later</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptGetProperty</span><span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">,</span> BCRYPT_OBJECT_LENGTH<span class="token punctuation">,</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span><span class="token operator">&amp;</span>cbKeyObject<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cbResult<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptGetProperty[1] Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Getting the size of the block used in the encryption. Since this is AES it should be 16 bytes.</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptGetProperty</span><span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">,</span> BCRYPT_BLOCK_LENGTH<span class="token punctuation">,</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span><span class="token operator">&amp;</span>dwBlockSize<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cbResult<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptGetProperty[2] Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Checking if block size is 16 bytes</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>dwBlockSize <span class="token operator">!=</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Allocating memory for the key object </span>
  pbKeyObject <span class="token operator">=</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cbKeyObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pbKeyObject <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Setting Block Cipher Mode to CBC. This uses a 32 byte key and a 16 byte IV.</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptSetProperty</span><span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">,</span> BCRYPT_CHAINING_MODE<span class="token punctuation">,</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>BCRYPT_CHAIN_MODE_CBC<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>BCRYPT_CHAIN_MODE_CBC<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptSetProperty Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Generating the key object from the AES key "pAes-&gt;pKey". The output will be saved in pbKeyObject of size cbKeyObject </span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptGenerateSymmetricKey</span><span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hKeyHandle<span class="token punctuation">,</span> pbKeyObject<span class="token punctuation">,</span> cbKeyObject<span class="token punctuation">,</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pAes<span class="token operator">-&gt;</span>pKey<span class="token punctuation">,</span> KEYSIZE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptGenerateSymmetricKey Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Running BCryptDecrypt first time with NULL output parameters to retrieve the size of the output buffer which is saved in cbPlainText</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptDecrypt</span><span class="token punctuation">(</span>hKeyHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span>PUCHAR<span class="token punctuation">)</span>pAes<span class="token operator">-&gt;</span>pCipherText<span class="token punctuation">,</span> <span class="token punctuation">(</span>ULONG<span class="token punctuation">)</span>pAes<span class="token operator">-&gt;</span>dwCipherSize<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> pAes<span class="token operator">-&gt;</span>pIv<span class="token punctuation">,</span> IVSIZE<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>cbPlainText<span class="token punctuation">,</span> BCRYPT_BLOCK_PADDING<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptDecrypt[1] Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Allocating enough memory for the output buffer, cbPlainText</span>
  pbPlainText <span class="token operator">=</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> cbPlainText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pbPlainText <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// Running BCryptDecrypt again with pbPlainText as the output buffer</span>
  STATUS <span class="token operator">=</span> <span class="token function">BCryptDecrypt</span><span class="token punctuation">(</span>hKeyHandle<span class="token punctuation">,</span> <span class="token punctuation">(</span>PUCHAR<span class="token punctuation">)</span>pAes<span class="token operator">-&gt;</span>pCipherText<span class="token punctuation">,</span> <span class="token punctuation">(</span>ULONG<span class="token punctuation">)</span>pAes<span class="token operator">-&gt;</span>dwCipherSize<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> pAes<span class="token operator">-&gt;</span>pIv<span class="token punctuation">,</span> IVSIZE<span class="token punctuation">,</span> pbPlainText<span class="token punctuation">,</span> cbPlainText<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cbResult<span class="token punctuation">,</span> BCRYPT_BLOCK_PADDING<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">NT_SUCCESS</span><span class="token punctuation">(</span>STATUS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] BCryptDecrypt[2] Failed With Error: 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    	bSTATE <span class="token operator">=</span> FALSE<span class="token punctuation">;</span> <span class="token keyword">goto</span> _EndOfFunc<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Clean up</span>
_EndOfFunc<span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hKeyHandle<span class="token punctuation">)</span>
    	<span class="token function">BCryptDestroyKey</span><span class="token punctuation">(</span>hKeyHandle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">)</span>
    	<span class="token function">BCryptCloseAlgorithmProvider</span><span class="token punctuation">(</span>hAlgorithm<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pbKeyObject<span class="token punctuation">)</span>
    	<span class="token function">HeapFree</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pbKeyObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pbPlainText <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> bSTATE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// if everything went well, we save pbPlainText and cbPlainText</span>
        pAes<span class="token operator">-&gt;</span>pPlainText   <span class="token operator">=</span> pbPlainText<span class="token punctuation">;</span>
        pAes<span class="token operator">-&gt;</span>dwPlainSize  <span class="token operator">=</span> cbPlainText<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> bSTATE<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4>Additional Helper Functions</h4>
<p>The code also includes two small helper functions as well, <code>PrintHexData</code> and <code>GenerateRandomBytes</code>.</p>
<p>The first function, <code>PrintHexData</code>, prints an input buffer as a char array in C syntax to the console.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// Print the input buffer as a hex char array</span>
VOID <span class="token function">PrintHexData</span><span class="token punctuation">(</span>LPCSTR Name<span class="token punctuation">,</span> PBYTE Data<span class="token punctuation">,</span> SIZE_T Size<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"unsigned char %s[] = {"</span><span class="token punctuation">,</span> Name<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">16</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
      	    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\t"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> Size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"0x%0.2X, "</span><span class="token punctuation">,</span> Data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"0x%0.2X "</span><span class="token punctuation">,</span> Data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"};\n\n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>The other function, <code>GenerateRandomBytes</code>, fills up an input buffer with random bytes which in this case is used to generate a random key and IV.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// Generate random bytes of size sSize</span>
VOID <span class="token function">GenerateRandomBytes</span><span class="token punctuation">(</span>PBYTE pByte<span class="token punctuation">,</span> SIZE_T sSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> sSize<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	pByte<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>BYTE<span class="token punctuation">)</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4>Padding</h4>
<p>Both <code>InstallAesEncryption</code> and <code>InstallAesDecryption</code> functions use the <code>BCRYPT_BLOCK_PADDING</code> flag with the <code>BCryptEncrypt</code> and <code>BCryptDecrypt</code>
 bcrypt functions respectively, which will automatically pad the input 
buffer, if required, to be a multiple of 16 bytes, solving the AES 
padding issue.</p>
<h4>Main Function - Encryption</h4>
<p>The main function below is used to perform the encryption routine on an array of plaintext data.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// The plaintext, in hex format, that will be encrypted</span>
<span class="token comment">// this is the following string in hex "This is a plain text string, we'll try to encrypt/decrypt !"</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token number">0x54</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span>
	<span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x78</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span>
	<span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x2C</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x77</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span>
	<span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x6F</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x63</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span>
	<span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x2F</span><span class="token punctuation">,</span> <span class="token number">0x64</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x63</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x21</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	BYTE pKey <span class="token punctuation">[</span>KEYSIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token comment">// KEYSIZE is 32 bytes</span>
	BYTE pIv <span class="token punctuation">[</span>IVSIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>                      <span class="token comment">// IVSIZE is 16 bytes</span>

	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// The seed to generate the key. This is used to further randomize the key.</span>
	<span class="token function">GenerateRandomBytes</span><span class="token punctuation">(</span>pKey<span class="token punctuation">,</span> KEYSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// Generating a key with the helper function</span>
	
	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">^</span> pKey<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// The seed to generate the IV. Use the first byte of the key to add more randomness.</span>
	<span class="token function">GenerateRandomBytes</span><span class="token punctuation">(</span>pIv<span class="token punctuation">,</span> IVSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// Generating the IV with the helper function</span>

	<span class="token comment">// Printing both key and IV onto the console </span>
	<span class="token function">PrintHexData</span><span class="token punctuation">(</span><span class="token string">"pKey"</span><span class="token punctuation">,</span> pKey<span class="token punctuation">,</span> KEYSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">PrintHexData</span><span class="token punctuation">(</span><span class="token string">"pIv"</span><span class="token punctuation">,</span> pIv<span class="token punctuation">,</span> IVSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Defining two variables the output buffer and its respective size which will be used in SimpleEncryption</span>
	PVOID pCipherText <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	DWORD dwCipherSize <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Encrypting</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">SimpleEncryption</span><span class="token punctuation">(</span>Data<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span><span class="token punctuation">,</span> pKey<span class="token punctuation">,</span> pIv<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pCipherText<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwCipherSize<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Print the encrypted buffer as a hex array</span>
	<span class="token function">PrintHexData</span><span class="token punctuation">(</span><span class="token string">"CipherText"</span><span class="token punctuation">,</span> pCipherText<span class="token punctuation">,</span> dwCipherSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Clean up</span>
	<span class="token function">HeapFree</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pCipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"PAUSE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p><img src="19_files/encryption-new-225952410-4a747a9a-ef94-479c-be3b-d6ae5e8de27.png" alt="image"></p>
<h4>Main Function - Decryption</h4>
<p>The main function below is used to perform the decryption routine. 
The decryption routine requires the decryption key, IV and ciphertext.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// the key printed to the screen</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> pKey<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token number">0x3E</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0xF4</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0xB6</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0xB8</span><span class="token punctuation">,</span> <span class="token number">0xF6</span><span class="token punctuation">,</span> <span class="token number">0x98</span><span class="token punctuation">,</span> <span class="token number">0x95</span><span class="token punctuation">,</span> <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0xC0</span><span class="token punctuation">,</span> <span class="token number">0x55</span><span class="token punctuation">,</span>
		<span class="token number">0xEB</span><span class="token punctuation">,</span> <span class="token number">0xDB</span><span class="token punctuation">,</span> <span class="token number">0xE1</span><span class="token punctuation">,</span> <span class="token number">0x7F</span><span class="token punctuation">,</span> <span class="token number">0x05</span><span class="token punctuation">,</span> <span class="token number">0xFE</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x6D</span><span class="token punctuation">,</span> <span class="token number">0x0F</span><span class="token punctuation">,</span> <span class="token number">0xA6</span><span class="token punctuation">,</span> <span class="token number">0x5B</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">,</span> <span class="token number">0xE6</span><span class="token punctuation">,</span> <span class="token number">0xD9</span><span class="token punctuation">,</span> <span class="token number">0x0B</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// the iv printed to the screen</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> pIv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token number">0xB4</span><span class="token punctuation">,</span> <span class="token number">0xC8</span><span class="token punctuation">,</span> <span class="token number">0x1D</span><span class="token punctuation">,</span> <span class="token number">0x1D</span><span class="token punctuation">,</span> <span class="token number">0x14</span><span class="token punctuation">,</span> <span class="token number">0x7C</span><span class="token punctuation">,</span> <span class="token number">0xCB</span><span class="token punctuation">,</span> <span class="token number">0xFA</span><span class="token punctuation">,</span> <span class="token number">0x07</span><span class="token punctuation">,</span> <span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0xD9</span><span class="token punctuation">,</span> <span class="token number">0xED</span><span class="token punctuation">,</span> <span class="token number">0x1A</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0xD9</span><span class="token punctuation">,</span> <span class="token number">0xCD</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">// the encrypted buffer printed to the screen, which is:</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> CipherText<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0xFC</span><span class="token punctuation">,</span> <span class="token number">0x24</span><span class="token punctuation">,</span> <span class="token number">0xFE</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x64</span><span class="token punctuation">,</span> <span class="token number">0xDF</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x81</span><span class="token punctuation">,</span> <span class="token number">0xD8</span><span class="token punctuation">,</span> <span class="token number">0xC1</span><span class="token punctuation">,</span> <span class="token number">0x9E</span><span class="token punctuation">,</span> <span class="token number">0x23</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0xA1</span><span class="token punctuation">,</span>
		<span class="token number">0xD3</span><span class="token punctuation">,</span> <span class="token number">0x97</span><span class="token punctuation">,</span> <span class="token number">0x5B</span><span class="token punctuation">,</span> <span class="token number">0xAE</span><span class="token punctuation">,</span> <span class="token number">0x29</span><span class="token punctuation">,</span> <span class="token number">0x7F</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0xB9</span><span class="token punctuation">,</span> <span class="token number">0xC1</span><span class="token punctuation">,</span> <span class="token number">0xEC</span><span class="token punctuation">,</span> <span class="token number">0x5A</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0xE3</span><span class="token punctuation">,</span> <span class="token number">0xA4</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span>
		<span class="token number">0xD6</span><span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0xFC</span><span class="token punctuation">,</span> <span class="token number">0xB5</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0x64</span><span class="token punctuation">,</span> <span class="token number">0x0F</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0xF9</span><span class="token punctuation">,</span> <span class="token number">0x49</span><span class="token punctuation">,</span> <span class="token number">0xB3</span><span class="token punctuation">,</span> <span class="token number">0x0B</span><span class="token punctuation">,</span> <span class="token number">0xCA</span><span class="token punctuation">,</span> <span class="token number">0x0C</span><span class="token punctuation">,</span> <span class="token number">0x04</span><span class="token punctuation">,</span>
		<span class="token number">0x17</span><span class="token punctuation">,</span> <span class="token number">0xDB</span><span class="token punctuation">,</span> <span class="token number">0xEF</span><span class="token punctuation">,</span> <span class="token number">0xB2</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0xC2</span><span class="token punctuation">,</span> <span class="token number">0x17</span><span class="token punctuation">,</span> <span class="token number">0xF6</span><span class="token punctuation">,</span> <span class="token number">0x34</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">,</span> <span class="token number">0xBA</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0x84</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0x5E</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// Defining two variables the output buffer and its respective size which will be used in SimpleDecryption</span>
	PVOID	pPlaintext  <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	DWORD	dwPlainSize <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token comment">// Decrypting</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">SimpleDecryption</span><span class="token punctuation">(</span>CipherText<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CipherText<span class="token punctuation">)</span><span class="token punctuation">,</span> pKey<span class="token punctuation">,</span> pIv<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pPlaintext<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwPlainSize<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// Printing the decrypted data to the screen in hex format</span>
	<span class="token function">PrintHexData</span><span class="token punctuation">(</span><span class="token string">"PlainText"</span><span class="token punctuation">,</span> pPlaintext<span class="token punctuation">,</span> dwPlainSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// this will print: "This is a plain text string, we'll try to encrypt/decrypt !"</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Data: %s \n"</span><span class="token punctuation">,</span> pPlaintext<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Clean up</span>
	<span class="token function">HeapFree</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pPlaintext<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"PAUSE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p><img src="19_files/encryption-new-225953480-03161b1a-119f-4c97-9b9e-11745047a21.png" alt="image"></p>
<h4>bCrypt Library Drawbacks</h4>
<p>One of the primary drawbacks of using the method outlined above to 
implement AES encryption is that the usage of the cryptographic WinAPIs 
results in them being visible in the binary's Import Address Table 
(IAT). Security solutions can detect the use of cryptographic functions 
by scanning the IAT, which can potentially indicate malicious behavior 
or raise suspicion. Hiding WinAPIs in the IAT is possible and will be 
discussed in a future module.</p>
<p>The image below shows the IAT of the binary using Windows APIs for AES encryption. The usage of the <code>bcrypt.dll</code> library and the cryptographic functions is clearly visible.</p>
<p><img src="19_files/iat-aes.png" alt="image"></p>
<h3>AES Using Tiny-AES Library</h3>
<p>This section makes use of the <a href="https://github.com/kokke/tiny-AES-c" target="_blank">tiny-AES-c</a>
 third-party encryption library that performs AES encryption without the
 use of WinAPIs. Tiny-AES-C is a small portable library that can perform
 AES128/192/256 in C.</p>
<h4>Setting Up Tiny-AES</h4>
<p>To begin using Tiny-AES there are two requirements:</p>
<ol>
<li>
<p>Include <code>aes.hpp</code> (C++) or include <code>aes.h</code> (C) in the project.</p>
</li>
<li>
<p>Add the <code>aes.c</code> file to the project.</p>
</li>
</ol>
<h4>Setting The AES256 Flag</h4>
<p>By default, the library applies the AES128 algorithm for encryption 
and decryption. However, one can set the library to use AES256 or AES192
 algorithms by enabling one of the <a href="https://github.com/kokke/tiny-AES-c/blob/master/aes.h#L27" target="_blank">AESXXX flags</a> located in the <code>aes.h</code> file and commenting the other flags accordingly. For example, enabling the <code>AES256</code> flag will force the library to use the AES256 algorithm, which is the algorithm used in this module. Therefore, the flags in <code>aes.h</code> should look like the following:</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">//#define AES128 1</span>
<span class="token comment">//#define AES192 1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">AES256</span> <span class="token expression"><span class="token number">1</span></span></span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4>Tiny-AES Library Drawbacks</h4>
<p>Before diving into the code it's important to be aware of the drawbacks of the tiny-AES library.</p>
<ol>
<li>
<p>The library does not support padding. All buffers must be multiples of 16 bytes.</p>
</li>
<li>
<p>The <a href="https://github.com/kokke/tiny-AES-c/blob/master/aes.c#L79" target="_blank">arrays</a>
 used in the library can be signatured by security solutions to detect 
the usage of Tiny-AES. These arrays are used to apply the AES algorithm 
and therefore are a requirement to have in the code. With that being 
said, there are ways to modify their signature in order to avoid 
security solutions detecting the usage of Tiny-AES. One possible 
solution is to XOR these arrays, for example, to decrypt them at runtime
 right before calling the initialization function, <code>AES_init_ctx_iv</code>.</p>
</li>
</ol>
<h4>Custom Padding Function</h4>
<p>The lack of padding support can be solved by creating a custom padding function as shown in the code snippet below.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">PaddBuffer</span><span class="token punctuation">(</span>IN PBYTE InputBuffer<span class="token punctuation">,</span> IN SIZE_T InputBufferSize<span class="token punctuation">,</span> OUT PBYTE<span class="token operator">*</span> OutputPaddedBuffer<span class="token punctuation">,</span> OUT SIZE_T<span class="token operator">*</span> OutputPaddedSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	PBYTE	PaddedBuffer        <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	SIZE_T	PaddedSize          <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token comment">// calculate the nearest number that is multiple of 16 and saving it to PaddedSize</span>
	PaddedSize <span class="token operator">=</span> InputBufferSize <span class="token operator">+</span> <span class="token number">16</span> <span class="token operator">-</span> <span class="token punctuation">(</span>InputBufferSize <span class="token operator">%</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// allocating buffer of size "PaddedSize"</span>
	PaddedBuffer <span class="token operator">=</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> PaddedSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>PaddedBuffer<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// cleaning the allocated buffer</span>
	<span class="token function">ZeroMemory</span><span class="token punctuation">(</span>PaddedBuffer<span class="token punctuation">,</span> PaddedSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// copying old buffer to new padded buffer</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>PaddedBuffer<span class="token punctuation">,</span> InputBuffer<span class="token punctuation">,</span> InputBufferSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//saving results :</span>
	<span class="token operator">*</span>OutputPaddedBuffer <span class="token operator">=</span> PaddedBuffer<span class="token punctuation">;</span>
	<span class="token operator">*</span>OutputPaddedSize   <span class="token operator">=</span> PaddedSize<span class="token punctuation">;</span>

	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4>Tiny-AES Encryption</h4>
<p>Similar to how the bCrypt library's encryption and decryption process
 was explained earlier in the module, the snippets below explain 
Tiny-AES's encryption and decryption process.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"aes.h"</span></span>

<span class="token comment">// "this is plaintext string, we'll try to encrypt... lets hope everything goes well :)" in hex</span>
<span class="token comment">// since the upper string is 82 byte in size, and 82 is not mulitple of 16, we cant encrypt this directly using tiny-aes</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span>
	<span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x78</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span>
	<span class="token number">0x2C</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x77</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span>
	<span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x6F</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x63</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x2E</span><span class="token punctuation">,</span> <span class="token number">0x2E</span><span class="token punctuation">,</span>
	<span class="token number">0x2E</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x73</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x6F</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span>
	<span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x79</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span>
	<span class="token number">0x6F</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x77</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x3A</span><span class="token punctuation">,</span> <span class="token number">0x29</span><span class="token punctuation">,</span> <span class="token number">0x00</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>



<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// struct needed for Tiny-AES library</span>
	<span class="token keyword">struct</span> <span class="token class-name">AES_ctx</span> ctx<span class="token punctuation">;</span>


	BYTE pKey<span class="token punctuation">[</span>KEYSIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>                             <span class="token comment">// KEYSIZE is 32 bytes</span>
	BYTE pIv<span class="token punctuation">[</span>IVSIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>                               <span class="token comment">// IVSIZE is 16 bytes</span>
		

	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                              <span class="token comment">// the seed to generate the key</span>
	<span class="token function">GenerateRandomBytes</span><span class="token punctuation">(</span>pKey<span class="token punctuation">,</span> KEYSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// generating the key bytes</span>
	
	<span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">^</span> pKey<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// The seed to generate the IV. Use the first byte of the key to add more randomness.</span>
	<span class="token function">GenerateRandomBytes</span><span class="token punctuation">(</span>pIv<span class="token punctuation">,</span> IVSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// Generating the IV</span>

	<span class="token comment">// Prints both key and IV to the console</span>
	<span class="token function">PrintHexData</span><span class="token punctuation">(</span><span class="token string">"pKey"</span><span class="token punctuation">,</span> pKey<span class="token punctuation">,</span> KEYSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">PrintHexData</span><span class="token punctuation">(</span><span class="token string">"pIv"</span><span class="token punctuation">,</span> pIv<span class="token punctuation">,</span> IVSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Initializing the Tiny-AES Library</span>
	<span class="token function">AES_init_ctx_iv</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ctx<span class="token punctuation">,</span> pKey<span class="token punctuation">,</span> pIv<span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token comment">// Initializing variables that will hold the new buffer base address in the case where padding is required and its size</span>
	PBYTE	PaddedBuffer        <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	SIZE_T	PAddedSize          <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token comment">// Padding the buffer, if required</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">16</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">PaddBuffer</span><span class="token punctuation">(</span>Data<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>PaddedBuffer<span class="token punctuation">,</span> <span class="token operator">&amp;</span>PAddedSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Encrypting the padded buffer instead</span>
		<span class="token function">AES_CBC_encrypt_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ctx<span class="token punctuation">,</span> PaddedBuffer<span class="token punctuation">,</span> PAddedSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Printing the encrypted buffer to the console</span>
		<span class="token function">PrintHexData</span><span class="token punctuation">(</span><span class="token string">"CipherText"</span><span class="token punctuation">,</span> PaddedBuffer<span class="token punctuation">,</span> PAddedSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// No padding is required, encrypt 'Data' directly</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">AES_CBC_encrypt_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ctx<span class="token punctuation">,</span> Data<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Printing the encrypted buffer to the console</span>
		<span class="token function">PrintHexData</span><span class="token punctuation">(</span><span class="token string">"CipherText"</span><span class="token punctuation">,</span> Data<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// Freeing PaddedBuffer, if necessary</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>PaddedBuffer <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">HeapFree</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> PaddedBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"PAUSE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4>Tiny-AES Decryption</h4>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"aes.h"</span></span>

<span class="token comment">// Key</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> pKey<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0xB8</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x7E</span><span class="token punctuation">,</span> <span class="token number">0xF0</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0xD6</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x2D</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x0C</span><span class="token punctuation">,</span> <span class="token number">0x6A</span><span class="token punctuation">,</span> <span class="token number">0xA2</span><span class="token punctuation">,</span> <span class="token number">0x34</span><span class="token punctuation">,</span>
		<span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0x7A</span><span class="token punctuation">,</span> <span class="token number">0x9D</span><span class="token punctuation">,</span> <span class="token number">0x06</span><span class="token punctuation">,</span> <span class="token number">0xC5</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0x7D</span><span class="token punctuation">,</span> <span class="token number">0x5F</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0xA9</span><span class="token punctuation">,</span> <span class="token number">0x32</span><span class="token punctuation">,</span> <span class="token number">0x9B</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// IV</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> pIv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0xB8</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x7E</span><span class="token punctuation">,</span> <span class="token number">0xF0</span><span class="token punctuation">,</span> <span class="token number">0x09</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0xD6</span><span class="token punctuation">,</span> <span class="token number">0x6E</span><span class="token punctuation">,</span> <span class="token number">0x2D</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x0C</span><span class="token punctuation">,</span> <span class="token number">0x6A</span><span class="token punctuation">,</span> <span class="token number">0xA2</span><span class="token punctuation">,</span> <span class="token number">0x34</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Encrypted data, multiples of 16 bytes</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> CipherText<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		<span class="token number">0xB9</span><span class="token punctuation">,</span> <span class="token number">0x49</span><span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">0xFC</span><span class="token punctuation">,</span> <span class="token number">0xAD</span><span class="token punctuation">,</span> <span class="token number">0x15</span><span class="token punctuation">,</span> <span class="token number">0xDA</span><span class="token punctuation">,</span> <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0xA2</span><span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0xD4</span><span class="token punctuation">,</span> <span class="token number">0x77</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0xBB</span><span class="token punctuation">,</span> <span class="token number">0x4E</span><span class="token punctuation">,</span>
		<span class="token number">0xDA</span><span class="token punctuation">,</span> <span class="token number">0xE5</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x71</span><span class="token punctuation">,</span> <span class="token number">0x2F</span><span class="token punctuation">,</span> <span class="token number">0xF4</span><span class="token punctuation">,</span> <span class="token number">0x69</span><span class="token punctuation">,</span> <span class="token number">0x2D</span><span class="token punctuation">,</span> <span class="token number">0x9C</span><span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0x8D</span><span class="token punctuation">,</span> <span class="token number">0xD0</span><span class="token punctuation">,</span> <span class="token number">0xA3</span><span class="token punctuation">,</span> <span class="token number">0x0E</span><span class="token punctuation">,</span> <span class="token number">0xB7</span><span class="token punctuation">,</span> <span class="token number">0x26</span><span class="token punctuation">,</span>
		<span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0xE4</span><span class="token punctuation">,</span> <span class="token number">0xA4</span><span class="token punctuation">,</span> <span class="token number">0xAD</span><span class="token punctuation">,</span> <span class="token number">0xB3</span><span class="token punctuation">,</span> <span class="token number">0x05</span><span class="token punctuation">,</span> <span class="token number">0xD9</span><span class="token punctuation">,</span> <span class="token number">0x13</span><span class="token punctuation">,</span> <span class="token number">0x8D</span><span class="token punctuation">,</span> <span class="token number">0x2B</span><span class="token punctuation">,</span> <span class="token number">0x0E</span><span class="token punctuation">,</span> <span class="token number">0x0C</span><span class="token punctuation">,</span> <span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xD1</span><span class="token punctuation">,</span> <span class="token number">0xC4</span><span class="token punctuation">,</span>
		<span class="token number">0xC1</span><span class="token punctuation">,</span> <span class="token number">0x5A</span><span class="token punctuation">,</span> <span class="token number">0x5F</span><span class="token punctuation">,</span> <span class="token number">0x64</span><span class="token punctuation">,</span> <span class="token number">0xDA</span><span class="token punctuation">,</span> <span class="token number">0x1B</span><span class="token punctuation">,</span> <span class="token number">0xB4</span><span class="token punctuation">,</span> <span class="token number">0x7A</span><span class="token punctuation">,</span> <span class="token number">0x7E</span><span class="token punctuation">,</span> <span class="token number">0x6B</span><span class="token punctuation">,</span> <span class="token number">0xE6</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x17</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x4E</span><span class="token punctuation">,</span>
		<span class="token number">0xA6</span><span class="token punctuation">,</span> <span class="token number">0x0A</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0xB8</span><span class="token punctuation">,</span> <span class="token number">0xBB</span><span class="token punctuation">,</span> <span class="token number">0x1E</span><span class="token punctuation">,</span> <span class="token number">0x27</span><span class="token punctuation">,</span> <span class="token number">0x6A</span><span class="token punctuation">,</span> <span class="token number">0x29</span><span class="token punctuation">,</span> <span class="token number">0xE4</span><span class="token punctuation">,</span> <span class="token number">0x5A</span><span class="token punctuation">,</span> <span class="token number">0xA5</span><span class="token punctuation">,</span> <span class="token number">0x4A</span><span class="token punctuation">,</span> <span class="token number">0x4C</span><span class="token punctuation">,</span> <span class="token number">0xB0</span><span class="token punctuation">,</span> <span class="token number">0xA3</span><span class="token punctuation">,</span>
		<span class="token number">0x7D</span><span class="token punctuation">,</span> <span class="token number">0x7A</span><span class="token punctuation">,</span> <span class="token number">0x4E</span><span class="token punctuation">,</span> <span class="token number">0x6D</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x86</span><span class="token punctuation">,</span> <span class="token number">0xEB</span><span class="token punctuation">,</span> <span class="token number">0xB2</span><span class="token punctuation">,</span> <span class="token number">0xFD</span><span class="token punctuation">,</span> <span class="token number">0x1B</span><span class="token punctuation">,</span> <span class="token number">0x21</span><span class="token punctuation">,</span> <span class="token number">0x89</span><span class="token punctuation">,</span> <span class="token number">0xB0</span><span class="token punctuation">,</span> <span class="token number">0x83</span><span class="token punctuation">,</span> <span class="token number">0x14</span><span class="token punctuation">,</span> <span class="token number">0xFE</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>



<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// Struct needed for Tiny-AES library</span>
	<span class="token keyword">struct</span> <span class="token class-name">AES_ctx</span> ctx<span class="token punctuation">;</span>
	<span class="token comment">// Initializing the Tiny-AES Library</span>
	<span class="token function">AES_init_ctx_iv</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ctx<span class="token punctuation">,</span> pKey<span class="token punctuation">,</span> pIv<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Decrypting</span>
	<span class="token function">AES_CBC_decrypt_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ctx<span class="token punctuation">,</span> CipherText<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CipherText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
	<span class="token comment">// Print the decrypted buffer to the console</span>
	<span class="token function">PrintHexData</span><span class="token punctuation">(</span><span class="token string">"PlainText"</span><span class="token punctuation">,</span> CipherText<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CipherText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Print the string</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Data: %s \n"</span><span class="token punctuation">,</span> CipherText<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// exit</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"PAUSE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h3>Tiny-AES IAT</h3>
<p>The image below shows a binary's IAT which uses Tiny-AES to perform 
encryption instead of WinAPIs. No cryptographic functions are visible in
 the IAT of the binary.</p>
<p><img src="19_files/iat-no-winapis.png" alt="image"></p>
<h3>Conclusion</h3>
<p>This module explained the basics of AES and provided two working AES 
implementations. One should also have an idea of how security solutions 
will detect the usage of encryption libraries.</p>

            
                
                                
            </div></div>
            <div id="accessory-container" class="hidden flex flex-col w-1/4 min-w-1/4 h-full">
                <div id="objectives" class="hidden p-4 border-r border-b bg-gray-900 border-gray-600 font-code w-full h-1/2">
                    <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">Objectives</div>
                                                                        
                                                                        
            <div class="flex items-center mb-2 font-sans">
                                <input type="checkbox" id="objective-0" data-objective-id="0" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Understand how AES encryption works</label>
                            </div>
                                                                        
                                                                        
                    <div class="flex items-center mb-2 font-sans">
                                <input type="checkbox" id="objective-1" data-objective-id="1" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Review the provided code</label>
                            </div>
                                                                        
                                                                        
                    <div class="flex items-center mb-2 font-sans">
                                <input type="checkbox" id="objective-2" data-objective-id="2" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Compile and run the code to encrypt and decrypt your shellcode</label>
                            </div>
                                                                        
                                                                        
                    <div class="flex items-center mb-2 font-sans">
                                <input type="checkbox" id="objective-3" data-objective-id="3" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Use Windows APIs to perform AES encryption on your shellcode</label>
                            </div>
                                                                        
                                                                        
                    <div class="flex items-center mb-2 font-sans">
                                <input type="checkbox" id="objective-4" data-objective-id="4" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Use Tiny-AES library to perform AES encryption on your shellcode</label>
                            </div>
                                                                                  
                </div>
                <div id="ide" class="hidden p-4 border-r border-b border-gray-600 font-code w-full h-1/2">
                    <textarea class="bg-gray-900 outline-0 w-full h-full resize-none font-sans" placeholder="Write temporary notes or code here"></textarea>
                </div>
            </div>
            <div id="progress-container" class="hidden flex flex-col w-1/4 min-w-1/4">
                <div id="progress" class="p-4 border-r overflow-auto border-b border-gray-600 font-code w-full min-h-full">
                <div class="max-h-[300px]">
                                        <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">Modules Progress</div>
                                                                                    <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-1" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                            <a data-target="_self" href="./1.html">
                                <div for="module-1" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 1 - Welcome Module
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-2" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./2.html">
                                <div for="module-2" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 2 - Introduction To Malware Development
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-3" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./3.html">
                                <div for="module-3" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 3 - Required Tools
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-4" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./4.html">
                                <div for="module-4" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 4 - Coding Basics
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-5" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./5.html">
                                <div for="module-5" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 5 - Windows Architecture
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-6" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./6.html">
                                <div for="module-6" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 6 - Windows Memory Management
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-7" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./7.html">
                                <div for="module-7" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 7 - Introduction To The Windows API
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-8" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./8.html">
                                <div for="module-8" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 8 - Portable Executable Format
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-9" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./9.html">
                                <div for="module-9" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 9 - Dynamic-Link Library
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-10" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./10.html">
                                <div for="module-10" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 10 - Detection Mechanisms
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-11" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./11.html">
                                <div for="module-11" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 11 - Windows Processes
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-12" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./12.html">
                                <div for="module-12" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 12 - Undocumented Structures
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-13" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./13.html">
                                <div for="module-13" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 13 - Payload Placement - .data &amp; .rdata Sections
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-14" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./14.html">
                                <div for="module-14" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 14 - Payload Placement - .text Section
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-15" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./15.html">
                                <div for="module-15" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 15 - Payload Placement - .rsrc Section
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-16" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./16.html">
                                <div for="module-16" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 16 - Introduction To Payload Encryption
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-17" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./17.html">
                                <div for="module-17" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 17 - Payload Encryption - XOR
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-18" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./18.html">
                                <div for="module-18" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 18 - Payload Encryption - RC4
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-19" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./19.html">
                                <div for="module-19" class="ml-2 text-sm font-medium 
                                            bg-blue-700 font-bold rounded-sm">
                                    Module 19 - Payload Encryption - AES Encryption
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-20" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./20.html">
                                <div for="module-20" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 20 - Evading Microsoft Defender Static Analysis
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-21" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./21.html">
                                <div for="module-21" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 21 - Payload Obfuscation - IPv4/IPv6Fuscation
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-22" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./22.html">
                                <div for="module-22" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 22 - Payload Obfuscation - MACFuscation
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-23" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./23.html">
                                <div for="module-23" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 23 - Payload Obfuscation - UUIDFuscation
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-24" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./24.html">
                                <div for="module-24" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 24 - Maldev Academy Tool - HellShell
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-25" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./25.html">
                                <div for="module-25" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 25 - Maldev Academy Tool - MiniShell
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-26" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./26.html">
                                <div for="module-26" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 26 - Local Payload Execution - DLL
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-27" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./27.html">
                                <div for="module-27" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 27 - Local Payload Execution - Shellcode
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-28" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./28.html">
                                <div for="module-28" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 28 - Process Injection - DLL Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-29" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./29.html">
                                <div for="module-29" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 29 - Process Injection - Shellcode Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-30" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./30.html">
                                <div for="module-30" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 30 - Payload Staging - Web Server
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-31" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./31.html">
                                <div for="module-31" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 31 - Payload Staging - Windows Registry
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-32" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./32.html">
                                <div for="module-32" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 32 - Malware Binary Signing
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-33" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./33.html">
                                <div for="module-33" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 33 - Process Enumeration - EnumProcesses
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-34" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./34.html">
                                <div for="module-34" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 34 - Process Enumeration - NtQuerySystemInformation
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-35" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./35.html">
                                <div for="module-35" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 35 - Thread Hijacking - Local Thread Creation
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-36" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./36.html">
                                <div for="module-36" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 36 - Thread Hijacking - Remote Thread Creation
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-37" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./37.html">
                                <div for="module-37" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 37 - Thread Hijacking - Local Thread Enumeration
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-38" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./38.html">
                                <div for="module-38" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 38 - Thread Hijacking - Remote Thread Enumeration
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-39" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./39.html">
                                <div for="module-39" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 39 - APC Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-40" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./40.html">
                                <div for="module-40" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 40 - Early Bird APC Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-41" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./41.html">
                                <div for="module-41" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 41 - Callback Code Execution
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-42" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./42.html">
                                <div for="module-42" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 42 - Local Mapping Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-43" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./43.html">
                                <div for="module-43" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 43 - Remote Mapping Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-44" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./44.html">
                                <div for="module-44" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 44 - Local Function Stomping Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-45" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./45.html">
                                <div for="module-45" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 45 - Remote Function Stomping Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-46" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./46.html">
                                <div for="module-46" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 46 - Payload Execution Control
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-47" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./47.html">
                                <div for="module-47" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 47 - Spoofing PPID
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-48" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./48.html">
                                <div for="module-48" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 48 - Process Argument Spoofing (1)
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-49" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./49.html">
                                <div for="module-49" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 49 - Process Argument Spoofing (2)
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-50" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./50.html">
                                <div for="module-50" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 50 - Parsing PE Headers
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-51" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./51.html">
                                <div for="module-51" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 51 - String Hashing
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-52" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./52.html">
                                <div for="module-52" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 52 - IAT Hiding &amp; Obfuscation - Introduction
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-53" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./53.html">
                                <div for="module-53" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 53 - IAT Hiding &amp; Obfuscation - Custom GetProcAddress
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-54" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./54.html">
                                <div for="module-54" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 54 - IAT Hiding &amp; Obfuscation - Custom GetModuleHandle
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-55" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./55.html">
                                <div for="module-55" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 55 - IAT Hiding &amp; Obfuscation - API Hashing
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-56" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./56.html">
                                <div for="module-56" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 56 - IAT Hiding &amp; Obfuscation - Custom Pseudo Handles
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-57" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./57.html">
                                <div for="module-57" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 57 - IAT Hiding &amp; Obfuscation - Compile Time API Hashing
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-58" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./58.html">
                                <div for="module-58" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 58 - API Hooking - Introduction
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-59" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./59.html">
                                <div for="module-59" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 59 - API Hooking - Detours Library
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-60" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./60.html">
                                <div for="module-60" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 60 - API Hooking - Minhook Library
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-61" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./61.html">
                                <div for="module-61" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 61 - API Hooking - Custom Code
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-62" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./62.html">
                                <div for="module-62" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 62 - API Hooking - Using Windows APIs
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-63" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./63.html">
                                <div for="module-63" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 63 - Syscalls - Introduction
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-64" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./64.html">
                                <div for="module-64" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 64 - Syscalls - Userland Hooking
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-65" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./65.html">
                                <div for="module-65" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 65 - Syscalls - SysWhispers
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-66" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./66.html">
                                <div for="module-66" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 66 - Syscalls - Hell's Gate
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-67" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./67.html">
                                <div for="module-67" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 67 - Syscalls - Reimplementing Classic Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-68" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./68.html">
                                <div for="module-68" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 68 - Syscalls - Reimplementing Mapping Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-69" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./69.html">
                                <div for="module-69" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 69 - Syscalls - Reimplementing APC Injection
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-70" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./70.html">
                                <div for="module-70" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 70 - Anti-Analysis - Introduction
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-71" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./71.html">
                                <div for="module-71" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 71 - Anti-Debugging - Multiple Techniques
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-72" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./72.html">
                                <div for="module-72" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 72 - Anti-Debugging - Self-Deletion
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-73" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./73.html">
                                <div for="module-73" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 73 - Anti-Virtual Environments - Multiple Techniques
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-74" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./74.html">
                                <div for="module-74" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 74 - Anti-Virtual Environments - Multiple Delay Execution Techniques
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-75" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./75.html">
                                <div for="module-75" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 75 - Anti-Virtual Environments - API Hammering
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-76" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./76.html">
                                <div for="module-76" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 76 - Binary Entropy Reduction
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-77" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./77.html">
                                <div for="module-77" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 77 - Brute Force Decryption
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-78" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./78.html">
                                <div for="module-78" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 78 - MalDev Academy Tool - KeyGuard
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-79" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./79.html">
                                <div for="module-79" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 79 - CRT Library Removal &amp; Malware Compiling
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-80" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./80.html">
                                <div for="module-80" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 80 - IAT Camouflage
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-81" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./81.html">
                                <div for="module-81" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 81 - Bypassing AVs
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-82" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./82.html">
                                <div for="module-82" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 82 - Introduction To EDRs
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-83" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./83.html">
                                <div for="module-83" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 83 - NTDLL Unhooking - Introduction
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-84" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./84.html">
                                <div for="module-84" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 84 - NTDLL Unhooking - From Disk
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-85" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./85.html">
                                <div for="module-85" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 85 - NTDLL Unhooking - From KnownDlls Directory
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-86" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./86.html">
                                <div for="module-86" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 86 - NTDLL Unhooking - From a Suspended Process
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-87" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./87.html">
                                <div for="module-87" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 87 - NTDLL Unhooking - From a Web Server
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-88" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./88.html">
                                <div for="module-88" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 88 - Updating Hell's Gate
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-89" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./89.html">
                                <div for="module-89" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 89 - Indirect Syscalls - HellsHall
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-90" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./90.html">
                                <div for="module-90" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 90 - Block DLL Policy
                                </div>
                            </a>
                        </div>
                                                                                <div class="flex items-center mb-2 font-sans">
                            <input type="checkbox" id="module-91" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                            <a data-target="_self" href="./91.html">
                                <div for="module-91" class="ml-2 text-sm font-medium 
                                            text-gray-900 dark:text-gray-300">
                                    Module 91 - Diving Into NtCreateUserProcess
                                </div>
                            </a>
                        </div>
                                                    </div>
                </div>
            </div>
        </div>
      </div>
      <div class="flex">
        <div class="flex flex-row flex-wrap justify-center items-center w-full bg-gray-700 border-r border-l border-gray-600 pl-4 pt-2 pb-2 rounded-bl rounded-br">
                        <div class="mr-2">
                <a data-target="_self" href="./18.html">
                    <button class="w-[100px] h-10 px-5 text-sm duration-150 text-white bg-blue-700 hover:bg-blue-800 rounded-lg focus:shadow-outline">Previous</button>
                </a>           
            </div>
                        <div class="mr-2">
                <a data-target="_self" href="../All Modules.html">
                    <button class="w-[100px] h-10 px-5 text-sm duration-150 text-white bg-blue-700 hover:bg-blue-800 rounded-lg focus:shadow-outline">Modules</button>
                </a>           
            </div>
                     
            <div class="my-2 mr-2">
            <form id="complete-module" action="./19/complete" method="POST">
            </form>
            <form id="uncomplete-module" action="./19#" method="POST">
            </form>
            </div>
           
                            <div class="mr-2">
                    <a data-target="_self" href="./20.html">
                        <button class="w-[100px] h-10 px-5 text-sm duration-150 text-white bg-blue-700 hover:bg-blue-800 rounded-lg focus:shadow-outline">Next</button>
                    </a>
                </div>
                    </div>
    </div>
    <input type="hidden" id="objectives-completed" value="17077">
</div>

<footer id="footer" class="text-gray-400 border-t-[1px] border-gray-700 bg-gray-900 body-font hidden">
    <div class="container px-5 py-8 mx-auto flex items-center sm:flex-row flex-col">
      <p class="text-sm text-gray-400 sm:ml-4 sm:pl-4 sm:border-gray-800 sm:py-2 sm:mt-0 mt-4"> 2025 Maldev Academy Inc.</p>
        <a href="https://twitter.com/maldevacademy" target="_blank" class="text-gray-500 hover:text-white ml-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 1200 1227" xmlns="http://www.w3.org/2000/svg">
            <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z" fill="white"></path>
          </svg>            
        </a>
      <span class="inline-flex sm:ml-auto sm:mt-0 mt-4 justify-center sm:justify-start">
        <a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos" target="_blank">
          Terms and Conditions
      </a></span><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos" target="_blank">
    </a></div><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos" target="_blank">
  </a></footer><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos" target="_blank">        

        <script src="19_files/jquery-3.6.0.min.js"></script>
        <script src="19_files/bootstrap.min.js"></script>
        <script src="19_files/navbar.js"></script>
        <link rel="preload" as="style" href="19_files/app.12640c20.css"><link rel="modulepreload" href="19_files/app.2a52064d.js"><link rel="stylesheet" href="19_files/app.12640c20.css"><script type="module" src="19_files/app.2a52064d.js"></script>
<script src="19_files/moduleviewer.js"></script>

    
</a></body></html>